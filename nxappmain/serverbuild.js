//>>built
require({cache:{"xide/types":function(){define(["dcl/dcl"],function(p){return p(null,{declaredClass:"xide/types"})})},"dcl/dcl":function(){(function(p){"undefined"!=typeof define?define(["./mini"],p):"undefined"!=typeof module?module.exports=p(require("./mini")):dcl=p(dcl)})(function(p){function n(){}function m(f,a,c){var e=f||n,g=a||n,d=c||n,b=function(){var b,q;e.apply(this,arguments);try{b=d.apply(this,arguments)}catch(a){b=a,q=!0}g.call(this,arguments,b);if(q)throw b;return b};b.advices={before:f,
after:a,around:c};return b}function k(f){return function(a,c){var e=a._meta,g;e&&((g=+e.weaver[c]||0)&&g!=f&&p._error("set chaining",c,a,f,g),e.weaver[c]=f)}}var h=p(p.Super,{constructor:function(){this.before=this.around.before;this.after=this.around.after;this.around=this.around.around}});p.mix(p,{Advice:h,advise:function(f){return p._makeSuper(f,h)},before:function(f){return p.advise({before:f})},after:function(f){return p.advise({after:f})},around:p.superCall,chainBefore:k(1),chainAfter:k(2),
isInstanceOf:function(f,a){if(f instanceof a)return!0;var c=f.constructor._meta,e;if(c)for(c=c.bases,e=c.length-1;0<=e;--e)if(c[e]===a)return!0;return!1},_stub:function(f,a,c,e){e=e[c]=p._extractChain(a,c,"around");var g=p._extractChain(a,c,"before").reverse();a=p._extractChain(a,c,"after");e=f?p._stubChainSuper(e,1==f?function(d){return p._stubChain(d.reverse())}:p._stubChain,c):p._stubSuper(e,c);return g.length||a.length?m(p._stubChain(g),p._stubChain(a),e):e||function(){}}});return p})},"dcl/mini":function(){(function(p){"undefined"!=
typeof define?define([],p):"undefined"!=typeof module?module.exports=p():dcl=p()})(function(){function p(c,e){var g=[0],d,b,l,q,f,t,h,n,v=0,u;if(c)if(c instanceof Array){f={};h=c.slice(0).reverse();for(n=h.length-1;0<=n;--n)if(b=h[n],b._uniqueId=b._uniqueId||k++,d=b._meta){t=d.bases;for(v=t.length-1;0<v;--v)u=t[v]._uniqueId,f[u]=(f[u]||0)+1;h[n]=t.slice(0)}else h[n]=[b];d={};a:for(;h.length;){for(n=0;n<h.length;++n)if(t=h[n],b=t[0],u=b._uniqueId,!f[u]){d[u]||(g.push(b),d[u]=1);t.shift();t.length?
--f[t[0]._uniqueId]:h.splice(n,1);continue a}p._error("cycle",e,h)}c=c[0];v=g.length-((q=c._meta)&&c===g[g.length-(v=q.bases.length)]?v:1)-1}else c._uniqueId=c._uniqueId||k++,g=g.concat((q=c._meta)?q.bases:c);d=c?p.delegate(c.prototype):{};for(t=c&&(q=c._meta)?p.delegate(q.weaver):{constructor:2};0<v;--v)if(b=g[v],q=b._meta,p.mix(d,q&&q.ownProps||b.prototype),q)for(u in h=q.weaver)t[u]=(+t[u]||0)|h[u];for(u in e)m(q=e[u])?t[u]=+t[u]||0:d[u]=q;q={bases:g,ownProps:e,weaver:t,chains:{}};g[0]={_meta:q,
prototype:d};b=d;f=q.weaver;t=q.bases;h=q.chains;for(l in f)b[l]=p._stub(f[l],t,l,h);l=d.constructor;l._meta=q;l.prototype=d;g[0]=l;g=p._postprocess(l);e.declaredClass&&(a[e.declaredClass]=g);return g}function n(a){this.around=a}function m(a){return a&&a.spr instanceof n}var k=0,h={},f,a={};(f=function(a,e){for(var g in e)a[g]=e[g]})(p,{mix:f,delegate:function(a){return Object.create(a)},allKeys:function(a){var e=[],g;for(g in a)e.push(g);return e},Super:n,superCall:function(a){return p._makeSuper(a)},
_makeSuper:function(a,e){var g=function(){};g.spr=new (e||n)(a);return g},_postprocess:function(a){return a},_error:function(a){throw Error("dcl: "+a);},_instantiate:function(a,e,g){e=a.spr.around(e);e.ctr=a.ctr;return e},_extractChain:function(a,e,g){for(var d=a.length-1,b=[],l,q,f="around"==g;l=a[d];--d)if((q=l._meta)?(q=q.ownProps).hasOwnProperty(e)&&(m(q=q[e])?f?q.spr.around:q=q.spr[g]:f):f&&(q="constructor"==e?l:l.prototype[e])&&q!==h[e])"function"==typeof q?(q.ctr=l,b.push(q)):p._error("wrong super",
l,e);return b},_stubChain:function(a){var e=a.length,g;return e?1==e?(g=a[0],function(){g.apply(this,arguments)}):function(){for(var d=0;d<e;++d)a[d].apply(this,arguments)}:0},_stubSuper:function(a,e){for(var g=0,d,b=h[e];d=a[g];++g)b=m(d)?a[g]=p._instantiate(d,b,e):d;return"constructor"!=e?b:function(){b.apply(this,arguments)}},_stubChainSuper:function(a,e,g){for(var d=0,b,l,q=0;b=a[d];++d)m(b)&&(l=d-q,a[d]=p._instantiate(b,l?1==l?a[q]:e(a.slice(q,d)):0,g),q=d);return(l=d-q)?1==l&&"constructor"!=
g?a[q]:e(q?a.slice(q):a):0},_stub:function(a,e,g,d){e=d[g]=p._extractChain(e,g,"around");return(a?p._stubChainSuper(e,p._stubChain,g):p._stubSuper(e,g))||function(){}}});p.getObject=function(c){return a[c]};return p})},"xide/types/Types":function(){define(["dojo/_base/lang","xide/types","dojo/_base/json","dojo/_base/kernel"],function(p,n,m,k){null==n.customTypes&&(n.customTypes={});null==n.customEnumerations&&(n.customEnumerations={});null==n.widgetMappings&&(n.widgetMappings={});null==n.customMimeIcons&&
(n.customMimeIcons={});n.registerCustomMimeIconExtension=function(h,f){n.customMimeIcons[h]=f};n.resolveType=function(h){return n.customTypes[h]?n.customTypes[h]:null};n.registerType=function(h,f){n.customTypes[h]=f};n.registerWidgetMapping=function(h,f){n.widgetMappings[h]=f};n.registerEnumeration=function(h,f){n.customEnumerations[h]=f};n.resolveEnumeration=function(h){return n.customEnumerations[h]?n.customEnumerations[h]:null};n.resolveWidgetMapping=function(h){return n.widgetMappings[h]?n.widgetMappings[h]:
null};n.GRID_FEATURE={KEYBOARD_NAVIGATION:"KEYBOARD_NAVIGATION",KEYBOARD_SELECT:"KEYBOARD_SELECT",SELECTION:"SELECTION",ACTIONS:"ACTIONS",CONTEXT_MENU:"CONTEXT_MENU"};n.VIEW_FEATURE={KEYBOARD_NAVIGATION:"KEYBOARD_NAVIGATION",KEYBOARD_SELECT:"KEYBOARD_SELECT",SELECTION:"SELECTION",ACTIONS:"ACTIONS",CONTEXT_MENU:"CONTEXT_MENU"};n.ACTION={LAYOUT:"View/Layout",COLUMNS:"View/Columns",SELECTION:"File/Select",CLIPBOARD:"Edit/Clipboard",UNDO:"Edit/Undo",REDO:"Edit/Redo",CLIPBOARD_COPY:"Edit/Clipboard/Copy",
CLIPBOARD_PASTE:"Edit/Clipboard/Paste",CLIPBOARD_CUT:"Edit/Clipboard/Cut",COPY:"File/Copy",MOVE:"File/Move",RENAME:"File/Rename",DELETE:"File/Delete",OPEN:"File/Open",EDIT:"File/Edit",SAVE:"File/Save",SEARCH:"File/Search",TOOLBAR:"View/Show/Toolbar",STATUSBAR:"View/Show/Statusbar",BREADCRUMB:"View/Show/Breadcrumb",HEADER:"View/Show/Header",DOWNLOAD:"File/Download",DOWNLOAD_TO:"File/downloadTo",INFO:"File/Info",COMPRESS:"File/Compress",RELOAD:"File/Reload",UPLOAD:"File/Upload",PREVIEW:"File/Preview",
OPEN_IN:"File/Open In",INSERT_IMAGE:"insertImage",COPY_PASTE:"copypaste",DND:"dnd",OPTIONS:"options",NEW_FILE:"File/New/New File",NEW_DIRECTORY:"File/New/New Folder",GET_CONTENT:"get",SET_CONTENT:"set",FIND:"File/Find",CUSTOM:"custom",PERMA_LINK:"permaLink",ADD_MOUNT:"ADD_MOUNT",REMOVE_MOUNT:"REMOVE_MOUNT",EDIT_MOUNT:"EDIT_MOUNT",PERSPECTIVE:"PERSPECTIVE",RUN:"File/Run",GO_UP:"Navigation/Go Up",STOP:"File/Stop",CLOSE:"View/Close",FULLSCREEN:"View/Fullscreen",OPEN_IN_TAB:"File/OpenInNewTab",SOURCE:"Navigation/Source",
RIBBON:"View/Show/Ribbon",MAIN_MENU:"View/Show/MainMenu",NAVIGATION:"View/Show/Navigation",BASH_CONSOLE:"File/Console/Bash",JS_CONSOLE:"File/Console/JS",PHP_CONSOLE:"File/Console/PHP",CONSOLE:"File/Console/PHP",SIZE_STATS:"View/Show/SizeStats",WELCOME:"Window/Welcome"};n.ACTION_TYPE={MULTI_TOGGLE:"multiToggle",SINGLE_TOGGLE:"singleToggle"};n.ACTION_ICON={CLIPBOARD_COPY:"fa-copy",CLIPBOARD_PASTE:"fa-paste",UPLOAD:"fa-upload",RENAME:"el-icon-edit",DELETE:"text-danger fa-remove",RELOAD:"fa-refresh",
EDIT:"fa-pencil",SAVE:"fa-floppy-o",SEARCH:"fa-search",NEW_DIRECTORY:"fa-magic",NEW_FILE:"fa-magic",RUN:"text-success el-icon-play",COMPRESS:"fa-file-archive-o",EXTRACT:"fa-folder-open",DOWNLOAD:"fa-download",GO_UP:"fa-level-up",TOOLBAR:"fa-bars",STATUSBAR:"fa-terminal",PREVIEW:"fa-eye",MAXIMIZE:"fa-arrows-alt",UNDO:"fa-undo",REDO:"fa-repeat"};n.KEYBOARD_PROFILE={DEFAULT:{prevent_default:!0,prevent_repeat:!1},PASS_THROUGH:{prevent_default:!1,prevent_repeat:!1},SEQUENCE:{prevent_default:!0,is_sequence:!0,
prevent_repeat:!0}};n.ECIType={BOOL:0,BOX:1,COLOUR:2,ENUMERATION:3,FILE:4,FLAGS:5,FLOAT:6,INTEGER:7,MATRIX:8,OBJECT:9,REFERENCE:10,QUATERNION:11,RECTANGLE:12,STRING:13,VECTOR:14,VECTOR2D:15,VECTOR4D:16,ICON:17,IMAGE:18,BANNER:19,LOGO:20,STRUCTURE:21,BANNER2:22,ICON_SET:23,SCRIPT:24,EXPRESSION:25,RICHTEXT:26,ARGUMENT:27,JSON_DATA:28,EXPRESSION_EDITOR:29,WIDGET_REFERENCE:30,DOM_PROPERTIES:31,BLOCK_REFERENCE:32,BLOCK_SETTINGS:33,FILE_EDITOR:34,END:35,UNKNOWN:-1};n.ITEM_TYPE={FILE:"BTFILE",WIDGET:"WIDGET",
BLOCK:"BLOCK",TEXT:"TEXT"};n.EXPRESSION_PARSER||(n.EXPRESSION_PARSER={});n.COMPONENT_NAMES={XIDEVE:"xideve",XNODE:"xnode",XBLOX:"xblox",XFILE:"xfile"};n.WIDGET_REFERENCE_MODE={BY_ID:"byid",BY_CLASS:"byclass",BY_CSS:"bycss",BY_EXPRESSION:"expression"};n.VIEW_SPLIT_MODE={DESIGN:1,SOURCE:2,SPLIT_VERTICAL:6,SPLIT_HORIZONTAL:7};n.PROTOCOL={TCP:"tcp",UDP:"udp",SERIAL:"serial",DRIVER:"driver",SSH:"ssh"};n.RESOURCE_VARIABLES={ACE:"ACE",APP_URL:"APP_URL",SITE_URL:"SITE_URL"};n.SOCKET_SERVER_COMMANDS={SIGNAL_MANAGER:"Manager_command",
SIGNAL_DEVICE:"Device_command",SIGNAL_RESPONSE:"WebSocket_response",MANAGER_TEST:"Manager_Test",MANAGER_CLOSE_ALL:"Close_All_Connections",MANAGER_STATUS:"status",MANAGER_START_DRIVER:"startDriver",MANAGER_STOP_DRIVER:"stopDriver",DEVICE_SEND:"Device_Send"};n.WidgetGroup={All:0,General:1,Visual:2,Module:3,Content:4,Hidden:5,Facebook:6,Twitter:7,Google:8,Apple:9,FourSquare:10,BitLy:11,Tablet:12,Unknown:13,System:14};n.EVENTS={SAVE_LAYOUT:"layoutSave",RESTORE_LAYOUT:"layoutRestore",ON_FILE_CHANGED:"fileChanged",
ON_FILE_DELETED:"fileDeleted",ON_NODE_SERVICE_STORE_READY:"onNodeServiceStoreReady",ON_CREATED_MANAGER:"onCreatedManager",ON_CI_UPDATE:"onCIUpdate",ON_CREATED_WIDGET:"onWidgetCreated",ON_WIDGET_READY:"onWidgetReady",ON_MAIN_VIEW_READY:"onMainViewReady",ON_MAIN_MENU_READY:"onMainMenuReady",ON_MAIN_MENU_OPEN:"onMainMenuOpen",ON_VIEW_REMOVED:"onViewRemoved",ON_VIEW_SHOW:"onViewShow",ON_VIEW_HIDE:"onViewHide",ON_VIEW_ADDED:"onViewAdded",ON_ITEM_SELECTED:"onItemSelected",ON_ITEM_REMOVED:"onItemRemoved",
ON_ITEM_CLOSED:"onItemClosed",ON_ITEM_ADDED:"onItemAdded",ON_ITEM_MODIFIED:"onItemModified",ON_ACTION_CHANGE_CONTEXT:"onChangeActionContext",ON_ACTION_CONTEXT_CHANGED:"onActionContextChanged",ON_CONTAINER_ADDED:"onContainerAdded",ON_CONTAINER_REMOVED:"onContainerRemoved",ON_REMOVE_CONTAINER:"onRemoveContainer",ON_CONTAINER_REPLACED:"onContainerReplaced",ON_CONTAINER_SPLIT:"onContainerSplit",ON_CLIPBOARD_COPY:"onClipboardCopy",ON_CLIPBOARD_PASTE:"onClipboardPaste",ON_CLIPBOARD_CUT:"onClipboardCut",
ON_MODULE_RELOADED:"onModuleReloaded",ON_MODULE_UPDATED:"onModuleUpdated",RESIZE:"onResize",ERROR:"onError",STATUS:"onStatus",ON_FILE_STORE_READY:"onFileStoreReady",ON_DID_OPEN_ITEM:"onDidOpenItem",ON_SHOW_PANEL:"onShowPanel",IMAGE_LOADED:"imageLoaded",IMAGE_ERROR:"imageError",UPLOAD_BEGIN:"uploadBegin",UPLOAD_PROGRESS:"uploadProgress",UPLOAD_FINISH:"uploadFinish",UPLOAD_FAILED:"uploadFailed",ON_CONTEXT_MENU_OPEN:"onContextMenuOpen",ON_PLUGIN_LOADED:"onPluginLoaded",ON_PLUGIN_READY:"onPluginReady",
ALL_PLUGINS_READY:"onAllPluginsReady",REGISTER_EDITOR:"registerEditor",REGISTER_ACTION:"registerAction",SET_ITEM_ACTIONS:"onSetItemsActions",ON_RENDER_ACTIONS:"onRenderActions",ON_FILE_CONTENT_CHANGED:"onFileContentChanged",ON_PANEL_CLOSED:"onPanelClosed",ON_PANEL_CREATED:"onPanelCreated",ON_COPY_BEGIN:"onCopyBegin",ON_COPY_END:"onCopyEnd",ON_DELETE_BEGIN:"onDeleteBegin",ON_DELETE_END:"onDeleteEnd",ON_MOVE_BEGIN:"onMoveBegin",ON_MOVE_END:"onMoveEnd",ON_CHANGED_CONTENT:"onChangedContent",ON_COMPRESS_BEGIN:"onCompressBegin",
ON_COMPRESS_END:"onCompressEnd",ON_CREATE_EDITOR_BEGIN:"onCreateEditorBegin",ON_CREATE_EDITOR_END:"onCreateEditorEnd",ON_EXPRESSION_EDITOR_ADD_FUNCTIONS:"onExpressionEditorAddFunctions",ON_ACE_READY:"onACEReady",ON_SERVER_LOG_MESSAGE:"onServerLogMessage",ON_CLIENT_LOG_MESSAGE:"onClientLogMessage",ON_DID_RENDER_COLLECTION:"onDidRenderCollection",ON_COMPONENT_READY:"onComponentReady",ON_ALL_COMPONENTS_LOADED:"onAllComponentsLoaded",ON_APP_READY:"onAppReady",ON_CREATE_STORE:"onCreateStore",ON_STORE_CREATED:"onStoreCreated",
ON_STORE_CHANGED:"onStoreChanged",ON_STATUS_MESSAGE:"onStatusMessage",ON_OPEN_VIEW:"onOpenView",ON_VIEW_MAXIMIZE_START:"onViewMaximizeStart",ON_VIEW_MAXIMIZE_END:"onViewMaximizeEnd"};n.DIALOG_SIZE={SIZE_NORMAL:"size-normal",SIZE_SMALL:"size-small",SIZE_WIDE:"size-wide",SIZE_LARGE:"size-large"};n.DIALOG_TYPE={DEFAULT:"type-default",INFO:"type-info",PRIMARY:"type-primary",SUCCESS:"type-success",WARNING:"type-warning",DANGER:"type-danger"};n.SERVICE_STATUS={OFFLINE:"offline",ONLINE:"online",TIMEOUT:"timeout"};
n.MAIN_MENU_KEYS={VIEWS:"views",FILES:"files",LOG:"log"};n.WidgetGroupTitle={General:"General",Visual:"Visual",Module:"Modules",Content:"Content",Facebook:"Facebook",Twitter:"Twitter",Google:"Google",Apple:"Apple",Others:"Misc",FourSquare:"Foursquare",Bitly:"Bitly",Tablet:"Tablet",Unknown:"Unknown",System:"System"};p.mixin(n,{LAYOUT_RIGHT_CENTER_BOTTOM:"LAYOUT_RIGHT_CENTER_BOTTOM",LAYOUT_CENTER_BOTTOM:"LAYOUT_CENTER_BOTTOM",LAYOUT_CENTER_RIGHT:"LAYOUT_CENTER_RIGHT",LAYOUT_LEFT_CENTER_RIGHT:"LAYOUT_LEFT_CENTER_RIGHT",
LAYOUT_LEFT_CENTER_RIGHT_BOTTOM:"LAYOUT_LEFT_CENTER_RIGHT_BOTTOM"});k.fromJson=function(h,f){var a=null,c=!1;try{a=eval("("+h+")")}catch(e){c=!0}if(c){c=h.substring(h.indexOf("{"),h.lastIndexOf("}")+1);try{c&&(a=eval("("+c+")"))}catch(g){!1!==f&&console.error("error in json parsing! "+h);if(-1!==h.indexOf("error"))return{jsonrpc:"2.0",result:{error:{code:1,message:h,data:null}},id:0};throw Error(h);}}return a};return n})},"xide/utils/ObjectUtils":function(){define(["xide/utils","require","dojo/Deferred",
"dojo/_base/json"],function(p,n,m,k){function h(g){var d=parseInt(g);return d.toString()===g?d:g}function f(g,d,b,a){_.isNumber(d)&&(d=[d]);if(_.isEmpty(d))return g;if(_.isString(d))return f(g,d.split(".").map(h),b,a);var q=d[0];if(1===d.length)return d=g[q],void 0!==d&&a||(g[q]=b),d;void 0===g[q]&&(_.isNumber(d[1])?g[q]=[]:g[q]={});return f(g[q],d.slice(1),b,a)}function a(g,d){_.isNumber(d)&&(d=[d]);if(!_.isEmpty(g)){if(_.isEmpty(d))return g;if(_.isString(d))return a(g,d.split("."));var b=h(d[0]),
l=g[b];if(1===d.length)void 0!==l&&(_.isArray(g)?g.splice(b,1):delete g[b]);else if(void 0!==g[b])return a(g[b],d.slice(1));return g}}"use strict";p.debounce=function(g,d,b,a,q,c){var e=g[d+"_debounced"];e||(e=g[d+"_debounced"]=_.debounce(b,a,q));1!=c||g[d+"_debouncedFirst"]||(g[d+"_debouncedFirst"]=!0,b.apply(g));return e()};p.pluck=function(g,d){var b=[];if(!g)return console.warn("pluck: no items"),b;for(var a=0;a<g.length;a++)b.push(g[a][d]);return b};p.download=function(g,d){var b=document.createElement("a");
d=_.isString(d)?d:JSON.stringify(d,null,2);b.setAttribute("href","data:text/plain;charset\x3dutf-8,"+encodeURIComponent(d));b.setAttribute("download",g);b.style.display="none";document.body.appendChild(b);b.click();document.body.removeChild(b)};p.hasObject=function(g,d,b){d=null;try{d=n(g)}catch(a){console.error("error in utils.hasObject ",a)}return d};p.getObject=function(g,d){var b=null;if(p.isString(g)){try{b=n(g)}catch(a){}try{if(!b){var q=new m,b=n([g],function(b){q.resolve(b)});return q.promise}}catch(c){console.error("error in requiring "+
g,c)}return b}return p.isObject(g)?g:null!==b?b:d};p.toObject=function(g,d){if(!g)return{};if(!1!==d)return _.object(_.map(g,_.values));if(p.isObject(g)&&g[0])return g[0];for(var b={},a=0;a<g.length;++a)b[a]=g[a];return b};p.byString=function(g,d,b){d=d.replace(/\[(\w+)\]/g,".$1");d=d.replace(/^\./,"");for(d=d.split(".");d.length;)if(b=d.shift(),b in g)g=g[b];else return;return g};var c=Object.prototype.hasOwnProperty,e={has:function(g,d){if(_.isEmpty(g))return!1;_.isNumber(d)?d=[d]:_.isString(d)&&
(d=d.split("."));if(_.isEmpty(d)||0===d.length)return!1;for(var b=0;b<d.length;b++){var a=d[b];if((_.isObject(g)||_.isArray(g))&&c.call(g,a))g=g[a];else return!1}return!0},ensureExists:function(g,d,b){return f(g,d,b,!0)},set:function(g,d,b,a){return f(g,d,b,a)},insert:function(g,d,b,a){var q=e.get(g,d);a=~~a;isArray(q)||(q=[],e.set(g,d,q));q.splice(a,0,b)},empty:function(a,d){if(_.isEmpty(d))return a;if(!_.isEmpty(a)){var b,l;if(!(b=e.get(a,d)))return a;if(_.isString(b))return e.set(a,d,"");if(_.isBoolean(b))return e.set(a,
d,!1);if(_.isNumber(b))return e.set(a,d,0);if(_.isArray(b))b.length=0;else if(_.isObject(b))for(l in b)c.call(b,l)&&delete b[l];else return e.set(a,d,null)}},push:function(a,d){var b=e.get(a,d);_.isArray(b)||(b=[],e.set(a,d,b));b.push.apply(b,Array.prototype.slice.call(arguments,2))},coalesce:function(a,d,b){for(var l,q=0,c=d.length;q<c;q++)if(void 0!==(l=e.get(a,d[q])))return l;return b},get:function(a,d,b){_.isNumber(d)&&(d=[d]);if(_.isEmpty(d))return a;if(_.isEmpty(a)&&a&&null==a.innerHTML)return b;
if(_.isString(d))return e.get(a,d.split("."),b);var l=h(d[0]);if(1===d.length){if(a&&void 0===a[l])return b;if(a)return a[l]}return a?e.get(a[l],d.slice(1),b):b},del:function(g,d){return a(g,d)}};p.getAt=function(a,d,b){return e.get(a,d,b)};p.setAt=function(a,d,b){return e.set(a,d,b)};p.hasAt=function(a,d){return e.has(a,d)};p.ensureAt=function(a,d,b){return e.ensureExists(a,d,b)};p.deleteAt=function(a,d){return e.del(a,d)};p.merge=function(a,d){for(var b in d)"object"!=typeof a[b]?a[b]=d[b]:"object"==
typeof d[b]&&(a[b]=p.merge(a[b],d[b]));return a};p.clone=function(a){if(!a||"object"!=typeof a||p.isFunction(a))return a;if(a.nodeType&&"cloneNode"in a)return a.cloneNode(!0);if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp)return new RegExp(a);var d,b,l;if(p.isArray(a))for(d=[],b=0,l=a.length;b<l;++b)b in a&&d.push(p.clone(a[b]));else d=a.constructor?new a.constructor:{};return p._mixin(d,a,p.clone)};p._mixin=function(a,d,b){var l,q,c={};for(l in d)q=d[l],l in a&&(a[l]===
q||l in c&&c[l]===q)||(a[l]=b?b(q):q);return a};p.mixin=function(a,d){if(d){a||(a={});for(var b=arguments.length,l=1;l<b;l++)p._mixin(a,arguments[l])}return a};p.cloneKeys=function(a,d){var b={},l;for(l in a)if(!0!==d||l in a)b[l]=a[l];return b};p.isArray=function(a){return _.isArray(a)};p.isObject=function(a){return _.isObject(a)};p.isString=function(a){return _.isString(a)};p.isNumber=function(a){return _.isNumber(a)};p.isFunction=function(a){return _.isFunction(a)};return p})},"xide/utils":function(){define(["dcl/dcl"],
function(p){return p(null,{declaredClass:"xide.utils"})})},"xlog/Server":function(){define("dojo/_base/declare dojo/_base/lang xide/types xide/utils xide/factory dojo/node!winston".split(" "),function(p,n,m,k,h,f){return p("xlog.Server",null,{fileLogger:null,loggly:null,delegate:null,publishLog:!0,loggers:{},constructor:function(a){for(var c in arguments)arguments.hasOwnProperty(c)&&(this[c]=a[c])},createLogger:function(a){var c=new f.Logger({transports:[new f.transports.File(a)]});if(this.publishLog)c.on("logging",
function(c,g,d,b){b.logId=a.filename;c={level:g,message:d,data:b,time:(new Date).getTime()};h.publish(m.EVENTS.ON_SERVER_LOG_MESSAGE,c)});return c},start:function(a){this.loggers={};this.options=a;if(a.fileLogger&&(this.fileLogger=f.add(f.transports.File,a.fileLogger),this.publishLog))this.fileLogger.on("logging",function(a,e,g,d){a={level:e,message:g,data:d,time:(new Date).getTime()};h.publish(m.EVENTS.ON_SERVER_LOG_MESSAGE,a)});a.loggly&&(this.loggly=f.add(f.transports.Loggly,a.loggly));null===
a.console&&f.remove(f.transports.Console)}})})},"xide/factory":function(){define(["dojo/_base/declare"],function(p){return p("xide.factory",null,{})})},"nxapp/types":function(){define(["dojo/_base/declare"],function(p){return p("nxapp.types",null,{})})},"nxapp/utils/FileUtils":function(){define(["dojo/_base/json","dojo/node!path","dojo/node!fs","dojo/node!util","nxapp/utils"],function(p,n,m,k,h){h.getExtension=function(f){f=n.extname(f||"").split(".");return f[f.length-1]};h.readFile=function(f){var a=
m.statSync(f).size,c=new Buffer(a);f=m.openSync(f,"r");if(!a)return"";m.readSync(f,c,0,a,0);m.closeSync(f);return c.toString()};h.writeFile=function(f,a){m.writeFile(f,a,function(a){a&&console.log(a)})};h.writeJSONFile=function(f,a){var c=JSON.stringify(a,null,4);m.writeFile(f,c,function(a){a&&console.log(a)})};return h})},"nxapp/utils":function(){define(["dojo/_base/declare"],function(p){return p("nxapp.utils",null,{})})},"nxapp/utils/TCPUtils":function(){define(["dojo/node!net","nxapp/utils","nxapp/server/WebSocket",
"nxapp/server/DeviceServer","nxapp/server/FileServer"],function(p,n,m,k,h){n.checkPort=function(f,a,c){var e=new p.Socket,g=null;e.on("connect",function(){g="open";e.end()});e.setTimeout(1500);e.on("timeout",function(){g="closed";e.destroy()});e.on("error",function(a){g="closed"});e.on("close",function(d){c(null,g,a,f)});e.connect(f,a)};n.createSocketServer=function(f,a){var c=new m;c.init({options:{port:f.socket_server.port,context:a,host:f.socket_server.host}});c.ctx=a;console.error("create socket server "+
f.socket_server.host);c.start(null,f);console.error("started socket server");return m};n.createDeviceServer=function(f,a){var c=new k;c.init({options:{port:f.socket_server.port,context:a,host:f.socket_server.host}});c.ctx=a;console.error("create device server "+f.socket_server.host+":"+f.socket_server.port);c.start(null,f);return c};n.createFileServer=function(f,a){var c=new h;c.init({options:{port:f.socket_server.port,context:a,host:f.socket_server.host}});c.ctx=a;console.error("create file server "+
f.socket_server.host);c.start(null,f);return m};n.connect=function(f,a){};return n})},"nxapp/server/WebSocket":function(){define("dojo/_base/declare dojo/_base/lang xide/types xide/factory nxapp/server/ServerBase nxapp/utils/_LogMixin nxapp/server/_CommandsParserMixin dojo/node!http dojo/node!sockjs dojo/node!colors".split(" "),function(p,n,m,k,h,f,a,c,e,g){return p("nxapp.server.WebSocket",[h,f,a],{_io_socket:null,clients:null,broadCastMessage:function(a,b){for(var l=this.clients.length;l--;)if(void 0!==
this.clients[l]){var q={event:a,data:b};3===this.clients[l].readyState?(this.clients[l].close(),this.clients.remove(this.clients[l])):(JSON.stringify(q),this.clients[l].write(JSON.stringify(q)))}},onFileChanged:function(a){this.broadCastMessage(m.EVENTS.ON_FILE_CHANGED,{path:a.path,type:a.type})},start:function(a,b){this.profile=b;this.options=n.mixin(this.options,a);this.clients=[];var l=this;k.subscribe(m.EVENTS.ON_FILE_CHANGED,this.onFileChanged,this);var q=this.options.port,g=this.options.host;
if(q){this.initLogger(b.debug);this.log("Socket server running in "+q,"socket_server");var f={};this.showDebugMsg("socket_server")||(f.log=function(){});var f=e.createServer(f),h=c.createServer(this._handler);f.installHandlers(h);h.listen(q,g);this._handleSocketEmits(f);k.publish(m.EVENTS.ON_WEBSOCKET_START,{socket_server:{port:q,socket_handler:f}},this);f.on("connection",function(b){var a=l.clients.push(b);b.on("close",function(){delete l.clients[a]})});return!0}console.error("Port must be provided into options");
return!1},emit:function(a,b){this.showDebugMsg("socket_server")&&!_.isString(b)&&_.isObject(b)&&(b=JSON.stringify(b));this.socket&&this.socket.write(b)},_handleSocketEmits:function(a){var b=this.options.port,l=this.options.delegate,q=this;a.on("connection",function(a){q.socket=a;k.publish(m.EVENTS.ON_WEBSOCKET_CONNECTION,{connection:{port:b,socket_handler:a}},this);a.on("data",function(b){n.isString(b)&&(b=dojo.fromJson(b));b.manager_command?l.handleManagerCommand(b,a):l.handleDeviceCommand(b,a)});
a.on("close",function(){console.error("closed!")})})}})})},"nxapp/server/ServerBase":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/_base/lang"],function(p,n,m){return p("nxapp.server.ServerBase",[n],{options:null,delegate:null,ctx:null,_defaultOptions:function(){return{delegate:this}},init:function(k){this.options=m.mixin(this._defaultOptions(),k.options)}})})},"nxapp/utils/_LogMixin":function(){define(["dcl/dcl"],function(p){return p(null,{declaredClass:"nxapp.utils._LogMixin",debug_conf:null,
logger:null,initLogger:function(n){this.debug_conf=n},log:function(n,m,k,h){m||(m=this._debugContext().main);m&&!this.showDebugMsg(m)||!this.logger||(k=k||"info",h.time=(new Date).getTime(),this.logger.log(k,n,h))},logEx:function(n,m,k,h){this.logger?(m=m||"info",h=h||{},h.type=k||"Unknown",h.time=h.time||(new Date).getTime(),this.logger.log(m,n,h)):console.error("have no logger!")},showDebugMsg:function(n){if(null!=this.debug_conf)return this.debug_conf.all?!0:this.debug_conf[n]?!0:!1;console.log("No debug config, showing all.");
this.debug_conf={all:!0};return!0}})})},"nxapp/server/_CommandsParserMixin":function(){define(["dcl/dcl","dojo/_base/declare","nxapp/types/Types","nxapp/utils/_console"],function(p,n,m,k){return p(null,{declaredClass:"nxapp.server._CommandsParserMixin",handleManagerCommand:function(h,f){switch(h.manager_command){case m.SOCKET_SERVER_COMMANDS.MANAGER_TEST:k.dir("Test Manager command");break;case m.SOCKET_SERVER_COMMANDS.MQTT_PUBLISH:return this.sendMQTTMessage(h,f);case m.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER:return this.startDriver(h,
f);case m.SOCKET_SERVER_COMMANDS.GET_DEVICE_VARIABLES:return this.getVariables(h,f);case m.SOCKET_SERVER_COMMANDS.WRITE_LOG_MESSAGE:this.logClientMessage(h);break;case m.SOCKET_SERVER_COMMANDS.MANAGER_STOP_DRIVER:this.stopDriver(h);break;case m.SOCKET_SERVER_COMMANDS.MANAGER_STATUS:h={message:"returning status",deviceConnections:this.options.context.getConnectionManager().getNumberOfConnections()};this.emit(m.SOCKET_SERVER_COMMANDS.SIGNAL_RESPONSE,JSON.stringify(h));break;case m.SOCKET_SERVER_COMMANDS.MANAGER_CLOSE_ALL:this.options.context.getConnectionManager().closeAll()}},
handleDeviceCommand:function(h,f){var a=h.device_command,c=this.options.context,e=this,g=this;this.showDebugMsg("socket_server");var d=c.getConnectionManager().connect(h.host,h.protocol,h.port,null,null,f);try{c.getConnectionManager().registerFeedBack(d,function(b,a){e.emit(m.SOCKET_SERVER_COMMANDS.SIGNAL_RESPONSE,a);h.lastResponse=""+a;g.onDeviceMessage(b,a)})}catch(b){k.error("-register feed back function failed",b),k.trace()}switch(a){case m.SOCKET_SERVER_COMMANDS.DEVICE_SEND:this.options.context.getConnectionManager().send(d,
h.command,h.options)}}})})},"nxapp/types/Types":function(){define(["dojo/_base/lang","xide/types/Types"],function(p,n){p.mixin(n.EVENTS,{ON_FILE_CHANGED:"fileChanged",ON_CONNECTION_CREATED:"connectionCreated",ON_CONNECTION_ERROR:"connectionError",ON_WEBSOCKET_START:"webSocketStart",ON_WEBSOCKET_CONNECTION:"webSocketConnection",ON_MQTT_MESSAGE:"onMQTTMessage",ON_DEVICE_MESSAGE:"onDeviceMessage",ON_COMMAND_FINISH:"onCommandFinish",ON_COMMAND_ERROR:"onCommandError",ON_DEVICE_DISCONNECTED:"onDeviceDisconnected",
ON_DEVICE_CONNECTED:"onDeviceConnected",STORE_CHANGED:"storeChange",BEFORE_STORE_CHANGE:"beforeStoreChange",STORE_REFRESHED:"storeRefreshed",ON_DID_OPEN_ITEM:"onDidOpenItem",ON_SHOW_PANEL:"onShowPanel",ITEM_SELECTED:"itemSelected",ERROR:"fileOperationError",STATUS:"fileOperationStatus",IMAGE_LOADED:"imageLoaded",IMAGE_ERROR:"imageError",RESIZE:"resize",UPLOAD_BEGIN:"uploadBegin",UPLOAD_PROGRESS:"uploadProgress",UPLOAD_FINISH:"uploadFinish",ON_CLIPBOARD_COPY:"onClipboardCopy",ON_CLIPBOARD_PASTE:"onClipboardPaste",
ON_CLIPBOARD_CUT:"onClipboardCut",ON_CONTEXT_MENU_OPEN:"onContextMenuOpen",ON_PLUGIN_LOADED:"onPluginLoaded",ON_PLUGIN_READY:"onPluginReady",ON_MAIN_VIEW_READY:"onMainViewReady2",REGISTER_EDITOR:"registerEditor",REGISTER_ACTION:"registerAction",ON_FILE_CONTENT_CHANGED:"onFileContentChanged",ON_PANEL_CLOSED:"onPanelClosed",ON_PANEL_CREATED:"onPanelCreated",SET_DEVICE_VARIABLES:"setDeviceVariables"});n.LOG_CONTEXT={DEVICE:"Device"};n.SOCKET_SERVER_COMMANDS={MQTT_PUBLISH:"MQTT_PUBLISH",MQTT_SUBSCRIBE:"MQTT_SUBSCRIBE",
SIGNAL_MANAGER:"Manager_command",SIGNAL_DEVICE:"Device_command",SIGNAL_RESPONSE:"WebSocket_response",MANAGER_TEST:"Manager_Test",MANAGER_CLOSE_ALL:"Close_All_Connections",MANAGER_STATUS:"status",MANAGER_START_DRIVER:"startDriver",GET_DEVICE_VARIABLES:"getVariables",MANAGER_STOP_DRIVER:"stopDriver",DEVICE_SEND:"Device_Send",LOG:"Log",WRITE_LOG_MESSAGE:"Write_Log_Message"};return n})},"nxapp/utils/_console":function(){define(["dojo/has!host-node?dojo/node!tracer"],function(p){var n=n;p&&(n=p.colorConsole({format:"\x3c{{title}}\x3e {{message}} (in {{file}}:{{line}})",
dateformat:"HH:MM:ss.L"}));return n})},"nxapp/server/DeviceServer":function(){define("dcl/dcl dojo/_base/declare dojo/_base/lang xide/types xide/factory nxapp/server/WebSocket nxapp/utils/_LogMixin nxapp/server/_CommandsParserMixin dojo/node!http dojo/node!sockjs dojo/node!colors nxapp/utils/_console xide/utils".split(" "),function(p,n,m,k,h,f,a,c,e,g,d,b,l){return n("nxapp.server.WebSocket",[f,a,c],{mqttManager:null,sendMQTTMessage:function(b,a){var d=b.data.device;b.data.sourceHost=a.remoteAddress;
b.data.sourcePort=a.remotePort;if(d&&(d=this.ctx.getConnectionManager().getConnection(d.host,d.protocol,d.port))&&d.variables){var l=b.topic.split("/");if(4==l.length&&"Variable"==l[2]){l=l[3];if(!l)return;for(var g=0;g<d.variables.length;g++){var c=d.variables[g];c.name===l&&(c.value=b.data.value)}}}this.mqttManager&&this.mqttManager.publishTopic(b.topic,b.data)},sendClientMessage:function(b,a,d,l){a={data:m.mixin({device:{host:a.host,port:a.port,protocol:a.protocol}},l),event:d};b.write(JSON.stringify(a))},
getVariables:function(a,d){var l=a.device,g=this.ctx.getConnectionManager().getConnection(l.host,l.protocol,l.port);this.ctx.getDeviceManager().toDeviceControlInfo(l);var c=[];if(g){var e=g.variables;e?(c=e,this.sendClientMessage(d,l,k.EVENTS.SET_DEVICE_VARIABLES,{variables:e})):(c=g.variables=a.variables,_.each(c,function(b){b.value=b.initial}),this.sendClientMessage(d,l,k.EVENTS.SET_DEVICE_VARIABLES,{variables:a.variables}))}else b.error(" get variables failed, have no connection");if((g=d.mqtt)&&
!g.didSubscribe)for(e=0;e<c.length;e++)g.subscribe(l.host+"/"+l.port+"/Variable/"+c[e].name)},logClientMessage:function(a){var d=a.data.device;d?this.logEx(a.message,a.level,a.type,{device:{host:d.host,port:d.port,protocol:d.protocol},deviceMessage:"",time:a.time}):b.error("wrong log parameters, host missing",a)},getLogger:function(b){var a=this.ctx.getLogManager(),d=a.options;b=l.replaceAll("/","_",b.host)+"_"+b.port+"_"+b.protocol;var g=a.loggers[b];g||(g=a.createLogger({filename:b,dirname:d.fileLogger.dirname,
json:!0,console:null}),a.loggers[b]=g);return g},logEx:function(b,a,d,l){var g=this.getLogger(l.device);a=a||"info";l=l||{};l.type=d||"Unknown";l.time=l.time||(new Date).getTime();g.log(a,b,l)},stopDriver:function(b){var a=this.ctx.getConnectionManager(),d=this.ctx.getDeviceManager();a.connectionExists(b.host,b.port,b.protocol);a.removeConnection({host:b.host,protocol:b.protocol,port:b.port});d.stopDevice(b.id)},sendClientEvent:function(b){},startDriver:function(a,d){var l=this.ctx.getConnectionManager();
this.ctx.getDriverManager();var g=this.ctx.getDeviceManager();if(-1!==l.connectionExists(a.host,a.protocol,a.port))return l.connect(a.host,a.protocol,a.port,a.mqtt);l.connect(a.host,a.protocol,a.port,a.mqtt,a,d);a.driverOptions&k.DRIVER_FLAGS.RUNS_ON_SERVER&&g&&g.startDevice&&((l=g.getItemById(a.id))?g.toDeviceControlInfo(l)&&g.startDevice(l,!0):b.error("cant find device with id "+a.id));return"xxxx"},onFileChanged:function(b){this.broadCastMessage(k.EVENTS.ON_FILE_CHANGED,{path:b.path,event:b.event})},
onDeviceMessage:function(a,d){d&&d.message&&256<d.message.length||(d?this.broadCastMessage(k.EVENTS.ON_DEVICE_MESSAGE,{device:{host:a.host,port:a.port,protocol:a.protocol},deviceMessage:d}):b.error("---onDeviceMessage:have no data"))},onLogMessage:function(b){this.broadCastMessage(k.EVENTS.ON_SERVER_LOG_MESSAGE,b)},onClientDisconnect:function(b){b.mqtt&&b.mqtt.end()},onClientConnection:function(b){if(this.mqttManager){var a=this;if(b&&!b.mqtt){var d=this.mqttManager.createMQTTClient(b.remoteAddress,
b.remotePort);d.client=b;b.mqtt=d;d.on("message",function(d,l){l.sourceHost!==b.remoteAddress&&l.sourcePort!==b.remotePort&&a.sendClientMessage(b,{},k.EVENTS.ON_MQTT_MESSAGE,{topic:d,message:l.toString(),host:b.remoteAddress,port:b.remotePort})})}}},start:function(a,d){this.profile=d;this.options=m.mixin(this.options,a);this.clients=[];var l=this,c=this.options.port,f=this.options.host;h.subscribe(k.EVENTS.ON_SERVER_LOG_MESSAGE,this.onLogMessage,this);if(c){this.initLogger(d.debug);this.log("Socket server running in "+
c,"socket_server");this.showDebugMsg("socket_server");var n=g.createServer({heartbeat_delay:1E3}),p=e.createServer(this._handler);n.installHandlers(p);p.listen(c,f);this._handleSocketEmits(n);h.publish(k.EVENTS.ON_WEBSOCKET_START,{socket_server:{port:c,socket_handler:n}},this);n.on("connection",function(b){var a=l.clients.push(b);l.onClientConnection(b);b.on("close",function(){l.onClientDisconnect(b);delete l.clients[a]})});return!0}b.error("Port must be provided into options");return!1},_handleSocketEmits:function(b){var a=
this.options.port,d=this.options.delegate,l=this;b.on("connection",function(b){l.socket=b;h.publish(k.EVENTS.ON_WEBSOCKET_CONNECTION,{connection:{port:a,socket_handler:b}},this);b.on("data",function(a){m.isString(a)&&(a=dojo.fromJson(a));a.manager_command?d.handleManagerCommand(a,b):d.handleDeviceCommand(a,b)});b.on("close",function(){})})}})})},"nxapp/server/FileServer":function(){define("dojo/_base/declare dojo/_base/lang xide/types xide/factory nxapp/server/WebSocket nxapp/utils/_LogMixin dojo/node!http dojo/node!sockjs".split(" "),
function(p,n,m,k,h,f,a,c){return p("nxapp.server.WebSocket",[h,f],{onFileChanged:function(a){console.log("file changed : "+a.modulePath);this.broadCastMessage(m.EVENTS.ON_FILE_CHANGED,{path:a.path,modulePath:a.modulePath,mask:a.mask})},start:function(e,g){this.profile=g;this.options=n.mixin(this.options,e);this.clients=[];var d=this;k.subscribe(m.EVENTS.ON_FILE_CHANGED,this.onFileChanged,this);var b=this.options.port,l=this.options.host;if(b){this.initLogger(g.debug);this.log("File Socket server running in "+
b,"socket_server");var q={};this.showDebugMsg("socket_server")||(q.log=function(){});var q=c.createServer(q),f=a.createServer(this._handler);q.installHandlers(f);f.listen(b,l);this._handleSocketEmits(q);k.publish(m.EVENTS.ON_WEBSOCKET_START,{socket_server:{port:b,socket_handler:q}},this);q.on("connection",function(b){var a=d.clients.push(b);b.on("close",function(){delete d.clients[a]})});return!0}console.error("Port must be provided into options");return!1},_handleSocketEmits:function(a){var g=this.options.port,
d=this;a.on("connection",function(b){d.socket=b;k.publish(m.EVENTS.ON_WEBSOCKET_CONNECTION,{connection:{port:g,socket_handler:b}},this);b.on("close",function(){})})}})})},"nxappmain/nxAppBase":function(){define("dcl/dcl dojo/_base/lang nxapp/utils/FileUtils dojo/Stateful dojo/node!commander dojo/node!fs dojo/node!os xide/factory/Events dojo/has xide/model/Base".split(" "),function(p,n,m,k,h,f,a,c,e,g){e.add("windows",function(){return"win32"===a.platform()});e.add("osx",function(){return"darwin"===
a.platform()});e.add("linux",function(){return"linux"===a.platform()});e.add("arm",function(){return"arm"===a.arch()});return p(g.dcl,{declaredClass:"nxappmain.nxAppBase",profile:null,commander:null,profilePath:"/nxappmain/profile_device_server.json",getDefaultProfilePath:function(){return process.cwd()+this.profilePath},getProfile:function(a){var b={};a||(a=this.commander.profile&&0<this.commander.profile.length?this.commander.profile:this.getDefaultProfilePath());f.existsSync(a)||(a=process.cwd()+
this.profilePath);var l=m.readFile(a);l?b=dojo.fromJson(l):console.error("have no profile at : "+a);return b},init:function(){this.commander||(h.version("0.0.1").option("-c, --command \x3cname\x3e","command to send").option("-i, --info","return service profile").option("-f, --file \x3cpath\x3e","run a file").option("-o, --oneshot","one shot command").option("-s, --send","Puts the shell into send mode").option("-P, --port \x3cnumber\x3e","set the device connection port").option("-H, --host \x3caddress\x3e",
"set the device host").option("-T, --protocol \x3cname\x3e","set the device connection protocol").option("-D, --driver \x3cname\x3e","runs a driver").option("-j, --jhelp","output options as json"),this.commander=h,this.commander.allowUnknownOption(!0),this.commander.parse(process.argv));if(h.jhelp){var a=[];h.options.map(function(b){a.push(b)});console.log(JSON.stringify(a));process.exit()}this.profile=this.getProfile(this.profilePath);null!=this.profile&&n.mixin(this.profile,this.commander)}})})},
"xide/factory/Events":function(){define(["xide/factory","dojo/_base/connect","dojo/_base/lang","dojo/on","dojo/has"],function(p,n,m,k,h){var f={click:null,dblclick:null,mousedown:null,mouseup:null,mouseover:null,mousemove:null,mouseout:null,keypress:null,keydown:null,keyup:null,focus:null,blur:null,change:null};p.publish=function(a,c,e,g){c=c?_.isString(c)?{message:c}:c:{};e=a;var d=n.publish,b=[];_.isArray(a)||(e=[a]);a=0;for(var l=e.length;a<l;a++){var q=e[a];if(!g||g(q))b=d(q,c)}return b};p.subscribe=
function(a,c,e,g){var d=a,b=n.subscribe,l=[];_.isArray(a)||(d=[a]);a=0;for(var q=d.length;a<q;a++)if(d[a]&&(!g||g(x))){var h=d[a],t=_.isString(h),x=t?h:h.key,h=t?c:h.handler,t=x in f;null!=e?(h=null!=h?h:e[x],t=t?k(e,x,m.hitch(e,h)):b(x,m.hitch(e,h)),t.handler=m.hitch(e,h)):(t=n.subscribe(x,h),t.handler=h);t.type=x;l.push(t)}return l};return p})},"xide/model/Base":function(){define(["dcl/dcl","xdojo/declare","xide/utils"],function(p,n,m){var k={declaredClass:"xide/model/Base",constructor:function(h){m.mixin(this,
h)},getLabel:function(){return null},getID:function(){return null}};n=n("xide/model/Base",null,k);n.dcl=p(null,k);return n})},"nxapp/manager/Context":function(){define(["dcl/dcl","./ConnectionManager","xide/manager/ContextBase"],function(p,n,m){return p(m,{declaredClass:"nxapp.manager.Context",connectionManager:null,driverManager:null,fileManager:null,blockManager:null,deviceServer:null,logManager:null,getDeviceServer:function(){return this.deviceServer},getFileManager:function(){return this.fileManager},
getConnectionManager:function(){return this.connectionManager},initManagers:function(k){this.connectionManager.init(k)},constructManagers:function(){this.connectionManager=new n({ctx:this})},getLogManager:function(){return this.logManager}})})},"nxapp/manager/ConnectionManager":function(){define("dcl/dcl dojo/_base/array nxapp/manager/ManagerBase nxapp/utils/_LogMixin nxapp/protocols/Tcp nxapp/protocols/Udp nxapp/protocols/Driver nxapp/protocols/SSH nxapp/protocols/Serial nxapp/types/Types xide/factory xide/utils nxapp/utils/_console".split(" "),
function(p,n,m,k,h,f,a,c,e,g,d,b,l){return p([m,k],{declaredClass:"nxapp.manager.ConnectionManager",options:null,profile:null,lastUpTime:null,mqttManager:null,onWakeup:function(){this.lastUpTime=(new Date).getTime();for(var b=0;b<this.pool.length;b++){var a=this.pool[b];a.socket&&a.socket.close&&a.socket.close();a.socket&&a.socket._socket&&a.socket._socket.close&&a.socket._socket.close()}this.pool=[]},init:function(b){this.profile=b;this.initLogger(b.debug);this.lastUpTime=(new Date).getTime();var a=
this;setInterval(function(){var b=(new Date).getTime();if(3E3<b-a.lastUpTime)a.onWakeup();a.lastUpTime=b},1E3)},connect:function(q,r,t,k,m,n){this.debug=!0;if(!r)return l.error("have no protocol, exit"),!1;r=r.toLowerCase();var p={port:t,host:q,debug:this.profile.debug,delegate:this};b.mixin(p,m);m=this.connectionExists(q,t,r);if(m!=this.poolNotFound){k=q+":"+t+":"+r+"_didOnConnect";if(n[k])return m;n[k]=!0;if(this.debug)this.onConnect(q,t,r);return m}m=n=null;switch(r){case g.PROTOCOL.TCP:n=new h;
n.init({options:p});m=n.connect();break;case g.PROTOCOL.UDP:n=new f;n.init({options:p});m=n.connect();break;case g.PROTOCOL.DRIVER:n=new a({owner:this});n.init({options:p});m=n.connect(p);break;case g.PROTOCOL.SSH:n=new c({owner:this});n.init({options:p});m=n.connect(p);break;case g.PROTOCOL.SERIAL:n=new e({owner:this}),n.init({options:p}),m=n.connect(p)}if(m){m=this.addConnection(m,q,t,r);d.publish(g.EVENTS.ON_CONNECTION_CREATED,{connection:this.getConnection(m)},this);if(this.mqttManager)this.mqttManager.onConnectedToDevice(p,
n,k);return m}d.publish(g.EVENTS.ON_CONNECTION_ERROR,{connection:{port:t,host:q,protocol:r}},this);return!1},send:function(b,a,d){var g=this.getConnection(b);return g.socket&&g.socket._socket&&g.socket._socket.writable?g.socket.send(a,d):(l.log("client is not writable "+a,b),this.close(b,!0),!1)},close:function(b,a){var d=this.getConnection(b);d&&d.socket&&d.socket._socket&&d.socket._socket.close&&d.socket._socket.close();l.log("removing");this.removeConnection(b)},closeAll:function(){var b=this;
this.forEachPool(function(a,d){b.close(d)});this.clearPool()},onTimeout:function(b){l.log("Timeout!")},onClose:function(b,a){this.removeConnection(b,a)},onDrain:function(b){l.log("Drain")},onError:function(b,a,d){b.lastError=a;this.removeConnection(b,d)},onFinish:function(b,a,d){this.showDebugMsg("protocol_messages");this.pinMode(2,0);a=this.connectionExists(b.host,b.port,b.protocol);a!=this.poolNotFound?this.callFeedBack(a,data):l.error("ConnectionManager::onData : cant find pool - reference:"+a+
":"+b.host+":"+b.port+":"+b.protocol)},onData:function(b,a){this.showDebugMsg("protocol_messages");var d=this.connectionExists(b.host,b.port,b.protocol);if(d!=this.poolNotFound)try{this.callFeedBack(d,a)}catch(g){l.error("call feedback error : "+g.message),l.log(g.stack)}else l.error("ConnectionManager::onData : cant find pool - reference:"+d+":"+b.host+":"+b.port+":"+b.protocol)},onConnect:function(b,a,d,l){var c={device:{host:b,port:a,protocol:d}};this.ctx.getDeviceServer().broadCastMessage(g.EVENTS.ON_DEVICE_CONNECTED,
c);var e=this.ctx.getDeviceServer();l&&(b=this.connectionExists(b,a,d),this.registerFeedBack(b,function(b,a){e.emit(g.SOCKET_SERVER_COMMANDS.SIGNAL_RESPONSE,a);a.lastResponse=""+a;e.onDeviceMessage(b,a)}))},onHandle:function(b,a){this.showDebugMsg("protocol_messages")},pool:[],poolNotFound:-1,getNumberOfConnections:function(){return this.pool.length},getDeviceConnection:function(){if(this.getNumberOfConnections())for(var b=0;b<this.pool.length;b++);},addConnection:function(b,a,d,l,g,c){this.pool.push({socket:b,
host:a,port:d,protocol:l,user:g,customFields:c,feedbackTo:[]});return this.pool.length-1},removeConnection:function(b,a){for(var d=this,c=0;c<this.pool.length;c++){var e=this.pool[c];if(b.host===e.host&&b.port===e.port&&b.protocol===e.protocol){e.socket&&e.socket.close();this.ctx.getDeviceServer()&&setTimeout(function(){var a={device:{host:e.host,port:e.port,protocol:e.protocol},error:b.lastError};d.ctx.getDeviceServer().broadCastMessage(g.EVENTS.ON_DEVICE_DISCONNECTED,a)},1E3);this.pool.splice(c,
1);return}}l.log("removing connection : couldnt find connection "+b.host+":"+b.port+"@"+b.protocol)},clearPool:function(){this.pool=[]},getConnection:function(b){if(3==arguments.length){for(var a=arguments[0],d=arguments[1],l=arguments[2],g=0;g<this.pool.length;g++){var c=this.pool[g];if(c.host==a&&c.port==l&&c.protocol==d)return c}return null}return this.pool[b]},registerFeedBack:function(b,a){var d=this.getConnection(b);null==d?l.error("cant find connection for pool ref:"+b):d&&0<d.feedbackTo.length||
d.feedbackTo.push(a)},callFeedBack:function(b,a){var d=this,g=this.getConnection(b);g?g.feedbackTo&&0!=g.feedbackTo.length?_.each(g.feedbackTo,function(l){l(d.getConnection(b),a)}):l.error("-- call feed back: have no feedback targets",g.feedbackTo):l.error("-- call feed back: have no connection")},connectionExists:function(b,a,d){var l=this.poolNotFound;_.each(this.pool,function(g,c){g&&g.host===b&&g.port===a&&g.protocol===d&&(l=c)});return l},forEachPool:function(b){_.each(this.pool,function(a,d){b(a,
d)})}})})},"nxapp/manager/ManagerBase":function(){define(["dcl/dcl","xide/model/Base"],function(p,n){var m=p(n.dcl,{declaredClass:"nxapp.manager.ManagerBase",ctx:null,profile:null,init:function(k){this.profile=k}});p.chainAfter(m,"init");return m})},"nxapp/protocols/Tcp":function(){define(["dojo/_base/declare","nxapp/utils","nxapp/protocols/ProtocolBase","dojo/node!net","dojo/node!child_process"],function(p,n,m,k,h){return p("nxapp.protocols.Tcp",[m],{_socket:null,protocolName:"tcp",connect:function(f){this.options=
f=f||this.options;var a=this.options.port,c=this.options.host;this.delegate=f.delegate;this._socket=new k.Socket({allowHalfOpen:!0});this._socket.setEncoding(this.options.text_encoding);var e=this;this._socket.connect(a,c,function(){e.delegate.onConnect(c,a,e.protocolName,e)});this._socket.setNoDelay(!0);this._socket.setKeepAlive(!0,0);this._setupEventListeners(this._socket,this.delegate);this.logConnection("New TCP connection to "+c+":"+a);return this},send:function(f){null==f?console.error("TCP : invalid command"):
(f=f.toUpperCase?f.toUpperCase():f,f+=this.options.end_of_command,this._socket.write(f))},close:function(){this._socket.end()}})})},"nxapp/protocols/ProtocolBase":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/_base/lang","nxapp/utils/_LogMixin"],function(p,n,m,k){return p("nxapp.protocols.ProtocolBase",[n,k],{options:null,protocolName:"undefined",debug_connection:"protocol_connection",debug_messages:"protocol_messages",delegate:null,_setupEventListeners:function(h,f){var a={port:this.options.port,
host:this.options.host,protocol:this.protocolName};h.handle=function(c){f.onHandle(a,c)};h.on("data",function(c){f.onData(a,c)});h.on("error",function(c){f.onError(a,c)});h.on("drain",function(){f.onDrain(a)});h.on("timeout",function(){f.onTimeout(a)});h.on("close",function(c){f.onClose(a,c)})},_defaultOptions:function(){return{port:23,text_encoding:"utf8",end_of_command:"\r"}},init:function(h){var f=this._defaultOptions();this.options=m.mixin(f,h.options);this.initLogger(h.options.debug)},logConnection:function(h){this.log(h,
this.debug_connection)},logMessages:function(h){this.log(h,this.debug_messages)}})})},"nxapp/protocols/Udp":function(){define(["dojo/_base/declare","nxapp/utils","nxapp/protocols/ProtocolBase","dojo/node!dgram"],function(p,n,m,k){return p("nxapp.protocols.Udp",[m],{_socket:null,protocolName:"udp",port:null,host:null,connect:function(h){this.options=h||this.options;this.port=this.options.port;this.host=this.options.host;this.delegate=this.options.delegate;this._socket=k.createSocket("udp4");this._setupEventListeners(this._socket,
this.delegate);return this},send:function(h){try{var f=new Buffer(h),a=this;this._socket.send(f,0,f.length,this.port,this.host,function(c,g){if(c)a.delegate.onError(c);else console.log("UDP message sent to "+a.host+":"+a.port)})}catch(c){console.error("crash !")}},close:function(){this._socket.close()}})})},"nxapp/protocols/Driver":function(){define("dojo/_base/declare nxapp/utils nxapp/protocols/ProtocolBase dojo/node!net dojo/node!path dojo/node!child_process require dojo/node!tracer".split(" "),
function(p,n,m,k,h,f,a,c){var e=c.colorConsole();return p("nxapp.protocols.Driver",[m],{_socket:null,protocolName:"driver",instance:null,onError:function(a){debugger},onConnected:function(a,d,b){e.error("# driver onConnected "+this.options.host+" : "+this.options.port+" @ "+this.protocolName);this.delegate.onConnect(this.options.host,this.options.port,this.protocolName)},_connect:function(a,d){var b=new a(d);b.owner=this;b.connect||e.error("     have     no connect");b.connect();this._socket=b;this._socket.writable=
!0},connect:function(g){this.delegate=g.delegate;if(!g||!g.driver)return e.error("no driver in options",g),this;try{var d="system_drivers/"+g.driver.replace(".js","");e.log("load driver module "+d+" \x3d\x3d\x3d ");var b=this;try{a([d],function(a){e.log("got module "+d);try{b._connect?b._connect(a,g):e.error("have no _connect")}catch(l){e.error("error calling connect on "+d+" | Error "+l.message,l)}})}catch(l){e.error("-----error loading driver module "+d+" :: "+l.message,l)}}catch(c){e.error("Error connecting driver "+
c.message)}return this},send:function(a){null==a?e.error("TCP : invalid command"):(this.logMessages("TCP - Sending command: "+a),a+=this.options.end_of_command,this._socket.write(a))},close:function(){this._socket.end()}})})},"nxapp/protocols/SSH":function(){define("dojo/_base/declare xide/utils nxapp/types/Types nxapp/protocols/ProtocolBase dojo/node!net dojo/node!path dojo/node!ssh2 dojo/node!strip-ansi dojo/node!child_process dojo/node!util dojo/node!deferred dojo/node!ansi-to-html dojo/node!ansi_up nxapp/utils/_console".split(" "),
function(p,n,m,k,h,f,a,c,e,g,d,b,l,q){var r=!1;return p("nxapp.protocols.SSH",[k],{_socket:null,protocolName:"ssh",instance:null,connection:null,sshOptions:null,getOptions:function(b,a,d){return n.mixin({config:!1,host:b,username:d.username,password:d.password,agent:"",agentForward:!1,port:a,proxy:{port:a},ignoreErrors:!1,minimatch:{},debug:r,suppressRemoteErrors:!1,callback:function(){}},d)},onConnected:function(){r&&q.log("# "+this.protocolName+" - Protocol:: onConnected "+this.options.host+" : "+
this.options.port+" @ "+this.protocolName);this.delegate.onConnect(this.options.host,this.options.port,this.protocolName)},onError:function(b,a){this.delegate.onError(this,n.mixin({code:b},a),this.options)},onClose:function(){this.delegate.onClose(this,this.options)},connect:function(b){this.delegate=b.delegate;if(!b||!b.driver)return r&&q.error("no driver in options",b),this;var d=this,l=b.host,g=b.port;b=n.getJson(b.options);!0===b.debug&&(r=!0);var c=this.getOptions(l,g,b);b=function(b){var a=
{host:b.host,port:b.port,username:b.username,readyTimeout:b.readyTimeout,agentForward:b.agentForward};b.privateKey?(a.privateKey=b.privateKey.trim(),b.passphrase&&(a.passphrase=b.passphrase.trim())):b.password?(a.password=b.password,b.agent&&(a.agent=b.agent)):a.agent=b.agent;return a}(c);this.sshOptions=c;this.host=l;this.port=g;this.protocol=this.protocolName;r&&q.log("SSH-\x3econnecting SSH with",c);var e=new a;this.connection=e;e.on("keyboard-interactive",function(b,a,d,l,g){l.forEach(function(b){-1!==
b.prompt.toLowerCase().indexOf("password")&&g([c.password])})});e.on("connect",function(){r&&q.log("SSH-\x3eConnection :: connect")});e.on("ready",function(){r&&q.log("SSH-\x3eConnection :: ready");var b,a,l;e.once("session",function(d,g){d().once("pty",function(d,g,c){b=c.rows;a=c.cols;l=c.term;d&&d();r&&q.log("SSH-\x3e pty "+b+" "+a+" "+l)}).once("shell",function(b,a){r&&q.log("SSH-\x3eshell")})});d.onConnected()});e.on("error",function(b){r&&q.warn("SSH-\x3eConnection - Error :: "+b);b=b.level+
":"+b.message;d.onError(b);d.lastError=b});e.on("debug",function(b){r&&q.log("SSH-\x3eConnection :: debug :: "+b)});e.on("end",function(){r&&q.log("SSH-\x3eConnection :: end");d.onClose()});e.on("close",function(b){if(b)r&&q.log("SSH - Connection :: Close, had Error ");else d.onClose()});e.connect(b);this._socket=e;this._socket.writable=!0;return this},onData:function(b){r&&q.log("SSH-\x3eonData",b);this.delegate.onData(this,b)},onCommandError:function(b,a){r&&q.log("SSH-\x3eonCommandError "+b+" id "+
a.id+" src "+a.src);var d=this.delegate;try{d.onData(this,n.mixin({cmd:b,event:m.EVENTS.ON_COMMAND_ERROR},a))}catch(l){q.error("---",l)}},onFinish:function(b,a){r&&q.log("SSH-\x3eonFinish "+b+" id "+a.id+" src "+a.src);var d=this.delegate;try{d.onData(this,n.mixin({cmd:b,event:m.EVENTS.ON_COMMAND_FINISH},a))}catch(l){q.error("onFinish-Error:",l)}},execCommand:function(a,g){var c=this.connection,e=this,f=e.sshOptions,h=d(),k=g.id,m=new b(f.ansiOptions||{}),n=1==f.waitForEOF,p="";if(0===a.length)r&&
q.log("SSH-\x3eno more SSH commands, call Defered::resolve");else{var z=a.shift();r&&q.log("SSH-\x3eExecuting :: "+z);c.exec(z,f,function(b,d){if(b)r&&q.log("---error in SSH ",b);else{var c;d.on("data",function(b,a){c=String(b);!0!==f.ansiUp&&1==f.html?c=m.toHtml(c):1==f.ansiUp&&1==f.html&&(c=l.ansi_to_html(c));(r||f.debug)&&q.log("SSH DATA : "+c);"stderr"===a?f.suppressRemoteErrors?r&&q.warn("SSH-\x3edata - 1"+c):r&&q.warn("SSH-\x3estdErr"+c):(r&&q.log("SSH-\x3edata - 2 "+c),n?(p+=c,d.lastData=p):
(e.onData(c),d.lastData=c))});d.on("end",function(){r&&q.log(!0!=="SSH-\x3eStream :: EOF, had Error "+d.hadError);c&&"function"===typeof f.callback&&f.callback(c.trim());d.hadError?h.reject({id:k,error:d.lastData}):(n&&(r&&q.error("--------------release data on EOF"),e.onData(d.lastData)),h.resolve(k))});d.on("exit",function(){r&&q.log("SSH-\x3eStream :: exit")});d.on("close",function(b,l){r&&q.log("SSH-\x3eStream :: close :: code: "+b+", signal: "+l);127==b&&(r&&q.error("--command error!"),d.hadError=
!0);f.ignoreErrors||0===b?e.execCommand(a,g):r&&q.error("SSH-\x3eError executing task "+z)})}})}return h.promise},send:function(b,a){if(null==b)q.error("SSH: invalid command");else{a=a||{id:n.createUUID()};this.logMessages("SSH - Sending command: "+b);r&&q.log("SSH-\x3esend : "+b,a);var d=this.execCommand([b],a),l=this;d.then(function(d){l.onFinish(b,a)},function(d){a.error=d.error;l.onCommandError(b,a)});return d}},close:function(){this.connection&&(this.connection.end(),this.connection=null)}})})},
"nxapp/protocols/Serial":function(){define("dojo/_base/declare xide/utils nxapp/types/Types nxapp/protocols/ProtocolBase dojo/node!net dojo/node!path dojo/node!child_process dojo/node!util dojo/node!deferred nxapp/utils/_console xdojo/has!serialport?dojo/node!serialport".split(" "),function(p,n,m,k,h,f,a,c,e,g,d){var b=!1;return p("nxapp.protocols.Serial",[k],{_socket:null,protocolName:"serial",instance:null,connection:null,sshOptions:null,getOptions:function(b,a,g,c){b=JSON.parse('"'+(c||"\\r")+
'"');b={baudrate:9600,parity:"none",rtscts:!1,xon:!1,xoff:!1,xany:!1,hupcl:!0,rts:!0,cts:!1,dtr:!0,dts:!1,brk:!1,databits:8,stopbits:1,buffersize:256,parser:d.parsers.readline(g.lineBreak||b||"\r")};return n.mixin(b,g)},onConnected:function(){b&&g.log("# "+this.protocolName+" - Protocol:: onConnected "+this.options.host+" : "+this.options.port+" @ "+this.protocolName);this.delegate.onConnect(this.options.host,this.options.port,this.protocolName,this)},onError:function(b,a){this.delegate.onError(this,
n.mixin({code:b},a),this.options)},onClose:function(){this.delegate.onClose(this,this.options)},connect:function(a){this.delegate=a.delegate;if(!has("serialport"))return this.onError("have serial port");if(!a||!a.driver)return b&&g.error("no driver in options",a),this;var c=this,e=a.host,f=a.port,h=n.getJson(a.options||{});!0===h.debug&&(b=!0);this.serialOptions=a=this.getOptions(e,f,h,(a.responseSettings||{}).delimiter);this.host=e;this.port=f;this.protocol=this.protocolName;b&&g.log("Serial-\x3econnecting to "+
e+" with",a);var k=new d.SerialPort(e,a);this.connection=k;try{k.on("open",function(a){if(a){var d=a.level+":"+a.message;c.onError(d);c.lastError=d;b&&g.warn("Serial-\x3eConnection - Error :: "+e+":"+a)}else c.onConnected(),k.on("data",function(b){c.onData(b.toString())})})}catch(m){b&&g.error("Serial-\x3econnect error :: code: ",m)}k.on("close",function(a){b&&g.log("Serial-\x3eclose :: code: ",a);c.onClose();k.close()});this._socket={};this._socket.writable=!0;return this},onData:function(a){b&&
g.log("SERIAL -\x3e on data",a);this.delegate.onData(this,a)},onCommandError:function(a,d){b&&g.log("SERIAL-\x3eCommandError "+a+" id "+d.id+" src "+d.src);var c=this.delegate;try{c.onData(this,n.mixin({cmd:a,event:m.EVENTS.ON_COMMAND_ERROR},d))}catch(e){g.error("---",e)}},onFinish:function(a,d){b&&g.log("SERIALonFinish "+a+" id "+d.id+" src "+d.src);var c=this.delegate;try{c.onData(this,n.mixin({cmd:a,event:m.EVENTS.ON_COMMAND_FINISH},d))}catch(e){g.error("onFinish-Error:",e)}},execCommand:function(a,
d){var c=this.connection,f=this,h=f.sshOptions,k=e(),m=d.id,n=new AnsiToHtml(h.ansiOptions||{}),p=1==h.waitForEOF,C="";if(0===a.length)b&&g.log("SERIALno more SSH commands, call Defered::resolve");else{var A=a.shift();b&&g.log("SERIALExecuting :: "+A);c.exec(A,h,function(c,e){if(c)b&&g.log("---error in SSH ",c);else{var r;e.on("data",function(a,d){r=String(a);!0!==h.ansiUp&&1==h.html?r=n.toHtml(r):1==h.ansiUp&&1==h.html&&(r=ansi_up.ansi_to_html(r));(b||h.debug)&&g.log("SSH DATA : "+r);"stderr"===
d?h.suppressRemoteErrors?b&&g.warn("SERIALdata - 1"+r):b&&g.warn("SERIALstdErr"+r):(b&&g.log("SERIALdata - 2 "+r),p?(C+=r,e.lastData=C):(f.onData(r),e.lastData=r))});e.on("end",function(){b&&g.log(!0!=="SERIALStream :: EOF, had Error "+e.hadError);r&&"function"===typeof h.callback&&h.callback(r.trim());e.hadError?k.reject({id:m,error:e.lastData}):(p&&(b&&g.error("--------------release data on EOF"),f.onData(e.lastData)),k.resolve(m))});e.on("exit",function(){b&&g.log("SERIALStream :: exit")});e.on("close",
function(c,k){b&&g.log("SERIAL-\x3eclose :: code: "+c+", signal: "+k);127==c&&(b&&g.error("--command error!"),e.hadError=!0);h.ignoreErrors||0===c?f.execCommand(a,d):b&&g.error("SERIALError executing task "+A)})}})}return k.promise},send:function(a,d){null==a?g.error("SERIAL invalid command"):(d=d||{id:n.createUUID()},this.logMessages("SERIAL - Sending command: "+a),b&&g.log("SERIAL -\x3e send command: "+a,d),this.connection.write(a))},close:function(){this.connection&&(this.connection.close(),this.connection=
null)}})})},"xide/manager/ContextBase":function(){define(["dcl/dcl","xide/factory","xide/types","xide/utils","xide/mixins/EventedMixin"],function(p,n,m,k,h){h=p(h.dcl,{declaredClass:"xide.manager.ContextBase",language:"en",managers:[],mixins:null,createManager:function(f,a,c){try{this.managers||(this.managers=[]);var e={ctx:this,config:a||this.config};k.mixin(e,c);if(_.isString(f)&&this.namespace){var g=null,g=-1==f.indexOf(".")?this.namespace+f:""+f;f=dojo.getObject(g)&&p.getObject(g)?g:this.defaultNamespace+
f}else _.isObject(f);var d=n.createInstance(f,e);if(d)return this.managers.push(d),n.publish(m.EVENTS.ON_CREATED_MANAGER,{instance:d,className:f,ctx:this,config:a||this.config}),d}catch(b){console.error("error creating manager "+b,arguments)}},constructManagers:function(){},initManagers:function(){},doMixins:function(f){this.mixins=f||this.mixins;for(var a=0;a<f.length;a++){var c=f[a],e=dojo.getObject(c.declaredClass)||p.getObject(c.declaredClass);c.declaredClass===this.declaredClass&&(e=this);e&&
k.mixin(e.prototype,c.mixin)}}});p.chainAfter(h,"constructManagers");p.chainAfter(h,"initManagers");return h})},"xide/mixins/EventedMixin":function(){define("dojo/_base/array dcl/dcl xdojo/declare xdojo/has xide/types xide/factory".split(" "),function(p,n,m,k,h,f){k={_didRegisterSubscribers:!1,subscribers:null,subscribes:{},emits:{},__events:null,addPublishFilter:function(a,c){a&&(null!=c?this.emits[a]=c:a in this.emits&&delete this.emits[a])},filterSubscribe:function(a){return this.subscribes?!1!==
this.subscribes[a]:!0},filterPublish:function(a){return this.emits?!1!==this.emits[a]:!0},subscribe:function(a,c,e){this.__events||(this.__events={});a=f.subscribe(a,c,e||this,this.filterSubscribe.bind(this));c=this.__events;e=0;for(var g=a.length;e<g;e++){var d=a[e].type;c[d]||(c[d]=[]);c[d].push(a[e])}return a},publish:function(a,c,e,g){var d=this;0<g?setTimeout(function(){f.publish(a,c,e||d,d.filterPublish.bind(d))}.bind(d),g):f.publish(a,c,e||d,d.filterPublish.bind(d))},_destroyHandle:function(a){},
_destroyHandles:function(){if(this.__events){for(var a in this.__events)p.forEach(this.__events[a],function(a){a&&a.remove&&a.remove()});delete this.__events}},destroy:function(){this.inherited&&this.inherited(arguments);this._destroyHandles()},once:function(a,c){function e(){g.removeListener(a,c);return c.apply(g,arguments)}var g=this;e.listener=c;g.on(a,e);return this},_emit:function(a){if(this.__events){if(!this._didRegisterSubscribers&&this.subscribers){for(var c=0;c<this.subscribers.length;c++){var e=
this.subscribers[c];this._on(e.event,e.handler,e.owner)}this._didRegisterSubscribers=!0}if(!0===arguments[2])throw Error("Please use emit.sticky() instead of passing sticky\x3dtrue for event: "+a);c=this.__events[a];e=1<arguments.length?arguments[2]:null;if(c){var g;if("function"==typeof c)switch(arguments.length){case 1:return c.call(this);case 2:return c.call(this,arguments[1]);case 3:return c.call(this,arguments[1],arguments[2]);default:var d=Array.prototype.slice.call(arguments,1);g=c.apply(this,
d)}else if(_.isArray(c))for(var d=Array.prototype.slice.call(arguments,1),b=c.slice(),l,q=l=null,c=0,f=b.length;c<f;c++)l=b[c],q=l.owner||this,d&&d[0]&&(d[0].owner=d[0]?d[0].owner||q:null),l=l.handler.apply(q,d),void 0!==l&&(g=l);e&&!0===e["public"]&&this.publish(a,d);return g}}},unsubscribe:function(a,c){if(!this.__events||!this.__events[a])return this;if("function"!==typeof c||!c)return p.forEach(this.__events[a],dojo.unsubscribe),delete this.__events[a],this.__events[a]=[],this;var e=this.__events[a];
if(isArray(e)){if(!e.some(function(a,d){if((a.listener||a)==c)return e.splice(d,1),!0}))return this;0===e.length&&delete this.__events[a]}else(this.__events[a].listener||this.__events[a])===c&&delete this.__events[a];"removeListener"!=a&&this.emit("removeListener",a,c);return this},listeners:function(a){this.__events||(this.__events={});this.__events[a]||(this.__events[a]=[]);isArray(this.__events[a])||(this.__events[a]=[this.__events[a]]);return this.__events[a]},addHandle:function(a,c){this.__events||
(this.__events={});this.__events[a]||(this.__events[a]=[]);c.type=a;this.__events[a].push(c);return c},__on:function(a,c,e,g){var d=g;"function"!=typeof e||g||(g=e,e=null);a=a.jquery?a:$(a);a.on(c,e,g);this.__events||(this.__events={});this.__events[c]||(this.__events[c]=[]);var b=this.__events[c];a={handler:d,owner:this,type:c,element:a,selector:e,remove:function(){b.remove(this);this.element.off(this.type,this.selector,this.handler)}};b.push(a);return a},_on:function(a,c,e){try{this.__events||(this.__events=
{});this.__events[a]||(this.__events[a]=[]);var g=this.__events[a];if(!g)this.__events[a]=c;else if(_.isArray(g)){if(-1!=g.indexOf(c))return console.warn("adding same listener twice",a);a={handler:c,owner:e||this,type:a,remove:function(){g.remove(this);this.handler=this.owner=null;delete this.type}};g.push(a);return a}}catch(d){logError(d)}return this}};m=m(null,k);m.Impl=k;m.dcl=n(null,k);return m})},"nxapp/Commons":function(){define("dojo/_base/declare dojo/has dojo/_base/lang nxapp/types/Types xide/factory xide/factory/Events xide/factory/Objects xide/utils/StringUtils xide/utils/CIUtils xide/utils/ObjectUtils xide/utils/StoreUtils xide/utils nxapp/utils dojo/node!os".split(" "),
function(p,n,m,k,h,f,a,c,e,g,d,b,l,q){p="linux";"win32"===q.platform()?p="windows":"darwin"===q.platform()?p="osx":"linux"===q.platform()&&"arm"==q.arch()&&(p="arm");"arm"===p?n.add("serialport",function(){return!1}):n.add("serialport",function(){return!0});b.mixin(l,b);Array.prototype.remove=function(){for(var b,a=arguments,d=a.length,l;d&&this.length;)for(b=a[--d];-1!=(l=this.indexOf(b));)this.splice(l,1);return this};Array.prototype.contains=function(b){for(var a=this.length;a--;)if(this[a]==b)return!0;
return!1};Array.prototype.indexOfPropertyValue||(Array.prototype.indexOfPropertyValue=function(b,a){for(var d=0;d<this.length;d++)if(this[d][b]&&this[d][b]==a)return d;return-1});"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(b){return this.substring(0,b.length)===b});"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(b){return this.substring(this.length-b.length,this.length)===b})})},"xide/factory/Objects":function(){define(["dcl/dcl",
"xide/utils","xide/factory","xdojo/declare"],function(p,n,m,k){m.createInstance=function(h,f,a){var c={};n.mixin(c,f);f=h;if(_.isString(h)&&(f=dojo.getObject(f)||p.getObject(f),!f))return console.error("no such class : "+h),null;a&&(f=k(a,f.prototype));(h=new f(c))&&(h.ctrArgs=c);return h};return m})},"xide/utils/StringUtils":function(){define(["dojo/_base/lang","xide/utils","xide/types","dojo/json"],function(p,n,m,k){function h(f,a){var c=[],e=[];null==a&&(a=function(a,d){return c[0]===d?"[Circular ~]":
"[Circular ~."+e.slice(0,c.indexOf(d)).join(".")+"]"});return function(g,d){if(0<c.length){var b=c.indexOf(this);~b?c.splice(b+1):c.push(this);~b?e.splice(b,Infinity,g):e.push(g);~c.indexOf(d)&&(d=a.call(this,g,d))}else c.push(d);return null==f?d:f.call(this,g,d)}}n.stringify=function(f){return JSON.stringify(f,h(),2)};n.humanFileSize=function(f,a){var c=a?1E3:1024;if(Math.abs(f)<c)return f+" B";var e=a?"kB MB GB TB PB EB ZB YB".split(" "):"KiB MiB GiB TiB PiB EiB ZiB YiB".split(" "),g=-1;do f/=c,
++g;while(Math.abs(f)>=c&&g<e.length-1);return f.toFixed(1)+" "+e[g]};"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(f){return 0===this.indexOf(f)});n.isNativeEvent=function(f){var a={onclick:null,ondblclick:null,onmousedown:null,onmouseup:null,onmouseover:null,onmousemove:null,onmouseout:null,onkeypress:null,onkeydown:null,onkeyup:null,onfocus:null,onblur:null,onchange:null};if(f in a)return!0;a={click:null,dblclick:null,mousedown:null,mouseup:null,mouseover:null,
mousemove:null,mouseout:null,keypress:null,keydown:null,keyup:null,focus:null,blur:null,change:null};return f in a};n.isSystemEvent=function(f){for(var a in m.EVENTS)if(m.EVENTS[a]===f)return!0;return!1};n.contains=function(f,a){for(var c=0;c<f.length;c++)if(f[c]===a)return c;return-1};n.getObjectKeyByValue=function(f,a){if(f&&a)for(var c in f)if(f.hasOwnProperty(c)&&f[c]===a)return c;return null};n.removeURLParameter=function(f,a){var c=f.split("?");if(2<=c.length){for(var e=encodeURIComponent(a)+
"\x3d",g=c[1].split(/[&;]/g),d=g.length;0<d--;)-1!==g[d].lastIndexOf(e,0)&&g.splice(d,1);f=c[0]+"?"+g.join("\x26")}return f};n.replaceUrlParam=function(f,a,c){var e=f.replace(new RegExp("("+a+"\x3d).*?(\x26|$)"),"$1"+c+"$2");e==f&&(e=e+(0<e.indexOf("?")?"\x26":"?")+a+"\x3d"+c);return e};n.buildPath=function(f,a,c){var e=""+f,e=n.replaceAll("/","",f);f=(""+a).replace("./","/").replace(/^\/|\/$/g,"");e=e+"://"+f;return!0===c?encodeURIComponent(e):e};n.isImage=function(f){return null!=f.toLowerCase().match(/\.(jpeg|jpg|gif|png)$/)};
n.hasFlag3=function(f,a){return 1<<a&f?!0:!1};n.hasFlag=function(f,a){return 1<<a&f?!0:!1};n.disableFlag=function(f,a){return f&~(1<<a)};n.cleanUrl=function(f){f&&(f=f.replace("//","/"),f=f.replace("./","/"),f=f.replace("http:/","http://"),f=f.replace("./","/"),f=f.replace("XApp-portletxasweb","XApp-portlet/xasweb"),f=f.replace("XApp-portletutils","XApp-portlet/utils"),f=f.replace("/XApp-portlet/CMAC/","/CMAC/"),f=f.replace("////","/"),f=f.replace("///","/"));return f};n.getJson=function(f,a,c){try{return _.isString(f)?
k.parse(f,!1):!0===a?null:f}catch(e){!1!==c&&console.error("error parsing json data "+f+" error \x3d "+e)}return null};n.fromJson=function(f){if(!p.isString(f))return f;var a=null,c=!1;try{a=eval("("+f+")",{})}catch(e){c=!0}if(c){f=f.substring(f.indexOf("{"),f.lastIndexOf("}")+1);try{a=eval("("+f+")",{})}catch(g){throw Error(f);}}return a};n.replaceAll=function(f,a,c){return c?c.split(f).join(a):""};n.isValidString=function(f){return null!=f&&null!=f.length&&0<f.length&&"undefined"!=f};n.substituteString=
function(f,a){return f.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(c,e){return a[e]})};n.findOcurrences=function(f,a){var c=n.escapeRegExp(a.begin),e=n.escapeRegExp(a.end);return f.match(new RegExp(c+"("+("[^"+e+"]*")+")"+e,"g"))};n.escapeRegExp=function(f){for(var a="[ ] ( ) { } * + . | ||".split(" "),c=0;c<a.length;c++)f=f.replace(a[c],"\\"+a[c]);return f};n.findOcurrences=function(f,a){var c=n.escapeRegExp(a.begin),e=n.escapeRegExp(a.end);return f.match(new RegExp(c+"("+("[^"+e+"]*")+
")"+e,"g"))};n.multipleReplace=function(f,a){var c=[],e;for(e in a)c[c.length]=e;return f.replace(new RegExp(c.join("\\b|\\b"),"g"),function(c){return a[c]||a["\\"+c]})};n.replace=function(f,a,c,e){if(!f)return"";if(c&&p.isObject(c)||p.isArray(c)){if(e){a=n.findOcurrences(f,e);var g=n.replaceAll;if(a)for(var d=0,b=a.length;d<b;d++){var l=a[d],q=g(e.begin,"",l),q=g(e.end,"",q);f=g(l,c[q],f)}}else return n.multipleReplace(f,c);return f}return n.replaceAll(a,c,f)};n.capitalize=function(f){return f.substring(0,
1).toUpperCase()+f.substring(1)};n.vsprintf=function(f,a){return n.sprintf.apply(this,[f].concat(a))};n.sprintf=function(){var f=arguments,a=0,c=function(a,b,l,c){l||(l=" ");b=a.length>=b?"":Array(1+b-a.length>>>0).join(l);return c?a+b:b+a},e=function(a,b,l,g,e,f){var h=g-a.length;0<h&&(a=l||!e?c(a,g,f,l):a.slice(0,b.length)+c("",h,"0",!0)+a.slice(b.length));return a},g=function(a,b,l,g,f,h,k){a>>>=0;l=l&&a&&{2:"0b",8:"0",16:"0x"}[b]||"";a=l+c(a.toString(b),h||0,"0",!1);return e(a,l,g,f,k)};return f[a++].replace(/%%|%(\d+\$)?([-+\'#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuideEfFgG])/g,
function(d,b,l,q,h,k,m){var n,p;if("%%"===d)return"%";var u=!1;p="";var w=h=!1;n=" ";for(var C=l.length,A=0;l&&A<C;A++)switch(l.charAt(A)){case " ":p=" ";break;case "+":p="+";break;case "-":u=!0;break;case "'":n=l.charAt(A+1);break;case "0":h=!0;break;case "#":w=!0}q=q?"*"===q?+f[a++]:"*"==q.charAt(0)?+f[q.slice(1,-1)]:+q:0;0>q&&(q=-q,u=!0);if(!isFinite(q))throw Error("sprintf: (minimum-)width must be finite");k=k?"*"===k?+f[a++]:"*"==k.charAt(0)?+f[k.slice(1,-1)]:+k:-1<"fFeE".indexOf(m)?6:"d"===
m?0:void 0;b=b?f[b.slice(0,-1)]:f[a++];switch(m){case "s":return m=String(b),null!=k&&(m=m.slice(0,k)),e(m,"",u,q,h,n);case "c":return m=String.fromCharCode(+b),null!=k&&(m=m.slice(0,k)),e(m,"",u,q,h,void 0);case "b":return g(b,2,w,u,q,k,h);case "o":return g(b,8,w,u,q,k,h);case "x":return g(b,16,w,u,q,k,h);case "X":return g(b,16,w,u,q,k,h).toUpperCase();case "u":return g(b,10,w,u,q,k,h);case "i":case "d":return n=+b||0,n=Math.round(n-n%1),d=0>n?"-":p,b=d+c(String(Math.abs(n)),k,"0",!1),e(b,d,u,q,
h);case "e":case "E":case "f":case "F":case "g":case "G":return n=+b,d=0>n?"-":p,p=["toExponential","toFixed","toPrecision"]["efg".indexOf(m.toLowerCase())],m=["toString","toUpperCase"]["eEfFgG".indexOf(m)%2],b=d+Math.abs(n)[p](k),e(b,d,u,q,h)[m]();default:return d}})};n.cleanString=function(f){return f?f=f.replace(/[\r]/g,"").replace(/[\b]/g,"").replace(/[\f]/g,"").replace(/[\n]/g,"").replace(/\\/g,""):null};n.normalizePath=function(f){if(!f)return null;f=n.cleanString(f);f=f.replace("./","");f=
f.replace("/.","");return f=f.replace(/([^:]\/)\/+/g,"$1")};m.PATH_PARTS={DIRNAME:1,BASENAME:2,EXTENSION:4,FILENAME:8,PATHINFO_ALL:0};n.basename=function(f,a){var c=f,e=c.charAt(c.length-1);if("/"===e||"\\"===e)c=c.slice(0,-1);c=c.replace(/^.*[\/\\]/g,"");"string"===typeof a&&c.substr(c.length-a.length)==a&&(c=c.substr(0,c.length-a.length));return c};n.pathinfo=function(f,a){var c="",e="",g="",d=0,b={},l=0,q=0,h=l=!1,k=!1;if(!f)return!1;a||(a="PATHINFO_ALL");var m={PATHINFO_DIRNAME:1,PATHINFO_BASENAME:2,
PATHINFO_EXTENSION:4,PATHINFO_FILENAME:8,PATHINFO_ALL:0};for(g in m)m.hasOwnProperty(g)&&(m.PATHINFO_ALL|=m[g]);if("number"!==typeof a){a=[].concat(a);for(q=0;q<a.length;q++)m[a[q]]&&(d|=m[a[q]]);a=d}g=function(b){b+="";var a=b.lastIndexOf(".")+1;return a?a!==b.length?b.substr(a):"":!1};a&m.PATHINFO_DIRNAME&&(d=f.replace(/\\/g,"/").replace(/\/[^\/]*\/?$/,""),b.dirname=d===f?".":d);a&m.PATHINFO_BASENAME&&(!1===l&&(l=n.basename(f)),b.basename=l);a&m.PATHINFO_EXTENSION&&(!1===l&&(l=n.basename(f)),!1===
h&&(h=g(l)),!1!==h&&(b.extension=h));a&m.PATHINFO_FILENAME&&(!1===l&&(l=n.basename(f)),!1===h&&(h=g(l)),!1===k&&(k=l.slice(0,l.length-(h?h.length+1:!1===h?0:1))),b.filename=k);l=0;for(c in b)b.hasOwnProperty(c)&&(l++,e=c);return 1===l?b[e]:b};n.parse_url=function(f,a){var c;c="source scheme authority userInfo user pass host port relative path directory file query fragment".split(" ");for(var e=this.php_js&&this.php_js.ini||{},g=e["phpjs.parse_url.mode"]&&e["phpjs.parse_url.mode"].local_value||"php",
d={php:/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/\/?)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},
d=d[g].exec(f),b={},l=14;l--;)d[l]&&(b[c[l]]=d[l]);if(a)return b[a.replace("PHP_URL_","").toLowerCase()];if("php"!==g){var q=e["phpjs.parse_url.queryKey"]&&e["phpjs.parse_url.queryKey"].local_value||"queryKey",d=/(?:^|&)([^&=]*)=?([^&]*)/g;b[q]={};c=b[c[12]]||"";c.replace(d,function(a,d,c){d&&(b[q][d]=c)})}delete b.source;return b};n.getMimeTable=function(){return{mid:"midi.png",txt:"txt2.png",sql:"txt2.png",js:"javascript.png",gif:"image.png",jpg:"image.png",html:"html.png",htm:"html.png",rar:"archive.png",
gz:"zip.png",tgz:"archive.png",z:"archive.png",ra:"video.png",ram:"video.png",rm:"video.png",pl:"source_pl.png",zip:"zip.png",wav:"sound.png",php:"php.png",php3:"php.png",phtml:"php.png",exe:"exe.png",bmp:"image.png",png:"image.png",css:"css.png",mp3:"sound.png",m4a:"sound.png",aac:"sound.png",xls:"spreadsheet.png",xlsx:"spreadsheet.png",ods:"spreadsheet.png",sxc:"spreadsheet.png",csv:"spreadsheet.png",tsv:"spreadsheet.png",doc:"word.png",docx:"word.png",odt:"word.png",swx:"word.png",rtf:"word.png",
ppt:"presentation.png",pps:"presentation.png",odp:"presentation.png",sxi:"presentation.png",pdf:"pdf.png",mov:"video.png",avi:"video.png",mpg:"video.png",mpeg:"video.png",mp4:"video.png",m4v:"video.png",ogv:"video.png",webm:"video.png",wmv:"video.png",swf:"flash.png",flv:"flash.png",tiff:"image.png",tif:"image.png",svg:"image.png",psd:"image.png",ers:"horo.png"}};n.getMimeTable2=function(){return{mid:"fa-file-audio-o",txt:"fa-file-text-o",sql:"fa-cube",js:"fa-cube",gif:"fa-file-picture-o",jpg:"fa-file-picture-o",
html:"fa-cube",htm:"fa-cube",rar:"fa-file-zip-o",gz:"fa-file-zip-o",tgz:"fa-file-zip-o",z:"fa-file-zip-o",ra:"fa-file-movie-o",ram:"fa-file-movie-o",rm:"fa-file-movie-o",pl:"source_pl.png",zip:"fa-file-zip-o",wav:"fa-file-audio-o",php:"fa-cube",php3:"fa-cube",phtml:"fa-cube",exe:"fa-file-o",bmp:"fa-file-picture-o",png:"fa-file-picture-o",css:"fa-cube",mp3:"fa-file-audio-o",m4a:"fa-file-audio-o",aac:"fa-file-audio-o",xls:"fa-file-excel-o",xlsx:"fa-file-excel-o",ods:"fa-file-excel-o",sxc:"fa-file-excel-o",
csv:"fa-file-excel-o",tsv:"fa-file-excel-o",doc:"fa-file-word-o",docx:"fa-file-word-o",odt:"fa-file-word-o",swx:"fa-file-word-o",rtf:"fa-file-word-o",ppt:"fa-file-powerpoint-o",pps:"fa-file-powerpoint-o",odp:"fa-file-powerpoint-o",sxi:"fa-file-powerpoint-o",pdf:"fa-file-pdf-o",mov:"fa-file-movie-o",avi:"fa-file-movie-o",mpg:"fa-file-movie-o",mpeg:"fa-file-movie-o",mp4:"fa-file-movie-o",m4v:"fa-file-movie-o",ogv:"fa-file-movie-o",webm:"fa-file-movie-o",wmv:"fa-file-movie-o",swf:"fa-file-movie-o",flv:"fa-file-movie-o",
tiff:"fa-file-picture-o",tif:"fa-file-picture-o",svg:"fa-file-picture-o",psd:"fa-file-picture-o",ers:"horo.png"}};n.getIconTable=function(){return{mid:"midi.png",txt:"txt2.png",sql:"txt2.png",js:"javascript.png",gif:"image.png",jpg:"image.png",html:"html.png",htm:"html.png",rar:"archive.png",gz:"zip.png",tgz:"archive.png",z:"archive.png",ra:"video.png",ram:"video.png",rm:"video.png",pl:"source_pl.png",zip:"zip.png",wav:"sound.png",php:"php.png",php3:"php.png",phtml:"php.png",exe:"exe.png",bmp:"image.png",
png:"image.png",css:"css.png",mp3:"sound.png",m4a:"sound.png",aac:"sound.png",xls:"spreadsheet.png",xlsx:"spreadsheet.png",ods:"spreadsheet.png",sxc:"spreadsheet.png",csv:"spreadsheet.png",tsv:"spreadsheet.png",doc:"word.png",docx:"word.png",odt:"word.png",swx:"word.png",rtf:"word.png",ppt:"presentation.png",pps:"presentation.png",odp:"presentation.png",sxi:"presentation.png",pdf:"pdf.png",mov:"video.png",avi:"video.png",mpg:"video.png",mpeg:"video.png",mp4:"video.png",m4v:"video.png",ogv:"video.png",
webm:"video.png",wmv:"video.png",swf:"flash.png",flv:"flash.png",tiff:"image.png",tif:"image.png",svg:"image.png",psd:"image.png",ers:"horo.png"}};n.urlDecode=function(f,a){if(!f||!f.length)return{};for(var c={},e=f.split("\x26"),g,d,b=0,l=e.length;b<l;b++)g=e[b].split("\x3d"),d=decodeURIComponent(g[0]),g=decodeURIComponent(g[1]),null!=g&&"true"===g?g=!0:"false"===g&&(g=!1),!0!==a?"undefined"==typeof c[d]?c[d]=g:("string"==typeof c[d]&&(c[d]=[c[d]]),c[d].push(g)):c[d]=g;return c};n.getUrlArgs=function(f){var a=
{};if(f&&(-1!=f.indexOf("?")||-1!=f.indexOf("\x26"))){f=(f.substr(f.indexOf("?")+1)||location.search.substring(1)).split("\x26");for(var c=0;c<f.length;c++){var e=f[c].indexOf("\x3d"),g=f[c].substring(0,e),e=f[c].substring(e+1),e=decodeURIComponent(e);a[g]=e}}return a};n.urlArgs=function(f){f=n.getUrlArgs(f);var a={},c;for(c in f){var e=f[c],g=n.findOcurrences(e,{begin:"|",end:"|"}),d=null;if(g&&g.length)for(var e=e.replace(g[0],""),g=g[0].substr(1,g[0].length-2).split(","),d={},b=0;b<g.length;b++){var l=
g[b].split(":");d[l[0]]=l[1]}e&&e.length&&(a[c]={value:e,options:d})}return a};n.getIcon=function(f){if(!f)return"txt2.png";if(f=n.getFileExtension(f)){var a=n.getMimeTable();if(null!=a[f])return a[f]}return"txt2.png"};n.getIconClass=function(f){if(!f)return"fa-file-o";f=n.getFileExtension(f);if(m.customMimeIcons[f])return m.customMimeIcons[f];if(f){var a=n.getMimeTable2();if(null!=a[f])return a[f]}return"fa-file-o"};n.getFileExtension=function(f){if(!f||""==f)return"";f=n.getBaseName(f).split(".");
return 1<f.length?f[f.length-1].toLowerCase():""};n.getBaseName=function(f){if(null==f)return null;var a="/";-1!=f.indexOf("\\")&&(a="\\");return f.substr(f.lastIndexOf(a)+1,f.length)};n.createUUID=function(){var f=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return f()+f()+"-"+f()+"-"+f()+"-"+f()+"-"+f()+f()+f()};n.strip_tags=function(f,a){a=(((a||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return f.replace(/\x3c!--[\s\S]*?--\x3e|<\?(?:php)?[\s\S]*?\?>/gi,
"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(c,e){return-1<a.indexOf("\x3c"+e.toLowerCase()+"\x3e")?c:""})};return n})},"xide/utils/CIUtils":function(){define("dojo/_base/declare dojo/_base/lang xide/utils xide/types xide/factory dojo/has".split(" "),function(p,n,m,k,h,f){m.toOptions=function(a){a=m.flattenCIS(a);for(var c=[],e=0;e<a.length;e++){var g=a[e];c.push({name:m.toString(g.name),value:m.getCIValue(g),type:m.toInt(g.type),enumType:m.toString(g.enumType),visible:m.toBoolean(g.visible),
active:m.toBoolean(g.active),changed:m.toBoolean(g.changed),group:m.toString(g.group),user:m.toObject(g.user),dst:m.toString(g.dst),params:m.toString(g.params)})}return c};m.getEventsAsOptions=function(a){var c=[{label:"Select Event",value:""}],e;for(e in k.EVENTS)c.push({label:k.EVENTS[e],value:k.EVENTS[e]});c=c.concat([{label:"onclick",value:"onclick"},{label:"ondblclick",value:"dblclick"},{label:"onmousedown",value:"mousedown"},{label:"onmouseup",value:"mouseup"},{label:"onmouseover",value:"mouseover"},
{label:"onmousemove",value:"mousemove"},{label:"onmouseout",value:"mouseout"},{label:"onkeypress",value:"keypress"},{label:"onkeydown",value:"keydown"},{label:"onkeyup",value:"keyup"},{label:"onfocus",value:"focus"},{label:"onblur",value:"blur"},{label:"On Load",value:"Load"}]);for(e=0;e<c.length;e++){var g=c[e];if(g.value===a){g.selected=!0;break}}return c};m.flattenCIS=function(a){for(var c=[],e=[],g=0;g<a.length;g++){var d=a[g],b=m.toInt(d.type);b>k.ECIType.END&&(b=k.resolveType(b))&&(n.mixin(c,
b),e.push(d))}0<c.length&&(a=a.concat(c));if(e)for(g in e)a.remove(e[g]);return a};m.arrayContains=function(a,c){for(var e=0;e<a.length;e++)if(a[e]===c)return!0;return!1};m.setStoreCIValueByField=function(a,c,e){null==a[c]&&(a[c]=[]);a[c][0]=m.getStringValue(e);return a};m.createOption=function(a,c,e){a={label:a,value:null!=c?c:a};e&&n.mixin(a,e);return a};m.createCI=function(a,c,e,g,d){a={dataRef:null,dataSource:null,name:a,group:-1,id:a,title:a,type:c,uid:-1,value:null!=e?e:-1,visible:!0,enumType:-1,
"class":"cmx.types.ConfigurableInformation"};g&&n.mixin(a,g);d&&d.publish&&h.publish(d.publish,{CI:a,owner:d.owner},d.owner);return a};m.createCIAsArray=function(a,c,e,g){return{chainType:[e?e:0],dataRef:[null],dataSource:[null],params:[],name:[a],group:[-1],id:[a],title:[a],type:[c],uid:[-1],value:[g?g:-1],visible:[!0],enumType:[-1],parentId:[-1],"class":["cmx.types.ConfigurableInformation"]}};m.hasValue=function(a){return a.value&&null!=a.value[0]&&0<a.value[0].length&&"0"!=a.value[0]&&"undefined"!=
a.value[0]&&"Unset"!=a.value[0]};m.hasValueAndDataRef=function(a){return a.value&&null!=a.value[0]&&0<a.value[0].length&&"0"!=a.value[0]&&"undefined"!=a.value[0]&&"Unset"!=a.value[0]&&a.dataRef&&null!=a.dataRef[0]&&0<a.dataRef[0].length&&"0"!=a.dataRef[0]&&"undefined"!=a.dataRef[0]};m.getInputCIByName=function(a,c){if(!a)return null;var e=a.inputs;e||(e=a);if(null!=e)for(var g=0;g<e.length;g++){var d=e[g],b=m.getStringValue(d.name);if(null!=b&&b.toLowerCase()===c.toLowerCase())return d}return null};
m.getCIByChainAndName=function(a,c,e){if(!a)return null;(c=0==c?a.inputs:1==c?a.outputs:null)||(c=a);if(null!=c)for(a=0;a<c.length;a++){var g=c[a],d=m.getStringValue(g.name);if(null!=d&&d.toLowerCase()===e.toLowerCase())return g}return null};m.getCIByUid=function(a,c){if(null!=a)for(var e=0;e<a.length;e++){var g=a[e],d=m.getStringValue(g.uid);if(null!=d&&d===c)return g}return null};m.getCIById=function(a,c,e){a=0==c?a.inputs:1==c?a.outputs:null;if(null!=a)for(c=0;c<a.length;c++){var g=a[c];if(g.id[0]==
e[0])return g}return null};m.getCIInputValueByName=function(a,c){var e=m.getCIByChainAndName(a,0,c);return e?e.value:null};m.getCIValue=function(a){return m.getCIValueByField(a,"value")};m.getStringValue=function(a){return m.toString(a)};m.toString=function(a){return null!=a?_.isArray(a)?a&&1==a.length&&null==a[0]?null:""+(null!=a[0]?a[0]:a):""+a:null};m.setIntegerValue=function(a,c){null!=a&&dojo.isArray(a)&&(a[0]=c)};m.getCIValueByField=function(a,c){return null!=a[c]?n.isArray(a[c])?a[c][0]?a[c][0]:
a[c]:a[c]:null};m.setCIValueByField=function(a,c,e){if(!a)return a;null==a[c]&&(a[c]=[]);a[c]=e;return a};m.setCIValue=function(a,c,e){(a=m.getInputCIByName(a,c))&&m.setCIValueByField(a,"value",e);return a};m.getCIInputValueByNameAndField=function(a,c,e){return(a=m.getCIByChainAndName(a,0,c))?a[""+e]:null};m.getCIInputValueByNameAndFieldStr=function(a,c,e){return(a=m.getCIInputValueByNameAndField(a,c,e))?m.getStringValue(a):null};m.getCIInputValueByNameAndFieldBool=function(a,c,e){return(a=m.getCIInputValueByNameAndField(a,
c,e))?m.toBoolean(a):null};m.getCIWidgetByName=function(a,c){for(var e=0;e<a.length;e++){var g=a[e];if(g._widget&&g.name===c)return g._widget}return null};return m})},"xide/utils/StoreUtils":function(){define(["xide/utils","dojo/store/Memory"],function(p,n){p.removeFromStore=function(m,k,h,f,a){m.getSync(k[f])&&console.error("no such item !! ",m);m.removeSync(k[f]);var c={};c[a]=k[f];if((k=m.query(c))&&k.length)for(c=0;c<k.length;c++)p.removeFromStore(m,k[c],h,f,a)};p.toString=function(m){return null!=
m?dojo.isArray(m)?m&&1==m.length&&null==m[0]?null:""+(null!=m[0]?m[0]:m):""+m:null};p.toBoolean=function(m){var k=!1;null!=m&&(m=m[0]?m[0]:m,null!=m&&(k=!(!0!==m&&"true"!==m&&"1"!==m)));return k};p.toObject=function(m){return null!=m?m[0]?m[0]:m:null};p.toInt=function(m){var k=-1;if(null!=m&&(m=1<m.length?m:m[0]?m[0]:m,null!=m))try{k=parseInt(m)}catch(h){}return k};p.deleteStoreItemById=function(m,k){var h=!1;m.fetch({query:{id:k},queryOptions:{deep:!0},onComplete:function(f){for(;0<f.length;){m.deleteItem(f[0]);
m.save();h=!0;break}}});return h};p.getStoreItemByName=function(m,k){var h=null;m.fetch({query:{name:k},queryOptions:{deep:!0},onComplete:function(f){h=0<f.length?f[0]:null}});return h};p.getStoreItemById=function(m,k){return p.queryStoreEx(m,{id:k})};p.getAppDataElementByIdAndType=function(m,k,h){return p.queryStore(m,{uid:k,type:h})};p.getElementsByType=function(m,k){return p.queryStoreEx(m,{type:k})};p.queryStoreEx=function(m,k,h,f){if(!m)return console.error("utils.queryStoreEx: store \x3d null"),
console.trace(),null;if(null!=dojo.store&&m instanceof dojo.store.Memory||m instanceof xide.data.Memory)return p.queryMemoryStoreEx(m,k);var a=null;m.fetch?m.fetch({query:k,queryOptions:{deep:!0},onComplete:function(c){a=c}}):m.query&&(a=m.query(k));return null!=h&&!0===h&&a&&0==a.length?null:!0===f&&a&&1==a.length?a[0]:a};p.queryStore=function(m,k,h){return null!=dojo.store&&m instanceof dojo.store.Memory?p.queryMemoryStoreSingle(m,k):(m=p.queryStoreEx(m,k))&&1==m.length?m[0]:null!=h&&!0===h&&m&&
0==m.length?null:m};p.queryMemoryStoreEx=function(m,k){var h=[];m.query(k).forEach(function(f){h.push(f)});return h};p.queryMemoryStoreSingle=function(m,k){var h=p.queryMemoryStoreEx(m,k);return 1==h.length?h[0]:h};return p})},"nxapp/manager/FileManager":function(){define("dojo/_base/declare dcl/dcl dojo/has nxapp/manager/ManagerBase nxapp/utils/_LogMixin xide/types xide/factory dojo/node!util dojo/node!path dojo/node!fs dojo/node!child_process dojo/node!watchr".split(" "),function(p,n,m,k,h,f,a,
c,e,g,d,b){var l=m("windows"),q=m("arm");return n([k,h],{declaredClass:"nxapp.manager.FileManager",initWindows_Watchr:function(d){for(var c=0;c<d.watchr.paths.length;c++){var l=d.watchr.paths[c],q=e.resolve(dojoConfig.libRoot),h=e.resolve(dojoConfig.clientRoot);"/"==l[0]?l=e.resolve(l):e.resolve(q+"/"+l)?d.watchr.paths[c]=e.resolve(q+"/"+l):g.existsSync(e.resolve(l))?d.watchr.paths[c]=e.resolve(l):e.resolve(h+"/"+l)&&(d.watchr.paths[c]=e.resolve(h+"/"+l))}var k=this;b.watch({paths:d.watchr.paths,
interval:500,listeners:{log:function(b){},error:function(b){console.log("an error occured:",b)},watching:function(b,a,d){b?console.log("watching the path "+a.path+" failed with error",b):console.log("watching the path "+a.path+" completed")},change:function(b,d,l,c){d&&a.publish(f.EVENTS.ON_FILE_CHANGED,{path:d,modulePath:d.replace(dojoConfig.libRoot,"")},k)}},next:function(b,a){if(b)return console.log("watching everything failed with error",b);console.log("watching everything completed")}})},initWindows:function(b){for(var a=
0;a<b.watchr.paths.length;a++){var l=b.watchr.paths[a],c=e.resolve(dojoConfig.libRoot),q=e.resolve(dojoConfig.clientRoot);"/"==l[0]?l=e.resolve(l):e.resolve(c+"/"+l)?b.watchr.paths[a]=e.resolve(c+"/"+l):g.existsSync(e.resolve(l))?b.watchr.paths[a]=e.resolve(l):e.resolve(q+"/"+l)&&(b.watchr.paths[a]=e.resolve(q+"/"+l))}var f=new function(b,a,l,c){var g=d.spawn;b=g(b,a);var e=this;b.stdout.on("data",function(b){l(e,b)});b.stdout.on("end",c)}(e.resolve(global.cwd+"/inotifywait.exe"),["-r","-m","-q",
"--format\x3d%w|%e|%f",b.watchr.paths[0]],function(b,a){b.stdout="";for(var d=a.toString().split(/(\r?\n)/g),l=0;l<d.length;l++){var c=d[l];if(c&&5<c.length&&(c=c.split("|"),3==c.length)){var g=e.resolve(c[0]+"/"+c[2]);console.log("file changed : "+c[1]+" path:"+g)}}},function(){console.log("end : "+f.stdout)})},init:function(b){if(l||q)return this.initWindows_Watchr(b);var a=this,d=require;try{d(["dojo/node!inotify-plusplus"],function(d){a.initLinux(b,d)})}catch(c){return console.error("cant load inotify, proceed with watchr "+
c.message),this.initWindows_Watchr(b)}},initLinux:function(b,d){for(var l=0;l<b.watchr.paths.length;l++){var c=b.watchr.paths[l],q=e.resolve(dojoConfig.libRoot),h=e.resolve(dojoConfig.clientRoot);"/"==c[0]?c=e.resolve(c):e.resolve(q+"/"+c)?b.watchr.paths[l]=e.resolve(q+"/"+c):g.existsSync(e.resolve(c))?b.watchr.paths[l]=e.resolve(c):e.resolve(h+"/"+c)&&(b.watchr.paths[l]=e.resolve(h+"/"+c))}for(var k=this,m=function(b){var a=[];g.existsSync(b)&&g.readdirSync(b).forEach(function(d){d=b+"/"+d;var l=
g.statSync(d);l&&l.isDirectory()&&(a.push(d),a=a.concat(m(d)))});return a},c=function(){return{all_events:function(b){if(b&&b.name&&b.name.indexOf&&-1==b.name.indexOf(".git")&&-1==b.name.indexOf(".tmp")&&-1==b.name.indexOf("_jb_old_")&&-1==b.name.indexOf("_jb_bak_")&&-1==b.masks.toString().indexOf("access")){b.masks.toString().indexOf("moved_to");var d=e.resolve(b.watch+"/"+b.name);b=b.masks.toString().replace("all_events,","");var l="changed";-1!==b.indexOf("delete")&&(l="deleted");d&&a.publish(f.EVENTS.ON_FILE_CHANGED,
{path:d,modulePath:d.replace(dojoConfig.libRoot,""),mask:b,type:l},k)}},close_write:function(b){-1==b.name.indexOf(".git")&&-1==b.name.indexOf(".tmp")&&-1==b.name.indexOf("_jb_old_")&&-1==b.name.indexOf("_jb_bak_")&&-1==b.masks.toString().indexOf("access")&&-1==b.masks.toString().indexOf("moved_to")&&(b=e.resolve(b.watch+"/"+b.name))&&a.publish(f.EVENTS.ON_FILE_CHANGED,{path:b,modulePath:b.replace(dojoConfig.libRoot,"")},k)},access:!0,moved_to:!0,moved_from:!0,"delete":!0}}(),q=d.create(!1),h=0;h<
b.watchr.paths.length;h++)if(l=b.watchr.paths[h],g.existsSync(l)){var n=m(l);q.watch(c,l);for(l=0;l<n.length;l++)q.watch(c,n[l])}else console.error("directory : "+l+" doesnt exists")}})})},"nxapp/client/WebSocket":function(){define(["dojo/_base/declare","dojo/_base/lang","nxapp/utils/_LogMixin","nxapp/client/ClientBase","dojo/node!sockjs-client"],function(p,n,m,k,h){return p("nxapp.client.WebSocket",[k,m],{_socket:null,debugConnect:!0,connect:function(f){this.options=n.mixin(this.options,f);f=this.options.host;
var a=this.options.port;this.options.debug&&this.initLogger(this.options.debug);this.log("Sock-JS-Client Connecting to "+f+":"+a,"socket_client");var c=h.create(f+":"+a),e=this;c.on("close",function(){console.log("on close!",e.options)});c.on("connection",function(){e.log("socket client connected","socket_client");c.on("error",function(a){console.error("Socket client error ")});c.on("end",function(){e.log("socket client connection end","socket_client")})});this._socket=c},emit:function(f,a){this.showDebugMsg("socket_client")&&
(console.log("Emiting: "+f+" with: "),console.dir(a));this._socket.write(a)},onSignal:function(f,a){this._socket.on("data",a)}})})},"nxapp/client/ClientBase":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/_base/lang"],function(p,n,m){return p("nxapp.server.ClientBase",[n],{options:null,_defaultOptions:function(){return{}},init:function(k){this.options=m.mixin(this._defaultOptions(),k.options)}})})},"xcf/types/Types":function(){define(["dojo/_base/lang","xide/types"],function(p,n){p.mixin(n.ITEM_TYPE,
{DEVICE:"Device",DEVICE_GROUP:"Device Group",DRIVER:"Driver",DRIVER_GROUP:"Driver Group",PROTOCOL:"Protocol",PROTOCOL_GROUP:"Protocol Group"});p.mixin(n.EVENTS,{ON_DEBUGGER_READY:"onDebuggerReady",ON_DEVICE_SELECTED:"onDeviceSelected",ON_DEVICE_GROUP_SELECTED:"onDeviceGroupSelected",ON_PROTOCOL_SELECTED:"onProtocolSelected",ON_PROTOCOL_GROUP_SELECTED:"onProtocolGroupSelected",ON_PROTOCOL_CHANGED:"onProtocolChanged",ON_MQTT_MESSAGE:"onMQTTMessage",ON_DEVICE_MESSAGE:"onDeviceMessage",ON_COMMAND_FINISH:"onCommandFinish",
ON_COMMAND_ERROR:"onCommandError",ON_DEVICE_DISCONNECTED:"onDeviceDisconnected",ON_DEVICE_CONNECTED:"onDeviceConnected",ON_DEVICE_STATE_CHANGED:"onDeviceStateChanged",ON_DEVICE_DRIVER_INSTANCE_READY:"onDeviceDriveInstanceReady",ON_DRIVER_SELECTED:"onDriverSelected",ON_DRIVER_GROUP_SELECTED:"onDriverGroupSelected",ON_DRIVER_VARIABLE_ADDED:"onDriverVariableAdded",ON_DRIVER_VARIABLE_REMOVED:"onDriverVariableRemoved",ON_DRIVER_VARIABLE_CHANGED:"onDriverVariableChanged",ON_DRIVER_COMMAND_ADDED:"onDriverCommandAdded",
ON_DRIVER_COMMAND_REMOVED:"onDriverCommandRemoved",ON_DRIVER_COMMAND_CHANGE:"onDriverVariableChanged",ON_SCOPE_CREATED:"onScopeCreated",ON_DRIVER_MODIFIED:"onDriverModified",SET_DEVICE_VARIABLES:"setDeviceVariables"});n.MESSAGE_SOURCE={DEVICE:"DEVICE",GUI:"GUI",BLOX:"BLOX",CODE:"CODE"};n.DEVICE_STATE={CONNECTING:"DeviceIsConnecting",CONNECTED:"DeviceIsConnected",SYNCHRONIZING:"DeviceIsSynchronizing",READY:"DeviceIsReady",DISCONNECTED:"DeviceIsDisconnected",DISABLED:"DeviceIsDisabled"};n.DRIVER_PROPERTY=
{CF_DRIVER_NAME:"CF_DRIVER_NAME",CF_DRIVER_ICON:"CF_DRIVER_ICON",CF_DRIVER_CLASS:"CF_DRIVER_CLASS",CF_DRIVER_ID:"CF_DRIVER_ID",CF_DRIVER_COMMANDS:"CF_DRIVER_COMMANDS",CF_DRIVER_VARIABLES:"CF_DRIVER_VARIABLES",CF_DRIVER_RESPONSES:"CF_DRIVER_RESPONSES"};n.PROTOCOL_PROPERTY={CF_PROTOCOL_TITLE:"Title",CF_PROTOCOL_ICON:"CF_PROTOCOL_ICON",CF_PROTOCOL_CLASS:"CF_PROTOCOL_CLASS",CF_PROTOCOL_ID:"CF_PROTOCOL_ID",CF_PROTOCOL_COMMANDS:"CF_PROTOCOL_COMMANDS",CF_PROTOCOL_VARIABLES:"CF_PROTOCOL_VARIABLES",CF_PROTOCOL_RESPONSES:"CF_PROTOCOL_RESPONSES"};
n.DEVICE_PROPERTY={CF_DEVICE_DRIVER:"Driver",CF_DEVICE_HOST:"Host",CF_DEVICE_PORT:"Port",CF_DEVICE_PROTOCOL:"Protocol",CF_DEVICE_TITLE:"Title",CF_DEVICE_ID:"Id",CF_DEVICE_ENABLED:"Enabled",CF_DEVICE_OPTIONS:"Options",CF_DEVICE_DRIVER_OPTIONS:"DriverOptions"};n.DRIVER_FLAGS={RUNS_ON_SERVER:4};p.mixin(n.ITEM_TYPE,{CF_DRIVER_VARIABLE:"DriverVariable",CF_DRIVER_BASIC_COMMAND:"DriverBasicCommand",CF_DRIVER_CONDITIONAL_COMMAND:"DriverConditionalCommand",CF_DRIVER_RESPONSE_VARIABLE:"DriverResponseVariable"});
n.BLOCK_GROUPS={CF_DRIVER_VARIABLE:"DriverVariable",CF_DRIVER_BASIC_COMMAND:"DriverBasicCommand",CF_DRIVER_CONDITIONAL_COMMAND:"DriverConditionalCommand",CF_DRIVER_RESPONSE_VARIABLE:"DriverResponseVariable",CF_DRIVER_RESPONSE_BLOCKS:"conditionalProcess",CF_DRIVER_RESPONSE_VARIABLES:"processVariables",CF_DRIVER_BASIC_VARIABLES:"basicVariables"};n.COMMAND_TYPES={BASIC_COMMAND:"basic",CONDITIONAL_COMMAND:"conditional"};p.mixin(n.ECIType,{DEVICE_NETWORK_SETTINGS:n.ECIType.END+1,DRIVER_COMMAND_SETTINGS:"CommandSettings"});
n.VFS_ROOTS={SYSTEM_DRIVERS:"system_drivers",USER_DRIVERS:"user_drivers",APP_DRIVERS:"app_drivers"};n.SOCKET_SERVER_COMMANDS={SIGNAL_MANAGER:"Manager_command",SIGNAL_DEVICE:"Device_command",SIGNAL_RESPONSE:"WebSocket_response",MANAGER_TEST:"Manager_Test",MANAGER_CLOSE_ALL:"Close_All_Connections",MANAGER_STATUS:"status",MANAGER_START_DRIVER:"startDriver",MANAGER_STOP_DRIVER:"stopDriver",DEVICE_SEND:"Device_Send",MQTT_PUBLISH:"MQTT_PUBLISH",MQTT_SUBSCRIBE:"MQTT_SUBSCRIBE",GET_DEVICE_VARIABLES:"getVariables",
WRITE_LOG_MESSAGE:"Write_Log_Message"};return n})},"nxapp/manager/DeviceServerContext":function(){define("dcl/dcl nxapp/manager/Context xcf/types/Types dojo/node!path dojo/node!fs nxapp/utils xide/utils/StringUtils xide/types xcf/manager/DriverManager xcf/manager/DeviceManager nxapp/manager/FileManager xcf/manager/Context nxapp/manager/DeviceManager xcf/manager/BlockManager xblox/factory/Blocks dojo/node!tracer nxapp/utils/_console".split(" "),function(p,n,m,k,h,f,a,c,e,g,d,b,l,q,r,t,x){var y=p(null,
{write:function(b){},emit:function(b){}}),v=p(null,{owner:null,remoteAddress:"fake - address",remotePort:"fake - port",constructor:function(b){f.mixin(this,b)},write:function(b){var a=this.owner.getDeviceManager(),d=f.getJson(b),d=d||{};if(d.data&&d.data.device){var l=a.getDeviceStoreItem(d.data.device);if(l&&(l=a.toDeviceControlInfo(l))&&!l.serverSide)return}if(d&&d.data&&d.data.deviceMessage&&d.data.deviceMessage.event===c.EVENTS.ON_COMMAND_FINISH)a.onCommandFinish(d.data.device,d.data.deviceMessage);
else if(d.data&&d.data.deviceMessage&&d.data.deviceMessage.event===c.EVENTS.ON_COMMAND_ERROR)a.onCommandError(d.data.device,d.data.deviceMessage);else if(d.event===c.EVENTS.ON_DEVICE_DISCONNECTED)a.publish(c.EVENTS.ON_DEVICE_DISCONNECTED,d.data);else{if(d.event===c.EVENTS.SET_DEVICE_VARIABLES)return a.onSetDeviceServerVariables(d.data);if(d.event===c.EVENTS.ON_DEVICE_CONNECTED)a.publish(c.EVENTS.ON_DEVICE_CONNECTED,d.data);else if(d.event!==c.EVENTS.ON_SERVER_LOG_MESSAGE)if(d.event===c.EVENTS.ON_MQTT_MESSAGE)a.publish(c.EVENTS.ON_MQTT_MESSAGE,
d.data),a.onMQTTMessage(d.data);else a.onDeviceServerMessage({data:b})}},emit:function(){x.error("device server client emit",arguments)}});return p([n,b],{declaredClass:"nxapp.manager.DeviceServerContext",profile:null,getDevices:function(b){function d(b,g){var e=h.readdirSync(b);e.length&&_.each(e,function(d){if(-1!=d.indexOf(".meta.json")){var e=a.getJson(f.readFile(b+k.sep+d));e?(d={isDir:!1,path:g+"/"+d,parentId:g,scope:"system_devices",user:e,id:f.getCIInputValueByName(e,c.DEVICE_PROPERTY.CF_DEVICE_ID)},
l.push(d)):x.error("device has no meta "+b+k.sep+d)}})}var l=[],g=function(a){var c=[];h.existsSync(a)?h.readdirSync(a).forEach(function(e){e=a+"/"+e;var q=h.statSync(e);if(q){var f=e.replace(b+"/","");q.isDirectory()&&(l.push({isDir:!0,parent:f,name:f,path:f}),d(e,f),c.push(e.replace(b+"/","")),c=c.concat(g(e)))}else x.error("cant get stat for "+e)}):x.error("device path "+a+" doesnt exists");return c};g(b);return l},getDrivers:function(b){function d(b,g){var e=h.readdirSync(b);e.length&&_.each(e,
function(d){if(-1!=d.indexOf(".meta.json")){var e=a.getJson(f.readFile(b+k.sep+d));if(e){var q=f.getCIInputValueByName(e,c.DRIVER_PROPERTY.CF_DRIVER_ID);d={isDir:!1,path:g+"/"+d,parentId:g,scope:"system_drivers",user:e,id:q,blox:a.getJson(f.readFile(b+"/"+d.replace(".meta.json",".xblox"))),blockPath:b+k.sep+d.replace(".meta.json",".xblox")};l.push(d)}else x.error("cant get driver meta "+b+k.sep+d)}})}var l=[],g=function(a){var c=[];h.existsSync(a)?h.readdirSync(a).forEach(function(e){e=a+"/"+e;var q=
h.statSync(e);if(q){var f=e.replace(k+"/","");q.isDirectory()&&(l.push({isDir:!0,parent:f,name:f,path:f}),d(e,f),c.push(e.replace(b+"/","")),c=c.concat(g(e)))}}):x.error("driver path "+a+" doesnt exists");return c};g(b);return l},initManagers:function(b){b&&(this.profile=b);this.deviceManager.init();this.driverManager.init();this.blockManager.init();this.fileManager.init(b);this.blockManager.onReady();var a=this;this.subscribe(c.EVENTS.ON_FILE_CHANGED,function(b){a.onXIDEMessage({event:c.EVENTS.ON_FILE_CHANGED,
data:b},!1);a.deviceManager.onFileChanged(b);a.driverManager.onFileChanged(b)})},onReady:function(){this.initDevices();var b=this.getDeviceServer(),a=this.connection;b.clients.push(a);b.onClientConnection(a)},constructManagers:function(){this.driverManager=this.createManager(e,null);g=p([g,l],{});var b=new y({});this.connection=new v({owner:this});this.deviceManager=this.createManager(g,null,{deviceServerClient:b,connection:this.connection});this.blockManager=this.createManager(q,null);this.fileManager=
this.createManager(d,null)},onLoaded:function(){},initDevices:function(){var b=k.resolve(this.profile.dataPath);require({packages:[{name:"system_drivers",location:b+"/drivers"}]});var a=k.resolve(b+"/devices"),d=k.resolve(b+"/drivers"),b=this.getDeviceManager(),l=this.getDriverManager();this.getDeviceServer();this.getConnectionManager();d=this.getDrivers(d);a=this.getDevices(a);l.createStore({items:d},"system_drivers",!0).getSync("SSH/Maintenance-SSH .meta.json");b.initStore({items:a},"system_devices",
!0);b.connectToAllDevices()}})})},"xcf/manager/DriverManager":function(){define("dcl/dcl xdojo/declare dojo/_base/lang dojo/_base/json xide/types xcf/types/Types xide/utils xcf/manager/BeanManager xcf/model/Variable xcf/manager/DriverManager_Server xide/data/TreeMemory xide/data/ObservableStore dstore/Trackable xdojo/has xcf/model/Driver xide/manager/ServerActionBase xide/data/Reference xdojo/has!xcf-ui?./DriverManager_UI".split(" "),function(p,n,m,k,h,f,a,c,e,g,d,b,l,q,r,t,x,y){k=[t,c,g];q("xcf-ui")&&
k.push(y);return p(k,{declaredClass:"xcf.manager.DriverManager",addDeviceInstance:function(b,a){a.directory=!0;var d=a._store,l=a.path,c=this.ctx.getDeviceManager(),g=d.getSync(l+"_instances"),g=g||d.putSync({path:l+"_instances",name:"Instances",isDir:!0,type:"leaf",parentId:l,virtual:!0,isCommand:!1,icon:"fa-folder",children:[]}),l=c.getMetaValue(b,h.DEVICE_PROPERTY.CF_DEVICE_TITLE),d=d.putSync(new x({name:l,isCommand:!1,path:g.path+"_instance_"+b.path,isDir:!1,type:"driver_instance",parentId:g.path,
device:b,driver:a,_mayHaveChildren:!1,icon:b.iconClass,state:b.state}));g.children.push(d);b.addReference(d,{properties:{name:!0,enabled:!0,state:!0,iconClass:!0},onDelete:!1},!0);!a.instances&&(a.instances=[]);a.instances.push(d)},beanNamespace:"driver",beanName:"Driver",beanIconClass:"fa-exchange",groupType:h.ITEM_TYPE.DRIVER_GROUP,itemType:h.ITEM_TYPE.DRIVER,itemMetaTitleField:h.DRIVER_PROPERTY.CF_DRIVER_NAME,defaultScope:"system_drivers",serviceClass:"XCF_Driver_Service",rawData:null,store:null,
treeView:null,driverScopes:null,_isLoading:!1,removeDriverInstance:function(b,a){var d=b.driver,l=d._store,c=d.path,g=c+"_instances_instance_"+a.path,e=l.getSync(g);e&&l.removeSync(g);d.instances.remove(e);a.removeReference(e);e&&(e.refresh(),l.getSync(c+"_instances").refresh())},onReloaded:function(){},_onReloaded:function(){},onDeviceMessage:function(b){if(b&&b.device&&b.driverInstance){var d=b.driverInstance,l=d.options;if(l)if(d.responseSettings){var l=l.serverSide,c=[b.deviceMessage];m.isString(b.deviceMessage)&&
(c=d.split(b.deviceMessage));if(d.hasMessages())console.error("abort incoming, have still messages to send");else if(0<c.length){b=d.blockScope;var d=b.getBlocks({group:h.BLOCK_GROUPS.CF_DRIVER_RESPONSE_BLOCKS}),g=b.getVariables({group:h.BLOCK_GROUPS.CF_DRIVER_RESPONSE_VARIABLES}),q=b.getVariable("value");q||(q=new e({id:a.createUUID(),name:"value",value:"",scope:b,type:13,group:"processVariables",gui:!1,cmd:!1}),b.blockStore.putSync(q));for(var f=0;f<c.length;f++)if(0!=c[f].length){q.value=c[f];
this.publish(h.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:q,scope:b,owner:this,save:!1,source:h.MESSAGE_SOURCE.DEVICE});for(var k=0;k<g.length;k++){var t=g[k];if("value"!=g[k].title){var r=null,r=q.value;"number"!=typeof r&&(r=""+r,r="'"+r+"'");if(t.target&&"None"!=t.target&&null!=r&&"null"!=r&&"'null'"!=r){var n=b.getVariable(t.target);n&&(n.value=r,this.publish(h.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:n,scope:b,owner:this,save:!1,source:h.MESSAGE_SOURCE.BLOX}))}}}if(l)for(k=0;k<d.length;k++)if(r=
d[k],0!=r.enabled){r.override={args:t?[t.value]:null};try{b.solveBlock(d[k],{highlight:!1})}catch(x){logError(x,"----solving response block crashed ")}}}}}else console.error("driver has no response settings!")}},getDriverById:function(b){var d=null,l;for(l in this.stores){a:{var d=this.stores[l],c=a.queryStore(d,{isDir:!1});m.isArray(c)||(c=[c]);for(var g=0;g<c.length;g++){var e=c[g],q=a.getInputCIByName(e.user,h.DRIVER_PROPERTY.CF_DRIVER_ID);if(q&&q.value==b){d=d.getSync(e.path);break a}}d=null}if(d)return d}return null},
getItemById:function(b){return _.find(this.store.data,{id:b})},onNewDriverScopeCreated:function(b){},onScopeCreated:function(b){},onDeviceDisconnected:function(b){},onDriverCreated:function(b){q("xcf-ui")&&h.registerEnumeration("Driver",this.getDriversAsEnumeration(b))},onDriverRemoved:function(b,a){q("xcf-ui")&&h.registerEnumeration("Driver",this.getDriversAsEnumeration(b))},onStoreReady:function(b){q("xcf-ui")&&h.registerEnumeration("Driver",this.getDriversAsEnumeration(b))},onStoreCreated:function(b){var a=
b.type;b=b.store;var d=b.query({isDir:!1});if(a===h.ITEM_TYPE.DRIVER)for(a=0;a<d.length;a++){var l=d[a];null==l._completed&&"Default"!==l.name&&(l._completed=!0,q("xcf-ui")&&this.completeDriver(b,l,l))}},createStore:function(a,c,g){a=new (n("driverStore",[d,l,b],{}))({data:a.items,Model:r,idProperty:"path",scope:c,observedProperties:["name","enabled"]});c&&!this.stores[c]&&!1!==g&&(this.stores[c]=a);this.store||"system_drivers"!==c||(this.store=a);return a},initStore:function(b,a){return this.createStore(b,
a)},getStore:function(b){if(!b||"system_drivers"===b)return this.store;var a=this.stores[b];if(a)return a;if(b)return this.ls(b)},ls:function(b){return this.runDeferred(null,"ls",[b]).then(function(a){try{var d=this.initStore(a,b);"system_drivers"===b&&(this.store=d);this.stores[b]=d;this.onStoreReady(d);this.publish(h.EVENTS.ON_STORE_CREATED,{data:a,owner:this,store:d,type:this.itemType})}catch(l){logError(l,"error ls drivers")}}.bind(this))},init:function(){var b=this,a=h.EVENTS;this.stores={};
this.subscribe([a.ON_SCOPE_CREATED,a.ON_STORE_CREATED]);this.subscribe(a.ON_BLOCK_EXPRESSION_FAILED,function(d){b.publish(a.ON_SERVER_LOG_MESSAGE,{data:{type:"Expression",device:d.deviceInfo},level:"error",message:"Expression Failed: "+d.item.title+" : "+d.item.value})});this.driverScopes={system_drivers:"system_drivers/"}}})})},"xcf/manager/BeanManager":function(){define("dcl/dcl xdojo/declare dojo/_base/lang xide/types xide/utils xide/manager/BeanManager xdojo/has!xcf-ui?xide/views/ActionDialog xdojo/has!xcf-ui?xide/views/CIActionDialog xdojo/has!xcf-ui?xide/views/CIGroupedSettingsView".split(" "),
function(p,n,m,k,h,f,a,c,e,g){return p(f,{declaredClass:"xcf.manager.BeanManager",toUrl:function(a,b,l,c){return m.replace((c||"")+"deviceScope\x3d{deviceScope}\x26device\x3d{deviceId}\x26driver\x3d{driverId}\x26driverScope\x3d{driverScope}\x26block\x3d{block}",{deviceId:a.id,deviceScope:a.scope,driverId:b.id,driverScope:b.scope,block:l.id})},openItemSettings:function(d,b){var l=d.user;if(!l||!l.inputs)return null;var c=this.getViewId(d),e=a.byId(c);try{if(e)return e.parentContainer&&e.parentContainer.selectChild(e),
null}catch(f){h.destroy(e)}var e=this.ctx.mainView.getDocker(),m=this.getMetaValue(d,this.itemMetaTitleField),n=b?this.ctx.getDeviceManager().toDeviceControlInfo(b):null,e=e.addTab(null,{title:(m||d.name)+""+(b?":"+b.name+":"+n.host+":":""),icon:this.beanIconClass});if(m=h.getCIByChainAndName(l,0,k.DRIVER_PROPERTY.CF_DRIVER_COMMANDS))m.device=b;d.blockScope&&!d.blockScope.serviceObject&&(d.blockScope.serviceObject=this.serviceObject);return h.addWidget(g,{cis:l.inputs,storeItem:d,iconClass:this.beanIconClass,
id:c,delegate:this,storeDelegate:this,blockManager:this.ctx.getBlockManager(),options:{groupOrder:{General:1,Settings:2,Visual:3}}},this,e,!0)},newGroup:function(){var a=this,b=this.getItem(),l=b?!0===b.isDir?b.path:"":"",b=new e({title:"New "+this.groupType,delegate:{onOk:function(b,c){var g=h.getCIInputValueByName(c,"Title"),e=h.getCIInputValueByName(c,"Scope");a.createGroup(e,l+"/"+g,function(b){b=a.createNewGroupItem(g,e,l);a.store.putSync(b);a.publish(k.EVENTS.ON_STORE_CHANGED,{owner:a,store:a.store,
action:k.NEW_DIRECTORY,item:b})})}},cis:[h.createCI("Title",13,""),h.createCI("Scope",3,this.defaultScope,{options:[{label:"System",value:this.defaultScope},{label:"User",value:this.userScope},{label:"App",value:this.appScope}]})]});b.startup();b.show()},onDeleteItem:function(a){var b=!0===h.toBoolean(a.isDir),l=b?"removeGroup":"removeItem",g=this;(new c({title:"Remove "+this.beanName+(b?" Group":"")+' "'+a.name+'"  ',style:"max-width:400px",titleBarClass:"text-danger",delegate:{isRemoving:!1,onOk:function(b){g[l](h.toString(a.scope),
h.toString(a.path),h.toString(a.name),function(){g.onItemDeleted(a);g.publish(k.EVENTS.ON_STORE_CHANGED,{owner:g,store:g.store,action:k.DELETE,item:a})})}}})).show()},hasItemActions:function(){return!0},onItemDeleted:function(a){this.store.removeSync(a.path);a==this.currentItem&&(this.currentItem=null);a&&(a=this.getView(a))&&h.destroyWidget(a)},onItemSelected:function(a){this.currentItem=a},onCIUpdate:function(a){a.owner===this&&this.updateCI(a.ci,a.newValue,a.oldValue,a.storeItem)},createNewGroupItem:function(a,
b,l){return this.createItemStruct(a,b,l,a,!0,this.groupType)},createNewItem:function(a,b,l){return this.createItemStruct(a,b,l,l+"/"+a,!1,this.itemType)},init:function(){this.subscribe(k.EVENTS.ON_CI_UPDATE)},createItem:function(a,b,l,c,g){return this.runDeferred(null,"createItem",[a,b,l,c,g])},ls:function(a){return this.runDeferred(null,"ls",[a]).then(function(b){try{this.rawData=b,this.initStore(b),this.publish(k.EVENTS.ON_STORE_CREATED,{data:b,owner:this,store:this.store,type:this.itemType})}catch(a){logError(a,
"error ls")}}.bind(this))},_getText:function(a){var b;dojo.xhrGet({url:a,sync:!0,handleAs:"text",load:function(a){b=a}});return""+b+""}})})},"xide/manager/BeanManager":function(){define("dcl/dcl dojo/_base/lang xide/utils xide/encoding/MD5 xide/registry xide/data/TreeMemory".split(" "),function(p,n,m,k,h,f){return p(null,{declaredClass:"xide.manager.BeanManager",beanNamespace:"beanNS",beanName:"beanName",createItemStruct:function(a,c,e,g,d,b){return{name:a,isDir:d,parentId:e,path:g,beanType:b,scope:c}},
getMetaValue:function(a,c){return m.getCIInputValueByName(m.getAt(a,this.itemMetaPath||"user"),c)},setCurrentItem:function(a){},getItem:function(){},onItemSelected:function(a){},onItemAdded:function(a){},onItemRemoved:function(a){},reload:function(){},getViewTarget:function(){return this.ctx.getApplication().mainView.getNewAlternateTarget()},getRightTopTarget:function(a,c,e,g){return this.ctx.getApplication().mainView.getRightTopTarget(a,c,e,g)},getLayoutRightMain:function(a,c){return this.ctx.getApplication().mainView.getLayoutRightMain(a,
c)},getRightBottomTarget:function(a,c){return this.ctx.getApplication().mainView.getRightBottomTarget(a,c)},getViewId:function(a,c){return this.beanNamespace+k(m.toString(a.scope)+m.toString(a.path),1)+(null!=c?c:"")},getView:function(a,c){var e=this.getViewId(a,c);return h.byId(e)},getStore:function(){return this.store},isValid:function(){return null!=this.store},initStore:function(a){this.store=new f({data:a.items,idProperty:"path"});this.onStoreReady(this.store);return this.store},onStoreReady:function(){},
createGroup:function(a,c,e){return this.callMethodEx(null,"createGroup",[a,c],e,!0)},removeGroup:function(a,c,e,g){return this.callMethodEx(null,"removeGroup",[a,c,e],g,!0)},removeItem:function(a,c,e,g){return this.callMethodEx(null,"removeItem",[a,c,e],g,!0)},updateCI:function(a,c,e,g){a&&g&&this.updateItemMetaData(m.toString(g.scope),m.toString(g.path),this.itemMetaStorePath||"/inputs",{id:m.toString(a.id)},{value:c})},updateItemMetaData:function(a,c,e,g,d,b,l){return this.callMethodEx(null,"updateItemMetaData",
[a,c,e,g,d],b,!1)},mergeNewModule:function(a){for(var c in a){var e=a[c];e&&_.isFunction(e)&&(this[c]=e)}},_onReloaded:function(a){this.mergeNewModule(a.prototype);a=this.declaredClass;(a=n.getObject(m.replaceAll("/",".",a))||n.getObject(a))&&a.prototype&&a.prototype.solve&&this.mergeNewModule(a.prototype)}})})},"xide/encoding/MD5":function(){define(["./_base"],function(p){function n(a,e){return a<<e|a>>>32-e}function m(a,e,g,d,b,l){return p.addWords(n(p.addWords(p.addWords(e,a),p.addWords(d,l)),
b),g)}function k(a,e,g,d,b,l,q){return m(e&g|~e&d,a,e,b,l,q)}function h(a,e,g,d,b,l,q){return m(e&d|g&~d,a,e,b,l,q)}function f(a,e,g,d,b,l,q){return m(g^(e|~d),a,e,b,l,q)}function a(a,e){a[e>>5]|=128<<e%32;a[(e+64>>>9<<4)+14]=e;for(var g=1732584193,d=-271733879,b=-1732584194,l=271733878,q=0;q<a.length;q+=16)var r=g,t=d,n=b,y=l,g=k(g,d,b,l,a[q+0],7,-680876936),l=k(l,g,d,b,a[q+1],12,-389564586),b=k(b,l,g,d,a[q+2],17,606105819),d=k(d,b,l,g,a[q+3],22,-1044525330),g=k(g,d,b,l,a[q+4],7,-176418897),l=k(l,
g,d,b,a[q+5],12,1200080426),b=k(b,l,g,d,a[q+6],17,-1473231341),d=k(d,b,l,g,a[q+7],22,-45705983),g=k(g,d,b,l,a[q+8],7,1770035416),l=k(l,g,d,b,a[q+9],12,-1958414417),b=k(b,l,g,d,a[q+10],17,-42063),d=k(d,b,l,g,a[q+11],22,-1990404162),g=k(g,d,b,l,a[q+12],7,1804603682),l=k(l,g,d,b,a[q+13],12,-40341101),b=k(b,l,g,d,a[q+14],17,-1502002290),d=k(d,b,l,g,a[q+15],22,1236535329),g=h(g,d,b,l,a[q+1],5,-165796510),l=h(l,g,d,b,a[q+6],9,-1069501632),b=h(b,l,g,d,a[q+11],14,643717713),d=h(d,b,l,g,a[q+0],20,-373897302),
g=h(g,d,b,l,a[q+5],5,-701558691),l=h(l,g,d,b,a[q+10],9,38016083),b=h(b,l,g,d,a[q+15],14,-660478335),d=h(d,b,l,g,a[q+4],20,-405537848),g=h(g,d,b,l,a[q+9],5,568446438),l=h(l,g,d,b,a[q+14],9,-1019803690),b=h(b,l,g,d,a[q+3],14,-187363961),d=h(d,b,l,g,a[q+8],20,1163531501),g=h(g,d,b,l,a[q+13],5,-1444681467),l=h(l,g,d,b,a[q+2],9,-51403784),b=h(b,l,g,d,a[q+7],14,1735328473),d=h(d,b,l,g,a[q+12],20,-1926607734),g=m(d^b^l,g,d,a[q+5],4,-378558),l=m(g^d^b,l,g,a[q+8],11,-2022574463),b=m(l^g^d,b,l,a[q+11],16,1839030562),
d=m(b^l^g,d,b,a[q+14],23,-35309556),g=m(d^b^l,g,d,a[q+1],4,-1530992060),l=m(g^d^b,l,g,a[q+4],11,1272893353),b=m(l^g^d,b,l,a[q+7],16,-155497632),d=m(b^l^g,d,b,a[q+10],23,-1094730640),g=m(d^b^l,g,d,a[q+13],4,681279174),l=m(g^d^b,l,g,a[q+0],11,-358537222),b=m(l^g^d,b,l,a[q+3],16,-722521979),d=m(b^l^g,d,b,a[q+6],23,76029189),g=m(d^b^l,g,d,a[q+9],4,-640364487),l=m(g^d^b,l,g,a[q+12],11,-421815835),b=m(l^g^d,b,l,a[q+15],16,530742520),d=m(b^l^g,d,b,a[q+2],23,-995338651),g=f(g,d,b,l,a[q+0],6,-198630844),l=
f(l,g,d,b,a[q+7],10,1126891415),b=f(b,l,g,d,a[q+14],15,-1416354905),d=f(d,b,l,g,a[q+5],21,-57434055),g=f(g,d,b,l,a[q+12],6,1700485571),l=f(l,g,d,b,a[q+3],10,-1894986606),b=f(b,l,g,d,a[q+10],15,-1051523),d=f(d,b,l,g,a[q+1],21,-2054922799),g=f(g,d,b,l,a[q+8],6,1873313359),l=f(l,g,d,b,a[q+15],10,-30611744),b=f(b,l,g,d,a[q+6],15,-1560198380),d=f(d,b,l,g,a[q+13],21,1309151649),g=f(g,d,b,l,a[q+4],6,-145523070),l=f(l,g,d,b,a[q+11],10,-1120210379),b=f(b,l,g,d,a[q+2],15,718787259),d=f(d,b,l,g,a[q+9],21,-343485551),
g=p.addWords(g,r),d=p.addWords(d,t),b=p.addWords(b,n),l=p.addWords(l,y);return[g,d,b,l]}p.MD5=function(c,e){var g=e||p.outputTypes.Base64,d=a(p.stringToWord(c),8*c.length);switch(g){case p.outputTypes.Raw:return d;case p.outputTypes.Hex:return p.wordToHex(d);case p.outputTypes.String:return p.wordToString(d);default:return p.wordToBase64(d)}};p.MD5._hmac=function(c,e,g){g=g||p.outputTypes.Base64;var d=p.stringToWord(e);16<d.length&&(d=a(d,8*e.length));var b=[];e=[];for(var l=0;16>l;l++)b[l]=d[l]^
909522486,e[l]=d[l]^1549556828;c=a(b.concat(p.stringToWord(c)),512+8*c.length);c=a(e.concat(c),640);switch(g){case p.outputTypes.Raw:return c;case p.outputTypes.Hex:return p.wordToHex(c);case p.outputTypes.String:return p.wordToString(c);default:return p.wordToBase64(c)}};return p.MD5})},"xide/encoding/_base":function(){define(["dojo/_base/lang"],function(p){return{outputTypes:{Base64:0,Hex:1,String:2,Raw:3},addWords:function(n,m){var k=(n&65535)+(m&65535);return(n>>16)+(m>>16)+(k>>16)<<16|k&65535},
stringToWord:function(n){for(var m=[],k=0,h=8*n.length;k<h;k+=8)m[k>>5]|=(n.charCodeAt(k/8)&255)<<k%32;return m},wordToString:function(n){for(var m=[],k=0,h=32*n.length;k<h;k+=8)m.push(String.fromCharCode(n[k>>5]>>>k%32&255));return m.join("")},wordToHex:function(n){for(var m=[],k=0,h=4*n.length;k<h;k++)m.push("0123456789abcdef".charAt(n[k>>2]>>k%4*8+4&15)+"0123456789abcdef".charAt(n[k>>2]>>k%4*8&15));return m.join("")},wordToBase64:function(n){for(var m=[],k=0,h=4*n.length;k<h;k+=3)for(var f=(n[k>>
2]>>k%4*8&255)<<16|(n[k+1>>2]>>(k+1)%4*8&255)<<8|n[k+2>>2]>>(k+2)%4*8&255,a=0;4>a;a++)8*k+6*a>32*n.length?m.push("\x3d"):m.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>6*(3-a)&63));return m.join("")},stringToUtf8:function(n){for(var m="",k=-1,h,f;++k<n.length;)h=n.charCodeAt(k),f=k+1<n.length?n.charCodeAt(k+1):0,55296<=h&&56319>=h&&56320<=f&&57343>=f&&(h=65536+((h&1023)<<10)+(f&1023),k++),127>=h?m+=String.fromCharCode(h):2047>=h?m+=String.fromCharCode(192|h>>>
6&31,128|h&63):65535>=h?m+=String.fromCharCode(224|h>>>12&15,128|h>>>6&63,128|h&63):2097151>=h&&(m+=String.fromCharCode(240|h>>>18&7,128|h>>>12&63,128|h>>>6&63,128|h&63));return m}}})},"xide/registry":function(){define(["dojo/_base/array","dojo/_base/window","xdojo/has"],function(p,n,m){var k={},h={},f={length:0,add:function(a){this._hash[a.id]&&(console.error("already registered "+a.id+" calss "+a.declaredClass),this.remove(a.id),this.add(a));h[a.id]=a;this.length++},remove:function(a){h[a]&&(delete h[a],
this.length--)},byId:function(a){return"string"==typeof a?h[a]:a},byNode:function(a){return h[a.getAttribute("widgetId")]},toArray:function(){return _.values(_.mapKeys(h,function(a,c){a.id=c;return a}))},getUniqueId:function(a){var c;do c=a+"_"+(a in k?++k[a]:k[a]=0);while(h[c]);return c},findWidgets:function(a,c){function e(a){for(a=a.firstChild;a;a=a.nextSibling)if(1==a.nodeType){var b=a.getAttribute("widgetId");b?(b=h[b])&&g.push(b):a!==c&&e(a)}}var g=[];e(a);return g},_destroyAll:function(){p(f.findWidgets(n.body()),
function(a){a._destroyed||(a.destroyRecursive?a.destroyRecursive():a.destroy&&a.destroy())})},getEnclosingWidget:function(a){for(;a;){var c=1==a.nodeType&&a.getAttribute("widgetId");if(c)return h[c];a=a.parentNode}return null},_hash:h};return f})},"xide/data/TreeMemory":function(){define(["xdojo/declare","xide/data/Memory","dstore/Tree","dojo/Deferred","dstore/QueryResults"],function(p,n,m,k,h){return p("xide.data.TreeMemory",[n,m],{_state:{filter:null},parentField:"parentId",reset:function(){this._state.filter=
null;this.resetQueryLog()},resetQueryLog:function(){this.queryLog=[]},fetchRange:function(){var f=this._fetchRange(arguments);return new h(f.then(function(a){return a}),{totalLength:f.then(function(a){return a.length})})},filter:function(f){var a=this.inherited(arguments);this._state.filter=f;return a},_fetchRange:function(f){var a=new k;f=this.fetchRangeSync(f);if(this._state.filter){if(this._state&&this._state.filter&&this._state.filter.parent){var c=this.getSync(this._state.filter.parent);c&&(this.reset(),
f={},this.getChildrenSync?f=this.getChildrenSync(c):(f[this.parentField]=c[this.idProperty],f=this.root.query(f)))}this._state&&this._state.filter&&this._state.filter.group&&(this.getSync(this._state.filter.parent),c&&(this.reset(),f=c.items))}a.resolve(f);return a},children:function(f){for(var a=this.root.data,c=[],e=0;e<a.length;e++){var g=a[e];g[this.parentField]==f[this.idProperty]&&c.push(g)}return a},mayHaveChildren:function(f){return!1===f._mayHaveChildren?!1:!0}})})},"xide/data/Memory":function(){define(["xdojo/declare",
"dstore/Memory","xide/data/_Base"],function(p,n,m){return p("xide.data.Memory",[n,m],{})})},"dstore/Memory":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array ./Store ./Promised ./SimpleQuery ./QueryResults".split(" "),function(p,n,m,k,h,f,a){return p([k,h,f],{constructor:function(){this.storage.version=0},postscript:function(){this.inherited(arguments);this.setData(this.data||[])},data:null,autoEmitEvents:!1,getSync:function(a){return this.storage.fullData[this.storage.index[a]]},
putSync:function(a,e){e=e||{};var g=this.storage,d=g.index,b=g.fullData,l=this.Model;!l||a instanceof l||(a=this._restore(a));var q=this.getIdentity(a);null==q&&(this._setIdentity(a,"id"in e?e.id:Math.random()),q=this.getIdentity(a));g.version++;var g=q in d?"update":"add",l={target:a},f;if("update"===g){if(!1===e.overwrite)throw Error("Object already exists");b.splice(f=d[q],1);q=f}else q=this.defaultNewToStart?0:b.length;var h;if("beforeId"in e){var k=e.beforeId;null===k?h=b.length:(h=d[k],f<h&&
--h);void 0!==h?l.beforeId=k:(console.error("options.beforeId was specified but no corresponding index was found"),h=q)}else h=q;b.splice(h,0,a);f=isFinite(f)?Math.min(f,h):h;for(q=b.length;f<q;++f)d[this.getIdentity(b[f])]=f;this.emit(g,l);return a},addSync:function(a,e){(e=e||{}).overwrite=!1;return this.putSync(a,e)},removeSync:function(a){var e=this.storage,g=e.index,e=e.fullData;if(a in g)return g=e.splice(g[a],1)[0],this._reindex(),this.emit("delete",{id:a,target:g}),!0},setData:function(a){this.parse&&
(a=this.parse(a));a.items&&(this.idProperty=a.identifier||this.idProperty,a=a.items);this.storage.fullData=this.data=a;this._reindex()},_reindex:function(){for(var a=this.storage,e=a.index={},g=a.fullData,d=this.Model,b=Object.prototype,l=0,f=g.length;l<f;l++){var h=g[l];if(d&&!(h instanceof d)){var k=this._restore(h,h.__proto__===b);h!==k&&(g[l]=h=k)}e[this.getIdentity(h)]=l}a.version++},fetchSync:function(){var c=this.data;if(!c||c._version!==this.storage.version){for(var c=this.storage.fullData,
e=this.queryLog,g=0,d=e.length;g<d;g++)c=e[g].querier(c);c._version=this.storage.version;this.data=c}return new a(c)},fetchRangeSync:function(c){var e=this.fetchSync();return new a(e.slice(c.start,c.end),{totalLength:e.length})},_includePropertyInSubCollection:function(a){return"data"!==a&&this.inherited(arguments)}})})},"dstore/Store":function(){define("dojo/_base/lang dojo/_base/array dojo/aspect dojo/has dojo/when dojo/Deferred dojo/_base/declare ./QueryMethod ./Filter dojo/Evented".split(" "),
function(p,n,m,k,h,f,a,c,e,g){function d(a){return function(b,d){var g=this;h(b,function(b){b={target:b};var c=d[1]||{};"beforeId"in c&&(b.beforeId=c.beforeId);g.emit(a,b)});return b}}k.add("object-proto",!!{}.__proto__&&!{}.watch);var b=k("object-proto");return a(g,{constructor:function(b){b&&a.safeMixin(this,b);this.Model&&this.Model.createSubclass&&(this.Model=this.Model.createSubclass([]).extend({_store:this}));this.storage=new g;var c=this;this.autoEmitEvents&&(m.after(this,"add",d("add")),m.after(this,
"put",d("update")),m.after(this,"remove",function(a,b){h(a,function(){c.emit("delete",{id:b[0]})});return a}))},autoEmitEvents:!0,idProperty:"id",queryAccessors:!0,getIdentity:function(a){return a.get?a.get(this.idProperty):a[this.idProperty]},_setIdentity:function(a,b){a.set?a.set(this.idProperty,b):a[this.idProperty]=b},forEach:function(a,b){var d=this;return h(this.fetch(),function(g){for(var c=0,e;void 0!==(e=g[c]);c++)a.call(b,e,c,d);return g})},on:function(a,b){return this.storage.on(a,b)},
emit:function(a,b){b=b||{};b.type=a;try{return this.storage.emit(a,b)}finally{return b.cancelable}},parse:null,stringify:null,Model:null,_restore:function(a,d){var g=this.Model;if(g&&a){var c=g.prototype,e=c._restore;e?a=e.call(a,g,d):b&&d?a.__proto__=c:a=p.delegate(c,a)}return a},create:function(a){return new this.Model(a)},_createSubCollection:function(b){var d=p.delegate(this.constructor.prototype),g;for(g in this)this._includePropertyInSubCollection(g,d)&&(d[g]=this[g]);return a.safeMixin(d,b)},
_includePropertyInSubCollection:function(a,b){return!(a in b)||b[a]!==this[a]},queryLog:[],filter:new c({type:"filter",normalizeArguments:function(a){var b=this.Filter;return a instanceof b?[a]:[new b(a)]}}),Filter:e,sort:new c({type:"sort",normalizeArguments:function(a,b){var d;"function"===typeof a?d=[a]:(d=a instanceof Array?a.slice():"object"===typeof a?[].slice.call(arguments):[{property:a,descending:b}],d=n.map(d,function(a){a=p.mixin({},a);a.descending=!!a.descending;return a}),d=[d]);return d}}),
select:new c({type:"select"}),_getQuerierFactory:function(a){return this["_create"+(a[0].toUpperCase()+a.substr(1))+"Querier"]}})})},"dstore/QueryMethod":function(){define([],function(){return function(p){var n=p.type,m=p.normalizeArguments,k=p.applyQuery,h=p.querierFactory;return function(){var f=Array.prototype.slice.call(arguments),a=m?m.apply(this,f):f,f={type:n,arguments:f,normalizedArguments:a},c=this._getQuerierFactory(n)||h;c&&(f.querier=c.apply(this,a));a=this._createSubCollection({queryLog:this.queryLog.concat(f)});
return k?k.call(this,a,f):a}}})},"dstore/Filter":function(){define(["dojo/_base/declare"],function(p){function n(m){return function(){var k=this.constructor,h=new k;h.type=m;h.args=arguments;return this.type?n("and").call(k.prototype,this,h):h}}p=p(null,{constructor:function(m){var k=typeof m;switch(k){case "object":var k=this,h;for(h in m)var f=m[h],k=f instanceof this.constructor?k[f.type](h,f.args[0]):f&&f.test?k.match(h,f):k.eq(h,f);this.type=k.type;this.args=k.args;break;case "function":case "string":this.type=
k,this.args=[m]}},and:n("and"),or:n("or"),eq:n("eq"),ne:n("ne"),lt:n("lt"),lte:n("lte"),gt:n("gt"),gte:n("gte"),contains:n("contains"),"in":n("in"),match:n("match")});p.filterCreator=n;return p})},"dstore/Promised":function(){define(["dojo/_base/declare","dojo/Deferred","./QueryResults","dojo/when"],function(p,n,m,k){function h(f,a){return function(){var c=new n;try{c.resolve(this[f].apply(this,arguments))}catch(e){c.reject(e)}return a?(c=new m(c.promise),c.totalLength=k(c.totalLength),c):c.promise}}
return p(null,{get:h("getSync"),put:h("putSync"),add:h("addSync"),remove:h("removeSync"),fetch:h("fetchSync",!0),fetchRange:h("fetchRangeSync",!0)})})},"dstore/QueryResults":function(){define(["dojo/_base/lang","dojo/when"],function(p,n){function m(k,h){return n(this,function(f){for(var a=0,c=f.length;a<c;a++)k.call(h,f[a],a,f)})}return function(k,h){var f=h&&"totalLength"in h;if(k.then){k=p.delegate(k);var a=k.then(function(a){var e=f?h.totalLength:a.totalLength||a.length;a.totalLength=e;return!f&&
e});k.totalLength=f?h.totalLength:a;k.response=h&&h.response}else k.totalLength=f?h.totalLength:k.length;k.forEach=m;return k}})},"dstore/SimpleQuery":function(){define(["dojo/_base/declare","dojo/_base/array"],function(p,n){function m(h,f){if(-1<h.indexOf(".")){var a=h.split("."),c=a.length;return function(e){for(var g=0;g<c;g++)e=e&&(f&&e.get?e.get(a[g]):e[a[g]]);return e}}return function(a){return a.get?a.get(h):a[h]}}var k={eq:function(h,f){return h===f},"in":function(h,f){return-1<n.indexOf(f.data||
f,h)},ne:function(h,f){return h!==f},lt:function(h,f){return h<f},lte:function(h,f){return h<=f},gt:function(h,f){return h>f},gte:function(h,f){return h>=f},match:function(h,f,a){return f.test(h,a)},contains:function(h,f,a,c){var e=this;return n.every(f.data||f,function(g){if("object"===typeof g&&g.type){var d=e._getFilterComparator(g.type);return n.some(h,function(b){return d.call(e,b,g.args[1],a,c)})}return-1<n.indexOf(h,g)})}};return p(null,{_createFilterQuerier:function(h){function f(g){var d=
g.type;g=g.args;var b=c._getFilterComparator(d);if(b){var l=g[0],q=m(l,a),h=g[1];h&&h.fetchSync&&(h=h.fetchSync());return function(a){return b.call(c,q(a),h,a,l)}}switch(d){case "and":case "or":for(var k=0,n=g.length;k<n;k++){var p=f(g[k]);e=e?function(a,b){return"and"===d?function(d){return a(d)&&b(d)}:function(d){return a(d)||b(d)}}(e,p):p}return e;case "function":return g[0];case "string":k=c[g[0]];if(!k)throw Error("No filter function "+g[0]+" was found in the collection");return k;case void 0:return function(){return!0};
default:throw Error('Unknown filter operation "'+d+'"');}}var a=this.queryAccessors,c=this,e=f(h);return function(a){return n.filter(a,e)}},_getFilterComparator:function(h){return k[h]||this.inherited(arguments)},_createSelectQuerier:function(h){return function(f){var a=h.length;return n.map(f,h instanceof Array?function(c){for(var e={},g=0;g<a;g++){var d=h[g];e[d]=c[d]}return e}:function(a){return a[h]})}},_createSortQuerier:function(h){var f=this.queryAccessors;return function(a){a=a.slice();a.sort("function"==
typeof h?h:function(a,e){for(var g=0;g<h.length;g++){var d,b=h[g];if("function"==typeof b)d=b(a,e);else{d=b.get||(b.get=m(b.property,f));var b=b.descending,l=d(a);d=d(e);null!=l&&(l=l.valueOf());null!=d&&(d=d.valueOf());d=l===d?0:!!b===(null===l||l>d&&null!==d)?-1:1}if(0!==d)return d}return 0});return a}}})})},"xide/data/_Base":function(){define(["xdojo/declare","dstore/Memory","dstore/Tree","dstore/QueryResults","xide/mixins/EventedMixin"],function(p,n,m,k,h){return p("xide/data/_base",h,{__all:null,
allowCache:!1,constructor:function(){var f=this;if(f._getQuerierFactory("filter")||f._getQuerierFactory("sort"))this.queryEngine=function(a,e){e=e||{};var g=f._getQuerierFactory("filter"),d=g?g(a):passthrough,g=f._getQuerierFactory("sort"),b=passthrough;g&&(b=g(arrayUtil.map(e.sort,function(a){return{property:a.attribute,descending:a.descending}})));var l=passthrough;isNaN(e.start)&&isNaN(e.count)||(l=function(a){var b=e.start||0,b=a.slice(b,b+(e.count||Infinity));b.total=a.length;return b});return function(a){return l(b(d(a)))}};
var a=this;f.on("add,update,delete",function(c){var e=c.type,g=c.target;a.notify("add"===e||"update"===e?g:void 0,"delete"===e||"update"===e?"id"in c?c.id:f.getIdentity(g):void 0)})},destroy:function(){this._emit("destroy",this)},notify:function(){},refreshItem:function(f){this.emit("update",{target:f})},query:function(f,a,c){a=a||{};f=f||{};var e=this.filter(f),g;if(f=a.sort)if("[object Array]"===Object.prototype.toString.call(f))for(;c=f.pop();)e=e.sort(c.attribute,c.descending);else e=e.sort(f);
"start"in a&&(g=a.start||0,g=e[e.fetchRangeSync?"fetchRangeSync":"fetchRange"]({start:g,end:a.count?g+a.count:Infinity}),g.total=g.totalLength);g=g||new k(e[e.fetchSync?"fetchSync":"fetch"]());g.observe=function(a,b){var g=e.on("add",function(b){a(b.target,-1,b.index)}),c=e.on("update",function(g){!b&&g.previousIndex===g.index&&isFinite(g.index)||a(g.target,g.previousIndex,g.index)}),f=e.on("delete",function(b){a(b.target,b.previousIndex,-1)}),h={remove:function(){g.remove();c.remove();f.remove()}};
h.cancel=h.remove;return h};return g}})})},"dstore/Tree":function(){define(["dojo/_base/declare"],function(p){return p(null,{constructor:function(){this.root=this},mayHaveChildren:function(n){return"hasChildren"in n?n.hasChildren:!0},getRootCollection:function(){return this.root.filter({parent:null})},getChildren:function(n){return this.root.filter({parent:this.getIdentity(n)})}})})},"xcf/model/Variable":function(){define(["dcl/dcl","xblox/model/variables/Variable"],function(p,n){return p(n,{declaredClass:"xcf.model.Variable",
hasInlineEdits:!0,gui:"off",cmd:"off",save:!1,target:"None",name:"No Title",value:-1,observed:["value","initial","name"],solve:function(){var m="";if("processVariables"==this.group){var k=this.scope.getVariable("value");k&&(k=k.value,this.isNumber(k)||(k="'"+k+"'"),m="var value \x3d "+k+";\n")}return this.scope.parseExpression(m+this.getValue(),!0)},canEdit:function(){return!0},canDisable:function(){return!1},getFields:function(){var m=this.getDefaultFields();m.push(this.utils.createCI("title",13,
this.name,{group:"General",title:"Name",dst:"name"}));var k=this;m.push(this.utils.createCI("value",this.types.ECIType.EXPRESSION,this.value,{group:"General",title:"Value",dst:"value",widget:{allowACECache:!0,showBrowser:!1,showSaveButton:!0,editorOptions:{showGutter:!1,autoFocus:!1,hasConsole:!1},aceOptions:{hasEmmet:!1,hasLinking:!1,hasMultiDocs:!1},item:this},delegate:{runExpression:function(h,f,a){if("processVariables"==k.group){var c=k.scope.getVariable("value"),e="";c&&(c=c.value,k.isNumber(c)||
(c="'"+c+"'"),e="var value \x3d "+c+";\n")}return k.scope.expressionModel.parse(k.scope,e+h,!1,f,a)}}}));return m}})})},"xblox/model/variables/Variable":function(){define(["dcl/dcl","xide/types","xblox/model/Block"],function(p,n,m){return p(m,{declaredClass:"xblox.model.variables.Variable",name:null,value:null,register:!0,readOnly:!1,initial:null,getValue:function(){return this.value},canDisable:function(){return!1},canMove:function(){return!1},getIconClass:function(){return"el-icon-quotes-alt"},
getBlockIcon:function(){return'\x3cspan class\x3d"'+this.icon+'"\x3e\x3c/span\x3e '},toText:function(){return"\x3cspan class\x3d'text-primary'\x3e"+this.getBlockIcon()+this.makeEditable("name","right","text","Enter a unique name","inline")+"\x3c/span\x3e"},solve:function(){this.scope.parseExpression(this.getValue(),!0);return[]},getFields:function(){var k=this.getDefaultFields(),h=this;k.push(this.utils.createCI("title",n.ECIType.STRING,this.name,{group:"General",title:"Name",dst:"name"}));k.push(this.utils.createCI("value",
n.ECIType.EXPRESSION,this.value,{group:"General",title:"Value",dst:"value",delegate:{runExpression:function(f,a,c){return h.scope.expressionModel.parse(h.scope,f,!1,a,c)}}}));return k}})})},"xblox/model/Block":function(){define("dcl/dcl dojo/Deferred dojo/_base/lang dojo/has ./ModelBase xide/factory xide/utils xide/types dojo/has!xblox-ui?./Block_UI".split(" "),function(p,n,m,k,h,f,a,c,e){h=[h];h.push(p(null,{getStatusIcon:function(){},getStatusClass:function(){},setStatusClass:function(){},onActivity:function(){},
onRun:function(){},onFailed:function(){},onSuccess:function(){},getIconClass:function(){}}));m.mixin(c,{BLOCK_FLAGS:{NONE:0,ACTIVE:1,SCRIPT:2,RESERVED1:4,USEFUNCTION:8,RESERVED2:16,SINGLE:32,WAITSFORMESSAGE:64,VARIABLEINPUTS:128,VARIABLEOUTPUTS:256,VARIABLEPARAMETERINPUTS:512,VARIABLEPARAMETEROUTPUTS:1024,TOPMOST:16384,BUILDINGBLOCK:32768,MESSAGESENDER:65536,MESSAGERECEIVER:131072,TARGETABLE:262144,CUSTOMEDITDIALOG:524288,RESERVED0:1048576,EXECUTEDLASTFRAME:2097152,DEACTIVATENEXTFRAME:4194304,RESETNEXTFRAME:8388608,
INTERNALLYCREATEDINPUTS:16777216,INTERNALLYCREATEDOUTPUTS:33554432,INTERNALLYCREATEDINPUTPARAMS:67108864,INTERNALLYCREATEDOUTPUTPARAMS:134217728,INTERNALLYCREATEDLOCALPARAMS:1073741824,ACTIVATENEXTFRAME:268435456,LOCKED:536870912,LAUNCHEDONCE:2147483648},BLOCK_CALLBACKMASK:{PRESAVE:1,DELETE:2,ATTACH:4,DETACH:8,PAUSE:16,RESUME:32,CREATE:64,RESET:4096,POSTSAVE:256,LOAD:512,EDITED:1024,SETTINGSEDITED:2048,READSTATE:4096,NEWSCENE:8192,ACTIVATESCRIPT:16384,DEACTIVATESCRIPT:32768,RESETINBREAKPOINT:65536,
RENAME:131072,BASE:14,SAVELOAD:769,PPR:304,EDITIONS:3072,ALL:4294967295}});p=p(h,{declaredClass:"xblox.model.Block",scopeId:null,mergeNewModule:function(a){for(var d in a){var b=a[d];b&&_.isFunction(b)&&(this[d]=b)}},__onReloaded:function(g){this.mergeNewModule(g.prototype);g=this.declaredClass;(g=m.getObject(a.replaceAll("/",".",g))||m.getObject(g))&&g.prototype&&g.prototype.solve&&this.mergeNewModule(g.prototype)},reparent:function(){if(!this)return!1;if(!this.getParent()){var a=this.next(null,
1)||this.next(null,-1);a&&(this.group=null,a._add(this))}},unparent:function(a,d){if(!this)return!1;var b=this.getParent();b&&b.removeBlock&&b.removeBlock(this,!1);this.group=a;this.parent=this.parentId=null;!1!==d&&(this._place(null,-1,null),this._place(null,-1,null))},move:function(a){if(!this)return!1;var d=this.getParent(),b=null;if(d){b=d[d._getContainer(this)];if(!b||2>b.length||!this.containsItem(b,this))return!1;d=this.indexOf(b,this);if(0>d+a)return!1;var l=b[d+a];if(!l)return!1;b[d+a]=this;
b[d]=l}else this._place(null,a);return!0},_place:function(a,d,b){function l(a){for(var d=0;d<b.length;d++)if(a.id===b[d].id)return d}var c=this._store,e=this;(a=a||e.next(null,d))?(a=_.isString(a)?c.getSync(a):a,e=_.isString(e)?c.getSync(e):e,b=b||c.storage.fullData,d=-1==d?0:1,b.remove(e),-1==d&&(d=0),b.splice(Math.max(l(a)+d,0),0,e),c._reindex()):console.error("have no next",this)},index:function(){var a=this.getParent(),d=null,b=this.group,d=this._store;if(a)return d=a[a._getContainer(this)],d=
d.filter(function(a){return a.group===b}),!d||2>d.length||!this.containsItem(d,this)?!1:this.indexOf(d,this);d=d.storage.fullData;d=d.filter(function(a){return a.group===b});return this.indexOf(d,this)},numberOfParents:function(){var a=0,d=this.getParent();d&&(a++,a+=d.numberOfParents());return a},next:function(a,d){function b(a,d,g){var c=a.indexOf(d,a);if(c=d[c+g*l]){if(!c.parentId&&c.group&&c.group===a.group)return c;l++;return b(a,d,g)}return null}var l=1;a=a||this._store.storage.fullData;return b(this,
a,d)},getParent:function(){return this.parentId?this.scope.getBlockById(this.parentId):null},getScope:function(){var a=this.scope;if(this.scopeId&&0<this.scopeId.length){var d=a.owner;d&&d.hasScope&&(d.hasScope(this.scopeId)?a=d.getScope(this.scopeId):console.error("have scope id but cant resolve it",this))}return a},enabled:!0,serializeMe:!0,name:null,shareTitle:"",sharable:!1,items:null,parent:null,_return:null,_lastResult:null,_deferredObject:null,_currentIndex:0,_lastRunSettings:null,_onLoaded:!1,
beanType:"BLOCK",override:{},ignoreSerialize:"_currentIndex _deferredObject _return parent ignoreSerialize _lastRunSettings _onLoaded beanType sharable override virtual _scenario _didRegisterSubscribers additionalProperties renderBlockIcon serializeMe _statusIcon _statusClass".split(" "),canAdd:function(){return null},getTarget:function(){var a=this._targetReference;if(a)return a;var d=this.getParent();d&&d.getTarget&&(a=d.getTarget());return a},addToEnd:function(a,d){d&&null!=a.length&&null!=d.length&&
a.push.apply(a,d);return a},removeBlock:function(a,d){a&&(!1!==d&&a.empty&&a.empty(),!1!==d&&delete a.items,a.parent=null,this.items&&this.items.remove(a))},_getContainer:function(a){return"items"},empty:function(a){try{this._empty(a)}catch(d){debugger}},_empty:function(a){if(a=a||this.items)for(var d=0;d<a.length;d++){var b=a[d];b&&b.empty&&b.empty();b&&this.scope&&this.scope.blockStore&&this.scope.blockStore.remove(b.id)}},containsItem:function(a,d){for(var b=a.length;b--;)if(a[b].id===d.id)return!0;
return!1},indexOf:function(a,d){for(var b=a.length;b--;)if(a[b].id===d.id)return b;return-1},_getBlock:function(a){try{if(!this||!this.parentId)return!1;var d=this.scope.getBlockById(this.parentId);if(!d)return null;var b=d[d._getContainer(this)];if(!b||2>b.length||!this.containsItem(b,this))return null;var l=this.indexOf(b,this);if(0>l+a)return!1;var c=b[l+a];if(c)return c}catch(e){debugger}return null},getPreviousBlock:function(){return this._getBlock(-1)},getNextBlock:function(){return this._getBlock(1)},
getPreviousResult:function(){var a=this.getPreviousBlock()||this.getParent();return a&&null!=a._lastResult?this.isArray(a._lastResult)?a._lastResult:[a._lastResult]:null},_getArg:function(c,d){var b=parseFloat(c);return isNaN(b)?"true"===c||"false"===c?a.toBoolean(c):c&&d&&_.isString(c)?"'"+c+"'":c:b},getArgs:function(c){var d=[],b=this._get("args");c&&c.override&&c.override.args&&(b=c.override.args);b&&(d=a.getJson(b,null,!1),null!=d&&_.isArray(d));if(d&&0==d.length&&b&&b.length&&_.isString(b)){if(-1!==
b.indexOf(",")){b=b.split(",");for(c=0;c<b.length;c++){var l=parseFloat(b[c]);isNaN(l)?"true"===b[c]||"false"===b[c]?d.push(a.toBoolean(b[c])):d.push(b[c]):d.push(l)}return d}d=[this._getArg(b)]}c=this.getPreviousResult();null!=c&&(m.isArray(c)&&1==c.length?d.push(c[0]):d.push(c));return d||[b]},remove:function(a){this._destroyed=!0;null!=this.parentId&&null==this.parent&&(this.parent=this.scope.getBlockById(this.parentId));if(this.parent&&this.parent.removeBlock)this.parent.removeBlock(this);else if(a=
a||this)a.empty&&a.empty(),delete a.items,a.parent=null,this.items&&this.items.remove(a)},prepareBlockContructorArgs:function(a){a||(a={});a.id||(a.id=this.createUUID());a.items||(a.items=[])},_add:function(a,d,b){var l=null;try{d?(this.prepareBlockContructorArgs(d),l=f.createBlock(a,d)):null==d&&(l=a);(l.scope=this.scope)&&(l=this.scope.registerBlock(l));if(l.id===this.id){console.error("adding new block to our self");debugger}l.parent=this;l.parentId=this.id;var c=b||this._getContainer();if(c)if(this[c]||
(this[c]=[]),-1!=this.indexOf(this[c],l))console.error(" have already "+l.id+" in "+c);else{if(this.id==l.id){console.error("tried to add our self to "+c);return}this[c].push(l)}return l}catch(e){logError(e,"_add")}return null},getStore:function(){return this.getScope().getStore()},add:function(a,d,b){a=this._add(a,d,b);return a.getStore().getSync(a.id)},getContext:function(){return this.scope.instance&&this.scope.instance?this.scope.instance:null},resolved:function(){this._deferredObject&&(this._deferredObject.resolve(),
delete this._deferredObject)},_solve:function(a,d){d=d||{highlight:!1};for(var b=[],l=0;l<this.items.length;l++)this.addToEnd(b,this.items[l].solve(a,d));return b},solve:function(a,d){d=d||{highlight:!1};for(var b=[],l=0;l<this.items.length;l++)this.addToEnd(b,this.items[l].solve(a,d));return b},solveMany:function(a,d){!this._lastRunSettings&&d&&(this._lastRunSettings=d);d=this._lastRunSettings||d;this._currentIndex=0;this._return=[];var b=this[this._getContainer()];if(b.length)return b=this.runFrom(b,
0,d),this.onSuccess(this,d),b;this.onSuccess(this,d);return[]},runFrom:function(a,d,b){var l=this;a=a||this.items;var c=function(d){d._deferredObject.then(function(c){d._lastResult=d._lastResult||c;l._currentIndex++;l.runFrom(a,l._currentIndex,b)})};if(a.length)for(;d<a.length;d++){var e=a[d];if(!0===e.deferred){e._deferredObject=new n;this._currentIndex=d;c(e);this.addToEnd(this._return,e.solve(this.scope,b));break}else this.addToEnd(this._return,e.solve(this.scope,b))}else this.onSuccess(this,b);
return this._return},serializeField:function(a){return-1==this.ignoreSerialize.indexOf(a)},onLoad:function(){},activate:function(){},deactivate:function(){},_get:function(a){return a in this.override?this.override[a]:this[a]},onDidRun:function(){this.override={}}});p.FLAGS=c.BLOCK_FLAGS;p.EMITS=c.BLOCK_CALLBACKMASK;k("xblox-ui")&&m.mixin(p.prototype,e.prototype);p.prototype.onSuccess||(p.prototype.onSuccess=function(){},p.prototype.onRun=function(){});return p})},"xblox/model/ModelBase":function(){define(["dcl/dcl",
"xide/utils","xide/types"],function(p,n,m){return p(null,{declaredClass:"xblox.model.ModelBase",id:null,description:"",parent:null,parentId:null,group:null,order:0,_store:null,outputs:function(){return[]},takes:function(){return[]},needs:function(){return[]},constructor:function(k){for(var h in k)k.hasOwnProperty(h)&&(this[h]=k[h]);this.id||(this.id=this.createUUID());this.utils=n;this.types=m},keys:function(k){var h=[],f;for(f in k)h.push(f);return h},values:function(k){var h=[],f;for(f in k)h.push(k[f]);
return h},toArray:function(){return this.map()},size:function(){return this.toArray().length},createUUID:function(){var k=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return k()+k()+"-"+k()+"-"+k()+"-"+k()+"-"+k()+k()+k()},canEdit:function(){return!0},getFields:function(){return null},isString:function(k){return"string"==typeof k},isNumber:function(k){return"number"==typeof k},isBoolean:function(k){return"boolean"==typeof k},isObject:function(k){return"object"===typeof k},
isArray:function(k){return Array.isArray?Array.isArray(k):!1},getValue:function(k){var h=parseFloat(k);return isNaN(h)?"true"===k||!0===k?!0:"false"===k||!1===k?!1:k:h},isScript:function(k){return this.isString(k)&&(-1!=k.indexOf("return")||-1!=k.indexOf(";")||-1!=k.indexOf("+")||-1!=k.indexOf("-")||-1!=k.indexOf("\x3c")||-1!=k.indexOf("*")||-1!=k.indexOf("/")||-1!=k.indexOf("%")||-1!=k.indexOf("\x3d")||-1!=k.indexOf("\x3d\x3d")||-1!=k.indexOf("\x3e")||-1!=k.indexOf("[")||-1!=k.indexOf("{")||-1!=
k.indexOf("}"))},replaceAll:function(k,h,f){return this.isString(f)?f.split(k).join(h):f},isInValidState:function(){return!0}})})},"xcf/manager/DriverManager_Server":function(){define(["dcl/dcl","dojo/_base/lang","dojo/_base/declare","xide/types","xide/utils"],function(p,n,m,k,h){return p(null,{declaredClass:"xcf.manager.DriverManager_Server",onDriverBlocksChanged:function(f,a){var c=[],e=this.getStore()||this.store;if(!e)return console.error("getDriversAsEnumeration:: have no store!"),c;c=e.query({isDir:!1});
for(e=0;e<c.length;e++){var g=c[e],d=g.user;h.getInputCIByName(d,k.DRIVER_PROPERTY.CF_DRIVER_ID);h.getInputCIByName(d,k.DRIVER_PROPERTY.CF_DRIVER_NAME);d&&g.blockPath&&g.blockPath.indexOf(a)}},onFileChanged:function(f){if("changed"===f.type&&!f._didb){f._didb=!0;var a=h.replaceAll("\\","/",f.path),a=h.replaceAll("//","/",a),a=a.replace(/\\/g,"/"),c;c=a;c=-1!=c.indexOf("system/driver")?c.substr(c.indexOf("system/driver")+14,c.length):null;c&&-1!==c.indexOf(".xblox")&&(console.log("driver blocks changed "+
c+" @ "+a,f),this.onDriverBlocksChanged(a,c))}},createDriverInstance:function(f,a){var c=this,e=this.driverScopes.system_drivers+"DriverBase";console.error(e);require([e],function(g){g.prototype.declaredClass=e;var d=c.driverScopes[f.scope],b=h.getCIInputValueByName(f.user,k.DRIVER_PROPERTY.CF_DRIVER_CLASS);if(b){var l=d+b,l=l.replace(".js",""),l=l.replace("./","");console.log("create driver instance "+l);require([l],function(b){b=new (m([g],b.prototype));b.baseClass=g.prototype.declaredClass;b.modulePath=
h.replaceAll("//","/",l);b.delegate=c;f.instance=b;a&&a(b);try{b.start()}catch(d){}return b})}else console.error("cant find driver class in meta")})},onDeviceDisconnected:function(f){},onDeviceMessage:function(f){console.log("onDeviceMessage");if(f&&f.device&&f.driverInstance){var a=f.device,c=f.driverInstance,e=c.options;if(e){var g=[f.deviceMessage];n.isString(f.deviceMessage)&&-1!=f.deviceMessage.indexOf(c.lineBreak)&&(g=f.deviceMessage.split(c.lineBreak));if(0<g.length){f=this.ctx.getBlockManager().getScope(e.id);
c=f.getBlocks({group:k.BLOCK_GROUPS.CF_DRIVER_RESPONSE_BLOCKS});e=f.getVariables({group:k.BLOCK_GROUPS.CF_DRIVER_RESPONSE_VARIABLES});c&&0!=c.length||console.log("have no response blocks, abort");var d=f.getVariable("value");d||(d=new Variable({id:h.createUUID(),title:"value",value:"",scope:f,type:13,group:"processVariables",gui:!1,cmd:!1}));for(var b=0;b<g.length;b++)if(0!=g[b].length){d.value=g[b];console.log("update process value "+d.value+" for "+a.host);this.publish(k.EVENTS.ON_DRIVER_VARIABLE_CHANGED,
{item:d,scope:f,owner:this});for(var l=0;l<e.length;l++)"value"!=e[l].title&&f.expressionModel.parseVariable(f,e[l]);for(l=0;l<c.length;l++)f.solveBlock(c[l],{highlight:!0})}console.log("forward messages to scope")}}}},init:function(){this.subscribe(k.EVENTS.ON_DEVICE_MESSAGE,this.onDeviceMessage);this.subscribe(k.EVENTS.ON_DEVICE_DISCONNECTED,this.onDeviceDisconnected)}})})},"xide/data/ObservableStore":function(){define(["xdojo/declare","xide/mixins/EventedMixin"],function(p,n){return p("xide/data/Observable",
n,{_ignoreChangeEvents:!0,observedProperties:[],putSync:function(m){this._ignoreChangeEvents=!0;var k=this.inherited(arguments);this._ignoreChangeEvents=!1;this.emit("added",k);return k},removeSync:function(m){var k=this.getSync(m);k&&k.onRemove&&k.onRemove();return this.inherited(arguments)},postscript:function(){var m=this;m.inherited(arguments);if(m.on)m.on("add",function(k){k=k.target;m._observe(k);k._store||(k._store=m);k._onCreated();k.onAdd&&k.onAdd(k)})},_onItemChanged:function(m,k,h,f){this._ignoreChangeEvents||
(k={target:m,property:k,value:h,source:f},this.emit("update",k),m.onItemChanged&&m.onItemChanged(k))},_observe:function(m){var k=this,h=k.observedProperties;m&&m.observed&&(h=h.concat(m.observed));h&&h.forEach(function(f){m.property(f).observe(function(a){k._ignoreChangeEvents||k._onItemChanged(m,f,a,k)})})},setData:function(m){this.inherited(arguments);this._ignoreChangeEvents=!0;m&&_.each(m,this._observe,this);this._ignoreChangeEvents=!1}})})},"dstore/Trackable":function(){define("dojo/_base/lang dojo/_base/declare dojo/aspect dojo/when dojo/promise/all dojo/_base/array dojo/on".split(" "),
function(p,n,m,k,h,f,a){function c(a,b,l){for(var c=a.length-1;0<=c;--c){var e=a[c],g=e.start,e=g+e.count;if(b>e){a.splice(c+1,0,{start:b,count:l-b});return}l>=g&&(b=Math.min(b,g),l=Math.max(l,e),a.splice(c,1))}a.unshift({start:b,count:l-b})}var e=0,g={track:function(){function d(){return function(){var a=this,b=this.inherited(arguments);k(b,function(b){b=a._results=b.slice();a._partialResults&&(a._partialResults=null);a._ranges=[];c(a._ranges,0,b.length)});return b}}function b(){return function(a){var b=
this,d=a.start,l=a.end,e=this.inherited(arguments);this._results||k(e,function(a){return k(a.totalLength,function(e){var g=b._partialResults||(b._partialResults=[]);l=Math.min(l,d+a.length);g.length=e;e=[d,l-d].concat(a);g.splice.apply(g,e);c(b._ranges,d,l);return a})});return e}}function l(a,b){e++;var d=b.target;b=p.delegate(b,u[a]);k(y._results||y._partialResults,function(c){if(c){var l,e,h,k=y._ranges,m,t="id"in b?b.id:g.getIdentity(d),n=-1,r=-1,p=-1,x=-1;if("delete"===a||"update"===a)for(l=0;-1===
n&&l<k.length;++l)for(m=k[l],e=m.start,h=e+m.count;e<h;++e)if(g.getIdentity(c[e])==t){n=b.previousIndex=e;r=l;c.splice(n,1);m.count--;for(e=l+1;e<k.length;++e)k[e].start--;break}if("add"===a||"update"===a){if(v){if(v([d]).length){var u=0;h=k.length-1;e=-1;for(var G;u<=h&&-1===p;)l=u+Math.round((h-u)/2),m=k[l],r=c.slice(m.start,m.start+m.count),"beforeId"in b&&(e=null===b.beforeId?r.length:w(r,b.beforeId)),-1===e&&(e=n>=Math.max(0,m.start-1)&&n<=m.start+m.count?n:g.defaultNewToStart?0:r.length),r.splice(e,
0,d),t=f.indexOf(v(r),d),G=m.start+t,0===t&&0!==m.start?h=l-1:t>=r.length-1&&G<c.length?u=l+1:(p=G,x=l);if(-1===p&&0<u&&u<k.length)var H=!0}}else{e=-1;if("beforeId"in b)if(null===b.beforeId)p=c.length,e=k.length-1;else for(l=0,h=k.length;-1===x&&l<h;++l)m=k[l],p=w(c,b.beforeId,m.start,m.start+m.count),-1!==p&&(x=l);else"update"===a?(p=n,x=r):g.defaultNewToStart?e=p=0:(p=c.length,e=k.length-1);-1!==e&&-1===x&&(m=k[e])&&m.start<=p&&p<=m.start+m.count&&(x=e)}if(-1<p&&-1<x)for(b.index=p,c.splice(p,0,
d),k[x].count++,l=x+1;l<k.length;++l)k[l].start++;else if(H)for(b.beforeIndex=k[u].start,l=u;l<k.length;++l)k[l].start++}b.totalLength=c.length}(c=y["on_tracked"+a])&&c.call(y,b)})}var g=this.store||this,h=[],t={add:1,update:1,"delete":1},x;for(x in t)h.push(this.on(x,function(a){return function(b){l(a,b)}}(x)));var y=n.safeMixin(p.delegate(this),{_ranges:[],fetch:d(),fetchRange:b(),releaseRange:function(a,b){if(this._partialResults){a:for(var d=this._ranges,l=0,c;c=d[l];++l){var e=c.start,g=e+c.count;
if(a<=e)if(b>=g)d.splice(l,1);else{c.start=b;c.count=g-c.start;break a}else if(a<g)if(b>e){d.splice(l,1,{start:e,count:a-e},{start:b,count:g-b});break a}else c.count=a-c.start}for(d=a;d<b;++d)delete this._partialResults[d]}},on:function(b,d){var l=this,c=this.getInherited(arguments);return a.parse(y,b,d,function(a,b){return b in t?m.after(y,"on_tracked"+b,d,!0):c.call(l,b,d)})},tracking:{remove:function(){for(;0<h.length;)h.pop().remove();this.remove=function(){}}},track:null});this.fetchSync&&(n.safeMixin(y,
{fetchSync:d(),fetchRangeSync:b()}),y.fetchSync());var v;f.forEach(this.queryLog,function(a){var b=v,d=a.querier;d&&(v=b?function(a){return d(b(a))}:d)});var u={add:{index:void 0},update:{previousIndex:void 0,index:void 0},"delete":{previousIndex:void 0}},w=function(a,b,d,l){l=void 0!==l?l:a.length;for(d=void 0!==d?d:0;d<l;++d)if(g.getIdentity(a[d])===b)return d;return-1};return y}};h=n(null,g);h.create=function(a,b){a=n.safeMixin(p.delegate(a),g);n.safeMixin(a,b);return a};return h})},"xcf/model/Driver":function(){define(["xdojo/declare",
"xide/data/Model","xide/utils"],function(p,n,m){return p(n,{itemMetaPath:"user.meta",getMetaValue:function(k){return m.getCIInputValueByName(this.user,k)},setMetaValue:function(k,h,f){var a=m.getCIByChainAndName(this.user,0,k);if(!a)return null;var c=this.getMetaValue(k);m.setCIValueByField(a,"value",h);this[k]=h;if(!1!==f)return this.publish(types.EVENTS.ON_CI_UPDATE,{owner:this.owner,ci:a,newValue:h,oldValue:c})},getParent:function(){return this._store.getSync(this.parentId)}})})},"xide/data/Model":function(){define("dcl/dcl dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/aspect dojo/when".split(" "),
function(p,n,m,k,h,f){function a(a,b){var d=a.schema[b];void 0===d||d instanceof v||(d=new v(d),d._parent=a);d&&(d.name=b);return d}function c(b,d){var l,c=b.hasOwnProperty("_properties")&&b._properties[d];l=c;c||(c=a(b,d))&&c.validate&&(c=m.delegate(c,{_parent:b,key:d}));return c&&c.validate?f(c.validate(),function(a){a||l||((b.hasOwnProperty("_properties")?b._properties:b._properties=new y)[d]=c);return a}):!0}function e(a){var b,d=1;a(function(a,l,c){a&&a.then?(d++,b||(b=new k),a.then(function(a){l(a,
c);d--;d||b.resolve()}).then(null,b.reject)):l(a,c)});if(b)return d--,d||b.resolve(),b.promise}function g(){2>q&&t&&(t(),t=null);q--}function d(){return d}var b=[].slice,l=n("xide/data/Model",null,{schema:{},additionalProperties:!0,_scenario:"update",constructor:function(a){this.init(a)},refresh:function(a){var b=this._store;b&&b.refreshItem(this,a)},getStore:function(){return this._store},init:function(a){this._scenario="insert";a=this._setValues(a);for(var b in this.schema){var d=this.schema[b];
d&&"object"===typeof d&&"default"in d&&!a.hasOwnProperty(b)&&(d=d["default"],a[b]="function"===typeof d?d.call(this):d)}},_setValues:function(a){return m.mixin(this,a)},_getValues:function(){return this._values||this},save:function(a){var b=this;return f(a&&a.skipValidation?!0:this.validate(),function(a){if(!a)throw b.createValidationError(b.errors);a=b._scenario;b.prepareForSerialization();return b._store&&f(b._store["insert"===a?"add":"put"](b),function(a){b.set(a);b._scenario="update";return b})})},
remove:function(){var a=this._store;return a.remove(a.getIdentity(this))},prepareForSerialization:function(){this._scenario=void 0;this._inherited&&(this._inherited.toJSON=d)},createValidationError:function(a){return Error("Validation error")},property:function(d,l){var c=this.hasOwnProperty("_properties")?this._properties:this._properties=new y,e=c[d];e||(e=a(this,d),e=c[d]=e?m.delegate(e):new v,e.name=d,e._parent=this);return l?e.property.apply(e,b.call(arguments,1)):e},get:function(b){var d,l=
this.schema[b];return(l=d||this.schema[b])&&l.valueOf&&(l.valueOf!==u||l.hasCustomGet)?((d=d||this.hasOwnProperty("_properties")&&this._properties[b])||(d=m.delegate(a(this,b),{name:b,_parent:this})),d.valueOf()):this._getValues()[b]},set:function(a,b){if("object"===typeof a){q++;try{for(var l in a)b=a[l],!a.hasOwnProperty(l)||b&&b.toJSON===d||this.set(l,b)}finally{g()}}else{l=this.schema[a];if(!l&&!this.additionalProperties)return console.warn("Schema does not contain a definition for",a);var e=
this.hasOwnProperty("_properties")&&this._properties[a];!e&&(b&&"object"===typeof b||l&&l.put!==w)&&(e=this.property(a));e?e.put(b):(l&&l.coerce&&(b=l.coerce(b)),this._getValues()[a]=b,l&&!1!==l.validateOnSet&&c(this,a));return b}},observe:function(a,b,d){return this.property(a).observe(b,d)},validate:function(a){var b=this,d=!0,l=[],g;if(a){g={};for(var h=0;h<a.length;h++)g[h]=!0}return f(e(function(a){for(var e in b.schema)g&&!g.hasOwnProperty(e)||a(c(b,e),function(a,c){a||(d=!1,l.push.apply(l,
b.property(c).errors))},e)}),function(){b.set("errors",d?void 0:l);return d})},isValid:function(){var a=!0,b;for(b in this.schema){var d=this.hasOwnProperty("_properties")&&this._properties[b];d&&d.errors&&d.errors.length&&(a=!1)}return a}}),q=0,r,t;(l.nextTurn=function(a){t=a}).atEnd=!0;var x=n([l],{observe:function(a,b){var d;if("string"===typeof a)return this.inherited(arguments);b&&b.onlyFutureUpdates||(d=new x,this._has()&&(d.value=a(this.valueOf())));var l=this._addListener(function(b){b=a(b);
d&&d.put(b)});return d?(d.remove=l.remove,d):l},validateOnSet:!1,validators:null,_addListener:function(a){return h.after(this,"onchange",a,!0)},valueOf:function(){return this._get()},_get:function(){return this.value},_has:function(){return this.hasOwnProperty("value")},setValue:function(a){this.value=a},put:function(a){var b=this._get();a=this.coerce(a);this.errors&&this.set("errors",void 0);var d=this;q++;return f(this.setValue(a,this._parent),function(l){void 0!==l&&(a=l);d.onchange&&d._queueChange(d.onchange,
b);var c,e=b&&"object"===typeof b&&!(b instanceof Array),f=a&&"object"===typeof a&&!(a instanceof Array);if(e||f){l={};if(e)for(c in b=b._getValues?b._getValues():b,b)l[c]={old:b[c]};if(f)for(c in a=a._getValues?a._getValues():a,a)(l[c]=l[c]||{}).value=a[c];d._values=f&&a;for(c in l)e=l[c],(f=d._properties&&d._properties[c])&&f.onchange&&f._queueChange(f.onchange,e.old)}d.validateOnSet&&d.validate();g()})},coerce:function(a){var b=this.type;b&&("string"===b?a=""+a:"number"===b?a=+a:"boolean"===b?
a="false"===a||"0"===a||a instanceof Array&&!a.length?!1:!!a:"function"!==typeof b||a instanceof b||(a=new b(a)));return a},addError:function(a){this.set("errors",(this.errors||[]).concat([a]))},checkForErrors:function(a){var b=[];this.type&&!("function"===typeof this.type?a instanceof this.type:this.type===typeof a)&&b.push(a+" is not a "+this.type);!this.required||null!=a&&""!==a||b.push("required, and it was not present");return b},validate:function(){var a=this,b=this._parent,d=this.validators,
l=this.valueOf(),c=[];return f(e(function(e){function g(a){a&&c.push.apply(c,a)}if(d)for(var f=0;f<d.length;f++)e(d[f].checkForErrors(l,a,b),g);e(a.checkForErrors(l,a,b),g)}),function(){if(c.length)return a.set("errors",c),!1;void 0!==a.get("errors")&&a.set("errors",void 0);return!0})},_queueChange:function(a,b){if(!a._queued){a._queued=!0;var d=this,c=function(){a._queued=!1;a.call(d,d._get(),b)};r&&r.push(c);r||(!l.nextTurn.atEnd||0<q?(r=[c],l.nextTurn(function(){for(var a=0;a<r.length;a++)r[a]();
r=null})):c())}},toJSON:function(){return this._values||this}}),y=function(){};y.prototype.toJSON=d;var v=l.Property=n(x,{init:function(a){if("string"===typeof a||"function"===typeof a)a={type:a};a&&n.safeMixin(this,a)},_get:function(){return this._parent._getValues()[this.name]},_has:function(){return this.name in this._parent._getValues()},setValue:function(a,b){b._getValues()[this.name]=a}}),u=v.prototype.valueOf,w=v.prototype.put;return l})},"xide/manager/ServerActionBase":function(){define("dcl/dcl dojo/_base/declare xdojo/has dojo/Deferred xide/manager/RPCService xide/manager/ManagerBase xide/types xide/utils".split(" "),
function(p,n,m,k,h,f,a,c){m={declaredClass:"xide.manager.ServerActionBase",serviceObject:null,serviceUrl:null,singleton:!0,serviceClass:null,defaultOptions:{omit:!0,checkMessages:!0,checkErrors:!0},base64_encode:function(a){var c,d,b,l,f=0,h=0,k="",k=[];if(!a)return a;do c=a.charCodeAt(f++),d=a.charCodeAt(f++),b=a.charCodeAt(f++),l=c<<16|d<<8|b,c=l>>18&63,d=l>>12&63,b=l>>6&63,l&=63,k[h++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(d)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(l);while(f<a.length);k=k.join("");a=a.length%3;return(a?k.slice(0,a-3):k)+"\x3d\x3d\x3d".slice(a||3)},runDeferred:function(c,g,d,b){var l=new k,f;b=b||this.defaultOptions;this.check();if(!this.checkCall(c,g,b.omit))return l.reject("method doesnt exists: "+g+" for service class:"+this.serviceClass+" in "+this.declaredClass);this.prepareCall();
var h=this.getService(),m=this.getServiceClass(c),n=this,p=function(a,d){var c=l;b.returnProm&&(c=f);c._data=a;if(d&&b.onError)return b.onError(d);c.resolve(a)};f=h[m][g](d);f.then(function(d){d=d||{};var c=d.error||{};if(b.checkMessages&&c&&3==c.code)n.onMessages(c);if(b.checkErrors){if(1==c.code){n.onError(c,m+"::"+g);l.reject(c);return}}else{if(1==c.code&&b.displayError)n.onError(c,m+"::"+g);if(c&&0!=c.code){p(d,c);return}}b.omit&&n.publish(a.EVENTS.STATUS,{message:"Ok!",what:arguments},this);
p(d)},function(a){n.onError(a)});return b.returnProm?f:l},getService:function(){return this.serviceObject},getServiceClass:function(a){return a||this.serviceClass},hasMethod:function(a,c){var d=this.getService(),b=c||this.getServiceClass();return d&&b&&null!=d[b]&&null!=d[b][a]},findServiceUrl:function(a){var c=window.xFileConfig;if(c&&c.mixins)for(var d=0;d<c.mixins.length;d++){var b=c.mixins[d];if(b.declaredClass===a&&b.mixin&&b.mixin.serviceUrl)return b.mixin.serviceUrl}return null},init:function(){this.check()},
_initService:function(){return!1},check:function(){this.serviceObject||this._initService()},onError:function(c,g){if(c)if(1===c.code){if(c.message&&_.isArray(c.message)){this.publish(a.EVENTS.ERROR,{message:c.message.join("\x3cbr/\x3e")});return}}else 0===c.code&&this.publish(a.EVENTS.STATUS,"Ok");g&&(c.message=g+" -\x3e "+c.message);this.publish(a.EVENTS.ERROR,{error:c},this)},checkCall:function(a,c,d){a=this.getServiceClass(a);return this.getService()?this.hasMethod(c,a)||!0!==d?!0:(this.onError({code:1,
message:["Sorry, server doesnt know "+c]}),!1):(console.error("have no service object"),!1)},prepareCall:function(){var a={};this.config&&this.config.RPC_PARAMS&&(a=c.mixin(a,this.config.RPC_PARAMS.rpcFixedParams),this.serviceObject.extraArgs=a,this.config.RPC_PARAMS.rpcUserField&&(a[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue,this.serviceObject.signatureField=this.config.RPC_PARAMS.rpcSignatureField,this.serviceObject.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken))},
callMethodEx:function(c,g,d,b,l){(c=c||this.serviceClass)||console.error("have no service class! "+this.declaredClass,this);this.check();if(this.checkCall(c,g,l)){this.prepareCall();var f=this;if(!this.getServiceClass(c))debugger;var h=this.serviceObject[this.getServiceClass(c)];if(!h||!h[g])debugger;this.serviceObject[this.getServiceClass(c)][g](d).then(function(d){try{b&&b(d)}catch(h){console.error("bad news : callback for method "+g+" caused a crash in service class "+c),logError(h,"server method failed "+
h)}d&&d.error&&3==d.error.code&&setTimeout(function(){f.onMessages(d.error)},50);if(d&&d.error&&d.error&&0!=d.error.code)f.onError(d.error);else 1==l&&f.publish(a.EVENTS.STATUS,{message:"Ok!"},this)},function(a){f.onError(a)})}},callMethodEx2:function(a,c,d,b,l){this.check();if(this.checkCall(a,c,l))return this.prepareCall(),this.serviceObject[this.getServiceClass(a)][c](d)},callMethod:function(e,g,d,b){g=g||[[]];var l=this.serviceClass;try{var f=this;if(null==this.serviceObject[l][e]){if(!0===b)this.onError({code:1,
message:["Sorry, server doesnt know "+e]});return null}l={};l=c.mixin(l,this.config.RPC_PARAMS.rpcFixedParams);l[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue;this.serviceObject.extraArgs=l;this.serviceObject.signatureField=this.config.RPC_PARAMS.rpcSignatureField;this.serviceObject.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken;this.serviceObject[this.serviceClass][e](g).then(function(c){try{d&&d(c)}catch(l){console.error("crashed in "+e);console.dir(l);debugger}c&&
c.error&&3==c.error.code&&setTimeout(function(){f.onMessages(c.error)},50);if(c&&c.error&&c.error&&1==c.error.code)f.onError(c.error);else!1!==b&&f.publish(a.EVENTS.STATUS,{message:"Ok!"},this)},function(a){f.onError(a)})}catch(h){console.error("crash! "+h),f.onError(h)}}};p=p(f,m);p.declare=n(null,m);return p})},"xide/manager/RPCService":function(){define("dojo/_base/declare dojo/_base/lang xide/rpc/Service xide/rpc/JsonRPC dojo/has dojo/Deferred xide/utils xide/types xide/mixins/EventedMixin xide/encoding/SHA1".split(" "),
function(p,n,m,k,h,f,a,c,e,g){return p("xide.manager.RPCService",[m,e],{extraArgs:null,signatureField:"sig",signatureToken:null,correctTarget:!0,sync:!1,defaultOptions:{omit:!0,checkMessages:!0,checkErrors:!0},onError:function(a){if(a)if(1===a.code){if(a.message&&_.isArray(a.message)){this.publish(c.EVENTS.ERROR,{message:a.message.join("\x3cbr/\x3e")});return}}else 0===a.code&&this.publish(c.EVENTS.STATUS,"Ok");this.publish(c.EVENTS.ERROR,{error:a},this)},prepareCall:function(){var d={};this.config&&
this.config.RPC_PARAMS&&(this.extraArgs=d=a.mixin(d,this.config.RPC_PARAMS.rpcFixedParams),this.config.RPC_PARAMS.rpcUserField&&(d[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue,this.signatureField=this.config.RPC_PARAMS.rpcSignatureField,this.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken))},runDeferred:function(a,b,l,e){var g=new f;e=e||this.defaultOptions;if(!this.checkCall(a,b,e.omit))return g.reject("method doesnt exists: "+b+" for service class:"+this.serviceClass+
" in "+this.declaredClass);this.prepareCall();var h=this;this[this.getServiceClass(a)][b](l).then(function(a){if(e.checkMessages&&a&&a.error&&3==a.error.code)h.onMessages(a.error);e.checkErrors&&a&&a.error&&a.error&&0!=a.error.code?(h.onError(a.error),g.reject(a.error)):(e.omit&&h.publish(c.EVENTS.STATUS,{message:"Ok!",what:arguments},this),g.resolve(a))},function(a){h.onError(a)});return g},getParameterMap:function(a,b){var c=this._smd.services[a+"."+b];return c&&c.parameters?c.parameters:[]},_getRequest:function(a,
b){var c=this._smd,e=m.envelopeRegistry.match(a.envelope||c.envelope||"NONE"),g=(a.parameters||a.params||[]).concat(c.parameters||[]);if(e.namedParams){if(1==b.length&&n.isObject(b[0]))b=b[0];else{for(var f={},h=a.parameters||a.params,k=0;k<h.length;k++)"undefined"==typeof b[k]&&h[k].optional||(f[h[k].name]=b[k]);b=f}if(a.strictParameters||c.strictParameters)for(k in b){f=!1;for(h=0;h<g.length;h++)g[k].name==k&&(f=!0);f||delete b[k]}for(k=0;k<g.length;k++)if(f=g[k],!f.optional&&f.name&&null!=b&&!b[f.name])if(f["default"])b[f.name]=
f["default"];else if(!(f.name in b))throw Error("Required parameter "+f.name+" was omitted");}else g&&g[0]&&g[0].name&&1==b.length&&dojo.isObject(b[0])&&(b=!1===e.namedParams?m.toOrdered(g,b):b[0]);n.isObject(this._options)&&(b=dojo.mixin(b,this._options));g=a._schema||a.returns;k=e.serialize.apply(this,[c,a,b]);k._envDef=e;return dojo.mixin(k,{sync:this.sync,contentType:a.contentType||c.contentType||k.contentType,headers:a.headers||c.headers||k.headers||{},target:k.target||m.getTarget(c,a),transport:a.transport||
c.transport||k.transport,envelope:a.envelope||c.envelope||k.envelope,timeout:a.timeout||c.timeout,callbackParamName:a.callbackParamName||c.callbackParamName,rpcObjectParamName:a.rpcObjectParamName||c.rpcObjectParamName,schema:g,handleAs:k.handleAs||"auto",preventCache:a.preventCache||c.preventCache,frameDoc:this._options.frameDoc||void 0})},_executeMethod:function(a){var b=[],c;if(2==arguments.length&&n.isArray(arguments[1]))b=arguments[1];else for(c=1;c<arguments.length;c++)b.push(arguments[c]);
var e=this._getRequest(a,b);this.correctTarget&&(e.target=this._smd.target);if(this.extraArgs)for(var f in this.extraArgs)e.target+=-1!=e.target.indexOf("?")?"\x26":"?",e.target+=f+"\x3d"+this.extraArgs[f];this.signatureToken&&(e.target+=-1!=e.target.indexOf("?")?"\x26":"?",b=g._hmac(e.data,this.signatureToken,1),b=g._hmac(e.data,this.signatureToken,1),e.target+=this.signatureField+"\x3d"+b);b=m.transportRegistry.match(e.transport).fire(e);b.addBoth(function(a){return e._envDef.deserialize.call(this,
a)});return b},getServiceClass:function(a){return a||this.serviceClass},hasMethod:function(a,b){var c=b||this.getServiceClass();return this&&c&&null!=this[c]&&null!=this[c][a]},checkCall:function(a,b,c){a=this.getServiceClass(a);return this.hasMethod(b,a)||!0!==c?!0:(this.onError({code:1,message:["Sorry, server doesnt know "+b]}),!1)},base64_encode:function(a){var b,c,e,g,f=0,h=0,k="",k=[];if(!a)return a;do b=a.charCodeAt(f++),c=a.charCodeAt(f++),e=a.charCodeAt(f++),g=b<<16|c<<8|e,b=g>>18&63,c=g>>
12&63,e=g>>6&63,g&=63,k[h++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(g);while(f<a.length);k=k.join("");a=a.length%3;return(a?k.slice(0,a-3):k)+"\x3d\x3d\x3d".slice(a||3)},callMethodEx:function(a,b,c,e,g,f){if(!this[a]||null==
this[a][b])return!0===f&&g&&g({code:1,message:["Sorry, server doesnt know "+b+" in class"+a]}),null;f={};this.config&&this.config.RPC_PARAMS&&(f=n.mixin(f,this.config.RPC_PARAMS.rpcFixedParams),f[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue,this.extraArgs=f,this.signatureField=this.config.RPC_PARAMS.rpcSignatureField,this.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken);this[a][b](c).then(function(c){try{e&&e(c)}catch(l){console.error("bad news : callback for method "+
b+" caused a crash in service class "+a)}c&&c.error&&c.error&&0!=c.error.code&&g&&g(c.error)},function(a){g(a)})},callMethod:function(a,b,c,e,g,f){try{var h=this;if(null==this[a][b])return!0===f&&g&&g({code:1,message:["Sorry, server doesnt know "+b]}),null;f={};f=n.mixin(f,this.config.RPC_PARAMS.rpcFixedParams);this[a][b](c).then(function(a){try{e&&e(a)}catch(d){console.error("crashed in "+b),console.dir(d)}a&&a.error&&a.error&&1==a.error.code&&g&&g(a.error)},function(a){h.onError(a)})}catch(k){console.error("crash! "+
k)}}})})},"xide/rpc/Service":function(){define(["dojo","dojo/_base/lang","dojo/_base/declare","./AdapterRegistry","dojo/_base/url"],function(p,n,m,k,h){function f(a,b){var c=a._baseUrl;a.target&&(c=new p._Url(c,a.target)+"");b.target&&(c=new p._Url(c,b.target)+"");return c}function a(a,b){if(p.isArray(b))return b;for(var c=[],e=0;e<a.length;e++)c.push(b[a[e].name]);return c}var c=new p.AdapterRegistry(!0),e=new p.AdapterRegistry(!0),g=1;m=m("xide.rpc.Service",null,{constructor:function(a,b){function c(a){a._baseUrl=
new p._Url(p.isBrowser?location.href:p.config.baseUrl,e||".")+"";g._smd=a;b&&"methods"===b.services&&(a.services=a.methods,delete a.methods,a.transport="POST",b.mixin&&n.mixin(a,b.mixin),b=null);for(var d in g._smd.services){a=d.split(".");for(var l=g,f=0;f<a.length-1;f++)l=l[a[f]]||(l[a[f]]={});l[a[a.length-1]]=g._generateService(d,g._smd.services[d])}}var e,g=this;if(a)if(p.isString(a)||a instanceof p._Url){e=a instanceof p._Url?a+"":a;var f=p._getText(e);if(f)c(p.fromJson(f));else throw Error("Unable to load SMD from "+
a);}else c(a);this._options=b?b:{};this._requestId=0},_generateService:function(a,b){if(this[b])throw Error("WARNING: "+a+" already exists for service. Unable to generate function");b.name=a;var l=p.hitch(this,"_executeMethod",b),e=c.match(b.transport||this._smd.transport);e.getExecutor&&(l=e.getExecutor(l,b,this));e=b.returns||(b._schema={});e._service=l;l.servicePath="/"+a+"/";l._schema=e;l.id=g++;return l},_getRequest:function(d,b){var c=this._smd,g=e.match(d.envelope||c.envelope||"NONE"),h=(d.parameters||
[]).concat(c.parameters||[]);if(g.namedParams){if(1==b.length&&p.isObject(b[0]))b=b[0];else{for(var k={},m=0;m<d.parameters.length;m++)"undefined"==typeof b[m]&&d.parameters[m].optional||(k[d.parameters[m].name]=b[m]);b=k}if(d.strictParameters||c.strictParameters)for(m in b){for(var k=!1,n=0;n<h.length;n++)h[n].name==m&&(k=!0);k||delete b[m]}for(m=0;m<h.length;m++)if(k=h[m],!k.optional&&k.name&&!b[k.name])if(k["default"])b[k.name]=k["default"];else if(!(k.name in b))throw Error("Required parameter "+
k.name+" was omitted");}else h&&h[0]&&h[0].name&&1==b.length&&p.isObject(b[0])&&(b=!1===g.namedParams?a(h,b):b[0]);p.isObject(this._options)&&(b=p.mixin(b,this._options));delete b.mixin;h=d._schema||d.returns;m=g.serialize.apply(this,[c,d,b]);m._envDef=g;return p.mixin(m,{sync:!1,contentType:d.contentType||c.contentType||m.contentType,headers:d.headers||c.headers||m.headers||{},target:m.target||f(c,d),transport:d.transport||c.transport||m.transport,envelope:d.envelope||c.envelope||m.envelope,timeout:d.timeout||
c.timeout,callbackParamName:d.callbackParamName||c.callbackParamName,rpcObjectParamName:d.rpcObjectParamName||c.rpcObjectParamName,schema:h,handleAs:m.handleAs||"auto",preventCache:d.preventCache||c.preventCache,frameDoc:this._options.frameDoc||void 0})},_executeMethod:function(a){var b=[],l;for(l=1;l<arguments.length;l++)b.push(arguments[l]);var e=this._getRequest(a,b),b=c.match(e.transport).fire(e);b.addBoth(function(a){return e._envDef.deserialize.call(this,a)});return b}});m.transportRegistry=
c;m.envelopeRegistry=e;m._nextId=g;m.getTarget=f;m.toOrdered=a;m._sync=!1;e.register("URL",function(a){return"URL"==a},{serialize:function(a,b,c){return{data:p.objectToQuery(c),transport:"POST"}},deserialize:function(a){return a},namedParams:!0});e.register("JSON",function(a){return"JSON"==a},{serialize:function(a,b,c){return{data:p.toJson(c),handleAs:"json",contentType:"application/json"}},deserialize:function(a){return a}});e.register("PATH",function(a){return"PATH"==a},{serialize:function(a,b,
c){var e;a=f(a,b);if(p.isArray(c))for(e=0;e<c.length;e++)a+="/"+c[e];else for(e in c)a+="/"+e+"/"+c[e];return{data:"",target:a}},deserialize:function(a){return a}});c.register("POST",function(a){return"POST"==a},{fire:function(a){a.url=a.target;a.postData=a.data;return p.rawXhrPost(a)}});c.register("GET",function(a){return"GET"==a},{fire:function(a){a.url=a.target+(a.data?"?"+(a.rpcObjectParamName?a.rpcObjectParamName+"\x3d":"")+a.data:"");return p.xhrGet(a)}});c.register("JSONP",function(a){return"JSONP"==
a},{fire:function(a){a.url=a.target+(-1==a.target.indexOf("?")?"?":"\x26")+(a.rpcObjectParamName?a.rpcObjectParamName+"\x3d":"")+a.data;a.callbackParamName=a.callbackParamName||"callback";return p.io.script.get(a)}});p._contentHandlers&&(p._contentHandlers.auto=function(a){var b=p._contentHandlers,c=a.getResponseHeader("Content-Type");return c?c.match(/\/.*json/)?b.json(a):c.match(/\/javascript/)?b.javascript(a):c.match(/\/xml/)?b.xml(a):b.text(a):b.text(a)});return m})},"xide/rpc/AdapterRegistry":function(){define(["dojo/_base/kernel",
"dojo/_base/lang"],function(p,n){var m=p.AdapterRegistry=function(k){this.pairs=[];this.returnWrappers=k||!1};n.extend(m,{register:function(k,h,f,a,c){this.pairs[c?"unshift":"push"]([k,h,f,a])},match:function(){for(var k=0;k<this.pairs.length;k++){var h=this.pairs[k];if(h[1].apply(this,arguments))return h[3]||this.returnWrappers?h[2]:h[2].apply(this,arguments)}throw Error("No match found");},unregister:function(k){for(var h=0;h<this.pairs.length;h++)if(this.pairs[h][0]==k)return this.pairs.splice(h,
1),!0;return!1}});return m})},"xide/rpc/JsonRPC":function(){define(["dojo/_base/lang","dojo/_base/json","./Service","dojo/errors/RequestError"],function(p,n,m,k){function h(f){return{serialize:function(a,c,e,g){a={id:this._requestId++,method:c.name,params:e};f&&(a.jsonrpc=f);return{data:n.toJson(a),handleAs:"json",contentType:"application/json",transport:"POST"}},deserialize:function(a){if("Error"==a.name||a instanceof k)a=n.fromJson(a.responseText);if(a.error){var c=Error(a.error.message||a.error);
c._rpcErrorObject=a.error;return c}return a.result}}}m.envelopeRegistry.register("JSON-RPC-1.0",function(f){return"JSON-RPC-1.0"==f},p.mixin({namedParams:!1},h()));m.envelopeRegistry.register("JSON-RPC-2.0",function(f){return"JSON-RPC-2.0"==f},p.mixin({namedParams:!0},h("2.0")))})},"xide/encoding/SHA1":function(){define(["./_base"],function(p){function n(a,c){a[c>>5]|=128<<24-c%32;a[(c+64>>9<<4)+15]=c;for(var e=Array(80),g=1732584193,d=-271733879,b=-1732584194,l=271733878,f=-1009589776,h=0;h<a.length;h+=
16){for(var k=g,m=d,n=b,v=l,u=f,w=0;80>w;w++){if(16>w)e[w]=a[h+w];else{var C=e[w-3]^e[w-8]^e[w-14]^e[w-16];e[w]=C<<1|C>>>31}C=p.addWords(p.addWords(g<<5|g>>>27,20>w?d&b|~d&l:40>w?d^b^l:60>w?d&b|d&l|b&l:d^b^l),p.addWords(p.addWords(f,e[w]),20>w?1518500249:40>w?1859775393:60>w?-1894007588:-899497514));f=l;l=b;b=d<<30|d>>>2;d=g;g=C}g=p.addWords(g,k);d=p.addWords(d,m);b=p.addWords(b,n);l=p.addWords(l,v);f=p.addWords(f,u)}return[g,d,b,l,f]}function m(a){for(var c=[],e=0,g=8*a.length;e<g;e+=8)c[e>>5]|=
(a.charCodeAt(e/8)&255)<<24-e%32;return c}function k(a){for(var c=[],e=0,g=4*a.length;e<g;e++)c.push("0123456789abcdef".charAt(a[e>>2]>>8*(3-e%4)+4&15),"0123456789abcdef".charAt(a[e>>2]>>8*(3-e%4)&15));return c.join("")}function h(a){for(var c=[],e=0,g=32*a.length;e<g;e+=8)c.push(String.fromCharCode(a[e>>5]>>>24-e%32&255));return c.join("")}function f(a){for(var c=[],e=0,g=4*a.length;e<g;e+=3)for(var d=(a[e>>2]>>8*(3-e%4)&255)<<16|(a[e+1>>2]>>8*(3-(e+1)%4)&255)<<8|a[e+2>>2]>>8*(3-(e+2)%4)&255,b=0;4>
b;b++)8*e+6*b>32*a.length?c.push("\x3d"):c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>6*(3-b)&63));return c.join("")}p.SHA1=function(a,c){var e=c||p.outputTypes.Base64,g=n(m(a),8*a.length);switch(e){case p.outputTypes.Raw:return g;case p.outputTypes.Hex:return k(g);case p.outputTypes.String:return h(g);default:return f(g)}};p.SHA1._hmac=function(a,c,e){e=e||p.outputTypes.Base64;var g=m(c);16<g.length&&(g=n(g,8*c.length));var d=Array(16);c=Array(16);for(var b=
0;16>b;b++)d[b]=g[b]^909522486,c[b]=g[b]^1549556828;a=n(d.concat(m(a)),512+8*a.length);a=n(c.concat(a),672);switch(e){case p.outputTypes.Raw:return a;case p.outputTypes.Hex:return k(a);case p.outputTypes.String:return h(a);default:return f(a)}};return p.SHA1})},"xide/manager/ManagerBase":function(){define(["dcl/dcl","xide/mixins/EventedMixin","xide/model/Base"],function(p,n,m){n=p([m.dcl,n.dcl],{declaredClass:"xide.manager.ManagerBase",ctx:null,init:function(){this.initReload&&this.initReload()}});
p.chainAfter(n,"init");return n})},"xide/data/Reference":function(){define(["xdojo/declare","xide/utils"],function(p,n){var m={_sources:[],removeSource:function(h){},updateSource:function(h){},onSourceUpdate:function(h){},onSourceRemoved:function(h){},onSourceDelete:function(h){},onItemChanged:function(h){},destroy:function(){this.item.removeReference&&this.item.removeReference(this);this.inherited(arguments)},addSource:function(h,f){this._sources.push({item:h,settings:f});var a=this;if(f&&f.onDelete)h._store.on("delete",
function(c){c.target==h&&a._store.removeSync(a[a._store.idProperty])})},updateSources:function(h){for(var f=0;f<this._sources.length;f++){var a=this._sources[f],c=a.item,a=a.settings;h.property&&a.properties&&a.properties[h.property]&&(c._store._ignoreChangeEvents=!0,c.set(h.property,h.value),c._store._ignoreChangeEvents=!1,c._store.emit("update",{target:c}))}},constructor:function(h){this._sources=[];n.mixin(this,h)}},k=p("xgrid.data.Reference",null,m);k.Implementation=m;return k})},"xcf/manager/DeviceManager":function(){define("dcl/dcl xdojo/declare dojo/_base/lang xide/encoding/MD5 xide/types xide/utils xide/factory xcf/manager/BeanManager xide/mixins/ReloadMixin xide/mixins/EventedMixin ./DeviceManager_Server ./DeviceManager_DeviceServer xide/data/TreeMemory xdojo/has xide/data/ObservableStore dstore/Trackable xcf/model/Device dojo/Deferred xide/manager/ServerActionBase xide/data/Reference xide/utils/StringUtils xdojo/has!xcf-ui?./DeviceManager_UI xdojo/has!xexpression?xexpression/Expression dojo/has!host-node?nxapp/utils/_console dojo/has!host-node?nxapp/utils".split(" "),
function(p,n,m,k,h,f,a,c,e,g,d,b,l,q,r,t,x,y,v,u,w,C,A,D,E){var z="undefined"!==typeof window?window.console:z;D&&D.error&&D.warn&&(z=D);a=[v,c,d,b,e.dcl];var B=h.DEVICE_PROPERTY,F=h.EVENTS;q("xcf-ui")&&a.push(C);return p(a,{declaredClass:"xcf.manager.DeviceManager",beanNamespace:"device",beanName:"Device",beanIconClass:"fa-sliders",groupType:h.ITEM_TYPE.DEVICE_GROUP,itemType:h.ITEM_TYPE.DEVICE,itemMetaTitleField:B.CF_DEVICE_TITLE,systemScope:"system_devices",userScope:"user_devices",appScope:"app_devices",
defaultScope:"system_devices",serviceClass:"XCF_Device_Service",rawData:null,store:null,treeView:null,deviceServerClient:null,deviceInstances:null,driverScopes:null,autoConnectDevices:!0,consoles:null,lastUpTime:null,reconnectDevice:5E3,checkDeviceServerConnection:function(){if(!this.deviceServerClient){var a=this.ctx.getNodeServiceManager().getStore();if(!a)return z.error("checkDeviceServerConnection : have no service store"),!1;this.createDeviceServerClient(a)}return!0},addDriverFunctions:function(a,
b){for(var d in b)"constructor"!==d&&"inherited"!==d&&"getInherited"!=d&&"isInstanceOf"!=d&&"__inherited"!=d&&"onModuleReloaded"!=d&&"start"!=d&&"publish"!=d&&"subscribe"!=d&&"getInherited"!=d&&"getInherited"!=d&&_.isFunction(b[d])&&!a[d]&&(a[d]=b[d])},addLoggingFunctions:function(a,b){var d=this;b.log=function(a,c,l,e){e=e||{};var g=m.clone(e);e.type=e.type||c||"Driver";b.options&&(e.device=b.options);d.publish(h.EVENTS.ON_SERVER_LOG_MESSAGE,{data:e,level:a||"info",message:l,details:g})}},completeDriverInstance:function(a,
b,d){var c=this,e=b.blockScope.blockStore,l=d.path,g=l+"_commands",f=l+"_variables";e.on("delete",function(a){var b=-1!==a.target.declaredClass.indexOf("Variable")?f:g,c=d._store.getSync(b);c&&c.refresh();(a=d._store.getSync(b+"_reference_"+a.target.id))&&a.refresh()});e.on("added",function(b){var c=b.name,e=b.icon||"fa-exclamation",l=-1!==b.declaredClass.indexOf("Variable"),k=l?f:g;-1!=b.declaredClass.indexOf(l?"Variable":"Command")&&(c=new u({enabled:!0,path:k+"_reference_"+b.id,name:c,id:b.id,
parentId:k,_mayHaveChildren:!1,virtual:!0,tooltip:!0,icon:e,ref:{driver:a,item:b,device:d},type:h.ITEM_TYPE.BLOCK}),c=d._store.putSync(c),b.addReference(c,{properties:{name:!0,enabled:!0,value:!0},onDelete:!0},!0),c.refresh())});b.callCommand=function(a){(a=this.blockScope.getBlockByName(a))&&a.solve(this.blockScope)};b.setVariable=function(b,d,e){if(b=this.blockScope.getVariable(b))b.value=d,b.set("value",d),c.publish(h.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:b,scope:this.blockScope,driver:a,owner:c,
save:!0===e})};b.getVariable=function(a){return(a=this.blockScope.getVariable(a))?a.value:""};b.log=function(a,d,e,l){l=l||{};var g=m.clone(l);l.type=l.type||d||"Driver";b.options&&(l.device=b.options);c.publish(h.EVENTS.ON_SERVER_LOG_MESSAGE,{data:l,level:a||"info",message:e,details:g})};for(var k in a)"constructor"!==k&&"inherited"!==k&&"getInherited"!=k&&"isInstanceOf"!=k&&"__inherited"!=k&&"onModuleReloaded"!=k&&"start"!=k&&"publish"!=k&&"subscribe"!=k&&"getInherited"!=k&&"getInherited"!=k&&m.isFunction(a[k])&&
!b[k]&&(b[k]=a[k])},onDeviceStarted:function(a,b,d){if(a&&b&&d){var c=this.toDeviceControlInfo(b).serverSide,l=a.blockScope;if(c){for(var e=[],e=e.concat(l.getBlocks({group:h.COMMAND_TYPES.BASIC_COMMAND,startup:!0})),e=e.concat(l.getBlocks({group:h.COMMAND_TYPES.CONDITIONAL_COMMAND,startup:!0})),c=0;c<e.length;c++)e[c].solve(l);e=e.concat(l.getBlocks({group:h.COMMAND_TYPES.BASIC_COMMAND,auto:/^[1-9][0-9]*$/}));e=e.concat(l.getBlocks({group:h.COMMAND_TYPES.CONDITIONAL_COMMAND,auto:/^[1-9][0-9]*$/}));
for(c=0;c<e.length;c++){var g=e[c];1==g.auto&&1<g.interval&&l.loopBlock(g)}this.publish(h.EVENTS.ON_DEVICE_DRIVER_INSTANCE_READY,{device:b,instance:a,driver:d,blockScope:l})}a.__didStartBlocks=!0;this.ctx.getDriverManager().addDeviceInstance(b,d)}},createDriverInstance:function(a,b,d){var c=k(JSON.stringify(a),1),l=this.driverScopes[a.scope]+a.driver,l=l.replace(".js",""),h=this,q=h.ctx,m=f.getCIInputValueByName(d.user,B.CF_DEVICE_DRIVER),t=q.getDriverManager().getItemById(m),r=new y,p=d.getMetaValue(B.CF_DEVICE_ENABLED),
x=a.serverSide;if(!1===p)return setTimeout(function(){r.reject()}),r;try{require([l],function(k){k=new (n([b,g,e],k.prototype));k.declaredClass=l;k.options=a;k.baseClass=b.prototype.declaredClass;k.modulePath=f.replaceAll("//","/",l);k.delegate=h;k.driver=t;k.serverSide=a.serverSide;try{k.start(),k.initReload()}catch(p){z.error("crash in driver instance startup! "+d.toString())}h.deviceInstances[c]=k;var y=m+"_"+c+"_"+d.path;t.blox&&t.blox.blocks||(t.blox={blocks:[]});t.blockPath&&(w.getJson(E.readFile(t.blockPath)),
t.blox=w.getJson(E.readFile(t.blockPath)));y=q.getBlockManager().createScope({id:y,device:d,driver:t,instance:k,serviceObject:h.serviceObject,ctx:q,serverSide:x,getContext:function(){return this.instance}},dojo.clone(t.blox.blocks));k.blockScope=y;d.blockScope=y;d.driverInstance=k;h.getDriverInstance(a,!0);h.completeDriverInstance(t,k,d);r.resolve(k);return k})}catch(v){z.error("DeviceManager::createDriverInstance:: requiring base driver at "+l+" failed",v)}return r},getDevice:function(a){var b=a;
if(_.isString(a)){var d=this.getItemById(a);d?b=d:(a=this.store.getSync(a))&&(b=a)}return b},stopDevice:function(a){if(a=this.getDevice(a)||a){this.checkDeviceServerConnection();a._userStopped=!0;var b=this.toDeviceControlInfo(a);b?b.serverSide&&(b.clientSide=!0,b=k(JSON.stringify(b),1),this.deviceInstances[b]&&(this._removeInstance(this.deviceInstances[b],b,a),delete this.deviceInstances[b])):z.error("cant find device::no device info",a.toString&&a.toString())}else z.error("cant find device")},getDevices:function(a,
b){var d=this.getStore();if(!d)return[];d=f.queryStore(d,{isDir:!1});d._S&&(d=[d]);for(var c=[],l=0;l<d.length;l++){var e=d[l],g=this.getMetaValue(e,B.CF_DEVICE_ENABLED);if(!0===a&&1==g||null==g||!1===a)c.push(e),1==b&&((g=this.getMetaValue(e,B.CF_DEVICE_DRIVER))?(g=this.ctx.getDriverManager().getItemById(g))&&(e.driver=g):z.error("device has no driver id!"))}return c},connectToAllDevices:function(){var a=this.getStore();if(a){a=f.queryStore(a,{isDir:!1});a._S&&(a=[a]);for(var b=0;b<a.length;b++){var d=
a[b],c=this.getMetaValue(d,B.CF_DEVICE_ENABLED);1!=c&&null!=c||this.startDevice(d)}}else z.error("have no device store")},_getLogText:function(a){return moment().format("HH:mm:SSS")+" ::   "+a+""},_parse:function(a,b){var d=""+b;if(0<d.indexOf("{{")||0<d.indexOf("}}"))z.time("parse expression"),d=(new A).parse(h.EXPRESSION_PARSER.FILTREX,d,this,{variables:a.getVariablesAsObject(),delimiters:{begin:"{{",end:"}}"}}),z.timeEnd("parse expression");else{var c=a.parseExpression(b);c&&(d=c)}return d},runCommand:function(a,
b){},_lastActions:null,onStoreReloaded:function(a){this.completeDeviceStore()},getInstance:function(a){if(a=a?a._store?this.toDeviceControlInfo(a):a:null)return this.getDriverInstance(a,!1)},getDriverInstance:function(a,b){if(!a)return z.error("getDriverInstance::have no device info"),null;for(var d in this.deviceInstances){var c=this.deviceInstances[d],l=c.options;if(l&&l.port===a.port&&l.host===a.host&&l.protocol===a.protocol)return!1!==b&&c&&!c.sendSettings&&(d=this.ctx.getDriverManager().getItemById(a.driverId))&&
(d=d.user,(l=f.getCIByChainAndName(d,0,h.DRIVER_PROPERTY.CF_DRIVER_COMMANDS))&&l.params&&(c.sendSettings=f.getJson(l.params)),(d=f.getCIByChainAndName(d,0,h.DRIVER_PROPERTY.CF_DRIVER_RESPONSES))&&d.params&&(c.responseSettings=f.getJson(d.params))),c}return null},onDeviceServerConnectionLost:function(){this.deviceServerClient&&(this.deviceServerClient.destroy(),this.deviceServerClient=null);var a=this;a.ctx.getNotificationManager().postMessage({message:"Lost connection to device server, try reconnecting in 5 seconds",
type:"error",showCloseButton:!0,duration:3E3});setTimeout(function(){a.checkDeviceServerConnection()},5E3)},onMQTTMessage:function(a){var b=f.getJson(a.message),d=!1;if(b){var c=b.sourceHost,l=b.sourcePort,e=a.host,g=a.port;c&&l&&c===e&&l==g&&(d=!0)}if(!d&&(d=a.topic.split("/"),4==d.length&&"Variable"==d[2]))if(c=this.getDeviceByHost(d[0],d[1])){if(a=this.toDeviceControlInfo(c))if(a=this.getDriverInstance(a))if(a=a.blockScope.getVariable(d[3]))a.set("value",b.value),a.refresh()}else z.error("cant find device for : "+
a.topic)},onNodeServiceStoreReady:function(a){this.deviceServerClient&&this.deviceServerClient.destroy();var b=this;this.createDeviceServerClient(a.store);this.autoConnectDevices&&setTimeout(function(){b.connectToAllDevices()},5E3)},onDriverUpdated:function(a,b){},onModuleReloaded:function(a){if(0!=this.deviceInstances.length){var b=f.replaceAll("//","/",a.module);a=a.newModule;for(var d in this.deviceInstances){var c=this.deviceInstances[d];if(c.modulePath===b||c.baseClass===b)this.mergeFunctions(c,
a.prototype),c.blockScope&&(c.blockScope.expressionModel.expressionCache={}),this.onDriverUpdated(c,b)}}},_removeInstance:function(a,b,d){a.destroy&&a.destroy();a.blockScope&&a.blockScope._destroy();delete this.deviceInstances[b];this.ctx.getBlockManager().removeScope(a.options.id);this.ctx.getDriverManager().removeDriverInstance(a,d);d.reset()},removeDriverInstance:function(a){for(var b in this.deviceInstances){var d=this.deviceInstances[b],c=d.options;c||z.error("invalid instance!");c&&c.port===
a.port&&c.host===a.host&&c.protocol===a.protocol&&(d.destroy&&d.destroy(),delete this.deviceInstances[b],this.ctx.getBlockManager().removeScope(d.options.id))}},getMetaValue:function(a,b){var d=a.user;return d?f.getCIInputValueByName(d,b):null},getDeviceByHost:function(a,b){for(var d=f.queryStore(this.getStore(),{isDir:!1}),c=0;c<d.length;c++){var l=d[c],e=this.getMetaValue(l,B.CF_DEVICE_HOST),g=this.getMetaValue(l,B.CF_DEVICE_PORT);if(e==a&&g==b)return l}return null},getDeviceById:function(a){var b=
f.queryStore(this.getStore(),{isDir:!1});b._S&&(b=[b]);for(var d=0;d<b.length;d++){var c=b[d];if(this.getMetaValue(c,B.CF_DEVICE_ID)==a)return c}return null},getDevicesByDriverId:function(a){var b=f.queryStore(this.getStore(),{isDir:!1});b._S&&(b=[b]);for(var d=0;d<b.length;d++){var c=b[d];if(this.getMetaValue(c,B.CF_DEVICE_ID)==a)return c}return null},getDeviceStoreItem:function(a){var b=this.getStore();if(b){b=f.queryStore(b,{isDir:!1});b._S&&(b=[b]);for(var d=0;d<b.length;d++){var c=b[d],l=c.user,
e=f.getCIInputValueByName(l,B.CF_DEVICE_HOST),g=f.getCIInputValueByName(l,B.CF_DEVICE_PORT),l=f.getCIInputValueByName(l,B.CF_DEVICE_PROTOCOL);if(g===a.port&&e===a.host&&l===a.protocol)return c}}},onDriverSettingsChanged:function(a,b){for(var d in this.deviceInstances){var c=this.deviceInstances[d];if(c&&c.driver==b){d=b.user;var l=f.getCIByChainAndName(d,0,h.DRIVER_PROPERTY.CF_DRIVER_COMMANDS);l&&l.params&&l==a&&(c.sendSettings=f.getJson(l.params));(d=f.getCIByChainAndName(d,0,h.DRIVER_PROPERTY.CF_DRIVER_RESPONSES))&&
d.params&&(c.responseSettings=f.getJson(d.params));break}}},onDeviceStateChanged:function(a,b){!0!==a._userStopped&&!0!==b&&a.info&&a.state&&a.state==h.DEVICE_STATE.DISCONNECTED&&this.ctx.getNotificationManager().postMessage({message:"Lost connection to "+a.info.host+", ...reconnecting",type:"error",showCloseButton:!1,duration:1500});!0!==b&&a.info&&a.state&&a.state==h.DEVICE_STATE.CONNECTED&&this.ctx.getNotificationManager().postMessage({message:"Connected to "+a.info.host+"",type:"success",showCloseButton:!1,
duration:2E3})},connectDevice:function(a){this.checkDeviceServerConnection();var b=this.toDeviceControlInfo(a);b.clientSide=!0;if(b){var d=k(JSON.stringify(b),1);if(this.deviceInstances[d])return z.log("device already connected",b),a.setState(h.DEVICE_STATE.CONNECTED),this.deviceInstances[d];a.setState(h.DEVICE_STATE.CONNECTING);this.publish(h.EVENTS.ON_STATUS_MESSAGE,{text:"Trying to connect to "+b.toString(),type:"info"});this.sendManagerCommand(h.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER,b)}else z.error("couldnt start device, invalid control info")},
onAppReady:function(a){a=a.context;a.deviceManager=this;a.driverManager=this;if(a.blockManager){var b=this.ctx.getBlockManager();m.mixin(a.blockManager.scopes,b.scopes)}},onHaveNoDeviceServer:function(){var a=this,b=this.ctx.getNotificationManager().postMessage({message:"Have no device server connection",type:"error",showCloseButton:!0,duration:1500,actions:{reconnect:{label:"Reconnect",action:function(){a.checkDeviceServerConnection();return b.update({message:"Reconnecting...",type:"success",actions:!1,
duration:1500})}}}})},createItem:function(a,b,d){return this.callMethodEx(null,"createItem",[dojo.toJson(a)],b,!0)},setDriverScriptContent:function(a,b,d,c,l){return this.callMethodEx(null,"setDriverContent",[a,b,d],c,!0)},getDriverScriptContent:function(a,b,d,c){return this.callMethodEx(null,"getDriverContent",[a,b],d,!0)},initStore:function(a){this.store=new (n("deviceStore",[l,t,r],{}))({data:a.items,idProperty:"path",Model:x,observedProperties:["name","state","iconClass","enabled"]});this.onStoreReady();
return this.store},fixDeviceCI:function(a){var b=a.user,d=f.getCIByChainAndName(b,0,B.CF_DEVICE_DRIVER_OPTIONS);d?(d.data=[{value:2,label:"Runs Server Side"},{value:4,label:"Show Debug Messages"},{value:8,label:"Allow Multiple Device Connections"}],d.group="Common"):b.inputs.push({chainType:0,"class":"cmx.types.ConfigurableInformation",dataRef:"",dataSource:"",description:null,enabled:!0,enumType:"-1",flags:-1,group:"Common",id:B.CF_DEVICE_DRIVER_OPTIONS,name:B.CF_DEVICE_DRIVER_OPTIONS,order:1,params:null,
platform:null,title:"Driver Options",type:5,uid:"-1",value:0,data:[{value:2,label:"Runs Server Side"},{value:4,label:"Show Debug Messages"},{value:8,label:"Allow Multiple Device Connections"}],visible:!0,device:a});if(a=f.getCIByChainAndName(b,0,B.CF_DEVICE_PROTOCOL))a.type=3,a.options=[{label:"TCP",value:"tcp"},{label:"UDP",value:"tcp"},{label:"Driver",value:"driver"},{label:"SSH",value:"ssh"},{label:"Serial",value:"serial"}]},toDeviceControlInfo:function(a){if(!a._store&&a.id){var b=this.getItemById(a.id);
b&&(a=b)}if(!a.path&&(b=this.getDeviceStoreItem(a),!b))return null;var d=a.user,b=f.getCIInputValueByName(d,B.CF_DEVICE_HOST),c=f.getCIInputValueByName(d,B.CF_DEVICE_PORT),l=f.getCIInputValueByName(d,B.CF_DEVICE_TITLE),e=f.getCIInputValueByName(d,B.CF_DEVICE_PROTOCOL),g=f.getCIInputValueByName(d,B.CF_DEVICE_DRIVER),k=f.getCIInputValueByName(d,B.CF_DEVICE_OPTIONS),d=f.getCIInputValueByName(d,B.CF_DEVICE_DRIVER_OPTIONS),q=d&h.DRIVER_FLAGS.RUNS_ON_SERVER,m=null;this.fixDeviceCI(a);var n=this.ctx.getDriverManager().getItemById(g);
if(n){var t=n.user,m=f.getCIInputValueByName(t,h.DRIVER_PROPERTY.CF_DRIVER_CLASS),t=f.getCIByChainAndName(t,0,h.DRIVER_PROPERTY.CF_DRIVER_RESPONSES),r={},n=n.scope;t&&t.params&&(r=f.getJson(t.params));m={host:b,port:c,protocol:e,driver:m?m.replace("./",""):"",driverId:g,scope:n,id:a.id,title:l,options:k,driverOptions:d,serverSide:q,responseSettings:r,toString:function(){return this.host+":"+this.port+"@"+this.protocol}}}return a.info=m},getDeviceStatusIcon:function(a){switch(a.state){case h.DEVICE_STATE.READY:case h.DEVICE_STATE.CONNECTED:return"fa-link iconStatusOn";
case h.DEVICE_STATE.SYNCHRONIZING:case h.DEVICE_STATE.CONNECTING:return"fa-spinner fa-spin"}return"fa-unlink iconStatusOff"},getItemById:function(a){return this.store&&this.store.data?(a=_.find(this.store.data,{id:a}))?this.store.getSync(a.path):null:null},onStoreCreated:function(a){var b=this.ctx,d=b.mainView.getToolbar(),c=a.type,l=(a=a.store)?f.queryStore(a,{isDir:!1}):[],e=this.ctx.getDriverManager();if(c===h.ITEM_TYPE.DEVICE)for(c=0;c<l.length;c++){var g=a.getSync(l[c].path);if(null==g._completed){g._completed=
!0;var k=this.getMetaValue(g,B.CF_DEVICE_DRIVER);k?(k=e.getItemById(k),_.each(g.user.inputs,function(a){a.device=g;a.actionTarget=d;a.ctx=b}),!_.isEmpty(k)&&q("xcf-ui")&&(this.completeDevice(a,g,k),g.iconClass=g.getStateIcon())):z.error("device has no driver id!")}}},onClientMessage:function(a){this.checkDeviceServerConnection();this.deviceServerClient&&(z.log("write log message"),this.sendManagerCommand(h.SOCKET_SERVER_COMMANDS.WRITE_LOG_MESSAGE,a))},onVariableChanged:function(a){var b=a.item,d=
a.scope;a=b.name;"value"!==a&&(b=b.value,d=d.device,a&&null!=b||z.error("------------invalid params"),d&&(d=d.info,this.sendManagerCommand(h.SOCKET_SERVER_COMMANDS.MQTT_PUBLISH,{topic:d.host+"/"+d.port+"/Variable/"+a,data:{value:b,device:d}})))},onClientLogMessage:function(){},init:function(){var a=this;this.initUI&&this.initUI();this.subscribe(h.EVENTS.ON_DRIVER_VARIABLE_CHANGED,this.onVariableChanged);this.subscribe([F.ON_NODE_SERVICE_STORE_READY,F.ON_MODULE_RELOADED,F.ON_DEVICE_DISCONNECTED,F.ON_DEVICE_CONNECTED,
F.ON_CLIENT_LOG_MESSAGE,F.ON_STORE_CREATED]);this.deviceInstances=this.consoles={};this.driverScopes={system_drivers:"system_drivers/"};this.lastUpTime=(new Date).getTime();setInterval(function(){var b=(new Date).getTime();3E4<b-a.lastUpTime&&(a.lastUpTime=(new Date).getTime());a.lastUpTime=b},1E3)},onDeviceServerConnected:function(){},addDeviceInstance:function(a,b){}})})},"xide/mixins/ReloadMixin":function(){define(["xdojo/declare","dcl/dcl","xide/types","xide/utils"],function(p,n,m,k){var h={_mergeFunctions:!0,
_mergeMissingVariables:!0,isInstanceOf_:function(f){try{if(!!this instanceof f||this.isInstanceOf&&this.isInstanceOf(f))return!0;var a=k.getAt(this,"constructor._meta.bases",[]),c=f.prototype.declaredClass;return _.findWhere(a,function(a){return a==f||k.getAt(a,"superclass.declaredClass")===c||k.getAt(a,"prototype.declaredClass")===c})}catch(e){console.log("ReloadMixin :: this.isInstanceOf_ crashed "+e)}return!1},mergeFunctions:function(f,a){for(var c in a)"constructor"!==c&&"inherited"!==c&&(_.isFunction(a[c])&&
(f[c]=null,f[c]=a[c]),_.isArray(a[c])&&null==f[c]&&(f[c]=a[c]))},onModuleReloaded:function(f){var a=f.newModule;if(a&&a.prototype&&!f._processed){var c=a.prototype,e=c.declaredClass,g=!1,d=this.declaredClass;e&&(e&&d&&(g=k.replaceAll("/",".",d)===k.replaceAll("/",".",e)),g?(this.mergeFunctions(this,c),this.onReloaded&&(f._processed=!0,this.onReloaded(a))):f.module&&k.replaceAll("//","/",f.module)===d&&this.mergeFunctions(this,c))}},initReload:function(){this.subscribe(m.EVENTS.ON_MODULE_RELOADED)}};
p=p(null,h);p.Impl=h;p.dcl=n(null,h);return p})},"xcf/manager/DeviceManager_Server":function(){define(["dcl/dcl"],function(p){return p(null,{})})},"xcf/manager/DeviceManager_DeviceServer":function(){define("dcl/dcl xdojo/declare dojo/_base/lang xide/encoding/MD5 xide/types xide/utils xide/factory xdojo/has dojo/Deferred dojo/has!host-node?nxapp/utils/_console".split(" "),function(p,n,m,k,h,f,a,c,e,g){var d="undefined"!==typeof window?window.console:d;g&&g.error&&g.warn&&(d=g);return p(null,{declaredClass:"xcf.manager.DeviceManager_Server",
onSetDeviceServerVariables:function(a){var d=this.getDriverInstance(a.device,!0),c=this.getDeviceStoreItem(a.device);if(c){if(d){var e=a.variables,g=d.blockScope;c.serverVariables=a.variables;_.each(e,function(a){var b=g.getVariable(a.name);b&&(b.value=a.value)})}this.onDeviceConnected(a);c.setState(h.DEVICE_STATE.READY);c._startDfd&&c._startDfd.resolve(c.driverInstance);delete c._startDfd;c._startDfd=null}},onDeviceDisconnected:function(a){if(a&&a.device){var c=a.error,c=c&&c.code?c.code:c||"",e=
this.getDeviceStoreItem(a.device);if(e)if(this.publish(h.EVENTS.ON_STATUS_MESSAGE,{text:'Device has been disconnected \x3cspan class\x3d"text-warning"\x3e'+a.device.host+":"+a.device.port+'\x3c/span\x3e :  \x3cspan class\x3d"text-danger"\x3e'+c+"\x3c/span\x3e",type:"info"}),this.toDeviceControlInfo(e),this.getDriverInstance(a.device,!0)&&this.removeDriverInstance(a.device),e.state===h.DEVICE_STATE.DISABLED)e.setState(h.DEVICE_STATE.DISCONNECTED);else if(e.setState(h.DEVICE_STATE.DISCONNECTED),e){var g=
this;setTimeout(function(){e.shouldReconnect()&&(e.setState(h.DEVICE_STATE.CONNECTING),d.error("reconnect"),g.connectDevice(e))},g.reconnectDevice)}}},getDeviceServerVariables:function(a,c){var e=c.blockScope;if(e){for(var e=e.getVariables({group:h.BLOCK_GROUPS.CF_DRIVER_BASIC_VARIABLES}),g=[],f=0;f<e.length;f++)g.push({name:e[f].name,value:e[f].value,initial:e[f].value});a.setState(h.DEVICE_STATE.SYNCHRONIZING);this.sendManagerCommand(h.SOCKET_SERVER_COMMANDS.GET_DEVICE_VARIABLES,{device:this.toDeviceControlInfo(a),
variables:g})}else d.error(" have no block scope")},onDeviceConnected:function(a){var c=this.getDeviceStoreItem(a.device);a=this.getDriverInstance(a.device,!0);if(!a)d.error("--cant find device instance",this.deviceInstances),c&&c.setState(h.DEVICE_STATE.DISCONNECTED);else if(c){var e=this.toDeviceControlInfo(c);if(e)if(a&&null==c.serverVariables)this.getDeviceServerVariables(c,a);else if(c.setState(h.DEVICE_STATE.CONNECTED),e.clientSide=!0,e){var g=k(JSON.stringify(e),1);if(this.deviceInstances[g]){if(a.__didStartBlocks)d.error("instance.__didStartBlocks bad "+
g,a.__didStartBlocks);else this.onDeviceStarted(a,c,a.driver);c.setState(h.DEVICE_STATE.READY);return this.deviceInstances[g]}var f=this,m=this.driverScopes.system_drivers+"DriverBase";try{require([m],function(a){a.prototype.declaredClass=m;f.createDriverInstance(e,a,c)})}catch(n){d.error("requiring base driver at "+m+" failed",n)}}else d.error("couldnt start device, invalid control info")}},startDevice:function(a,c){this.checkDeviceServerConnection();a.check();var g=new e;if(a._startDfd&&!a._startDfd.isResolved())return a._startDfd;
!a.driverInstance&&a.reset();1==c&&a.setMetaValue(h.DEVICE_PROPERTY.CF_DEVICE_ENABLED,!0,!1);if(!a.getMetaValue(h.DEVICE_PROPERTY.CF_DEVICE_ENABLED)&&!0!==c)return this.publish(h.EVENTS.ON_STATUS_MESSAGE,{text:"Can`t start device because its not enabled! "+a.toString(),type:"error"}),setTimeout(function(){g.reject()},10),g;var f=this.toDeviceControlInfo(a);f.clientSide=!0;if(!f)return d.error("couldnt start device, invalid control info "+a.toString()),g.reject(),g;var m=k(JSON.stringify(f),1);if(this.deviceInstances[m])return g.resolve(this.deviceInstances[m]),
g;a.setState(h.DEVICE_STATE.CONNECTING);a.info=f;a._userStopped=null;a._startDfd=g;var n=this,m=this.driverScopes.system_drivers,p=m+"DriverBase";try{require([p],function(d){d.prototype.declaredClass=p;n.createDriverInstance(f,d,a).then(function(d){f.mqtt={driverScopeId:d.blockScope.id,driverId:d.driver.id,deviceId:a.path};n.publish(h.EVENTS.ON_STATUS_MESSAGE,{text:"Trying to connect to "+f.toString(),type:"info"});n.sendManagerCommand(h.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER,f);delete f.mqtt})})}catch(v){logError(v,
"DeviceManager::startDevice: requiring base driver at "+p+" failed! Base Driver - Prefix : "+m)}return g},onCommandFinish:function(a,d){var c=this.getDriverInstance(a,!0);if(c&&(this.getDeviceStoreItem(a),d.src&&d.id&&(c=c.blockScope.getBlockById(d.src))&&c.onCommandFinish))c.onCommandFinish(d)},onCommandError:function(a,d){var c=this.getDriverInstance(a,!0);if(c&&(this.getDeviceStoreItem(a),d.src&&d.id&&(c=c.blockScope.getBlockById(d.src))&&c.onCommandError))c.onCommandError(d)},onDeviceServerMessage:function(a){var e=
a.data,g=null;if(m.isString(e)&&-1!=e.indexOf("{"))try{g=dojo.fromJson(e)}catch(f){d.error("error parsing device message",a);return}if(g&&g.data&&g.data.device&&(a=g.data.device)){var n=this.getDriverInstance(g.data.device,!0);if(n&&(a=this.getDeviceStoreItem(a),e=a.get("state"),n.onBroadcastMessage({device:g.data.device,message:g.data.deviceMessage}),n.onMessage({device:g.data.device,message:g.data.deviceMessage}),e!==h.DEVICE_STATE.READY&&a.set("state",h.DEVICE_STATE.READY),g.event&&(g.data.driverInstance=
n,this.publish(g.event,g.data)),c("xcf-ui"))){var e=k(JSON.stringify(n.options),1),p=[],e=this.consoles[e+"-Console"];a.setState(h.DEVICE_STATE.READY);this.publish(h.EVENTS.ON_STATUS_MESSAGE,{text:"Device Message from "+n.options.host+' : \x3cspan class\x3d"text-info"\x3e'+g.data.deviceMessage+"\x3c/span\x3e"});e&&_.each(e,function(a){if(a){var b=g.data.deviceMessage;p=[];m.isString(b)&&(p=n.split(b));for(b=0;b<p.length;b++)0!=p[b].length&&a.log(p[b])}})}}},sendManagerCommand:function(a,c){this.checkDeviceServerConnection();
var e={manager_command:a};m.mixin(e,c);if(this.deviceServerClient)return this.deviceServerClient.emit(null,e,a);d.error("Send Manager Command "+a+" failed, have no  device Server client");this.onHaveNoDeviceServer()},sendDeviceCommand:function(a,c,e,g){this.checkDeviceServerConnection();var f=a.options;e={command:c,device_command:"Device_Send",host:f.host,port:f.port,protocol:f.protocol,options:{id:g,src:e}};this.publish(h.EVENTS.ON_STATUS_MESSAGE,{text:'Did send message : \x3cspan class\x3d"text-warnin"\x3e'+
e.command.substr(0,30)+'\x3c/span\x3e to \x3cspan class\x3d"text-info"\x3e'+e.host+":"+e.port+"@"+e.protocol+"\x3c/span\x3e"});k(JSON.stringify(a.options),1);this.deviceServerClient?this.deviceServerClient.emit(null,e,"Device_Send"):(this.onHaveNoDeviceServer(),d.error("this.deviceServerClient is null"),d.error("Send Device Command "+c+"failed, have no  device Server client"))},createDeviceServerClient:function(b){var d=this;this.deviceServerClient=null;if(this.deviceServerClient=a.createClientWithStore(b,
"Device Control Server",{delegate:{onConnected:function(){d.onDeviceServerConnected()},onLostConnection:function(){d.onDeviceServerConnectionLost()},onServerResponse:function(a){var b=a.data,c=null;if(_.isString(b)){try{c=dojo.fromJson(b,!1)}catch(e){c=b}if((c=c||{},c.data)&&c.data.deviceMessage&&c.data.deviceMessage.event===h.EVENTS.ON_COMMAND_FINISH){d.onCommandFinish(c.data.device,c.data.deviceMessage);return}if(c.data&&c.data.deviceMessage&&c.data.deviceMessage.event===h.EVENTS.ON_COMMAND_ERROR){d.onCommandError(c.data.device,
c.data.deviceMessage);return}if(c.event===h.EVENTS.ON_DEVICE_DISCONNECTED){d.publish(h.EVENTS.ON_DEVICE_DISCONNECTED,c.data);return}if(c.event===h.EVENTS.SET_DEVICE_VARIABLES)return d.onSetDeviceServerVariables(c.data);if(c.event===h.EVENTS.ON_DEVICE_CONNECTED){d.publish(h.EVENTS.ON_DEVICE_CONNECTED,c.data);return}if(c.event===h.EVENTS.ON_SERVER_LOG_MESSAGE){d.publish(h.EVENTS.ON_SERVER_LOG_MESSAGE,c.data);return}if(c.event===h.EVENTS.ON_MQTT_MESSAGE){d.publish(h.EVENTS.ON_MQTT_MESSAGE,c.data);d.onMQTTMessage(c.data);
return}}d.onDeviceServerMessage(a)}}}))return this.deviceServerClient}})})},"xcf/model/Device":function(){define("xdojo/declare xide/data/Model xide/data/Source xide/types xide/utils xide/mixins/EventedMixin".split(" "),function(p,n,m,k,h,f){return p("xcf.model.Device",[n,m,f],{_userStopped:!1,check:function(){this._startDfd&&!0===this._userStopped&&this.reset()},shouldReconnect:function(){return this._userStopped?!1:!0===this.getMetaValue(k.DEVICE_PROPERTY.CF_DEVICE_ENABLED)},reset:function(){delete this._startDfd;
this._startDfd=null;delete this.blockScope;this.blockScope=null;delete this.serverVariables;this.serverVariables=null;delete this.driverInstance;this.driverInstance=null;this.setState(k.DEVICE_STATE.DISCONNECTED)},constructor:function(){},state:k.DEVICE_STATE.DISCONNECTED,driverInstance:null,blockScope:null,getBlockScope:function(){return this.blockScope},getDriverInstance:function(){return this.driverInstance},getDriver:function(){var a=this.getBlockScope();return a?a.driver:null},getMetaValue:function(a){return h.getCIInputValueByName(this.user,
a)},setMetaValue:function(a,c,e){var g=h.getCIByChainAndName(this.user,0,a);if(!g)return null;var d=this.getMetaValue(a);h.setCIValueByField(g,"value",c);this[a]=c;if(!1!==e)return this.publish(k.EVENTS.ON_CI_UPDATE,{owner:this.owner,ci:g,newValue:c,oldValue:d})},getStateIcon:function(a){a=a||this.state;switch(a){case k.DEVICE_STATE.READY:case k.DEVICE_STATE.CONNECTED:return"fa-link iconStatusOn";case k.DEVICE_STATE.SYNCHRONIZING:case k.DEVICE_STATE.CONNECTING:return"fa-spinner fa-spin"}return"fa-unlink iconStatusOff"},
setState:function(a,c){if(a!=this.state){var e=this.state,g=this.getStateIcon(a);this.state=a;this.set("iconClass",g);this.set("state",a);this._emit(k.EVENTS.ON_DEVICE_STATE_CHANGED,{old:e,state:a,icon:g,"public":!0})}}})})},"xide/data/Source":function(){define(["dcl/dcl","xdojo/declare","xide/utils"],function(p,n,m){var k={_references:null,_originReference:null,onReferenceUpdate:function(){},onReferenceRemoved:function(){},onReferenceDelete:function(){},updateReference:function(){},getReferences:function(){return this._references?
m.pluck(this._references,"item"):[]},addReference:function(h,f,a){this._references||(this._references=[]);this._references.push({item:h,settings:f});var c=this;if(f&&f.onDelete&&h._store)h._store.on("delete",function(a){a.target==h&&c._store.removeSync(c[c._store.idProperty])});a&&h.addSource&&h.addSource(this,f)},removeReference:function(h){this._references&&_.each(this._references,function(f){f&&f.item==h&&this._references&&this._references.remove(f)},this)},updateReferences:function(h){var f=h.property,
a=h.value;this._references||(this._references=[]);for(var c=0;c<this._references.length;c++){var e=this._references[c],g=e.item,e=e.settings,d=g._store;if(this._originReference!=g&&h.property&&e.properties&&e.properties[h.property]){d&&(d._ignoreChangeEvents=!0);try{if(g.onSourceChanged)g.onSourceChanged(f,a);else g.set(f,a)}catch(b){}d&&(d._ignoreChangeEvents=!1,d.emit("update",{target:g}))}}},constructor:function(h){this._references=[];m.mixin(this,h)},onItemChanged:function(h){this.updateReferences(h)}};
n=n("xgrid.data.Source",null,k);n.dcl=p(null,k);n.Implementation=k;return n})},"xcf/manager/Context":function(){define("dcl/dcl dojo/_base/declare dojo/_base/array dojo/_base/lang xide/manager/Context xide/factory xide/types xcf/manager/DriverManager xcf/manager/DeviceManager xcf/manager/ProtocolManager xcf/manager/Application xcf/manager/LogManager xide/manager/ResourceManager xide/manager/PluginManager xdojo/has xdojo/has!xideve?xcf/manager/WidgetManager".split(" "),function(p,n,m,k,h,f,a,c,e,g,
d,b,l,q,r,t){return p([h],{declaredClass:"xcf.manager.Context",namespace:"xcf.manager.",driverManager:null,deviceManager:null,protocolManager:null,debugManager:null,nodeServiceManager:null,blockManager:null,getBlockManager:function(){return this.blockManager},getProtocolManager:function(){return this.protocolManager},getDriverManager:function(){return this.driverManager},getDeviceManager:function(){return this.deviceManager},getNodeServiceManager:function(){return this.nodeServiceManager},getDebugManager:function(){return this.debugManager},
constructManagers:function(a){this.isEditor()},initManagers:function(){this.isEditor()||(this.driverManager.init(),this.deviceManager.init(),r("protocols")&&this.protocolManager.init(),r("log")&&this.logManager.init());this.resourceManager&&this.resourceManager.init()}})})},"xide/manager/Context":function(){define("dcl/dcl dojo/_base/lang dojo/_base/json dojo/Deferred dojo/has xide/manager/ContextBase xide/factory xide/types xide/utils require dojo/promise/all xdojo/has!host-browser?xide/manager/Context_UI".split(" "),
function(p,n,m,k,h,f,a,c,e,g,d,b){f=p([f],{declaredClass:"xide.manager.Context",application:null,contextManager:null,fileManager:null,resourceManager:null,notificationManager:null,serviceObject:null,pluginManager:null,windowManager:null,logManager:null,mountManager:null,config:null,managers:null,namespace:"xide.manager.",defaultNamespace:"xide.manager.",vfsMounts:null,xideServiceClient:null,fileUpdateTimes:{},onXIDEMessage:function(a,b){var d=this;!1!==b&&d.publish(a.event,a);if(a.event===c.EVENTS.ON_FILE_CHANGED)if(a.data&&
a.data.mask&&-1!==a.data.mask.indexOf("delete"))d.publish(c.EVENTS.ON_FILE_DELETED,a);else{var f=a.data.path,h=(new Date).getTime();if(d.fileUpdateTimes[f]&&30>h-d.fileUpdateTimes[f])d.fileUpdateTimes[f]=h;else if(d.fileUpdateTimes[f]=h,f=e.replaceAll("\\","/",a.data.path),f=e.replaceAll("//","/",a.data.path),f=f.replace(/\\/g,"/"),null!=f&&null!=f.indexOf){if(f.match(/\.css$/))d.onCSSChanged({path:f});if(f.match(/\.js$/)){var k=a.data.modulePath;if(k){k=k.replace(".js","");try{g(k)}catch(m){}-1!=
f.indexOf("data/system/drivers")&&(f=f.substr(f.indexOf("data/system/drivers")+20,f.length),f=f.replace(".js",""),k="system_drivers/"+f);k=e.replaceAll(".","/",k);setTimeout(function(){d._reloadModule(k,!0)},400)}}}}},onNodeServiceStoreReady:function(b){this.xideServiceClient&&this.xideServiceClient.destroy();var d=this;this.deviceServerClient=a.createClientWithStore(b.store,"XIDE Server",{delegate:{onServerResponse:function(a){d.onXIDEMessage(m.fromJson(a.data))}}})},mergeFunctions:function(a,b){for(var d in b)_.isFunction(b[d])&&
b[d]&&a&&(a[d]=b[d])},reloadModules:function(a,b){var c=new k,e=[],f=[],h=this;g({cacheBust:"time\x3d"+(new Date).getTime()});_.each(a,function(a){var d=null,c=new k;!1!==b&&(d=g(a));g.undef(a);g([a],function(a){d&&h.mergeFunctions(d.prototype,a.prototype);f.push(a);c.resolve()});e.push(c)});d(e).then(function(){c.resolve(f);g({cacheBust:null})});return c},_reloadModule:function(a,b){var d=n.getObject(e.replaceAll("/",".",a))||n.getObject(a);if(d&&d.prototype&&d.prototype.reloadModule)d.prototype.reloadModule();
else{var f=n.getObject(e.replaceAll("/",".",a))||n.getObject(a);if(!f&&(f="undefined"!==typeof a?f:null,!f&&"undefined"!==typeof window))if(f=e.getAt(window,e.replaceAll("/",".",a),null))d=f;else try{f=g(e.replaceAll(".","/",a))}catch(h){}f&&(d=f);f=document.getElementsByTagName("script");_.each(f,function(b){b&&b.src&&-1!==b.src.indexOf(a)&&b.parentElement.removeChild(b)});g.undef(a);var k=this;b&&setTimeout(function(){g({cacheBust:"time\x3d"+(new Date).getTime(),waitSeconds:5});try{g([a],function(b){g({cacheBust:null});
n.isString(b)?console.error("module reloaded failed : "+b+" for module : "+a):(b.modulePath=a,d&&(k.mergeFunctions(d.prototype,b.prototype),d.prototype&&d.prototype._onReloaded&&d.prototype._onReloaded(b)),k.publish(c.EVENTS.ON_MODULE_RELOADED,{module:a,newModule:b}),b.prototype&&b.prototype.declaredClass&&k.publish(c.EVENTS.ON_MODULE_UPDATED,{moduleClass:b.prototype.declaredClass,moduleProto:b.prototype}))})}catch(b){console.error("error reloading module",b),logError(b,"error reloading module")}},
100)}},onCSSChanged:function(a){a=a.path;a=e.replaceAll("//","/",a);a=a.replace("/PMaster/","");var b=window.xappOnStyleSheetChanged;b&&b(a)},onDidChangeFileContent:function(a){if(!a.didProcess&&(a.didProcess=!0,this.vfsMounts&&a.path)){var b=a.path;if(-1!=b.indexOf(".css"))this.onCSSChanged(a);else if(-1==b.indexOf("resources")&&-1==b.indexOf("meta")&&-1!=b.indexOf(".js")){var b=a.mount.replace("/",""),d=null;if(this.vfsMounts[b]){var d=""+a.path,d=d.replace("./",""),d=d.replace("/","."),d=d.replace(".js",
""),d=e.replaceAll(".","/",d),c=this;setTimeout(function(){c._reloadModule(d,!0)},100)}}}},getBlockManager:function(){return this.blockManager},getPluginManager:function(){return this.pluginManager},getService:function(){return this.serviceObject},getFileManager:function(){return this.fileManager},getResourceManager:function(){return this.resourceManager},getMountManager:function(){return this.mountManager},getContextManager:function(){return this.contextManager},getLogManager:function(){return this.logManager},
getApplication:function(){return this.application},constructor:function(a){this.managers=[];this.config=a;this.language="en";this.subscribe(c.EVENTS.ON_CHANGED_CONTENT,this.onDidChangeFileContent);h("xnode")&&this.subscribe(c.EVENTS.ON_NODE_SERVICE_STORE_READY,this.onNodeServiceStoreReady)},prepare:function(){this.config&&this.initWithConfig(this.config)},initWithConfig:function(a){a&&a.mixins&&this.doMixins(a.mixins)},isEditor:function(){return this.args&&this.args.file}});p.chainAfter(f,"constructManagers");
p.chainAfter(f,"initManagers");return f})},"xcf/manager/ProtocolManager":function(){define("dcl/dcl dojo/_base/declare xide/manager/ServerActionBase xide/types xide/utils xide/factory xide/action/Action ./BeanManager".split(" "),function(p,n,m,k,h,f,a,c,e,g,d,b,l,q){return p([m,c],{declaredClass:"xcf.manager.ProtocolManager",beanNamespace:"protocol",beanName:"Protocol",beanIconClass:"fa-code",groupType:k.ITEM_TYPE.PROTOCOL_GROUP,itemType:k.ITEM_TYPE.PROTOCOL,itemMetaPath:"user.meta",itemMetaStorePath:"/meta/inputs",
itemMetaTitleField:k.PROTOCOL_PROPERTY.CF_PROTOCOL_TITLE,systemScope:"system_protocols",userScope:"user_protocols",appScope:"app_protocols",defaultScope:"system_protocols",serviceClass:"XCF_Protocol_Service",rawData:null,store:null,treeView:null,protocolScopes:null,getItemActions:function(){var a=[],b=this,d=this.getItem(),c=d?!0===h.toBoolean(d.isDir):!1;a.push({title:"New Group",icon:"el-icon-folder",place:"last",emit:!1,style:"",handler:function(a,d,c){b.newGroup()}});a.push({title:"Reload",icon:"fa-refresh",
disabled:!1,command:"Reload",place:"last",emit:!1,style:"",handler:function(){b.reload()}});null!=this.getItem()&&(a.push({title:"Delete",icon:"el-icon-remove-circle",disabled:!1,command:"Delete",place:"last",emit:!1,style:"",handler:function(){b.onDeleteItem(d)}}),c?a.push({title:"New Protocol",icon:"el-icon-file-new",disabled:!1,command:"NewItem",place:"last",emit:!1,style:"",handler:function(){b.newItem(d)}}):a.push({title:"Connect",icon:"el-icon-play-circle",disabled:!1,command:"Start",place:"last",
emit:!1,style:"",handler:function(){b.startDevice(d)}}));return a},onItemRemoved:function(a){a==this.currentItem&&(this.currentItem=null);a&&(a=this.getView(a))&&h.destroyWidget(a)},_onDeleteItem:function(a){var b=!0===h.toBoolean(a.isDir),d=h.toString(a.name),c=b?"removeGroup":"removeItem",g=this;(new e({title:"Remove Protocol"+(b?" Group":"")+" '"+d+"'",style:"max-width:400px",titleBarClass:"text-danger",delegate:{isRemoving:!1,onOk:function(b){g[c](h.toString(a.scope),h.toString(a.path),function(){g.onItemRemoved(a)})}},
inserts:[{query:".dijitDialogPaneContent",insert:'\x3cdiv\x3e\x3cspan class\x3d"fileManagerDialogText"\x3eDo you really want to remove  this item?\x3c/span\x3e\x3c/div\x3e',place:"first"}]})).show()},newItem:function(){var a=this.getItem();a||(a={path:""});var b=[h.createCI("In Group",13,h.toString(a.path),{widget:{disabled:!0},group:"Common"}),h.createCI("Title",13,"",{group:"Common"})],a=new d({title:"New Device",resizable:!0,delegate:{onOk:function(a,d){var c=h.createCI("Id",13,h.createUUID(),
{visible:!1,group:"Common"});d.push(c);h.toOptions(d);h.getInputCIByName(b,"Title");h.getInputCIByName(b,"Scope");h.getInputCIByName(b,"In Group")}},cis:b});a.show();a.resize()},reload:function(){this.currentItem=null},onNodeServiceStoreReady:function(a){},onFileChanged:function(a){if(!a._pp2){a._pp2=!0;var b=a.data;this.fileUpdateTimes||(this.fileUpdateTimes={});if(b.event===k.EVENTS.ON_FILE_CHANGED){if(b.data&&b.mask&&-1!==b.mask.indexOf("delete")){console.error("deleted");return}(new Date).getTime()}var d=
h.replaceAll("\\","/",b.path),d=h.replaceAll("//","/",b.path),d=d.replace(/\\/g,"/");-1!=d.indexOf("protocols")&&(d.match(/\.json$/)&&(-1!=d.indexOf("data/system/protocols")&&console.log("protocol changed"+d),this.ls("system_protocols")),this.onFileChanged2&&this.onFileChanged2(a))}},init:function(){this.subscribe(k.EVENTS.ON_FILE_CHANGED,this.onFileChanged)},_resetItem:function(a){a.commandsItem&&h.removeFromStore(this.getStore(),a.commandsItem,!0,"path","parentId");a.variablesItem&&h.removeFromStore(this.getStore(),
a.variablesItem,!0,"path","parentId")},_completeProtocolItem:function(a){if(a&&a.user){var b=h.getInputCIByName(a.user.meta,"content"),d=this,c=this.getStore();if(!b&&(a.mount=""+a.scope,a.getPath=function(){return a.path},a.virtual=!1,a.isDir=!0,a.children=[],b=h.createCI("Content",k.ECIType.FILE_EDITOR,"no value",{group:"Content",editor:"JSON Editor",editorArgs:{subscribers:[{event:"onSave",handler:function(b){(b=h.getJson(b.value))&&b.meta&&(a.user=b,a._completed=!1,d._resetItem(a),d._completeProtocolItem(a),
d.publish(k.EVENTS.ON_PROTOCOL_CHANGED,{item:a}))},owner:d}],leftEditorArgs:{subscribers:[{event:"addAction",handler:function(a){console.log("add action",arguments)},owner:d}],hiddenFields:{},readOnlyNodes:{commands:!0,variables:!0,meta:!0},insertTemplates:[{label:"New Command",path:"commands",value:'{title:"No Title",send:""}',newNodeTemplate:"[]",collapse:!0,select:!0},{label:"New Variable",path:"variables",value:'{title:"No Title",value:""}',newNodeTemplate:"[]",collapse:!0,select:!0}],renderTemplates:[{nodeValuePath:"field.innerHTML",
match:[/^variables[\s]?\.(\d+)$/,/^commands[\s]?\.(\d+)$/],replaceWith:"{nodeValue} - {title}",variables:null,nodeValueTransform:function(a){return h.capitalize(a)},insertIfMatch:{}}]},rightEditorArgs:{subscribers:[{event:"addAction",handler:function(a){console.log("add action",arguments)},owner:d}]}},editorItem:a,editorOverrides:{},isOwnTab:!0}),a.user.meta.inputs.push(b),!a._completed)){a._completed=!0;var e={path:h.createUUID(),name:"Commands",isDir:!0,type:"leaf",parentId:a.path,virtual:!0,children:[]};
a.commandsItem=e;a.children.push(e);c.putSync(e);for(var g=a.user.commands,b=0;b<g.length;b++){var l=g[b];e.children.push(c.putSync({path:h.createUUID(),name:l.name,id:h.createUUID(),parentId:e.path,_mayHaveChildren:!1,virtual:!0,user:{},isDir:!1,value:l.value,ref:{protocol:a,item:l},type:"protocolCommand"}))}e={path:h.createUUID(),name:"Variables",isDir:!0,type:"leaf",parentId:a.path,virtual:!0,items:[],children:[]};c.putSync(e);a.children.push(e);a.variablesItem=e;g=a.user.variables;for(b=0;b<g.length;b++)l=
g[b],e.children.push(c.putSync({isDir:!1,path:h.createUUID(),name:l.name,id:h.createUUID(),parentId:e.path,_mayHaveChildren:!1,value:l.value,virtual:!0,user:{},ref:{protocol:a,item:l},type:"protocolVariable"}))}}},onStoreReady:function(a){a=a?h.queryStore(a,{isDir:!1}):[];var b=this;_.each(a,function(a,d,c){b._completeProtocolItem(a)});console.log("store ready : ",a)},onMainViewReady:function(){var b=this,d=a.createDefault("New Protocol","fa-exchange","File/New/Protocol","__anewAction",null,{permanent:!0,
handler:function(){b.newItem()}}).setVisibility(k.ACTION_VISIBILITY.ACTION_TOOLBAR,null).setVisibility(k.ACTION_VISIBILITY.MAIN_MENU,{}).setVisibility(k.ACTION_VISIBILITY.CONTEXT_MENU,null);b.publish(k.EVENTS.REGISTER_ACTION,{owner:b,action:d});g.prototype.ctx=this.ctx},openItemSettings:function(a){var d=a.user;if(!d||!d.meta)return null;var c=this.getViewId(a),e=l.byId(c);try{if(e)return e.parentContainer&&e.parentContainer.selectChild(e),null}catch(g){h.destroyWidget(e)}var e=this.getViewTarget(),
f=this.getMetaValue(a,this.itemMetaTitleField);a.beanContextName=this.ctx.mainView.beanContextName;return h.addWidget(b,{title:f||h.toString(a.name),cis:d.meta.inputs,beanContextName:this.ctx.mainView.beanContextName,storeItem:a,iconClass:this.beanIconClass,id:c,delegate:this,storeDelegate:this,closable:!0,showAllTab:!1,blockManager:this.ctx.getBlockManager()},this,e,!0)}})})},"xide/action/Action":function(){define("xdojo/declare dojo/_base/lang xide/model/Base xide/types xide/utils xide/mixins/EventedMixin".split(" "),
function(p,n,m,k,h,f){h.mixin(k,{ACTION_VISIBILITY:{MAIN_MENU:"MAIN_MENU",CONTEXT_MENU:"CONTEXT_MENU",ACTION_TOOLBAR:"ACTION_TOOLBAR",PROPERTY_VIEW:"PROPERTY_VIEW",RIBBON:"RIBBON",widgetArgs:null,factory:function(){var a=arguments[1]||n.clone(k.ACTION_VISIBILITY),e=arguments;if(0<e[0].length&&_.isNumber(e[0][0])){var g=e[0],d=0;_.each(a,function(b,e){"function"!==typeof a[e]&&d<g.length&&(a[e+"_val"]=g[d]);d++})}if(_.isString(e[0][0])){if(!0===e[0][2])n.mixin(a[e[0][0]+"_val"],e[0][2]);else return a[e[0][0]+
"_val"]=e[0][1],a;return e[1]}return a}}});k.ACTION_VISIBILITY_ALL="ACTION_VISIBILITY_ALL";var a=p("xide/action/Action",[m,f],{disabled:!1,enabled:!0,object:null,show:!0,group:"",types:"",command:null,icon:"fa-play",event:null,handler:null,tab:null,visibility_:null,value:null,setVisibility:function(){if(2==arguments.length&&_.isString(arguments[0])&&arguments[0]==k.ACTION_VISIBILITY_ALL){var a=arguments[1],e=k.ACTION_VISIBILITY,g=this;[e.MAIN_MENU,e.ACTION_TOOLBAR,e.CONTEXT_MENU,e.RIBBON].forEach(function(d){g.setVisibility(d,
h.cloneKeys(a,!1))});return this}e=_.isArray(arguments[0])?arguments[0]:arguments;this.visibility_=k.ACTION_VISIBILITY.factory(e,this.visibility_);return this},getVisibility:function(a){this.visibility_||this.setVisibility(k.ACTION_VISIBILITY_ALL,{});return this.visibility_?(null==this.visibility_[a+"_val"]&&(this.visibility_[a+"_val"]={vis:a}),this.visibility_[a+"_val"]):{}},shouldDestroyWidget:function(a,e,g){a=null!=this.getVisibility?this.getVisibility(a):null;var d=!0;a&&a.permanent&&(d=!(_.isFunction(a.permanent)?
a.permanent(this,e,g):a.permanent));return d}});a.create=function(c,e,g,d,b,l,f,k,m,n,p){c=new a({permanent:d,command:g,icon:e,label:c,owner:this,types:l,operation:b,group:f,handler:n,title:c});h.mixin(c,p);return c};a.createDefault=function(c,e,g,d,b,l){return a.create(c,e,g,!1,null,null,d||"nogroup",null,!1,b,l)};return a})},"xcf/manager/Application":function(){define("dcl/dcl require xdojo/declare xide/manager/Application xide/utils xide/types xdojo/declare xdojo/has xdojo/has!xcf-ui?xcf/manager/Application_UI xdojo/has!xexpression?xexpression/Expression".split(" "),
function(p,n,m,k,h,f,a,c,e,g,d){return p(k,{declaredClass:"xcf.manager.Application",vfsItems:null,onReloaded:function(){},onMountDataReady:function(a){},_onXBlocksReady:function(){n("xfile/manager/BlockManager");var a=this.ctx;if(a.blockManager)a.blockManager.onReady();n(["xcf/manager/BlockManager"],function(d){a.blockManager=new d;a.blockManager.ctx=a;a.blockManager.updatePalette=!1;a.blockManager.init();a.blockManager.onReady();a.blockManager.serviceObject=a.fileManager.serviceObject});var d=n("xblox/views/BlocksFileEditor"),
a=this.ctx;a.registerEditorExtension("xBlocks","xblox","fa-play-circle-o",this,!0,null,d,{ctx:this.ctx,mainView:this.mainView,blockManagerClass:"xfile.manager.BlockManager",registerView:!0})},onComponentReady:function(a){console.log("on component ready",a)},onPluginLoaded:function(a){this.publish(f.EVENTS.ON_PLUGIN_READY,{name:a.name,mainView:this.rootView,config:this.config,ctx:this.ctx,panelManager:this,fileManager:this.ctx.getFileManager(),store:this.store,serviceObject:this.ctx.getService()},
this)}})})},"xide/manager/Application":function(){define("dcl/dcl xdojo/has xide/manager/ManagerBase xide/types xide/utils dojo/Deferred dojo/has!host-browser?xide/manager/Application_UI".split(" "),function(p,n,m,k,h,f,a){return p([m],{declaredClass:"xide.manager.Application",container:null,ctx:null,_debug:!0,_loadedComponents:{},_loadingComponents:null,getComponents:function(){return this._loadedComponents},doComponents:function(){var a=this.loadComponents(),e=require,g=this;if(!a||!a.dfd)return console.error("componentsToLoad is null or has no head dfd"),
a;n("xfile")&&a[k.COMPONENT_NAMES.XFILE].dfd&&a[k.COMPONENT_NAMES.XFILE].dfd.then(function(){g.initXFile()});n("xideve")&&a[k.COMPONENT_NAMES.XIDEVE].dfd&&a[k.COMPONENT_NAMES.XIDEVE].dfd.then(function(){g.initXIDEVE()});n("xnode")&&a[k.COMPONENT_NAMES.XNODE].dfd&&a[k.COMPONENT_NAMES.XNODE].dfd.then(function(){g.initXNODE()});a[k.COMPONENT_NAMES.XBLOX].dfd&&a[k.COMPONENT_NAMES.XBLOX].dfd.then(function(){e(["xblox/embedded_ui","xfile/manager/BlockManager","xblox/views/BlocksFileEditor"],function(){g.onXBlocksReady()})});
a.dfd.then(function(){g.registerEditorExtensions()});return a.dfd},loadComponents:function(a){if(this._loadingComponents)return this._loadingComponents;var e=this,g,d;e._loadedComponents={};a=a||h.getJson(this.ctx.getResourceManager().getVariable("COMPONENTS"));_.each(a,function(b,d){0==n(d)&&delete a[d]});if(!a)return null;g=function(){var b=_.find(a,{status:0});b?d(b.name,b):(a.dfd.resolve(a),e.publish(k.EVENTS.ON_ALL_COMPONENTS_LOADED,a),a.dfd.resolve())};d=function(a,b){var d=b.settings;0==n(a)&&
console.error("loading component "+a+"which is disabled by has!");e.ctx.getPluginManager().loadComponent(a,null,!0===d?null:d).then(function(d){e._loadedComponents[a]=d;d={component:d,name:a};b.dfd.resolve(d);e.publish(k.EVENTS.ON_COMPONENT_READY,d);b.status=1;g()})};for(var b in a){var l=""+b,m=a[l];a[l]=m?{settings:m,status:0,name:l,dfd:new f}:{status:1}}a.dfd=new f;g();return this._loadingComponents=a},hasComponent:function(a){var e=h.getJson(this.ctx.getResourceManager().getVariable("COMPONENTS"));
return!(!e||!e[a])}})})},"xcf/manager/LogManager":function(){define(["dcl/dcl","xide/utils","xlog/manager/LogManager","xdojo/has!xcf-ui?xcf/views/LogView"],function(p,n,m,k){return p(m,{declaredClass:"xcf.manager.LogManager",createLoggingView:function(h,f){var a=this.getViewTarget();try{return n.addWidget(k,{delegate:this,store:h,title:"Log",closable:!0},this,a,!0)}catch(c){console.error(c)}},ls:function(h,f){var a=this;return this.callMethodEx(null,"ls",["unset"],function(c){a.rawData=c;a.initStore(c);
h&&h(c)},!0)}})})},"xlog/manager/LogManager":function(){define("dcl/dcl xdojo/declare dojo/_base/lang xide/manager/ServerActionBase xide/manager/BeanManager xide/encoding/MD5 xide/types xide/utils dojo/cookie dojo/json dojo/Deferred xide/data/Memory dstore/Trackable xide/mixins/EventedMixin".split(" "),function(p,n,m,k,h,f,a,c,e,g,d,b,l,q){var r=n([q],{bytesLoaded:null,percentValue:null,item:null,delegate:null,_onEnd:null,_onHandle:null,serviceClass:"XIDE_Log_Service",constructor:function(a){this.item=
a;this.subscribe(a.progressMessage,this._onProgress);this.subscribe(a.progressFailedMessage,this._onProgressFailed)},_onProgressFailed:function(a){this.item.level="error";this.item.message=this.item.oriMessage+" : Failed";this.item._isTerminated=!0;a&&a.item&&a.item.error&&this.item.details&&(this.item.details.error=a.item.error)},_onFinish:function(){this._onHandle&&this._onHandle.remove()},destroy:function(){this._destroyHandles()},_onProgress:function(a){try{var b=a.progress;a=null;null==a&&(a=
Math.round(100*b.loaded/b.total),this.bytesLoaded=b.loaded);if(this.percentValue!=a){var d=""+this.item.oriMessage;this.item.message=""+(d+(" : "+a+"%"))}this.percentValue=a;this._emit("progress");100<=this.percentValue&&(this.item.message=this.item.oriMessage+" : Done",this._emit("finish"),this._onFinish(),this.destroy())}catch(c){console.error("crash in log progress "+c)}}});return p([k,h],{declaredClass:"xcf.manager.LogManager",serviceClass:"XIDE_Log_Service",cookiePrefix:"logging",singleton:!0,
serviceView:null,clients:null,beanNamespace:"logging",views:null,stores:{},removeStore:function(a){var b=this.stores[a];b&&(b.destroy&&b.destroy(),delete this.stores[a])},getViewId:function(a){return this.beanNamespace+f(JSON.stringify({info:a.info}),1)},loadPreferences:function(){var a=e(this.cookiePrefix+"_debug_settings");return a=a?g.parse(a):{}},savePreferences:function(a){e(this.cookiePrefix+"_debug_settings",g.stringify(a))},empty:function(a){this.clear(a);a=this.getStore(a);a.then&&a.then(function(a){a.setData([])})},
clear:function(a){return this.runDeferred(null,"clear",[a||""]).then(function(a){})},getViewTarget:function(){return this.ctx.getApplication().mainView.getNewAlternateTarget()},getStore:function(a){if(!a)return this.store;var b=new d;if(this.stores[a])return b.resolve(this.stores[a]),b;var e=this;this.runDeferred(null,"ls",[a||""]).then(function(d){m.isString(d)&&(d=c.getJson(d));d=e.initStore(d);e.stores[a]=d;b.resolve(d)});return b},isValid:function(){return null!=this.store},_buildLoggingMessage:function(a){var b=
{id:c.createUUID(),level:a.level,message:a.message,host:"",data:a.data||{},time:a.time||(new Date).getTime(),type:"",show:!0,showDevice:!0};a.type&&(b.type=a.type);a.device&&a.device.host&&(b.host=a.device.host+":"+a.device.port);a.deviceMessage&&(b.message=b.message+":"+a.deviceMessage);b.ori=a;return b},initStore:function(a){var d={identifier:"time",label:"level",items:[],sort:"time"},c=null;0==a.length&&(a=[]);for(var e=0;e<a.length;e++)d.items.push(this._buildLoggingMessage(a[e]));try{c=new (n("LogStore",
[b,l],{}))({idProperty:"time",data:d})}catch(g){console.error("log creation failed: ",g)}return c},createLoggingView:function(a,b,d){b=b||this.getViewTarget();try{return c.addWidget(!1,{delegate:this,store:a,title:"Log",closable:!0,style:"padding:0px",silent:d},this,b,!0)}catch(e){console.error(e)}},updateViews:function(a,b){for(var d=0;d<this.views.length;d++)this.views[d].update(a,b)},refreshViews:function(a,b){for(var d=0;d<this.views.length;d++)this.views[d].grid.refresh()},addLogView:function(a){this.views.push(a)},
openLogView:function(a,b){this.isValid()||this.initStore([]);var d=this.createLoggingView(this.store,a,b);this.views.push(d);return d},_createPendingEvent:function(a,b,d,c){function e(a){!b._isTerminated&&g&&(b.message=b.oriMessage+" : Done",a&&!0===a.failed&&(b.level="error",b.message=b.oriMessage+" : Failed"),b._isTerminated=!0,g.remove(),g=null,l.refreshViews(),b.progressHandler&&b.progressHandler.destroy())}var g=null,l=this;b._isInProgress=!0;g=l.subscribe(d,e,l)[0];b.showProgress&&b.progressMessage&&
!b.progressHandler&&(a=new r(b,this),a._onEnd=e,a._onEndHandle=g,b.progressHandler=a)},addLoggingMessage:function(a){if(a&&a.data){var b=a.data.logId;!b&&a.data&&a.data.device&&(b=a.data.device,b=b.host+"_"+b.port+"_"+b.protocol)}var d={id:c.createUUID(),level:a.level,message:a.message,host:a.host||"",data:a.data||{},time:a.time||(new Date).getTime(),type:a.type||"",show:!0,showDevice:!0,terminatorItem:a.item,terminatorMessage:a.terminatorMessage,showProgress:a.showProgress,progressMessage:a.progressMessage,
progressFailedMessage:a.progressFailedMessage,details:a.details};a.data&&(a.data.type&&(d.type=a.data.type),a.data.device&&a.data.device.host&&(d.host=a.data.device.host+":"+a.data.device.port),a.data.deviceMessage&&(d.message=d.message+":"+a.data.deviceMessage));this.isValid()||this.initStore([]);try{null==d.terminatorMessage||d._isTerminated||(null==d.oriMessage&&(d.oriMessage=""+d.message),this._createPendingEvent(d.oriMessage,d,d.terminatorMessage,d.time));var e=this.getStore(b);e&&(e.then?e.then(function(a){d=
a.putSync(d)}):d=e.putSync(d))}catch(g){console.error("adding log message to store failed "+g)}},onServerLogMessage:function(b){b.data&&b.data.time&&(b.time=b.data.time);this.addLoggingMessage(b);1==b.write&&this.publish(a.EVENTS.ON_CLIENT_LOG_MESSAGE,{message:b.message,data:b.data,details:b.details,level:b.level,type:b.type,time:b.data.time||b.time})},onMainViewReady:function(){},init:function(){this.subscribe([a.EVENTS.ON_MAIN_MENU_OPEN,a.EVENTS.ON_MAIN_VIEW_READY,a.EVENTS.ON_SERVER_LOG_MESSAGE]);
this.views=[];this.stores={}},onStoreReloaded:function(a){for(a=0;a<this.views.length;a++){var b=this.views[a];b.reload(this.store);b.update()}},reload:function(){var a=this;this.currentItem=null;this.ls(function(b){a.onStoreReloaded(b)})},onMainMenuOpen:function(b){b=b.menu;b.logMenuItem||b.name!=a.MAIN_MENU_KEYS.VIEWS||(b.logMenuItem=new dijit.MenuItem({label:"Log",onClick:m.hitch(this,"openLogView")}),b.addChild(b.logMenuItem))},ls:function(a,b,d){var e=this;return this.callMethodEx(null,"ls",
[b||""],d||function(b){e.rawData=b;m.isString(b)&&(b=c.getJson(b));e.store=e.initStore(b);a&&a(b)},!0)}})})},"xide/manager/ResourceManager":function(){define(["dcl/dcl","xide/manager/ServerActionBase","xide/utils","xide/mixins/VariableMixin"],function(p,n,m,k){return p([n,k.dcl],{declaredClass:"xide.manager.ResourceManager",serviceClass:"XApp_Resource_Service",resourceData:null,resourceVariables:null,getResourceVariables:function(){return this.resourceVariables},setVariable:function(h,f){return this.resourceVariables[h]=
f},getVariable:function(h){return this.resourceVariables[h]},init:function(){this.resourceVariables||(this.resourceVariables={})},replaceVariables:function(h,f){return m.multipleReplace(""+h,f||this.resourceVariables)}})})},"xide/mixins/VariableMixin":function(){define(["dcl/dcl","xdojo/declare","xide/utils"],function(p,n,m){var k={resolve:function(h,f,a){f=f||this.resourceVariables||this.ctx.getResourceManager().getResourceVariables()||null;a=a||this.variableDelimiters||null;return m.replace(h,null,
f,a)}};n=n("xide/mixins/VariableMixin",null,k);n.dcl=p(null,k);return n})},"xide/manager/PluginManager":function(){define("dcl/dcl dojo/has xide/manager/ManagerBase xide/utils xide/types xide/factory dojo/Deferred dojo/promise/all".split(" "),function(p,n,m,k,h,f,a,c){return p(m,{declaredClass:"xide.manager.PluginManager",_defaultPackageLocationPrefix:"../../",_defaultPackageLocationSuffix:"/component",_defaultComponentFlags:{LOAD:1,RUN:2},defaultComponentMixin:function(a){return{owner:this,ctx:this.ctx,
flags:a}},componentBaseClasses:null,ctx:null,pluginResources:null,pluginInstances:null,_componentReady:function(a,c,d){if(c.RUN)try{a.run(this.ctx)}catch(b){}return d.resolve(a)},_componentLoaded:function(a,c,d,b){try{k.mixin(d,this.defaultComponentMixin(c));var l=f.createInstance(a,d,this.componentBaseClasses),h=function(a,b,d){this._componentReady(a,b,d)}.bind(this);c.LOAD?l.load().then(function(){h(l,c,b)}):h(l,c,b)}catch(m){b.reject(arguments),logError(m)}},loadComponent:function(c,g,d,b,l){d=
"true"===d?{}:d;c=-1==c.indexOf("/")?this._defaultPackageLocationPrefix+c+this._defaultPackageLocationSuffix:c;g=null!=g?g:this._defaultComponentFlags;var f=new a,h=this;(b=k.getObject(c))?_.isFunction(b.then)?b.then(function(a){h._componentLoaded(a,g,d,f)},function(a){console.error("error in loading component at path "+c,a)}):this._componentLoaded(b,g,d,f):console.error("cant get object at "+c);return f},loadComponentResources:function(a,c){},reloadComponent:function(a){},loadPlugins:function(e){if(n("plugins")){var g=
new a,d=[],b=this;this.pluginResources=e;this.pluginInstances=[];if(this.pluginResources)for(var l=0;l<this.pluginResources.length;l++){var f=this.pluginResources[l];f.type&&"JS-PLUGIN"==f.type&&f.path&&d.push(this.loadComponent(f.path,null,f).then(function(a){a.pluginResources=f;b.pluginInstances.push(a)}))}c(d).then(function(){g.resolve(d);b.publish(h.EVENTS.ALL_PLUGINS_READY,{instances:b.pluginInstances,resources:e})});return g}}})})},"nxapp/manager/DeviceManager":function(){define("xdojo/declare dcl/dcl nxapp/factory dojo/node!util xcf/manager/DeviceManager xide/types xide/utils nxapp/utils/_console nxapp/utils".split(" "),
function(p,n,m,k,h,f,a,c,e){n(null,{emit:function(){c.error("device server client emit",arguments)}});return n(h,{declaredClass:"nxapp.manager.DeviceManager",connection:null,onDeviceMetaChanged:function(c,d){_.each(this.store.data,function(b){if(-1!==b.path.indexOf(d)){var f=a.getJson(e.readFile(c));f&&(b.user=f)}})},onFileChanged:function(c){if("changed"===c.type&&!c._did){c._did=!0;c=a.replaceAll("\\","/",c.path);c=a.replaceAll("//","/",c);c=c.replace(/\\/g,"/");var d;d=c;d=-1!=d.indexOf("system/devices")?
d.substr(d.indexOf("system/devices")+15,d.length):null;if(d&&-1!==d.indexOf(".meta.json"))this.onDeviceMetaChanged(c,d)}},checkDeviceServerConnection:function(){},sendManagerCommand:function(e,d){try{var b=this.ctx.getDeviceServer(),f={manager_command:e};a.mixin(f,d);b.handleManagerCommand(f,this.connection)}catch(h){c.error("error "+h.message,h.stack)}},sendDeviceCommand:function(a,d,b,c){a=a.options;d={command:d,device_command:"Device_Send",host:a.host,port:a.port,protocol:a.protocol,options:{id:c,
src:b}};this.ctx.getDeviceServer().handleDeviceCommand(d,this.connection)}})})},"nxapp/factory":function(){define(["dojo/_base/declare"],function(p){return p("nxapp.factory",null,{})})},"xcf/manager/BlockManager":function(){define("dcl/dcl xdojo/declare dojo/_base/lang xide/types xide/utils xide/factory xide/manager/ManagerBase xblox/manager/BlockManager".split(" "),function(p,n,m,k,h,f,a,c){return p([a,c],{declaredClass:"xcf.manager.BlockManager",onReady:function(){},addDriverFunctions:function(a,
c){for(var d in c)"constructor"!==d&&"inherited"!==d&&m.isFunction(c[d])&&(a[d]=c[d])},setScriptFunctions:function(a,c,d){var b=d;c.context||(c.context=a);a.blockScope||(a.blockScope=c);this.ctx.getDeviceManager();c.context?c.context.instance&&(c.device=c.context.instance):console.error("scope has no context!");a.callCommand||(a.callCommand=function(a){var b=this.blockScope.getBlockByName(a);b?b.solve(this.blockScope):console.log("no such variable : "+a)});a.setVariable||(a.setVariable=function(d,
f,h,m,n){var p=this.blockScope.getVariable(d);p?(p.value=f,p.set("value",f),console.log("setting variable "+d+" to "+f),!1!==m&&b.publish(k.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:p,scope:c,driver:a,owner:b,save:!0===h,source:n||k.MESSAGE_SOURCE.BLOX})):console.log("no such variable : "+d)});a.getVariable||(a.getVariable=function(a){return(a=this.blockScope.getVariable(a))?a.value:""});this.inherited(arguments)},onReloaded:function(){this.init()},getDeviceVariablesAsEventOptions:function(a){a=[];
var c=function(a,b,d,c,e){c="";if(0<d)for(var f=0;f<d;f++)c+="\x26nbsp;",c+="\x26nbsp;",c+="\x26nbsp;";return{label:c+("\x3cspan style\x3d''\x3e"+a+"\x3c/span\x3e"),label2:e,value:b}};this.ctx.getDriverManager();for(var d=this.ctx.getDeviceManager(),b=d.getDevices(!1,!0),f=0;f<b.length;f++){var h=b[f],m=h.driver;if(m){h=d.getMetaValue(h,k.DEVICE_PROPERTY.CF_DEVICE_TITLE);a.push(c(h,m.id+"/"+m.id,0,!1));for(var n=m.blockScope.getVariables(),p=0;p<n.length;p++){var y=n[p],v=m.id+"/"+y.id;a.push(c(y.title,
v,1,ci.value===v,h+"/"+y.title))}}}},onCreateVariableCI:function(a){console.log("onCreateVariableCI12",a);var c=a.CI,d=a.owner;a=null!=d.scope.device;console.log("ci value "+c.value);if(a){a=[];var b=function(a,b,d,c,e){c="";if(0<d)for(var f=0;f<d;f++)c+="\x26nbsp;",c+="\x26nbsp;",c+="\x26nbsp;";return{label:c+("\x3cspan style\x3d''\x3e"+a+"\x3c/span\x3e"),label2:e,value:b}};this.ctx.getDriverManager();for(var f=this.ctx.getDeviceManager(),h=f.getDevices(!1,!0),m=0;m<h.length;m++){var d=h[m],n=d.driver;
if(n){var p=f.getMetaValue(d,k.DEVICE_PROPERTY.CF_DEVICE_TITLE);a.push(b(p,n.id+"/"+n.id,0,!1));for(var y=n.blockScope.getVariables(),v=0;v<y.length;v++){var d=y[v],u=n.id+"/"+d.id;a.push(b(d.name,u,1,c.value===u,p+"/"+d.title))}}}c.options=a;c.widget={"class":"xide.form.FilterSelect"}}}})})},"xblox/manager/BlockManager":function(){define("dcl/dcl dojo/_base/declare dojo/_base/lang dojo/has dojo/Deferred dojo/promise/all xide/types xide/utils xide/factory xblox/model/ModelBase xblox/model/Scope xblox/model/BlockModel xide/mixins/ReloadMixin xide/manager/ManagerBase xblox/data/Store dojo/has!xblox-ui?xblox/manager/BlockManagerUI".split(" "),
function(p,n,m,k,h,f,a,c,e,g,d,b,l,q,r,t){return p([q,l.dcl],{declaredClass:"xblox/manager/BlockManager",serviceObject:null,loaded:{},scope:null,scopes:null,_createBlock:null,_registerActions:function(){},toScope:function(a){try{a=c.getJson(a)}catch(b){return console.error("BlockManager::toScope: failed,err\x3d"+b),null}a||(console.error("correct data"),a={blocks:[],variables:[]});var d=c.createUUID(),e=a;!m.isArray(a)&&m.isObject(a)&&(d=a.scopeId||d,e=a.blocks||[]);a=this.getScope(d,{owner:this},
!0);e=a.blocksFromJson(e);for(d=0;d<e.length;d++)e[d]._lastRunSettings={force:!1,highlight:!0};a.serviceObject=this.serviceObject;return a},loadFiles:function(a){for(var b=[],d=new h,c=0;c<a.length;c++){var e=a[c];b.push(this.load(e.mount,e.path,e.force))}f(b).then(function(a){console.log("got all block files ",a);d.resolve(a)});return d.promise},load:function(a,b,d,e){var f=new h,g=this;e=c.replaceAll("/","",a);var l=c.replaceAll("./","",b),k=e+l,k=k.trim();this.loaded[k]&&(this.removeScope(this.loaded[k].id),
this.loaded[k]=null);if(!0!==d&&this.loaded[k])return f.resolve(this.loaded[k]),f.promise;this.ctx.getFileManager().getContent(e,l,function(d){if(d=g.toScope(d))g.loaded[k]=d,d.mount=a,d.path=b;f.resolve(d)},!1);return f.promise},onBlocksReady:function(a){for(var b=a.allBlocks(),d=0;d<b.length;d++)this.setScriptFunctions(b[d],a,this);if((a=a.getBlocks({group:"On Load"}))&&0<a.length)for(d=0;d<a.length;d++)if(b=a[d],b.onLoad)b.onLoad()},setScriptFunctions:function(b,d,c){b.blockScope||(b.blockScope=
d);console.log("set script functions "+d.id,b);d.serviceObject=this.serviceObject;b.setVariable||(b.setVariable=function(e,f,g,l,h){var k=this.blockScope.getVariable(e);k?(k.value=f,!1!==l&&c.publish(a.EVENTS.ON_VARIABLE_CHANGED,{item:k,scope:d,driver:b,owner:c,save:!0===g,source:h||a.MESSAGE_SOURCE.BLOX})):console.log("no such variable : "+e)});b.getVariable||(b.getVariable=function(a){return(a=this.blockScope.getVariable(a))?a.value:""})},hasScope:function(a){this.scopes||(this.scopes={});return this.scopes[a]?
this.scopes[a]:null},getScope:function(b,d,c){this.scopes||(this.scopes={});if(!this.scopes[b]&&(this.scopes[b]=this.createScope({id:b,ctx:this.ctx}),this.scopes[b].userData=d,!1!==c))try{e.publish(a.EVENTS.ON_SCOPE_CREATED,this.scopes[b])}catch(f){console.error("bad, scope creation failed "+f,f)}return this.scopes[b]},removeScope:function(a){this.scopes||(this.scopes={});for(var b in this.loaded)this.loaded[b].id==a&&delete this.loaded[b];try{this.scopes[a]&&(this.scopes[a]._destroy(),delete this.scopes[a])}catch(d){debugger}return null},
createScope:function(a,e){e=e||[];var f=new r({data:[],Model:n("xblox.model.BlockModel",b,{}),observedProperties:["name","enabled","value"],getLabel:function(a){return a.name},labelAttr:"name"});f.reset();f.setData([]);f={owner:this,blockStore:f,serviceObject:this.serviceObject,config:this.config};c.mixin(f,a);try{var g=new d(f);e&&g.initWithData(e);g.init()}catch(l){logError(l,"error creating scope")}return g},onReloaded:function(){console.log("on reloaded")},init:function(){this.scope={variables:[],
blocks:[]};g.prototype.types=a;g.prototype.factory=e;if(this.onReady)this.onReady()}})})},"xblox/model/Scope":function(){define("dcl/dcl ./ModelBase ./Expression xide/factory xide/utils xide/types xide/mixins/EventedMixin dojo/_base/lang dojo/has!host-node?dojo/node!tracer dojo/has!host-node?nxapp/utils/_console".split(" "),function(p,n,m,k,h,f,a,c,e,g){var d="undefined"!==typeof window?window.console:d;e&&e.error&&d&&d.error&&(d=g);return p([n,a.dcl],{declaredClass:"xblox.model.Scope",variableStore:null,
serviceObject:null,context:null,blockStore:null,toFriendlyName:function(a,d){if(!d||!a)return null;var c=this,e=this.ctx,c=this.driver,f=e.getDeviceManager(),c=e.getDriverManager();if(-1==d.indexOf("://"))return d;var e=h.parse_url(d),e=h.urlArgs(e.host),g=f.getItemById(e.device.value);return g&&(f=f.toDeviceControlInfo(g),c=c.getDriverById(f.driverId),(g=g.driverInstance)||c)&&(c=c.blockScope?c.blockScope:g?g.blockScope:null,(a=c.getStore().getSync(e.block.value))||g&&g.blockScope&&(a=g.blockScope.getBlock(e.block.value)))?
f.title+"/"+a.name:d},getContext:function(){return this.instance},toString:function(){var a={blocks:null,variables:null},d=this.blocksToJson();try{dojo.fromJson(JSON.stringify(d))}catch(c){return}a.blocks=d;return JSON.stringify(a,null,2)},initWithData:function(a){a&&this.blocksFromJson(a);this.clearCache()},getService:function(){return this.serviceObject},getStore:function(){return this.blockStore},empty:function(){this.clearCache();var a=this.blockStore,d=this.getBlocks();_.each(d,function(d){d&&
a.removeSync(d.id)});a.setData([])},fromScope:function(a){this.empty();a=a.blocksToJson();this.blocksFromJson(a)},clearCache:function(){this.expressionModel.expressionCache={};this.expressionModel.variableFuncCache={}},getVariableStore:function(){return this.blockStore},getBlockStore:function(){return this.blockStore},getVariables:function(a){if(!this.blockStore)return[];var d=this.blockStore.data,c=[];if(a&&"processVariables"===a.group){for(a=0;a<d.length;a++)"processVariables"===d[a].group&&c.push(d[a]);
return c}if(!a){for(a=0;a<d.length;a++){var e=d[a],f=e.declaredClass;"xblox.model.variables.Variable"!=f&&"xcf.model.Variable"!=f||c.push(e)}return c}return this.blockStore.query(a)},loopBlock:function(a,d){if(a&&1==a.auto&&0<a.interval&&a.enabled){var c=this;a._loop&&clearTimeout(a._loop);a._loop=setInterval(function(){a.solve(c,d||a._lastSettings);a.enabled||(clearTimeout(a._loop),a._loop=null)},a.interval)}},getEventsAsOptions:function(a){var d=[],c;for(c in f.EVENTS)d.push({label:f.EVENTS[c],
value:f.EVENTS[c]});d=d.concat([{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",
value:"onchange"}]);for(c=0;c<d.length;c++){var e=d[c];if(e.value===a){e.selected=!0;break}}return d},getVariablesAsObject:function(){for(var a=this.getVariables(),d={},c=0;c<a.length;c++)d[a[c].title]=a[c].value;return d},getVariablesAsOptions:function(){var a=this.getVariables(),d=[];if(a)for(var c=0;c<a.length;c++)d.push({label:a[c].label,value:a[c].variable});return d},getCommandsAsOptions:function(){var a=this.getBlocks({declaredClass:"xcf.model.Command"}),d=[];if(a)for(var c=0;c<a.length;c++)d.push({label:a[c].name,
value:a[c].name});return d},getBlocks:function(a){if(!this.blockStore)return[];a=a||{id:/\S+/};return this.blockStore.query(a)},expressionModel:new m,registerVariable:function(a){this.variables[a.title]=a;this.blockStore&&this.blockStore.putSync(a)},getVariable:function(a){for(var d=this.getVariables(),c=0;c<d.length;c++){var e=d[c];if(e.name===a)return e}return null},getVariableById:function(a){var c=a.split("/"),e=this;2==c.length&&((a=e.owner)&&a.hasScope&&(a.hasScope(c[0])?e=a.getScope(c[0]):
d.error("have scope id but cant resolve it",this)),a=c[1]);return(c=e.blockStore.getSync(a))?c:null},registerBlock:function(a){var d=this.blockStore;if(d){var c=d.getSync(a.id);if(c)return c;if(a.addToStore)a.addToStore(d);else return d.putSync(a)}},allBlocks:function(a){return this.getBlocks()},hasGroup:function(a){for(var d=this.allGroups(),c=0;c<d.length;c++)if(d[c]===a)return!0;return!1},allGroups:function(){for(var a=[],d=this.allBlocks(),c=function(d){for(var c=0;c<a.length;c++)if(a[c]===d)return!0;
return!1},e=0;e<d.length;e++){var f=d[e];f.parentId||(f.group?c(f.group)||a.push(f.group):c("No Group")||a.push("No Group"))}return a},variablesToJson:function(){var a=[],d=this.variableStore?this.getVariables():this.variables,c;for(c in d){var e=d[c];if(!1!==e.serializeMe&&null!=e.keys){var f={},g;for(g in e)if(this.isString(e[g])||this.isNumber(e[g])||this.isBoolean(e[g]))f[g]=e[g];a.push(f)}}return a},isScript:function(a){return this.isString(a)&&(-1!=a.indexOf("return")||-1!=a.indexOf(";")||-1!=
a.indexOf("[")||-1!=a.indexOf("{")||-1!=a.indexOf("}"))},variablesToJavascriptEx:function(a,d){for(var c=[],e=this.variableStore?this.getVariables():this.variables,f=0;f<e.length;f++){var g=e[f];if(g!=a){var h=""+g.value;a&&a.value&&-1==a.value.indexOf(g.title)||d&&-1==d.indexOf(g.title)||0==h.length||(this.isScript(h)||-1!=h.indexOf("'")?this.isScript(h)&&(h=this.expressionModel.parseVariable(this,g)):h="'"+h+"'","''"===h&&(h="'0'"),c.push(h))}}return c},variablesToJavascript:function(a,d){for(var c=
"",e=this.variableStore?this.getVariables():this.variables,f=0;f<e.length;f++){var g=e[f];if(g!=a){var h=""+g.value;a&&a.value&&-1==a.value.indexOf(g.title)||d&&-1==d.indexOf(g.title)||0==h.length||(this.isScript(h)||-1!=h.indexOf("'")?this.isScript(h)&&(h=this.expressionModel.parseVariable(this,g)):h="'"+h+"'","''"===h&&(h="'0'"),c+="var "+g.title+" \x3d "+h+";",c+="\n")}}return c},variablesFromJson:function(a){for(var c=[],e=0;e<a.length;e++){var f=a[e];f.scope=this;if(f.declaredClass){var g=h.replaceAll(".",
"/",f.declaredClass),k=require(g);k?c.push(new k(f)):d.log("couldnt resolve "+g)}else d.log("   variable has no class ")}return c},regenerateIDs:function(a){for(var d=this,c=function(a){var b=h.createUUID(),e=d.getBlocks({parentId:a.id});if(e&&0<e.length)for(var f=0;f<e.length;f++){var g=e[f];g.parentId=b;c(g)}a.id=b},e=0;e<a.length;e++)c(a[e])},cloneBlocks2:function(a,d){var c=this.blocksToJson(a),e=this.owner.getScope(h.createUUID(),null,!1),c=e.blocksFromJson(c,!1),f=this.blockStore,c=e.allBlocks();
e.regenerateIDs(c);c=e.blocksToJson(c);if(d)for(e=0;e<c.length;e++){var g=c[e];null==g.parentId&&(g.group=d)}var k=[],c=this.blocksFromJson(c);_.each(c,function(a){k.push(f.getSync(a.id))});return k},cloneBlocks:function(a){a=this.blocksToJson(a);var d=this.owner.getScope(h.createUUID(),null,!1);a=d.blocksFromJson(a,!1);a=d.allBlocks();for(d=0;d<a.length;d++){var c=a[d];c.id=h.createUUID();c.parentId=null}this.blocksToJson(a);this.blocksFromJson(a);return a},blockToJson:function(a){var d={_containsChildrenIds:[]},
c;for(c in a)if("ctrArgs"!=c&&("function"===typeof a[c]||a.serializeField(c))){if(this.isString(a[c])||this.isNumber(a[c])||this.isBoolean(a[c]))d[c]=a[c];if("parent"!=c)if(this.isBlock(a[c]))d[c]=a[c].id,d._containsChildrenIds.push(c);else if(this.areBlocks(a[c])){d[c]=[];for(var e=0;e<a[c].length;e++)d[c].push(a[c][e].id);d._containsChildrenIds.push(c)}}return d},blocksToJson:function(a){try{var c=[];a=a&&a.length?a:this.blockStore?this.getBlocks():this.blocks;for(var e in a){var f=a[e];if(null!=
f.keys&&!1!==f.serializeMe){var g={_containsChildrenIds:[]},h;for(h in f)if("ctrArgs"!=h&&("function"===typeof f[h]||f.serializeField(h))){if(this.isString(f[h])||this.isNumber(f[h])||this.isBoolean(f[h]))g[h]=f[h];if("parent"!=h)if(this.isBlock(f[h]))g[h]=f[h].id,g._containsChildrenIds.push(h);else if(this.areBlocks(f[h])){g[h]=[];for(var k=0;k<f[h].length;k++)g[h].push(f[h][k].id);g._containsChildrenIds.push(h)}}c.push(g)}}}catch(m){d.error("from json failed : "+m)}return c},_createBlockStore:function(){},
blockFromJson:function(a){a.scope=this;null==a._containsChildrenIds&&(a._containsChildrenIds=[]);for(var c={},e=0;e<a._containsChildrenIds.length;e++){var f=a._containsChildrenIds[e];c[f]=a[f];a[f]=null}delete a._containsChildrenIds;if(!a.declaredClass)return d.log("   not a class "),null;f=e=null;try{f=h.replaceAll(".","/",a.declaredClass),e=require(f)}catch(g){try{f=h.replaceAll("/",".",a.declaredClass),e=require(f)}catch(m){}}if(!e)return null;f=null;try{f=k.createBlock(e,a)}catch(n){return logError(n),
null}f._children=c;return f},blocksFromJson:function(a,c){for(var e=[],f={},g=0;g<a.length;g++){var m=a[g];m.scope=this;null==m._containsChildrenIds&&(m._containsChildrenIds=[]);for(var n={},p=0;p<m._containsChildrenIds.length;p++){var u=m._containsChildrenIds[p];n[u]=m[u];m[u]=null}delete m._containsChildrenIds;if(m.declaredClass){var w=p=null;try{w=h.replaceAll(".","/",m.declaredClass),p=require(w)}catch(C){d.error("couldnt resolve class "+w)}if(p){w=null;try{w=k.createBlock(p,m)}catch(A){d.error("error in block creation ",
A+" "+m.declaredClass);logError(A);continue}w._children=n;f[w.id]=n;e.push(w)}else d.log("couldnt resolve "+w)}else d.log("   not a class ")}n=this.allBlocks();for(g=0;g<n.length;g++){m=n[g];m._children=f[m.id];if(m._children){for(u in m._children)if("string"==typeof m._children[u])(p=this.getBlockById(m._children[u]))?(m[u]=p,p.parent=m):d.log("   couldnt resolve child: "+m._children[u],m);else if("object"==typeof m._children[u])for(m[u]=[],w=0;w<m._children[u].length;w++)(p=this.getBlockById(m._children[u][w]))?
m[u].push(p):d.log("   couldnt resolve child: "+m._children[u][w]);delete m._children}!1!==c&&null!=m.parentId&&null==this.getBlockById(m.parentId)&&(m.parentId=null)}this.allBlocks();return e},resolveBlock:function(a){var d=this,c=this.ctx,d=this.driver,d=c.getDeviceManager(),c=c.getDriverManager();if(-1==a.indexOf("://"))return a;a=h.parse_url(a);a=h.urlArgs(a.host);var e=d.getItemById(a.device.value);if(e&&(d=d.toDeviceControlInfo(e),d=c.getDriverById(d.driverId),(c=e.driverInstance)||d)&&(d=c?
c.blockScope:d.blockScope,a=d.getStore().getSync(a.block.value)))return a},getBlock:function(a){return this.getBlockById(a)},getBlockByName:function(a){if(-1!==a.indexOf("://")){var d=this.resolveBlock(a);if(d)return d}for(var c=this.getBlocks(),e=0;e<c.length;e++)if(d=c[e],d.name===a)return d;return(a=this.blockStore.query({name:a}))&&0<a.length?a[0]:null},getBlockById:function(a){return this.blockStore.getSync(a)},flatten:function(a){var d=[],c;for(c in a){var e=a[c];if(null!=e.keys){d.push(e);
for(var f in e)if("ctrArgs"!=f&&"parent"!=f)if(this.isBlock(e[f]))d.push(e[f]);else if(this.areBlocks(e[f]))for(var g=0;g<e[f].length;g++)d.push(e[f][g])}}return d},_getSolve:function(a){return a.prototype?a.prototype.solve:a.__proto__.solve},solveBlock:function(a,d,e,f){d=d||{highlight:!1};var g=null;this.isString(a)?(g=this.getBlockByName(a))||(g=this.getBlockById(a)):this.isObject(a)&&(g=a);a=null;if(g){if(!0!==d.force&&0==g.enabled)return null;!0===d.force&&(d.force=!1);var k=g.declaredClass;
(k=c.getObject(h.replaceAll("/",".",k))||c.getObject(k))?k.prototype&&k.prototype.solve&&(a=k.prototype.solve.apply(g,[this,d])):a=g.solve(this,d,e,f)}return a},solve:function(a,d){for(var c="",e=0;e<this.items.length;e++)c+=this.items[e].solve(a,d);return c},parseExpression:function(a,d,c,e,f,g){return this.expressionModel.parse(this,a,d,e,f,g,c)},isString:function(a){return"string"==typeof a},isNumber:function(a){return"number"==typeof a},isBoolean:function(a){return"boolean"==typeof a},isObject:function(a){return"object"===
typeof a},isBlock:function(a){var d=!1;"object"==typeof a&&null!=a&&void 0==a.length&&a.serializeMe&&(d=!0);return d},areBlocks:function(a){var d=!1;"object"==typeof a&&null!=a&&0<a.length&&this.isBlock(a[0])&&(d=!0);return d},_onVariableChanged:function(a){a.item&&this.expressionModel.variableFuncCache[a.item.title]&&delete this.expressionModel.variableFuncCache[a.item.title]},init:function(){this.subscribe(f.EVENTS.ON_DRIVER_VARIABLE_CHANGED,this._onVariableChanged);var a=this;this.subscribe(f.EVENTS.ON_MODULE_RELOADED,
function(d){var c=d.module,e=d.newModule;(d=a.getBlocks().filter(function(a){return a.declaredClass==c||a.declaredClass==h.replaceAll("/",".",c)?a:null}))&&_.each(d,function(a){var b=e.prototype,d;for(d in b){var c=b[d];c&&_.isFunction(c)&&(a[d]=c)}})})},_destroy:function(){for(var a=this.allBlocks(),d=0;d<a.length;d++){var c=a[d];if(c)try{c&&c.reset&&c.reset(),c&&c._destroy&&c._destroy(),c&&c.destroy&&c.destroy(),c._emit&&c._emit(f.EVENTS.ON_ITEM_REMOVED,{item:c})}catch(e){}}},moveTo:function(a,
c,e,f){if(f){if(c.canAdd&&c.canAdd()){var g=this.getBlockById(a.parentId);g&&g.removeBlock(a,!1);c.add(a,null,null);return}d.error("cant reparent");return!1}if(c.parentId||0!=f)if(!a.parentId&&c.parentId&&0==f)a.group=c.group;else if(a.parentId||c.parentId||!f){if(a.parentId&&c.parentId&&0==f&&a.parentId===c.parentId){d.error("we move within the same parents");var h=this.getBlockById(a.parentId);if(!h)return d.error("     couldnt find parent "),!1;var k=h[h._getContainer(a)],g=a.indexOf(k,a);c=a.indexOf(k,
c);k=g>c?-1:1;e=Math.abs(g-(c+(1==e?-1:1)));for(c=0;c<e-1;c++)h.move(a,k);return!0}if(a.parentId&&c.parentId&&0==f&&a.parentId!==c.parentId){d.log("same parent!");d.error("we move within the different parents");g=this.getBlockById(a.parentId);if(!g)return d.error("     couldnt find source parent "),!1;h=this.getBlockById(c.parentId);if(!h)return d.error("     couldnt find target parent "),!1;if(g&&g.removeBlock&&h.canAdd&&h.canAdd())g.removeBlock(a,!1),h.add(a,null,null);else return d.error("cant reparent"),
!1;k=h[h._getContainer(a)];null==k&&d.error("weird : target parent has no item container");g=h.indexOf(k,a);c=h.indexOf(k,c);if(!g||!c){d.error(" weird : invalid drop processing state, have no valid item indicies");return}k=g>c?-1:1;e=Math.abs(g-(c+(1==e?-1:1)));for(c=0;c<e-1;c++)h.move(a,k);return!0}}else return d.error("we are adding an item into root root item"),c.canAdd&&c.canAdd()&&(a.group=null,c.add(a,null,null)),!0;else{(g=this.getBlockById(a.parentId))&&g.removeBlock&&(g.removeBlock(a,!1),
a.parentId=null,a.group=c.group);var h=[],k=this.getBlocks({group:c.group}),m=[],g=this.getBlockStore(),n=g.storage.index[c.id];for(c=0;c<k.length;c++)if(f=k[c],null==k[c].parentId&&k[c]!=a&&(f=g.storage.index[f.id],f=e?f>=n:f<=n))h.push(k[c]),m.push(g.storage.index[k[c].id]);for(c=0;c<h.length;c++)g.remove(h[c].id);this.getBlockStore().remove(a.id);e&&this.getBlockStore().putSync(a);for(c=0;c<h.length;c++)g.put(h[c]);e||this.getBlockStore().putSync(a);return!0}return!1}})})},"xblox/model/Expression":function(){define(["dojo/_base/declare",
"xblox/model/ModelBase"],function(p,n){return p("xblox.model.Expression",[n],{id:null,context:null,variableDelimiters:{begin:"[",end:"]"},blockCallDelimiters:{begin:"{",end:"}"},expressionCache:{},variableFuncCache:{},reset:function(){this.expressionCache={};this.variableFuncCache={}},replaceVariables:function(m,k,h,f,a,c){var e=this._findOcurrences(k,this.variableDelimiters);if(e)for(var g=0;g<e.length;g++){var d=this._getVar(m,e[g]),b=null;if(d){if(c){k=k.replace(e[g],"this.getVariable('"+d.name+
"')");continue}b=this.getValue(d.value);a&&d.name in a&&(b=a[d.name]);if(this.isScript(b)&&!1!==h)try{var l=m.variablesToJavascript(d,!0);l&&(b=l+b);var n=(new Function("{"+b+"}")).call(m.context||{});console.log(" parsed variable value to : "+n);"undefined"===n||"undefined"===typeof n?b=""+d.value:(b=n,b="'"+b+"'")}catch(p){console.log(" parsed variable expression failed \n"+b,p)}else this.isNumber(b)||!1!==f&&(b="'"+b+"'")}else console.log("   expression failed, no such variable :"+e[g]+" ! setting to default "),
b="";k=k.replace(e[g],b)}return k},parse:function(m,k,h,f,a,c,e){k=this.replaceAll("''","'",k);h=c||m.context||m.getContext()||{};k=this.replaceVariables(m,k,null,null,e,null!=h.getVariable);if(!this.isScript(k)&&(this.isString(k)||this.isNumber(k)))return f&&f("Expression "+k+" evaluates to "+k),k;-1==k.indexOf("return")&&(k="return "+k);m=this;try{k=this.replaceAll("''","'",k);var g=this.expressionCache[k];g||(g=new Function("{"+k+"; }"),this.expressionCache[k]=g);m=g.call(h)}catch(d){return a&&
a("invalid expression : \n"+k+": "+d,d),m=""+k}f&&f("Expression "+k+" evaluates to "+m);return m},parseVariableO:function(m,k){var h=""+k.value;if("None"===k.title)return"";try{var f=m.variablesToJavascript(k,!1);f&&(h=f+h);var a=(new Function("{"+h+"}")).call(this.context||{});"undefined"===a||"undefined"===typeof a?h=""+k.value:this.isNumber(a)?h=a:(h=""+a,h="'"+h+"'")}catch(c){console.error("parse variable failed : "+k.title+"\n"+h)}return h},parseVariable:function(m,k,h,f,a,c,e){var g=""+k.value;
h=h||"";!1!==a?(a=this.variableFuncCache[m.id+"|"+k.title],a||(a=new Function("{"+h+g+"}"),this.variableFuncCache[m.id+"|"+k.title]=a)):a=new Function("{"+h+g+"}");m=a.apply(c||m.context||{},e||[]);return g="undefined"===m||"undefined"===typeof m?""+k.value:this.isNumber(m)||!1===f?m:"'"+m+"'"},replaceBlockCalls:function(m,k){var h=this._findOcurrences(k,this.blockCallDelimiters);if(h)for(var f=0;f<h.length;f++){var a=this._removeDelimiters(h[f],this.blockCallDelimiters),a=m.solveBlock(a).join("\n");
k=k.replace(h[f],a)}return k},_getVar:function(m,k){return m.getVariable(this._getVarName(k))},_getVarName:function(m){return this._removeDelimiters(m,this.variableDelimiters)},_removeDelimiters:function(m,k){return m.replace(k.begin,"").replace(k.end,"")},_escapeRegExp:function(m){for(var k="[](){}*+.".split(""),h=0;h<k.length;h++)m=m.replace(k[h],"\\"+k[h]);return m},_findOcurrences:function(m,k){var h=this._escapeRegExp(k.begin),f=this._escapeRegExp(k.end);return m.match(new RegExp(h+"("+("[^"+
f+"]*")+")"+f,"g"))}})})},"xblox/model/BlockModel":function(){define(["dcl/dcl","xdojo/declare","xide/data/Model","xide/data/Source"],function(p,n,m,k){return n("xblox.model.BlockModel",[m,k],{declaredClass:"xblox.model.BlockModel",icon:"fa-play",mayHaveChildren:function(h){return null!=this.items&&0<this.items.length},getChildren:function(h){return this.items},getBlockIcon:function(){return'\x3cspan class\x3d"'+this.icon+'"\x3e\x3c/span\x3e'}})})},"xblox/data/Store":function(){define("dojo/_base/declare xide/data/TreeMemory xide/data/ObservableStore xide/data/Model dstore/Trackable dojo/Deferred".split(" "),
function(p,n,m,k,h,f){return p("xblox.data.Store",[n,h,m],{idProperty:"id",parentField:"parentId",filter:function(a){var c=this.inherited(arguments);this._state.filter=a;return c},getChildren:function(a){return this.root.filter({parentId:this.getIdentity(a)})},__getChildren:function(a){return this.inherited(arguments)},_fetchRange:function(a){var c=new f;a=this.fetchRangeSync(a);if(this._state.filter){if(this._state&&this._state.filter&&this._state.filter.parentId){var e=this.getSync(this._state.filter.parentId);
e&&(this.reset(),a=e.items,e.getChildren&&(a=e.getChildren()),c.resolve(a))}this._state&&this._state.filter&&this._state.filter.group&&(this.getSync(this._state.filter.parent),e&&(this.reset(),a=e.items))}c.resolve(a);return c},mayHaveChildren:function(a){return a.mayHaveChildren?a.mayHaveChildren(a):null!=a.items&&0<a.items.length}})})},"xblox/factory/Blocks":function(){define("dojo/_base/lang xide/factory xide/utils xide/types xide/mixins/ReloadMixin xide/mixins/EventedMixin xblox/model/logic/CaseBlock xblox/model/Block xblox/model/functions/CallBlock xblox/model/code/CallMethod xblox/model/code/RunScript xblox/model/loops/ForBlock xblox/model/loops/WhileBlock xblox/model/variables/VariableAssignmentBlock xblox/model/logic/IfBlock xblox/model/logic/ElseIfBlock xblox/model/logic/SwitchBlock xblox/model/variables/VariableSwitch xblox/model/logging/Log xblox/model/server/RunServerMethod xblox/model/code/RunBlock xblox/model/events/OnEvent xblox/model/events/OnKey xblox/model/html/SetStyle xblox/model/html/SetCSS xcf/factory/Blocks".split(" "),
function(p,n,m,k,h,f,a,c,e,g,d,b,l,q,r,t,x,y,v,u,w,C,A,D,E){var z=null;n.clearVariables=function(){};n.getAllBlocks=function(a,b,d,c,e){if(!1!==e&&null!=z){for(a=0;a<z.length;a++)if(b=z[a],"Set Variable"===b.name){z.remove(b);break}return z}0==e&&(z=null);e=n._getFlowBlocks(a,b,d,c);e=e.concat(n._getLoopBlocks(a,b,d,c));e=e.concat(n._getCommandBlocks(a,b,d,c));e=e.concat(n._getCodeBlocks(a,b,d,c));e=e.concat(n._getEventBlocks(a,b,d,c));e=e.concat(n._getLoggingBlocks(a,b,d,c));e=e.concat(n._getServerBlocks(a,
b,d,c));return z=e=e.concat(n._getServerBlocks(a,b,d,c))};n._getServerBlocks=function(a,b,d,c){var e=[];e.push({name:"Server",iconClass:"el-icon-repeat",items:[{name:"Run Server Method",owner:b,iconClass:"fa-plug",proto:u,target:d,ctrArgs:{scope:a,group:c}}]});n.publish(k.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"Server"});return e};n._getHTMLBlocks=function(a,b,d,c){var e=[];e.push({name:"HTML",iconClass:"fa-paint-brush",items:[{name:"Set Style",owner:b,iconClass:"fa-paint-brush",proto:D,target:d,
ctrArgs:{scope:a,group:c}},{name:"Set CSS",owner:b,iconClass:"fa-paint-brush",proto:E,target:d,ctrArgs:{scope:a,group:c}}]});return e};n._getVariableBlocks=function(a,b,d,c){var e=[];e.push({name:"Flow",iconClass:"el-icon-random",items:[{name:"If...Else",owner:b,iconClass:"el-icon-fork",proto:r,target:d,ctrArgs:{scope:a,group:c,condition:"[value]\x3d\x3d'PW'"}}]});return e};n._getEventBlocks=function(a,b,d,c){var e=[];e.push({name:"Events",iconClass:"fa-bell",items:[{name:"On Event",owner:b,iconClass:"fa-bell",
proto:C,target:d,ctrArgs:{scope:a,group:c}},{name:"On Key",owner:b,iconClass:"fa-keyboard-o",proto:A,target:d,ctrArgs:{scope:a,group:c}}]});n.publish(k.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"Events"});return e};n._getLoggingBlocks=function(a,b,d,c){var e=[];e.push({name:"Logging",iconClass:"fa-bug",items:[{name:"Log",owner:b,iconClass:"fa-bug",proto:v,target:d,ctrArgs:{scope:a,group:c}}]});n.publish(k.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"Logging"});return e};n._getCodeBlocks=function(a,
b,c,e){var f=[];f.push({name:"Code",iconClass:"fa-code",items:[{name:"Call Method",owner:b,iconClass:"el-icon-video",proto:g,target:c,ctrArgs:{scope:a,group:e}},{name:"Run Script",owner:b,iconClass:"fa-code",proto:d,target:c,ctrArgs:{scope:a,group:e}},{name:"Run Block",owner:b,iconClass:"fa-code",proto:w,target:c,ctrArgs:{scope:a,group:e}}]});n.publish(k.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:f,group:"Code"});return f};n._getFlowBlocks=function(a,b,d,c){var e=[];e.push({name:"Flow",iconClass:"el-icon-random",
items:[{name:"If...Else",owner:b,iconClass:"el-icon-fork",proto:r,target:d,ctrArgs:{scope:a,group:c,condition:"[value]\x3d\x3d'PW'"}},{name:"Variable Switch",owner:b,iconClass:"el-icon-fork",proto:y,target:d,ctrArgs:{scope:a,group:c}}]});n.publish(k.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"Flow"});return e};n._getLoopBlocks=function(a,d,c,e){var f=[];f.push({name:"Loops",iconClass:"el-icon-repeat",items:[{name:"While",owner:d,iconClass:"el-icon-repeat",proto:l,target:c,ctrArgs:{scope:a,group:e,
condition:"[Volume]\x3c\x3d100"}},{name:"For",owner:d,iconClass:"el-icon-repeat",proto:b,target:c,ctrArgs:{scope:a,group:e,initial:"1",comparator:"\x3c\x3d","final":"5",modifier:"+1",counterName:"value"}}]});n.publish(k.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:f,group:"Loops"});return f};n._getMathBlocks=function(a,b,d,c){b=[];b.push({name:"Math",owner:this,iconClass:"el-icon-qrcode",dstItem:d,items:[{name:"If...Else",owner:d,iconClass:"el-icon-compass",proto:r,item:d,ctrArgs:{scope:a,group:c}}]});
return b};n._getTimeBlocks=function(a,b,d,c){b=[];b.push({name:"Time",owner:this,iconClass:"el-icon-qrcode",dstItem:d,items:[{name:"If...Else",owner:d,iconClass:"el-icon-time",proto:r,item:d,ctrArgs:{scope:a,group:c}}]});return b};n._getTransformBlocks=function(a,b,d,c){b=[];b.push({name:"Time",owner:this,iconClass:"el-icon-magic",dstItem:d,items:[{name:"If...Else",owner:d,iconClass:"el-icon-time",proto:r,item:d,ctrArgs:{scope:a,group:c}}]});return b};n.prepareBlockContructorArgs=function(a){a||(a=
{});a.id||(a.id=m.createUUID());a.items||(a.items=[])};n.createBlock=function(a,b,d){n.prepareBlockContructorArgs(b);a=n.createInstance(a,b,d);a.ctrArgs=null;var c;try{a&&a.init&&a.init();h.prototype.mergeFunctions(a,f.prototype);a.scope&&(c=a.scope.registerBlock(a));try{a.initReload&&a.initReload()}catch(e){debugger}}catch(g){logError(g,"create block")}return c||a};return n})},"xblox/model/logic/CaseBlock":function(){define(["dcl/dcl","xide/utils","xide/types","xblox/model/Block"],function(p,n,m,
k){return p(k,{declaredClass:"xblox.model.logic.CaseBlock",comparator:null,expression:null,items:null,name:"Case",icon:"",hasInlineEdits:!0,toText:function(){return'\x3cspan style\x3d"text-indent: 1em;"\x3e\x26nbsp;\x26nbsp;\x26nbsp;'+this.getBlockIcon("I")+this.name+" "+this.makeEditable("comparator","right","text","Enter a comparison","inline")+(null!=this.expression?" "+this.makeEditable("expression","right","text","Enter a value to compare"):"")+"\x3c/span\x3e"},canAdd:function(){return[]},solve:function(h,
f,a){try{var c=h.getVariableById(f.variable);f="";if(c)f=this._getArg(c.value,!0);else return this.onFailed(this,a),!1;if(!0===h.parseExpression(""+f+""+this.comparator+this._getArg(this.expression,!0)))return this.onSuccess(this,a),this._solve(h,a);this.onFailed(this,a);return!1}catch(e){console.error("case block crashed! ",e.stack),console.trace()}},getChildren:function(h){return this.items},getFields:function(){var h=this.inherited(arguments)||this.getDefaultFields();h.push(n.createCI("Expression",
13,this.expression,{group:"General",title:"Expression",dst:"expression"}));h.push(n.createCI("Comparator",13,this.comparator,{group:"General",title:"Comparator",dst:"comparator"}));console.log("fields",h);return h}})})},"xblox/model/functions/CallBlock":function(){define(["dcl/dcl","xide/utils","xide/types","xblox/model/Block"],function(p,n,m,k){return p([k],{declaredClass:"xblox.model.functions.CallBlock",command:"PowerStandby",icon:"",solve:function(h,f){if(this.command){var a=h.solveBlock(this.command,
f);if(a)this.onSuccess(this,f);else this.onFailed(this,f);return a}},toText:function(){var h="Unknown",f=this.scope.getBlock(this.command);f&&(h=f.name);-1!==this.command.indexOf("://")&&(h='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");return this.getBlockIcon("D")+"Call Command : "+h},getFields:function(){var h=this.inherited(arguments)||this.getDefaultFields();this.command.indexOf("://")&&this.scope.toFriendlyName(this,this.command);h.push(n.createCI("value",
"xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),block:this,pickerType:"command",value:this.command}));return h}})})},"xblox/model/code/CallMethod":function(){define(["dcl/dcl","xblox/model/Block","xide/utils"],function(p,n,m){return p(n,{declaredClass:"xblox.model.code.CallMethod",name:"Call Method",method:"",args:"",sharable:!0,solve:function(k,h){var f=this.getContext();if(f&&null!=f[this.method]){var a=[],c=f[this.method];
try{var e=this.getArgs(h);console.log("args",e);a=c.apply(f,e||[]);this.onSuccess(this,h);return a}catch(g){console.error("call method "+this.method+" failed: "+g),logError(g),this.onFailed(this,h)}}else this.onFailed(this,h);return[]},toText:function(){var k=this.getBlockIcon()+" "+this.name+" ";this.method&&(k+=this.makeEditable("method","bottom","text","Enter a driver method","inline"));return k},getFields:function(){var k=this.getDefaultFields();this.getContext();k.push(m.createCI("value",13,
this.method,{group:"General",title:"Method",dst:"method"}));k.push(m.createCI("value",27,this.args,{group:"Arguments",dst:"args",widget:{title:""}}));return k},getBlockIcon:function(){return'\x3cspan class\x3d"fa-caret-square-o-right"\x3e\x3c/span\x3e'}})})},"xblox/model/code/RunScript":function(){define("dcl/dcl dojo/_base/declare dojo/_base/lang dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains dojo/promise/all xide/types xdojo/has!xblox-ui?dojo/text!./RunScript.html".split(" "),function(p,
n,m,k,h,f,a,c,e,g){return p([h,a],{declaredClass:"xblox.model.code.RunScript",name:"Run Script",method:"",args:"",deferred:!1,sharable:!0,context:null,icon:"fa-code",observed:["method"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},__solve:function(a,b,c,e){this._currentIndex=0;this._return=[];var f=""+this._get("method"),g=this,h=this.getContext();if(f&&f.length){var k=function(){var a=new Function("{"+f+"}"),d=g.getArgs()||[];try{var k=a.apply(h,
d||{});g._lastResult=k;c&&c("Expression "+f+" evaluates to "+k);if("false"!==k&&!1!==k)g.onSuccess(g,b,{result:k});else return g.onFailed(g,b),[]}catch(m){return e&&e("invalid expression : \n"+f+": "+m),g.onFailed(g,b),[]}};if(a.global)(function(){window=a.global;var k=g.getArgs()||[];try{var m=null,m=h.runExpression?h.runExpression(f,null,k):(new Function("{"+f+"}")).bind(this).apply(h,k||{});g._lastResult=m;c&&c("Expression "+f+" evaluates to "+m);if("false"!==m&&!1!==m)g.onSuccess(g,b);else return g.onFailed(g,
b),[]}catch(n){return g._lastResult=null,e&&e("invalid expression : \n"+f+": "+n),g.onFailed(g,b),[]}}).call(a.global);else return k()}else console.error("have no script");k=this[this._getContainer()];if(k.length)this.runFrom(k,0,b);else this.onSuccess(this,b);this.onDidRun();return[]},solve:function(a,b,c,e,f){this._currentIndex=0;this._return=[];a=""+this._get("method");var g=this;c=this.getContext();var h=this[this._getContainer()],m=new k,n=g.deferred;this.onRunThis(b);var p=new Function("{"+
a+"}"),w=g.getArgs(b)||[];try{n&&(c.resolve=function(a){g._deferredObject&&g._deferredObject.resolve();g.onDidRunThis(m,a,h,b)});var C=p.apply(c,w||{});g._lastResult=C;e&&e("Expression "+a+" evaluates to "+C);if(!n)g.onDidRunThis(m,C,h,b);if("false"!==C&&!1!==C)g.onSuccess(g,b);else g.onFailed(g,b)}catch(A){A=A||{},g.onDidRunItemError(m,A,b),g.onFailed(g,b),f&&f("invalid expression : \n"+a+": "+A)}return m},toText:function(){var a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+" "+this.name+" :: \x3c/span\x3e";
this.method&&(a+=this.method.substr(0,50));return a},canAdd:function(){return[]},getFields:function(){"No Description"===this.description&&(this.description=g);var a=this.inherited(arguments)||this.getDefaultFields(),b=this;a.push(f.createCI("name",13,this.name,{group:"General",title:"Name",dst:"name"}));a.push(f.createCI("deferred",0,this.deferred,{group:"General",title:"Deferred",dst:"deferred"}));a.push(f.createCI("arguments",27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));a.push(f.createCI("value",
e.ECIType.EXPRESSION_EDITOR,this.method,{group:"Script",title:"Script",dst:"method",select:!0,widget:{allowACECache:!0,showBrowser:!1,showSaveButton:!0,editorOptions:{showGutter:!0,autoFocus:!1},item:this},delegate:{runExpression:function(a,d,c){b.method=a;b.solve(b.scope,null,d,c)}}}));return a}})})},"xblox/model/Contains":function(){define(["dcl/dcl","dojo/promise/all","xide/types"],function(p,n,m){return p(null,{declaredClass:"xblox.model.Contains",getContainer:function(){return this[this._getContainer()]},
mayHaveChildren:function(k){k=this[this._getContainer()];return null!=k&&0<k.length},getChildren:function(k){return this[this._getContainer()]},canAdd:function(){return[]},runFrom:function(k,h,f){var a=this,c=k||this.items;k=[];var e=function(d){d._deferredObject.then(function(b){console.log("----def block finish");d._lastResult=d._lastResult||b;a._currentIndex++;a.runFrom(c,a._currentIndex,f)})};if(c.length)for(;h<c.length;h++){var g=c[h];console.log("run child \n"+g.method);if(!0===g.deferred){g._deferredObject=
new Deferred;this._currentIndex=h;e(g);g=g.solve(this.scope,f);k.push(g);break}else g=g.solve(this.scope,f),k.push(g)}else this.onSuccess(this,f);return k},_solve:function(k,h,f,a){!this._lastRunSettings&&h&&(this._lastRunSettings=h);h=this._lastRunSettings||h;this._currentIndex=0;this._return=[];k=this[this._getContainer()];if(k.length)return k=this.runFrom(k,0,h),this.onSuccess(this,h),k;this.onSuccess(this,h);return[]},onDidRunItem:function(k,h,f){this._emit(m.EVENTS.ON_RUN_BLOCK_SUCCESS,this);
k.resolve(h)},onDidRunItemError:function(k,h,f){k.reject(h)},onRunThis:function(k){this._emit(m.EVENTS.ON_RUN_BLOCK,this)},onDidRunThis:function(k,h,f,a){var c=this;if(f.length)f=c.runFrom(f,0,a),n(f).then(function(e){console.log("all solved!",e);c.onDidRunItem(k,h,a)},function(e){console.error("error in chain",e);c.onDidRunItem(k,e,a)});else c.onDidRunItem(k,h,a)},___solve:function(k,h,f,a){}})})},"xblox/model/loops/ForBlock":function(){define("dcl/dcl xblox/model/Block xblox/model/variables/Variable xblox/model/Contains dojo/promise/all dojo/Deferred".split(" "),
function(p,n,m,k,h,f){return p([n,k],{declaredClass:"xblox.model.loops.ForBlock",initial:null,"final":null,comparator:null,modifier:null,items:null,counterName:null,_counter:null,name:"For",sharable:!0,icon:"",ignoreErrors:!1,runFrom:function(a,c,e){var g=this,d=a||this.items;a=[];var b=function(a){a._deferredObject.then(function(b){console.log("----def block finish");a._lastResult=a._lastResult||b;g._currentIndex++;g.runFrom(d,g._currentIndex,e)})};if(d.length)for(;c<d.length;c++){var h=d[c];if(!1!==
h.enabled)if(!0===h.deferred){h._deferredObject=new f;this._currentIndex=c;b(h);h=h.solve(this.scope,e);a.push(h);break}else h=h.solve(this.scope,e),a.push(h)}else this.onSuccess(this,e);return a},_currentForIndex:0,solveSubs:function(a,c,e,f){var d=this;f.override=f.override||{};f.override.args=[this._currentForIndex];if(e.length)return c=d.runFrom(e,0,f),h(c).then(function(a){},function(b){console.error("error in chain",b);d.onDidRunItem(a,b,f)}),c;d.onDidRunItem(a,c,f)},_solve:function(a,c){var e=
new f,g=this,d=this.solveSubs(e,null,this.items,c);h(d).then(function(a){a=a.indexOf(!1);!0!==g.ignoreErrors&&-1!==a?e.resolve(!1):e.resolve(!0)});return e},step:function(a,c){var e=this._checkCondition(a,c),g=new f;e&&this._solve(a,c).then(function(a){1==a?g.resolve(!0):g.resolve(!1)});return g},_forState:!1,loop:function(a,c){var e=this;this.step(a,c).then(function(f){e._updateCounter(a);e._currentForIndex=e._counter.value;if(1==f)e.loop(a,c);else e.onFailed(e,c)})},solve:function(a,c){this._counter=
new m({title:this.counterName,value:this.initial,scope:a,register:!1});this._forState=!0;this._currentForIndex=this.initial;this.loop(a,c);return[]},_checkCondition:function(a,c){var e=a.parseExpression(""+this._counter.value+this.comparator+this["final"]);if(0!=e)this.onSuccess(this,c);return this._forState=e},_updateCounter:function(a){var c=this._counter.value,c=a.parseExpression(""+c+this.modifier);if(c==this._counter.value)return!1;this._counter.value=c;return!0},mayHaveChildren:function(a){return null!=
this.items&&0<this.items.length},getChildren:function(a){a=[];this.items&&(a=a.concat(this.items));return a},canAdd:function(){return[]},toText:function(){return this.getBlockIcon("F")+this.name+" "+this.initial+" "+this.comparator+" "+this["final"]+" with "+this.modifier},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields();return a=a.concat([this.utils.createCI("initial",13,this.initial,{group:"General",title:"Initial",dst:"initial"}),this.utils.createCI("Final",13,this["final"],
{group:"General",title:"Final",dst:"final"}),this.utils.createCI("comparator",13,this.comparator,{group:"General",title:"Comparision",dst:"comparator"}),this.utils.createCI("modifier",13,this.modifier,{group:"General",title:"Modifier",dst:"modifier"}),this.utils.createCI("Abort on Error",0,this.ignoreErrors,{group:"General",title:"Ignore Errors",dst:"ignoreErrors"})])}})})},"xblox/model/loops/WhileBlock":function(){define(["dcl/dcl","xblox/model/Block","xblox/model/variables/Variable"],function(p,
n,m){return p(n,{declaredClass:"xblox.model.loops.WhileBlock",condition:null,items:null,loopLimit:200,name:"While",wait:0,_currentIndex:0,sharable:!0,icon:"",_timer:null,canAdd:function(){return[]},_solve:function(k,h){for(var f=0;f<this.items.length;f++)this.items[f].solve(k,h);return[]},doStep:function(k){if(this._currentIndex<this.loopLimit){var h=[];this._checkCondition(this.scope)?(this.onSuccess(this,k),this.addToEnd(h,this._solve(this.scope,k)),this._currentIndex++):(this._timer&&clearInterval(this._timer),
this.onFailed(this,k))}else console.error("--while block : reached loop limit"),this.reset()},reset:function(){this._timer&&(clearTimeout(this._timer),this._timer=null);this._currentIndex=0},solve:function(k,h){h=h||{};var f=0,a=this,c=this._getArg(this.wait);this.reset();if(0<c)return this._timer=setInterval(function(){a.doStep(h)},c),[];for(;this._checkCondition(k)&&f<this.loopLimit;)this._solve(k,h),f++;this.reset();return[]},toText:function(){return this.getBlockIcon("G")+this.name+" "+this.condition},
_checkCondition:function(k){return k.parseExpression(this.condition)},mayHaveChildren:function(k){return null!=this.items&&0<this.items.length},getChildren:function(k){k=[];this.items&&(k=k.concat(this.items));return k},getFields:function(){var k=this,h=this.inherited(arguments)||this.getDefaultFields();h.push(this.utils.createCI("condition",25,this.condition,{group:"General",title:"Expression",dst:"condition",delegate:{runExpression:function(f,a,c){return k.scope.expressionModel.parse(k.scope,f,
!1,a,c)}}}));h.push(this.utils.createCI("wait",13,this.wait,{group:"General",title:"Wait",dst:"wait"}));return h}})})},"xblox/model/variables/VariableAssignmentBlock":function(){define("dcl/dcl xblox/model/Block xide/utils xide/types dstore/legacy/DstoreAdapter xide/factory".split(" "),function(p,n,m,k,h,f){return p(n,{declaredClass:"xblox.model.variables.VariableAssignmentBlock",variable:null,value:null,name:"Set Variable",icon:"",toText:function(){var a=this.scope.getVariableById(this.variable),
a=a?a.name:"";-1!==this.variable.indexOf("://")&&(a='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.variable)+"\x3c/span\x3e");return this.getBlockIcon("C")+this.name+" "+a+" to "+this.value},solve:function(a,c){if(this.variable&&this.value){this.onRun(this,c);var e=-1!==this.variable.indexOf("://")?this.scope.resolveBlock(this.variable):a.getVariableById(this.variable),g=this._getArg(this.value);if(!e)return console.error("     no such variable : "+this.variable),[];this.isScript(g)?
(e.value=a.parseExpression(g),e.value=this.replaceAll("'","",e.value)):e.value=g;e.set("value",g);f.publish(k.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:e,scope:this.scope,save:!1,block:this,name:e.name,value:g});this.onSuccess(this,c);return[]}},canAdd:function(){return null},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields(!1),c=this;a.push(this.utils.createCI("value",29,this.value,{group:"General",title:"Value",dst:"value",widget:{allowACECache:!0,showBrowser:!1,showSaveButton:!0,
editorOptions:{showGutter:!1,autoSelect:!1,autoFocus:!1,hasConsole:!1,hasItemActions:function(){return!1}},item:this},delegate:{runExpression:function(a,f,d){return c.scope.expressionModel.parse(c.scope,a,!1,f,d)}}}));a.push(m.createCI("value","xcf.widgets.CommandPicker",this.variable,{group:"Variable",title:"Variable",dst:"variable",options:this.scope.getVariablesAsOptions(),block:this,pickerType:"variable",value:this.variable}));return a}})})},"dstore/legacy/DstoreAdapter":function(){define(["dojo/_base/declare",
"dojo/_base/array","dojo/store/util/QueryResults"],function(p,n,m){function k(f){return f}var h={store:null,constructor:function(f){this.store=f;if(f._getQuerierFactory("filter")||f._getQuerierFactory("sort"))this.queryEngine=function(a,e){e=e||{};var g=f._getQuerierFactory("filter"),d=g?g(a):k,g=f._getQuerierFactory("sort"),b=k;g&&(b=g(n.map(e.sort,function(a){return{property:a.attribute,descending:a.descending}})));var h=k;isNaN(e.start)&&isNaN(e.count)||(h=function(a){var b=e.start||0,b=a.slice(b,
b+(e.count||Infinity));b.total=a.length;return b});return function(a){return h(b(d(a)))}};var a=this;f.on("add,update,delete",function(c){var e=c.type,g=c.target;a.notify("add"===e||"update"===e?g:void 0,"delete"===e||"update"===e?"id"in c?c.id:f.getIdentity(g):void 0)})},labelAttr:"title",getLabel:function(f){return this.store.getLabel(f)},query:function(f,a){a=a||{};var c=this.store.filter(f),e,g,d;if(d=a.sort)if("[object Array]"===Object.prototype.toString.call(d))for(var b;b=d.pop();)c=c.sort(b.attribute,
b.descending);else c=c.sort(d);c.track&&!c.tracking&&(c=c.track(),g=!0);"start"in a&&(e=a.start||0,e=c[c.fetchRangeSync?"fetchRangeSync":"fetchRange"]({start:e,end:a.count?e+a.count:Infinity}));e=e||c[c.fetchSync?"fetchSync":"fetch"]();d=e.totalLength;e=new m(e);e.total=d;e.observe=function(a,b){function d(a){return void 0===a&&g?-1:a}var e=c.on("add",function(b){a(b.target,-1,d(b.index))}),f=c.on("update",function(c){!b&&c.previousIndex===c.index&&isFinite(c.index)||a(c.target,d(c.previousIndex),
d(c.index))}),h=c.on("delete",function(b){a(b.target,d(b.previousIndex),-1)}),k={remove:function(){e.remove();f.remove();h.remove()}};k.cancel=k.remove;return k};return e},notify:function(){}};n.forEach(["get","put","add","remove","getIdentity"],function(f){h[f]=function(){var a=this.store;return(a[f+"Sync"]||a[f]).apply(a,arguments)}});return p(null,h)})},"xblox/model/logic/IfBlock":function(){define(["dcl/dcl","xblox/model/Block","xblox/model/Statement"],function(p,n,m){return p([n],{declaredClass:"xblox.model.logic.IfBlock",
condition:"Invalid Expression",consequent:null,elseIfBlocks:null,alternate:null,canAdd:function(){return[]},autoCreateElse:!0,name:"if",icon:"",add:function(k,h,f){null==f&&(f="consequent");return this._add(k,h,f)},addToStore:function(k){k.put(this)},mayHaveChildren:function(k){return null!=this.consequent&&0<this.consequent.length},getChildren:function(k){console.log("grt children",this);k=[];this.consequent&&(k=k.concat(this.consequent));return k},toText:function(){return"\x3cspan class\x3d'text-primary'\x3e"+
this.getBlockIcon("E")+this.name+" \x3c/span\x3e\x3cspan class\x3d'text-warning small'\x3e"+this.toFriendlyName(this.condition)+"\x3cspan\x3e"},_checkCondition:function(k){return k.parseExpression(this.condition+";",null,null)},solve:function(k,h){var f=this._checkCondition(k);if(1==f||0<f){this.onSuccess(this,h);f=null;console.log("run subs");if(this.consequent&&this.consequent.length)for(var a=0;a<this.consequent.length;a++)f=this.consequent[a].solve(k,h);return f}this.onFailed(this,h);if(this.elseIfBlocks)for(f=
0;f<this.elseIfBlocks.length;f++)if("xblox.model.logic.ElseIfBlock"==this.elseIfBlocks[f].declaredClass&&this.elseIfBlocks[f]._checkCondition(k))return this.elseIfBlocks[f].consequent.solve(k,h);if(this.alternate&&0<this.alternate.length){f=null;for(a=0;a<this.alternate.length;a++)f=this.alternate[a].solve(k,h);return f}return[]},empty:function(k){this._empty(this.alternate);this._empty(this.consequent);this._empty(this.items)},removeBlock:function(k){k&&(k&&k.empty&&k.empty(),delete k.items,k.parent=
null,this.alternate.remove(k),this.consequent.remove(k))},_getContainer:function(k){return-1!=this.consequent.indexOf(k)?"consequent":-1!=this.alternate.indexOf(k)?"alternate":"_"},init:function(){this.alternate=this.alternate||[];this.consequent=this.consequent||[];for(var k=0;k<this.alternate.length;k++)this.alternate[k].parentId=this.id,this.alternate[k].parent=this;for(k=0;k<this.consequent.length;k++)this.consequent[k].parentId=this.id,this.consequent[k].parent=this},getFields:function(){var k=
this,h=this.inherited(arguments)||this.getDefaultFields();h.push(this.utils.createCI("condition",this.types.ECIType.EXPRESSION,this.condition,{group:"General",title:"Expression",dst:"condition",delegate:{runExpression:function(f,a,c){return k.scope.expressionModel.parse(k.scope,f,!1,a,c)}}}));return h},postCreate:function(){},_toPHP:function(k){},_toJavascript:function(k){},toCode:function(k,h){switch(k){case "Javascript":return this._toJavascript();case "PHP":return this._toPHP()}}})})},"xblox/model/Statement":function(){define(["dojo/_base/declare",
"./Block"],function(p,n){return p("xblox.model.Statement",[n],{toText:function(){return this.name},getChildren:function(){return this.items}})})},"xblox/model/logic/ElseIfBlock":function(){define(["dojo/_base/declare","xblox/model/Block"],function(p,n){return p("xblox.model.logic.ElseIfBlock",[n],{condition:null,consequent:null,mayHaveChildren:function(){return null!=this.consequent},getChildren:function(m){m=[];this.consequent&&m.push(this.consequent);return m},name:"else if",toText:function(){return this.name+
" "+this.condition},_checkCondition:function(m){return m.parseExpression(this.condition)}})})},"xblox/model/logic/SwitchBlock":function(){define(["dcl/dcl","xblox/model/Block","xblox/model/logic/CaseBlock"],function(p,n,m){return p(n,{declaredClass:"xblox.model.logic.SwitchBlock",variable:"PowerState",items:null,name:"Switch",toText:function(){return this.getBlockIcon("H")+this.name+" "+this.variable},canAdd:function(){return[]},solve:function(k,h){var f=!1,a=[];this.onSuccess(this,h);for(var c=0;c<
this.items.length;c++){var e=this.items[c];if("xblox.model.logic.CaseBlock"===e.declaredClass&&(e=e.solve(k,this,h),0!=e)){f=!0;this.addToEnd(a,e);break}}if(!f)for(c=0;c<this.items.length;c++)e=this.items[c],"xblox.model.logic.CaseBlock"!=e.declaredClass&&this.addToEnd(a,e.solve(k));return a},init:function(){},getChildren:function(k){return this.items},postCreate:function(){this.add(m,{comparator:"\x3d\x3d",expression:"'ON'",group:null});this.add(m,{comparator:"\x3d\x3d",expression:"'Standby'",group:null})}})})},
"xblox/model/variables/VariableSwitch":function(){define(["dcl/dcl","xblox/model/logic/SwitchBlock","xide/types","xblox/model/logic/CaseBlock","dojo/Deferred"],function(p,n,m,k,h){return p(n,{declaredClass:"xblox.model.variables.VariableSwitch",name:"Switch on Variable",icon:"",toText:function(){var f=this.scope.getVariableById(this.variable),f=f?f.name:"";return this.getBlockIcon("H")+this.name+" "+f},getFields:function(){var f=this.inherited(arguments)||this.getDefaultFields();return f=f.concat([this.utils.createCI("Variable",
3,this.variable,{group:"General",widget:{store:this.scope.blockStore,labelField:"name",valueField:"id",query:{group:"basicVariables"}},dst:"variable"})])},runAction:function(f){if("New/Case"===f.command){f=new h;var a=this.add(k,{comparator:"\x3d\x3d",expression:"'ON'",group:null});f.resolve({select:[a],focus:!0,append:!1});a.refresh();return f}},getActions:function(){return[this.createAction({label:"New Case",command:"New/Case",icon:this.getBlockIcon("I"),tab:"Home",group:"File",mixin:{addPermission:!0,
custom:!0}})]}})})},"xblox/model/logging/Log":function(){define("dcl/dcl dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin".split(" "),function(p,n,m,k,h,f){return p([m,f.dcl],{declaredClass:"xblox.model.logging.Log",name:"Log Message",level:"info",message:"",_type:"XBlox",host:"this host",sharable:!0,toText:function(){var a="text-primary";switch(this.level){case "info":a="text-info";break;case "warn":a="text-warning";break;case "error":a="text-danger"}a=this.getBlockIcon()+
" "+this.name+" : \x3cspan class\x3d'"+a+" small'\x3e  :: ";this.message&&(a+=this.message);return a+"\x3c/span\x3e"},_solveExpression:function(a,c,e,f,d){if((a=""+a)&&a.length){c=new Function("{"+a+"}");e=this.getArgs();try{var b=c.apply(this,e||{});f&&f("Expression "+a+" evaluates to "+b);return b}catch(h){d&&d("invalid expression : \n"+a+": "+h)}}else console.error("have no script");return a},solve:function(a,c,e,f){var d=new n,b=a.device;a=this._solveExpression(this.message,a,c,e,f);b={message:a,
level:this.level,type:this._type,details:this.getArgs(),time:(new Date).getTime(),data:{device:b?b.info:null},write:!0};this.onSuccess(this,c);d.resolve(a);try{this.publish(h.EVENTS.ON_SERVER_LOG_MESSAGE,b)}catch(k){this.onFailed(this,c)}return d},canAdd:function(){return null},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields(),c=this;a.push(k.createCI("Level",3,this.level,{group:"General",options:[{value:"info",label:"Info"},{value:"warn",label:"Warning"},{value:"error",
label:"Error"},{value:"debug",label:"Debug"},{value:"help",label:"Help"},{value:"verbose",label:"verbose"},{value:"silly",label:"Silly"}],dst:"level"}));a.push(k.createCI("message",25,this.message,{group:"General",title:"Message",dst:"message",delegate:{runExpression:function(a,f,d){c._solveExpression(a,c.scope,null,f,d)}}}));a.push(k.createCI("message",13,this._type,{group:"General",title:"Type",dst:"_type"}));return a},getBlockIcon:function(){return'\x3cspan class\x3d"fa-bug"\x3e\x3c/span\x3e'}})})},
"xblox/model/server/RunServerMethod":function(){define(["dojo/_base/declare","xblox/model/server/ServerBlock","xide/utils"],function(p,n,m){return p("xblox.model.server.RunServerMethod",[n],{description:"Runs a JSON-RPC-2.0 method on the server",name:"Run Server Method",method:"XShell::run",args:"",deferred:!0,defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:!0,onMethodChanged:function(k,h){this.method=k;if(!m.isValidString(this.args)){var f=this.getServerParams();f&&this._updateArgs(f,
h)}},_getArgs:function(){var k=m.getJson(this.args||"[]"),h=[];if(k){var f=!1;k&&k[0]&&null!=k[0].optional&&(f=!0);if(f)for(f=0;f<k.length;f++){var a=k[f],c=a.value;-1!=a.name.indexOf("Base64")&&(c=this.getService().base64_encode(c));"notset"!==a.value?-1!=a.value.indexOf("[")&&-1!=a.value.indexOf("]")?(c=this.scope.expressionModel.replaceVariables(this.scope,a.value,!1,!1),-1!=a.name.indexOf("Base64")&&(c=this.getService().base64_encode(c)),h.push(c)):h.push(c||a["default"]):h.push(a["default"]||
c)}}else return[this.args];return h},_updateArgs:function(k,h){var f=this.utils.getCIWidgetByName(h,"args");if(f){var a=JSON.stringify(k);f.editBox.set("value",a);this.args=a}},getServerParams:function(){var k=this.getService().getParameterMap(this.getServiceClass(),this.getServiceMethod());if(k)for(var h=0;h<k.length;h++)k[h].value="notset";return k},onReloaded:function(k){console.log("sdfsd");this._solve()},_solve:function(k,h,f,a){console.log("solve223")},solve:function(k,h,f,a){this._return=[];
this._lastResult=null;k=[];if(!this.isInValidState())return this.onFailed(this,h),k;k=this._getArgs();this.onRun(this,h);this.getService();h=this.scope.serviceObject;console.error("run deferred");(h=h.runDeferred(this.getServiceClass(),this.getServiceMethod(),k))&&h.then(function(a){console.error("returned ",a)});return h},toText:function(){var k=this.getBlockIcon()+" "+this.name+" :: ";this.method&&(k+=this.method.substr(0,50));return k},canAdd:function(){return[]},getFields:function(){var k=this.getDefaultFields(),
h=this;k.push(this.utils.createCI("value",25,this.method,{group:"General",title:"Method",dst:"method",description:"This should be in the format : MyServerClass::myMethod",delegate:{runExpression:function(f,a,c){h.method=f;h.solve(h.scope,null,a,c)}}}));return k=k.concat(this.getServerDefaultFields())},getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(k){return null!=this.items&&0<this.items.length},getChildren:function(k){return this.items},onChangeField:function(k,
h,f){if("method"===k)this.onMethodChanged(h,f)},isInValidState:function(){return null!=this.getService()},getService:function(){var k=this.scope.getService();k||console.error("have no service object");return k},getServiceClass:function(){return this.method.split("::")[0]||this.defaultServiceClass},getServiceMethod:function(){return this.method.split("::")[1]||this.defaultServiceMethod},hasMethod:function(k){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]&&null!=this.getService()[this.getServiceClass()][this.getServiceMethod()]},
hasServerClass:function(k){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]},getServerFunction:function(){return this.isInValidState()&&this.getServiceClass()&&this.getServiceMethod()?this.getService()[this.getServiceClass()][this.getServiceMethod()]:null}})})},"xblox/model/server/ServerBlock":function(){define(["dcl/dcl","xblox/model/Block"],function(p,n){return p(n,{declaredClass:"xblox.model.server.ServerBlock",name:"Run Server Block",method:"XShell::run",args:"",deferred:!0,
defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:!0,onReloaded:function(){console.log("1")},solve:function(m,k,h,f){this._currentIndex=0;this._return=[];if((m=""+this.method)&&m.length){var a=new Function("{"+m+"}"),c=this.getArgs();try{var e=a.apply(this,c||{});this._lastResult=e;h&&h("Expression "+m+" evaluates to "+e);if("false"!==e&&!1!==e)this.onSuccess(this,k);else return this.onFailed(this,k),[]}catch(g){return f&&f("invalid expression : \n"+m+": "+g),this.onFailed(this,k),
[]}}else console.error("have no script");h=this[this._getContainer()];if(h.length)this.runFrom(h,0,k);else this.onSuccess(this,k);return[]},toText:function(){var m=this.getBlockIcon()+" "+this.name+" :: ";this.method&&(m+=this.method.substr(0,50));return m},canAdd:function(){return[]},getServerDefaultFields:function(m){m=m||[];m.push(this.utils.createCI("args",27,this.args,{group:"General",title:"Arguments",dst:"args"}));return m},getFields:function(){return this.inherited(arguments)||this.getDefaultFields()},
getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(m){return null!=this.items&&0<this.items.length},getChildren:function(m){return this.items},isInValidState:function(){return null!=this.getService()},getService:function(){return this.scope.getService()},getServiceClass:function(){return this.method.split("::")[0]||this.defaultServiceClass},getServiceMethod:function(){return this.method.split("::")[1]||this.defaultServiceMethod},hasMethod:function(m){return this.isInValidState()&&
null!=this.getService()[this.getServiceClass()]&&null!=this.getService()[this.getServiceClass()][this.getServiceMethod()]},hasServerClass:function(m){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]},getServerFunction:function(){return this.isInValidState()&&this.getServiceClass()&&this.getServiceMethod()?this.getService()[this.getServiceClass()][this.getServiceMethod()]:null}})})},"xblox/model/code/RunBlock":function(){define(["dcl/dcl","xblox/model/Block","xide/types",
"xide/utils"],function(p,n,m,k){return p(n,{declaredClass:"xblox.model.code.RunBlock",name:"Run Block",file:"",method:"",args:"",sharable:!0,block:"",description:"Runs another Block",solve:function(h,f){var a=this.getContext();if(a&&null!=a[this.method]){var c=[],e=a[this.method];try{var g=this._getArgs(),c=e.apply(a,g||[]);this.onSuccess(this,f);return c}catch(d){console.error("call method failed"),this.onFailed(this,f)}}else this.onFailed(this,f);return[]},toText:function(){var h=this.getBlockIcon()+
" "+this.name+" ";this.method&&(h+=this.method.substr(0,20));return h},getFields:function(){var h=this.getDefaultFields();h.push(k.createCI("Block",m.ECIType.BLOCK_REFERENCE,this.block,{toolTip:"Enter  block, you can use also the block's share title",group:"General",dst:"block",value:this.block,title:"Block",scope:this.scope}));h.push(k.createCI("File",m.ECIType.FILE,this.file,{toolTip:"Leave empty to auto-select this file",group:"General",dst:"file",value:this.file,intermediateChanges:!1,acceptFolders:!1,
acceptFiles:!0,encodeFilePath:!1,buildFullPath:!0,filePickerOptions:{dialogTitle:"Select Block File",filePickerMixin:{beanContextName:this.id,persistent:!1,globalPanelMixin:{allowLayoutCookies:!1}},configMixin:{beanContextName:this.id,LAYOUT_PRESET:m.LAYOUT_PRESET.SINGLE,PANEL_OPTIONS:{ALLOW_MAIN_MENU:!1,ALLOW_NEW_TABS:!0,ALLOW_MULTI_TAB:!1,ALLOW_INFO_VIEW:!0,ALLOW_LOG_VIEW:!1,ALLOW_CONTEXT_MENU:!0,ALLOW_LAYOUT_SELECTOR:!0,ALLOW_SOURCE_SELECTOR:!0,ALLOW_COLUMN_RESIZE:!0,ALLOW_COLUMN_REORDER:!0,ALLOW_COLUMN_HIDE:!0,
ALLOW_ACTION_TOOLBAR:!0,ALLOW_BREADCRUMBS:!1}},defaultStoreOptions:{fields:1663,includeList:"xblox",excludeList:"*"},startPath:this.file}}));return h},getBlockIcon:function(){return'\x3cspan class\x3d"el-icon-share-alt"\x3e\x3c/span\x3e'}})})},"xblox/model/events/OnEvent":function(){define("dcl/dcl dojo/_base/lang dojo/_base/array dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Referenced xide/registry dojo/on".split(" "),function(p,n,m,k,h,f,a,c,e,g,d){return p([h,
c.dcl,e.dcl],{declaredClass:"xblox.model.events.OnEvent",name:"On Event",event:"",reference:"",references:null,sharable:!0,_nativeEvents:"onclick ondblclick onmousedown onmouseup onmouseover onmousemove onmouseout onkeypress onkeydown onkeyup onfocus onblur onchange".split(" "),solve:function(a,d,c,e){!this._lastRunSettings&&d&&(this._lastRunSettings=d);d=this._lastRunSettings||d;this._currentIndex=0;this._return=[];a=this[this._getContainer()];if(a.length)return a=this.runFrom(a,0,d),this.onSuccess(this,
d),a;this.onSuccess(this,d);return[]},toText:function(){var a=this.getBlockIcon()+" "+this.name+" :: ";this.event&&(a+=this.event);return a},canAdd:function(){return[]},getFields:function(){var b=this.inherited(arguments)||this.getDefaultFields();this.deserialize(this.reference);var d=null;if(-1<f.contains(this._nativeEvents,this.event))for(var d=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},
{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],c=0;c<d.length;c++){var e=d[c];if(e.value===this.event){e.selected=!0;break}}else d=this.scope.getEventsAsOptions(this.event);b.push(f.createCI("Event",a.ECIType.ENUMERATION,
this.event,{group:"General",options:d,dst:"event",widget:{search:!0}}));b.push(f.createCI("Object/Widget",a.ECIType.WIDGET_REFERENCE,this.reference,{group:"General",dst:"reference",value:this.reference}));return b},getBlockIcon:function(){return'\x3cspan class\x3d"fa-bell"\x3e\x3c/span\x3e'},mayHaveChildren:function(a){return null!=this.items&&0<this.items.length},getChildren:function(a){return this.items},onEvent:function(a){this._lastResult=a;this.solve(this.scope,this._lastRunSettings)},_subscribe:function(a,
c,e){if(a)if(-1==f.contains(this._nativeEvents,a))this.subscribe(a,this.onEvent,e);else if(e){a=a.replace("on","");var g=this;e=d(e,a,function(a){g.onEvent(a)});console.log("wire native event : "+a);this._events.push(e)}},_registerEvent:function(a){if(a&&a.length){console.log("register event : "+a+" for "+this.reference);var d=this.resolveReference(this.deserialize(this.reference)),c=this;if(d&&d.length){for(var e=0;e<d.length;e++){var f=d[e];if(f&&f.id){var h=g.byId(f.id);if(h&&h.on){var k=this.event.replace("on",
"");console.log("found widget : "+f.id+" will register event "+k);f=h.on(k,n.hitch(this,function(a){console.log("event triggered : "+c.event);c.onEvent(a)}));this._events.push(f)}else this._subscribe(a,this.onEvent,f)}else this._subscribe(a,this.onEvent,f)}console.log("objects found : ",d)}else this._subscribe(a,this.onEvent)}},onLoad:function(){this._onLoaded=!0;this.event&&this.event.length&&this.enabled&&this._registerEvent(this.event)},destroy:function(){this.inherited(arguments)},updateEventSelector:function(b,
d){var c=[];if(b&&b.length)for(var c=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",
value:"onchange"}],e=0;e<c.length;e++){var f=c[e];if(f.value===this.event){f.selected=!0;break}}else c=this.scope.getEventsAsOptions(this.event);for(e=0;e<d.length;e++)if(f=d[e],f.widget&&"Event"===f.widget.title){e=f._widget;e.nativeWidget.set("options",c);e.nativeWidget.reset();e.nativeWidget.set("value",this.event);this.publish(a.EVENTS.RESIZE,{});break}},onReferenceChanged:function(a,d){this._destroy();this.reference=a;var c=this.resolveReference(this.deserialize(a));this.updateEventSelector(c,
d);this._registerEvent(this.event)},onChangeField:function(a,d,c){"event"==a&&(this._destroy(),this._onLoaded&&(this.event=d,this._registerEvent(d)));if("reference"==a)this.onReferenceChanged(d,c);this.inherited(arguments)},activate:function(){this._destroy();this._registerEvent(this.event)},deactivate:function(){this._destroy()},_destroy:function(){this._events||(this._events=[]);m.forEach(this._events,dojo.unsubscribe);this._lastResult=null;this._events=[]}})})},"xblox/model/Referenced":function(){define(["dcl/dcl",
"xdojo/declare","xide/mixins/ReferenceMixin"],function(p,n,m){var k={reference:null,deserialize:function(h){if(!h||0==h.length)return{};try{return dojo.fromJson(h)}catch(f){return{}}}};n=n("xblox.model.Referenced",[m],k);n.dcl=p(m.dcl,k);return n})},"xide/mixins/ReferenceMixin":function(){define(["dcl/dcl","xdojo/declare","xide/types","xide/utils","xide/registry"],function(p,n,m,k,h){var f={_targetReference:null,getTarget:function(){return this._targetReference||this.inherited(arguments)},skipWidgetCSSClasses:"dijitButtonHover dijitHover dijit dijitInline dijitReset dijitCheckBoxChecked dijitChecked dijitLeft".split(" "),
_cssClassesToQuery:function(a){var c="";if(a){a=a.split(" ");for(var e=0;e<a.length;e++)-1<k.contains(this.skipWidgetCSSClasses,a[e])||-1<a[e].toLowerCase().indexOf("hover")||(c+="."+a[e])}return c.trim()},resolveReference:function(a){var c=this.getTarget(),e=this;if(!(a&&a.reference&&a.reference.length)&&c)return[c];switch(a.mode){case m.WIDGET_REFERENCE_MODE.BY_ID:if(this.scope&&this.scope.document){var c=function(a){return(a=e.scope.document.getElementById(a))?a:null},f=[],d=a.reference;if(-1!==
d.indexOf(" "))for(d=d.split(" "),a=0;a<d.length;a++){var b=c(d[a]);b&&f.push(b)}else return[c(a.reference)];return f}return[h.byId(a.reference)];case m.WIDGET_REFERENCE_MODE.BY_CLASS:if(c=dojo.getObject(a.reference)||p.getObject(a.reference))return[c];break;case m.WIDGET_REFERENCE_MODE.BY_CSS:if(d=this._cssClassesToQuery(a.reference),this.scope&&this.scope.global&&(c=this.scope.global.$)&&(c=c(d))||(c=k.find(d,null,!1)))return c}return null}};n=n("xblox.model.ReferenceMixin",null,f);n.dcl=p(null,
f);return n})},"xblox/model/events/OnKey":function(){define("dcl/dcl dojo/_base/lang dojo/_base/array dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Referenced xblox/model/Contains xblox/model/events/OnEvent xide/registry dojo/on".split(" "),function(p,n,m,k,h,f,a,c,e,g,d,b,l){return p([h,c.dcl,e.dcl,g],{declaredClass:"xblox.model.events.OnKey",name:"On Key",event:"",reference:"",references:null,description:"Triggers when a keyboard sequence "+this.event+
" has been entered",listeners:null,sharable:!0,toText:function(){var a=this.getBlockIcon()+" "+this.name+" :: ";this.event&&(a+=this.event);return a},canAdd:function(){return[]},getFields:function(){var b=this.inherited(arguments)||this.getDefaultFields();b.push(f.createCI("Keyboard Sequence",a.ECIType.STRING,this.event,{group:"General",dst:"event",value:this.event,intermediateChanges:!1}));b.push(f.createCI("Object/Widget",a.ECIType.WIDGET_REFERENCE,this.reference,{group:"General",dst:"reference",
value:this.reference}));return b},getBlockIcon:function(){return'\x3cspan class\x3d"fa-keyboard-o"\x3e\x3c/span\x3e'},onEvent:function(a){this._lastResult=a;this.solve(this.scope,this._lastRunSettings)},_addListerner:function(a,b,d){null==this.listeners&&(this.listeners=[]);var c=null,c=new window.keypress.Listener(d,{is_unordered:!0,prevent_repeat:!1,prevent_default:!1,on_keyup:function(a){console.log("up")},on_keydown:function(a){console.log("down")},on_release:function(a){console.log("release")}});
c.simple_combo(a,function(a){b&&b(arguments)});this.listeners.push(c)},_subscribe:function(a,b,d){a&&(d&&d.domNode&&(d=d.domNode),this._addListerner(a,b,d))},_registerEvent:function(a){if(a&&a.length){var d=this.resolveReference(this.deserialize(this.reference)),c=this;if(d&&d.length)for(var e=0;e<d.length;e++){var f=d[e];if(f&&f.id){var g=b.byId(f.id);g=null,this._subscribe(a,function(){c.onEvent(arguments)},f)}else this._subscribe(a,function(){c.onEvent(arguments)},f)}else this._subscribe(a,function(){c.onEvent(arguments)})}},
onLoad:function(){this._onLoaded=!0;this.event&&this.event.length&&this.enabled&&this._registerEvent(this.event)},destroy:function(){this.inherited(arguments)},updateEventSelector:function(b,d){var c=[];if(b&&b.length)for(var c=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},
{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],e=0;e<c.length;e++){var f=c[e];if(f.value===this.event){f.selected=!0;break}}else c=this.scope.getEventsAsOptions(this.event);for(e=0;e<d.length;e++)if(f=d[e],f.widget&&"Event"===f.widget.title){e=f._widget;e.nativeWidget.set("options",c);e.nativeWidget.reset();e.nativeWidget.set("value",
this.event);this.publish(a.EVENTS.RESIZE,{});break}},onReferenceChanged:function(a,b){this._destroy();this.reference=a;this.resolveReference(this.deserialize(a));this._registerEvent(this.event)},onChangeField:function(a,b,d){"event"==a&&(this._destroy(),this._onLoaded&&(this.event=b,this._registerEvent(b)));if("reference"==a)this.onReferenceChanged(b,d);this.inherited(arguments)},activate:function(){this._destroy();this._registerEvent(this.event)},deactivate:function(){this._destroy()},_destroy:function(){if(this.listeners)for(var a=
0;a<this.listeners.length;a++){var b=this.listeners[a];b.stop_listening();var d=b.get_registered_combos();d&&b.unregister_many(d);b.reset();console.log("did destroy listener")}this.listeners=[]},onFieldsRendered:function(a,b){}})})},"xblox/model/html/SetStyle":function(){define("xdojo/declare xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Referenced dojo/dom-attr dojo/dom-style dojo/_base/Color".split(" "),function(p,n,m,k,h,f,a,c,e){var g={name:"Set Style",reference:"",
references:null,description:"Sets HTML Node Style Attribute",value:"",mode:1,sharable:!0,solve:function(a,b){var c=this.value;this.override&&this.override.variables&&(c=m.replace(c,null,this.override.variables,{begin:"{",end:"}"}));this.updateObjects(null,c,this.mode);this.onSuccess(this,b);this.onDidRun()},toText:function(){var a=this.deserialize(this.reference),a=this.getBlockIcon()+" "+this.name+" :: on "+a.reference+" to"||"  to ";this.value&&(a+=" "+this.value);return a},getFields:function(){var a=
this.inherited(arguments)||this.getDefaultFields();a.push(m.createCI("Value",k.ECIType.DOM_PROPERTIES,this.value,{group:"General",dst:"value",value:this.value,intermediateChanges:!1}));a.push(m.createCI("Mode",k.ECIType.ENUMERATION,this.mode,{group:"General",options:[m.createOption("Set",1),m.createOption("Add",2),m.createOption("Remove",3),m.createOption("Increase",4),m.createOption("Decrease",5)],dst:"mode"}));var b={group:"General",dst:"reference",value:this.reference};this.scope&&(this.scope.global&&
(b.window=this.scope.global,b.allowHTMLNodes=!0,b.allowWidgets=!1),this.scope.document&&(b.document=this.scope.document));a.push(m.createCI("Target",k.ECIType.WIDGET_REFERENCE,this.reference,b));return a},getBlockIcon:function(){return'\x3cspan class\x3d"fa-paint-brush"\x3e\x3c/span\x3e'},destroy:function(){this.inherited(arguments)},updateEventSelector:function(a,b){var c=[];if(a&&a.length)for(var c=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},
{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],e=0;e<c.length;e++){var f=c[e];if(f.value===this.event){f.selected=!0;break}}else c=this.scope.getEventsAsOptions(this.event);
for(e=0;e<b.length;e++)if(f=b[e],f.widget&&"Event"===f.widget.title){e=f._widget;e.nativeWidget.set("options",c);e.nativeWidget.reset();e.nativeWidget.set("value",this.event);this.publish(k.EVENTS.RESIZE,{});break}},onReferenceChanged:function(a,b){this.reference=a;this.references=this.resolveReference(this.deserialize(a));this.updateObjects(this.references,this.value)},getPropValue:function(a,b){for(var c in a)if(c===b)return a[c];return null},_getStyle:function(a,b,c){switch(a){case "height":return c.outerHeight();
case "width":return c.outerWidth();case "color":return c.css("color");case "border-color":return c.css("border-color")||"rgba(0,0,0,0)"}return null},updateObject:function(d,b,f){if(!d)return!1;f=f||1;null!=d.domNode&&(d=d.domNode);var g=a.get(d,"style");";"===g&&(g="");""===g&&(g=null!=d.lastStyle?d.lastStyle:b);";"===g&&(g=b);switch(f){case 1:var h=this._toObject(g);b=b.split(";");for(g=0;g<b.length;g++)f=b[g].split(":"),2==f.length&&(h[f[0]]=f[1]);var g=[],k;for(k in h)g.push(k+":"+h[k]);$(d).attr("style",
g.join(";"));break;case 2:b=_.uniq((g+";"+b).split(";")).join(";");a.set(d,"style",b);break;case 3:a.set(d,"style",m.replaceAll(b,"",g));break;case 4:case 5:k=new RegExp(/(\D*)(-?)(\d+)(\D*)/);f=this._toObject(b);var n={},p=$(d);if(f)for(h in f)g=this._getStyle(h,d,p),n[h]=g;p={};for(h in f){var v=""+h.trim();if(null!=n[v]){var u=f[h],w=n[h],C=-1!=u.indexOf("#"),A=-1!=u.indexOf("rgb"),D=-1!=u.indexOf("rgba");if(C||A||D){var E=dojo.colorFromString(u),v=dojo.colorFromString(u),z=dojo.colorFromString(w),
B=new e;_.each(["r","g","b","a"],function(a){B[a]=Math.min(z[a]+E[a],"a"==a?1:255)});console.log("color computed "+z.toRgba()+" color requested: "+v.toRgba()+" | multiplicator color \x3d "+E.toRgba()+" is then \x3d "+B.toRgba());w="";C?w=B.toHex():A?w=B.toCss(!1):D&&(w=B.toCss(!0));p[h]=w;c.set(d,h,w)}else(C=k.exec(n[v]))&&3<=C.length&&parseInt(C[3])}}g=this._toObject(g);this._toObject(b);if(!g)return!1;for(h in g)v=""+h.trim();this._toStyleString(p)}},onDomStyleChanged:function(a,b,c){if(a=a||this.resolveReference(this.deserialize(this.reference))){console.log("change dom style to "+
b+" on "+a.length+" objects");for(var e=0;e<a.length;e++){var f=a[e];f&&f.id&&-1!=f.id.indexOf("davinci")||this.updateObject(f,b,c)}}else console.log("have no objects")},updateObjects:function(a,b,c){a=a||this.resolveReference(this.deserialize(this.reference));this.onDomStyleChanged(a,b,c)},onChangeField:function(a,b,c){this._destroy();"mode"==a&&b!==this.mode&&(this.mode=b);"value"==a&&b!==this.value&&(this.onDomStyleChanged(null,b,this.mode),this.value=b);if("reference"==a)this.onReferenceChanged(b,
c);this.inherited(arguments)},activate:function(){this._destroy()},deactivate:function(){this._destroy()},_destroy:function(){},_changeValue:function(a,b){if(!a)return"";for(var c=a.split(" "),e="",f=0;f<c.length;f++){0<f&&(e+=" ");var g=c[f].match(/([-\d\.]+)([a-zA-Z%]*)/);if(g)if(1==g.length)e+=g[0];else for(var h=1;h<g.length;h++)e=isNaN(g[h])||""==g[h]?e+g[h]:e+(parseFloat(g[h])+b);else e+=c[f]}return e},_toObject:function(a){if(!a)return{};var b={};a=a.split(";");for(var c=0;c<a.length;c++){var e=
a[c];e&&0!=e.length&&e.split&&(e=e.split(":"))&&e.length&&(b[e[0]]=e[1])}return b},_toStyleString:function(a){var b=[],c;for(c in a)b.push(c+":"+a[c]);return b.join(";")+";"}};p=p("xblox.model.html.SetStyle",[n,h,f],g);p.Impl=g;return p})},"xblox/model/html/SetCSS":function(){define("dojo/_base/declare dojo/_base/lang xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Targeted xide/registry".split(" "),function(p,n,m,k,h,f,a,c){return p("xblox.model.html.SetCSS",[m,f,a],
{name:"Set CSS",file:"",reference:"",references:null,description:"Sets HTML Node CSS",solve:function(a,c){this.onSuccess(this,c)},toText:function(){var a=this.getBlockIcon()+" "+this.name+" :: ";this.event&&(a+=this.event);return a},getFields:function(){try{var a=this.inherited(arguments)||this.getDefaultFields();a.push(k.createCI("File",h.ECIType.FILE,this.file,{group:"General",dst:"file",value:this.file,intermediateChanges:!1,acceptFolders:!1,acceptFiles:!0,encodeFilePath:!1,buildFullPath:!0,filePickerOptions:{dialogTitle:"Select CSS File",
filePickerMixin:{beanContextName:"CSSFilePicker",persistent:!1,globalPanelMixin:{allowLayoutCookies:!1}},configMixin:{beanContextName:"CSSFilePicker",LAYOUT_PRESET:h.LAYOUT_PRESET.SINGLE,PANEL_OPTIONS:{ALLOW_MAIN_MENU:!1}},defaultStoreOptions:{fields:1663,includeList:"css",excludeList:"*"},startPath:this.file}}));a.push(k.createCI("Target",h.ECIType.WIDGET_REFERENCE,this.reference,{group:"General",dst:"reference",value:this.reference}))}catch(c){}return a},getBlockIcon:function(){return'\x3cspan class\x3d"fa-paint-brush"\x3e\x3c/span\x3e'},
onReferenceChanged:function(a,c){this._destroy();this.reference=a;this.resolveReference(this.deserialize(a))},onChangeField:function(a,c,d){if("reference"==a)this.onReferenceChanged(c,d);this.inherited(arguments)},activate:function(){this._destroy()},deactivate:function(){this._destroy()},_destroy:function(){}})})},"xblox/model/Targeted":function(){define(["dojo/_base/declare","./Referenced"],function(p,n){return p("xblox.model.Targeted",[n],{})})},"xcf/factory/Blocks":function(){define(["dojo/_base/lang",
"xblox/factory/Blocks","xcf/model/Command","xblox/model/functions/CallBlock"],function(p,n,m,k){n._getCommandBlocks=function(h,f,a,c){var e=[];e.push({name:"Commands",iconClass:"el-icon-random",items:[{name:"Call Command",owner:f,iconClass:"el-icon-video",proto:k,target:a,ctrArgs:{scope:h,group:c,condition:""}},{name:"New Command",owner:f,iconClass:"el-icon-video",proto:m,target:a,ctrArgs:{scope:h,group:c,condition:"",name:"No-Title"}}]});return e};return n})},"xcf/model/Command":function(){define("dcl/dcl xblox/model/Block xblox/model/Contains xide/utils xide/types dojo/Deferred".split(" "),
function(p,n,m,k,h,f){return p([n,m],{declaredClass:"xcf.model.Command",startup:!1,auto:null,send:"",name:"No Title",observed:["send"],interval:0,waitForResponse:!1,_runningDfd:null,onCommandFinish:function(a){this.getScope().getContext();this.waitForResponse&&this._emit("cmd:"+a.cmd+"_"+a.id,{msg:a})},onCommandError:function(a){this.getScope().getContext();this.waitForResponse&&this._emit("cmd:"+a.cmd+"_"+a.id,a)},sendToDevice:function(a,c){a=this.replaceAll("'","",a);var e=k.createUUID(),f=this;
if(this.scope.instance)this.waitForResponse&&this._on("cmd:"+a+"_"+e,function(a){if(a.error)f.onFailed(f,c);else f.onSuccess(f,c)}),this.scope.instance.sendMessage(a,null,this.id,e);else return this.publish(h.EVENTS.ON_STATUS_MESSAGE,{text:"Command "+this.name+" : have no device",type:"error",delay:1E3}),!1;return e},reset:function(){this._lastSettings={};this._loop&&(clearTimeout(this._loop),this._loop=null)},solve:function(a,c,e,g){var d=null;a=a||this.scope;g=g||this.send;c=this._lastSettings=
c||this._lastSettings;1==e&&this._loop&&this.reset();if(!0!==this.waitForResponse)this.onRun(this,c);else this.onRun(this,c,{timeout:!1}),this._runningDfd=d=new f;if(this.items&&0<this.items.length){if(g&&0<g.length){var b=a.parseExpression(g);if(b&&0<b.length)if(this.sendToDevice(b,c))this.onSuccess(this,c);else this.onFailed(this,c)}e=[];for(b=0;b<this.items.length;b++)d=this.items[b],d.enabled&&e.push(d.solve(a,c));return e}if(0<g.length){if(d=this.override&&this.override.variables?this.override.variables:
null)for(b in d)_.isNumber(d[b])&&(d[b]=Math.round(d[b]));if((b=this.isScript(g)?a.parseExpression(g,null,d):""+g)&&0<b.length&&!this.sendToDevice(b,c))this.onFailed(this,c);if(!0!==this.waitForResponse)this.onSuccess(this,c);else this._settings=c;e&&this.scope.loopBlock(this,c);return[b]}return!1},canAdd:function(){return[]},mayHaveChildren:function(a){return null!=this.items&&0<this.items.length},getChildren:function(a){return this.items},hasInlineEdits:!0,toText:function(a,c,e,f){var d="";!1!==
a&&(d+="\x3cspan class\x3d'text-primary inline-icon'\x3e"+this.getBlockIcon()+"\x3c/span\x3e");!1!==c&&(d+=""+this.makeEditable("name","bottom","text","Enter a unique name","inline")+"");1==f&&(d+="\x3cbr/\x3e");!1!==e&&(d+="\x3cspan class\x3d'text-muted small'\x3e Send:\x3ckbd class\x3d'text-warning'\x3e"+this.makeEditable("send","bottom","text","Enter the string to send","inline")+"\x3c/kbd\x3e\x3c/span\x3e");!1!==a&&(this.startup&&(d+=this.getIcon("fa-bell inline-icon text-warning","text-align:right;float:right;",
"")),this.auto&&10<this.interval&&(d+=this.getIcon("fa-clock-o inline-icon text-warning","text-align:right;float:right","")));return d},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields(),c=this;a.push(this.utils.createCI("name",13,this.name,{group:"General",title:"Name",dst:"name"}));a.push(this.utils.createCI("startup",0,this.startup,{group:"General",title:"Send on Startup",dst:"startup"}));a.push(this.utils.createCI("auto",0,this.auto,{group:"General",title:"Auto Send",
dst:"auto"}));a.push(this.utils.createCI("interval",13,this.interval,{group:"General",title:"Interval",dst:"interval"}));a.push(this.utils.createCI("interval",0,this.waitForResponse,{group:"General",title:"%%Has Response",dst:"waitForResponse"}));a.push(this.utils.createCI("send",h.ECIType.EXPRESSION_EDITOR,this.send,{group:"Send",title:"Send",dst:"send",widget:{allowACECache:!0,showBrowser:!1,showSaveButton:!0,style:"height:inherit;",editorOptions:{showGutter:!1,autoFocus:!1},aceOptions:{hasEmmet:!1,
hasLinking:!1,hasMultiDocs:!1},item:this},delegate:{runExpression:function(a,f,d){return c.scope.expressionModel.parse(c.scope,a,!1,f,d)}}}));return a},icon:"fa-exclamation",getIconClass:function(){return"el-icon-play-circle"},getBlockIcon:function(){return'\x3cspan class\x3d"'+this.icon+'"\x3e\x3c/span\x3e '},canEdit:function(){return!0},onChangeField:function(a,c,e){"auto"==a&&(1==c?this.scope.loopBlock(this):this._loop&&this.reset());"enabled"==a&&(0==c?this.reset():this.auto&&this.scope.loopBlock(this));
"interval"==a&&this.auto&&this.scope.loopBlock(this);this.inherited(arguments)}})})},"nxappmain/main_server":function(){require("dojo/node!readline nxapp/Commons xide/types nxapp/utils/TCPUtils nxappmain/nxAppBase nxapp/manager/DeviceServerContext nxapp/client/WebSocket xlog/Server dojo/node!winston dojo/node!path dojo/node!fs dojo/node!util dojo/node!vm nxapp/manager/MQTTManager nxapp/Commons nxapp/utils/FileUtils nxapp/utils/_console".split(" "),function(p,n,m,k,h,f,a,c,e,g,d,b,l,q,r,t,x){n={filename:"all.log",
dirname:dojoConfig.logRoot,json:!0};var y=new c({});y.start({fileLogger:n,console:null});var v=new h({commander:null}),u,w,C;v.init();var A=v.profile;h=v.commander;if(h.file){console.error("run js file : "+h.file);g=g.resolve(h.file);if(d.existsSync(g)){f=new l.createContext({require:require.nodeRequire,commander:h,console:x,process:process});t=t.readFile(g);(new l.Script(t)).runInContext(f);return}console.error("file specified but doesnt exists "+h.file)}h.port&&(A.socket_server.port=h.port);h.host&&
(A.socket_server.host=h.host);var D=new f;D.constructManagers();D.initManagers(A);D.logManager=y;var E=new q({ctx:D,profile:A});E.init(A);D.connectionManager.mqttManager=E;D.mqttManager=E;l=A.common.createSocketServer;var z=null,B=function(){var b=new a;b.init({options:{host:"http://"+v.profile.socket_server.host,port:v.profile.socket_server.port,debug:v.profile.debug}});b.connect();b.onSignal(m.SIGNAL_RESPONSE,function(a){A.common.stdout&&process.stdout.write(a+"\n");v.commander.oneshot&&v.commander.command&&
process.exit()});return b};if(v.commander.info)console.log(JSON.stringify({host:"http://"+v.profile.socket_server.host,port:v.profile.socket_server.port})),process.exit();else{var F=function(){v.commander.host&&(u=v.commander.host);v.commander.port&&(w=parseInt(v.commander.port));v.commander.protocol&&(C=v.commander.protocol);if(v.commander.driver){console.error("run in driver mode");var a=B(),b={driver:"xcf/driver/SubTest",host:"192.168.1.20",port:23,protocol:"tcp"},d=m.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER;
b.manager_command=m.SOCKET_SERVER_COMMANDS.START_DRIVER;d=m.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER;a.emit(d,b)}else if(v.commander.send){console.error("sending command");console.error("  create web socket client to control server : http://"+v.profile.socket_server.host+":"+v.profile.socket_server.port);var a=B(),c=function(b){if(null!==a&&null!=b){var d={command:b,host:u,port:w,protocol:C},c=m.SOCKET_SERVER_COMMANDS.SIGNAL_DEVICE;"startDriver"==b?(d.manager_command=m.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER,
c=m.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER):"status"==b?(d.manager_command=m.SOCKET_SERVER_COMMANDS.MANAGER_STATUS,c=m.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER):"closeall"==b?(d.manager_command=m.SOCKET_SERVER_COMMANDS.MANAGER_CLOSE_ALL,c=m.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER):d.device_command=m.SOCKET_SERVER_COMMANDS.DEVICE_SEND;a.emit(c,d)}},b=function(b){if(null!==a&&null!=b)if(b.indexOf&&-1!=b.indexOf(";")){b=b.split(";");for(var d=0;d<b.length;d++)c(b[d])}else c(b)};p.createInterface({input:process.stdin,
output:process.stdout}).on("line",function(a){null!=a&&0<a.length&&(console.log("sending stdin : "+a),c(a))});"string"==typeof v.commander.command&&b(v.commander.command);console.error("Send command. ^C to close connection and quit")}};if(l)k.checkPort(A.socket_server.port,A.socket_server.host,function(a,b,d,c){a=!1;"closed"==b?(console.error("have no device server yet, creating a new one!"),z=k.createDeviceServer(A,D),D.deviceServer=z,D.logger=e,D.deviceServer.logger=e,D.logManager=y,z.mqttManager=
E,console.log("start device server"),D.onReady(),a=!0):"open"==b&&(a=!0);a&&F()});else try{F()}catch(I){console.error("app crash!")}}})},"nxapp/manager/MQTTManager":function(){define("dcl/dcl nxapp/manager/ManagerBase nxapp/utils/_LogMixin nxapp/types/Types dojo/node!mosca dojo/node!mqtt dojo/node!node-notifier dojo/node!colors".split(" "),function(p,n,m,k,h,f,a,c){return p([n,m],{declaredClass:"nxapp.manager.MQTTManager",options:null,profile:null,lastUpTime:null,mqttClients:null,publishTopic:function(a,
c){var d={topic:a,payload:JSON.stringify(c),qos:1};this.server.publish(d,function(){})},createMQTTClient2:function(a,c,d){var b=a+":"+c,h=f.connect("mqtt://localhost",{clean:!1,clientId:b}),m=this.ctx;console.log("create mqtt - client for "+b);h.on("connect",function(){console.log("on connected local mqtt client for "+b);h.subscribe("192.168.1.20/23/Variable/PowerState",{qos:2})});h.on("message",function(b,f){m.getDeviceServer().broadCastMessage(k.EVENTS.ON_MQTT_MESSAGE,{host:a,port:c,topic:b,message:f.toString(),
mqtt:d})});return h},createMQTTClient:function(a,c,d){a=a+":"+c;if(this.mqttClients[a])return this.mqttClients[a];if(!this.mqttClients[a])return c=f.connect("mqtt://localhost",{clean:!1,clientId:a}),c.on("connect",function(){}),this.mqttClients[a]=c},onConnectedToDevice:function(a,c,d){},onWakeup:function(){this.lastUpTime=(new Date).getTime();for(var a=0;a<this.pool.length;a++){var c=this.pool[a];c.socket&&c.socket.close&&c.socket.close();c.socket&&c.socket._socket&&c.socket._socket.close&&c.socket._socket.close()}this.pool=
[]},init:function(e){this.profile=e;this.lastUpTime=(new Date).getTime();this.mqttClients={};e=new h.Server({port:1883,backend:{type:"mongo",url:"mongodb://localhost:27017/mqtt",pubsubCollection:"xcf",mongo:{}},persistence:{factory:h.persistence.Mongo,url:"mongodb://localhost:27017/mqtt"}});e.on("ready",function(){try{a.notify({title:"Control-Freak",message:"All servers up and running, you can start now Control-Freak IDE",sound:!0,wait:!0,open:"file:///"},function(a,b){})}catch(e){}console.log(c.green("\n\r\t Mosca server up and running\n\r \t ***********   You can start Control Freak now  **************\n\r"))});
e.on("clientConnected",function(){});e.on("clientDisconnected",function(){});this.server=e},onTimeout:function(a){},onClose:function(a){this.removeConnection(a)},onDrain:function(a){},onError:function(a,c){},onData:function(a,c){this.showDebugMsg("protocol_messages");var d=this.connectionExists(a.host,a.port,a.protocol);d!=this.poolNotFound&&this.callFeedBack(d,c)},onConnect:function(a,c,d){this.log("Connected to "+a+":"+c+" via "+d,"protocol_messages");a={device:{host:a,port:c,protocol:d}};this.ctx.getDeviceServer().broadCastMessage(k.EVENTS.ON_DEVICE_CONNECTED,
a)},onHandle:function(a,c){this.showDebugMsg("protocol_messages")}})})}}});define("nxappmain/serverbuild",[],1);
//# sourceMappingURL=serverbuild.js.map