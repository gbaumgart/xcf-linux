//>>built
require({cache:{"xide/types":function(){define(["dcl/dcl"],function(p){return p(null,{declaredClass:"xide/types"})})},"dcl/dcl":function(){(function(p){"undefined"!=typeof define?define(["./mini"],p):"undefined"!=typeof module?module.exports=p(require("./mini")):dcl=p(dcl)})(function(p){function m(){}function l(e,a,b){var f=e||m,h=a||m,c=b||m,d=function(){var d,b;f.apply(this,arguments);try{d=c.apply(this,arguments)}catch(a){d=a,b=!0}h.call(this,arguments,d);if(b)throw d;return d};d.advices={before:e,
after:a,around:b};return d}function k(e){return function(a,b){var f=a._meta,h;f&&((h=+f.weaver[b]||0)&&h!=e&&p._error("set chaining",b,a,e,h),f.weaver[b]=e)}}var g=p(p.Super,{constructor:function(){this.before=this.around.before;this.after=this.around.after;this.around=this.around.around}});p.mix(p,{Advice:g,advise:function(e){return p._makeSuper(e,g)},before:function(e){return p.advise({before:e})},after:function(e){return p.advise({after:e})},around:p.superCall,chainBefore:k(1),chainAfter:k(2),
isInstanceOf:function(e,a){if(e instanceof a)return!0;var b=e.constructor._meta,f;if(b)for(b=b.bases,f=b.length-1;0<=f;--f)if(b[f]===a)return!0;return!1},_stub:function(e,a,b,f){f=f[b]=p._extractChain(a,b,"around");var h=p._extractChain(a,b,"before").reverse();a=p._extractChain(a,b,"after");f=e?p._stubChainSuper(f,1==e?function(c){return p._stubChain(c.reverse())}:p._stubChain,b):p._stubSuper(f,b);return h.length||a.length?l(p._stubChain(h),p._stubChain(a),f):f||function(){}}});return p})},"dcl/mini":function(){(function(p){"undefined"!=
typeof define?define([],p):"undefined"!=typeof module?module.exports=p():dcl=p()})(function(){function p(b,f){var h=[0],c,d,n,q,r,e,g,m,t=0,u;if(b)if(b instanceof Array){r={};g=b.slice(0).reverse();for(m=g.length-1;0<=m;--m)if(d=g[m],d._uniqueId=d._uniqueId||k++,c=d._meta){e=c.bases;for(t=e.length-1;0<t;--t)u=e[t]._uniqueId,r[u]=(r[u]||0)+1;g[m]=e.slice(0)}else g[m]=[d];c={};a:for(;g.length;){for(m=0;m<g.length;++m)if(e=g[m],d=e[0],u=d._uniqueId,!r[u]){c[u]||(h.push(d),c[u]=1);e.shift();e.length?
--r[e[0]._uniqueId]:g.splice(m,1);continue a}p._error("cycle",f,g)}b=b[0];t=h.length-((q=b._meta)&&b===h[h.length-(t=q.bases.length)]?t:1)-1}else b._uniqueId=b._uniqueId||k++,h=h.concat((q=b._meta)?q.bases:b);c=b?p.delegate(b.prototype):{};for(e=b&&(q=b._meta)?p.delegate(q.weaver):{constructor:2};0<t;--t)if(d=h[t],q=d._meta,p.mix(c,q&&q.ownProps||d.prototype),q)for(u in g=q.weaver)e[u]=(+e[u]||0)|g[u];for(u in f)l(q=f[u])?e[u]=+e[u]||0:c[u]=q;q={bases:h,ownProps:f,weaver:e,chains:{}};h[0]={_meta:q,
prototype:c};d=c;r=q.weaver;e=q.bases;g=q.chains;for(n in r)d[n]=p._stub(r[n],e,n,g);n=c.constructor;n._meta=q;n.prototype=c;h[0]=n;h=p._postprocess(n);f.declaredClass&&(a[f.declaredClass]=h);return h}function m(b){this.around=b}function l(b){return b&&b.spr instanceof m}var k=0,g={},e,a={};(e=function(b,a){for(var h in a)b[h]=a[h]})(p,{mix:e,delegate:function(b){return Object.create(b)},allKeys:function(b){var a=[],h;for(h in b)a.push(h);return a},Super:m,superCall:function(b){return p._makeSuper(b)},
_makeSuper:function(b,a){var h=function(){};h.spr=new (a||m)(b);return h},_postprocess:function(b){return b},_error:function(b){throw Error("dcl: "+b);},_instantiate:function(b,a,h){a=b.spr.around(a);a.ctr=b.ctr;return a},_extractChain:function(b,a,h){for(var c=b.length-1,d=[],n,q,e="around"==h;n=b[c];--c)if((q=n._meta)?(q=q.ownProps).hasOwnProperty(a)&&(l(q=q[a])?e?q.spr.around:q=q.spr[h]:e):e&&(q="constructor"==a?n:n.prototype[a])&&q!==g[a])"function"==typeof q?(q.ctr=n,d.push(q)):p._error("wrong super",
n,a);return d},_stubChain:function(b){var a=b.length,h;return a?1==a?(h=b[0],function(){h.apply(this,arguments)}):function(){for(var c=0;c<a;++c)b[c].apply(this,arguments)}:0},_stubSuper:function(a,f){for(var h=0,c,d=g[f];c=a[h];++h)d=l(c)?a[h]=p._instantiate(c,d,f):c;return"constructor"!=f?d:function(){d.apply(this,arguments)}},_stubChainSuper:function(a,f,h){for(var c=0,d,n,q=0;d=a[c];++c)l(d)&&(n=c-q,a[c]=p._instantiate(d,n?1==n?a[q]:f(a.slice(q,c)):0,h),q=c);return(n=c-q)?1==n&&"constructor"!=
h?a[q]:f(q?a.slice(q):a):0},_stub:function(a,f,h,c){f=c[h]=p._extractChain(f,h,"around");return(a?p._stubChainSuper(f,p._stubChain,h):p._stubSuper(f,h))||function(){}}});p.getObject=function(b){return a[b]};return p})},"xide/types/Types":function(){define(["dojo/_base/lang","xide/types","dojo/_base/json","dojo/_base/kernel"],function(p,m,l,k){null==m.customTypes&&(m.customTypes={});null==m.customEnumerations&&(m.customEnumerations={});null==m.widgetMappings&&(m.widgetMappings={});null==m.customMimeIcons&&
(m.customMimeIcons={});m.registerCustomMimeIconExtension=function(g,e){m.customMimeIcons[g]=e};m.resolveType=function(g){return m.customTypes[g]?m.customTypes[g]:null};m.registerType=function(g,e){m.customTypes[g]=e};m.registerWidgetMapping=function(g,e){m.widgetMappings[g]=e};m.registerEnumeration=function(g,e){m.customEnumerations[g]=e};m.resolveEnumeration=function(g){return m.customEnumerations[g]?m.customEnumerations[g]:null};m.resolveWidgetMapping=function(g){return m.widgetMappings[g]?m.widgetMappings[g]:
null};m.GRID_FEATURE={KEYBOARD_NAVIGATION:"KEYBOARD_NAVIGATION",KEYBOARD_SELECT:"KEYBOARD_SELECT",SELECTION:"SELECTION",ACTIONS:"ACTIONS",CONTEXT_MENU:"CONTEXT_MENU"};m.VIEW_FEATURE={KEYBOARD_NAVIGATION:"KEYBOARD_NAVIGATION",KEYBOARD_SELECT:"KEYBOARD_SELECT",SELECTION:"SELECTION",ACTIONS:"ACTIONS",CONTEXT_MENU:"CONTEXT_MENU"};m.ACTION={LAYOUT:"View/Layout",COLUMNS:"View/Columns",SELECTION:"File/Select",CLIPBOARD:"Edit/Clipboard",UNDO:"Edit/Undo",REDO:"Edit/Redo",CLIPBOARD_COPY:"Edit/Clipboard/Copy",
CLIPBOARD_PASTE:"Edit/Clipboard/Paste",CLIPBOARD_CUT:"Edit/Clipboard/Cut",COPY:"File/Copy",MOVE:"File/Move",RENAME:"File/Rename",DELETE:"File/Delete",OPEN:"File/Open",EDIT:"File/Edit",SAVE:"File/Save",SEARCH:"File/Search",TOOLBAR:"View/Show/Toolbar",STATUSBAR:"View/Show/Statusbar",BREADCRUMB:"View/Show/Breadcrumb",HEADER:"View/Show/Header",DOWNLOAD:"File/Download",DOWNLOAD_TO:"File/downloadTo",INFO:"File/Info",COMPRESS:"File/Compress",RELOAD:"File/Reload",UPLOAD:"File/Upload",PREVIEW:"File/Preview",
OPEN_IN:"File/Open In",INSERT_IMAGE:"insertImage",COPY_PASTE:"copypaste",DND:"dnd",OPTIONS:"options",NEW_FILE:"File/New/New File",NEW_DIRECTORY:"File/New/New Folder",GET_CONTENT:"get",SET_CONTENT:"set",FIND:"File/Find",CUSTOM:"custom",PERMA_LINK:"permaLink",ADD_MOUNT:"ADD_MOUNT",REMOVE_MOUNT:"REMOVE_MOUNT",EDIT_MOUNT:"EDIT_MOUNT",PERSPECTIVE:"PERSPECTIVE",RUN:"File/Run",GO_UP:"Navigation/Go Up",STOP:"File/Stop",CLOSE:"View/Close",FULLSCREEN:"View/Fullscreen",OPEN_IN_TAB:"File/OpenInNewTab",SOURCE:"Navigation/Source",
RIBBON:"View/Show/Ribbon",MAIN_MENU:"View/Show/MainMenu",NAVIGATION:"View/Show/Navigation",BASH_CONSOLE:"File/Console/Bash",JS_CONSOLE:"File/Console/JS",PHP_CONSOLE:"File/Console/PHP",CONSOLE:"File/Console/PHP",SIZE_STATS:"View/Show/SizeStats",WELCOME:"Window/Welcome"};m.ACTION_TYPE={MULTI_TOGGLE:"multiToggle",SINGLE_TOGGLE:"singleToggle"};m.ACTION_ICON={CLIPBOARD_COPY:"fa-copy",CLIPBOARD_PASTE:"fa-paste",UPLOAD:"fa-upload",RENAME:"el-icon-edit",DELETE:"text-danger fa-remove",RELOAD:"fa-refresh",
EDIT:"fa-pencil",SAVE:"fa-floppy-o",SEARCH:"fa-search",NEW_DIRECTORY:"fa-magic",NEW_FILE:"fa-magic",RUN:"text-success el-icon-play",COMPRESS:"fa-file-archive-o",EXTRACT:"fa-folder-open",DOWNLOAD:"fa-download",GO_UP:"fa-level-up",TOOLBAR:"fa-bars",STATUSBAR:"fa-terminal",PREVIEW:"fa-eye",MAXIMIZE:"fa-arrows-alt",UNDO:"fa-undo",REDO:"fa-repeat"};m.KEYBOARD_PROFILE={DEFAULT:{prevent_default:!0,prevent_repeat:!1},PASS_THROUGH:{prevent_default:!1,prevent_repeat:!1},SEQUENCE:{prevent_default:!0,is_sequence:!0,
prevent_repeat:!0}};m.ECIType={BOOL:0,BOX:1,COLOUR:2,ENUMERATION:3,FILE:4,FLAGS:5,FLOAT:6,INTEGER:7,MATRIX:8,OBJECT:9,REFERENCE:10,QUATERNION:11,RECTANGLE:12,STRING:13,VECTOR:14,VECTOR2D:15,VECTOR4D:16,ICON:17,IMAGE:18,BANNER:19,LOGO:20,STRUCTURE:21,BANNER2:22,ICON_SET:23,SCRIPT:24,EXPRESSION:25,RICHTEXT:26,ARGUMENT:27,JSON_DATA:28,EXPRESSION_EDITOR:29,WIDGET_REFERENCE:30,DOM_PROPERTIES:31,BLOCK_REFERENCE:32,BLOCK_SETTINGS:33,FILE_EDITOR:34,END:35,UNKNOWN:-1};m.ITEM_TYPE={FILE:"BTFILE",WIDGET:"WIDGET",
BLOCK:"BLOCK",TEXT:"TEXT"};m.EXPRESSION_PARSER||(m.EXPRESSION_PARSER={});m.COMPONENT_NAMES={XIDEVE:"xideve",XNODE:"xnode",XBLOX:"xblox",XFILE:"xfile"};m.WIDGET_REFERENCE_MODE={BY_ID:"byid",BY_CLASS:"byclass",BY_CSS:"bycss",BY_EXPRESSION:"expression"};m.VIEW_SPLIT_MODE={DESIGN:1,SOURCE:2,SPLIT_VERTICAL:6,SPLIT_HORIZONTAL:7};m.PROTOCOL={TCP:"tcp",UDP:"udp",SERIAL:"serial",DRIVER:"driver",SSH:"ssh",MQTT:"mqtt"};m.RESOURCE_VARIABLES={ACE:"ACE",APP_URL:"APP_URL",SITE_URL:"SITE_URL"};m.SOCKET_SERVER_COMMANDS=
{SIGNAL_MANAGER:"Manager_command",SIGNAL_DEVICE:"Device_command",SIGNAL_RESPONSE:"WebSocket_response",MANAGER_TEST:"Manager_Test",MANAGER_CLOSE_ALL:"Close_All_Connections",MANAGER_STATUS:"status",MANAGER_START_DRIVER:"startDriver",MANAGER_STOP_DRIVER:"stopDriver",DEVICE_SEND:"Device_Send"};m.WidgetGroup={All:0,General:1,Visual:2,Module:3,Content:4,Hidden:5,Facebook:6,Twitter:7,Google:8,Apple:9,FourSquare:10,BitLy:11,Tablet:12,Unknown:13,System:14};m.EVENTS={SAVE_LAYOUT:"layoutSave",RESTORE_LAYOUT:"layoutRestore",
ON_FILE_CHANGED:"fileChanged",ON_FILE_DELETED:"fileDeleted",ON_NODE_SERVICE_STORE_READY:"onNodeServiceStoreReady",ON_CREATED_MANAGER:"onCreatedManager",ON_CI_UPDATE:"onCIUpdate",ON_CREATED_WIDGET:"onWidgetCreated",ON_WIDGET_READY:"onWidgetReady",ON_MAIN_VIEW_READY:"onMainViewReady",ON_MAIN_MENU_READY:"onMainMenuReady",ON_MAIN_MENU_OPEN:"onMainMenuOpen",ON_VIEW_REMOVED:"onViewRemoved",ON_VIEW_SHOW:"onViewShow",ON_VIEW_HIDE:"onViewHide",ON_VIEW_ADDED:"onViewAdded",ON_ITEM_SELECTED:"onItemSelected",
ON_ITEM_REMOVED:"onItemRemoved",ON_ITEM_CLOSED:"onItemClosed",ON_ITEM_ADDED:"onItemAdded",ON_ITEM_MODIFIED:"onItemModified",ON_ACTION_CHANGE_CONTEXT:"onChangeActionContext",ON_ACTION_CONTEXT_CHANGED:"onActionContextChanged",ON_CONTAINER_ADDED:"onContainerAdded",ON_CONTAINER_REMOVED:"onContainerRemoved",ON_REMOVE_CONTAINER:"onRemoveContainer",ON_CONTAINER_REPLACED:"onContainerReplaced",ON_CONTAINER_SPLIT:"onContainerSplit",ON_CLIPBOARD_COPY:"onClipboardCopy",ON_CLIPBOARD_PASTE:"onClipboardPaste",ON_CLIPBOARD_CUT:"onClipboardCut",
ON_MODULE_RELOADED:"onModuleReloaded",ON_MODULE_UPDATED:"onModuleUpdated",RESIZE:"onResize",ERROR:"onError",STATUS:"onStatus",ON_FILE_STORE_READY:"onFileStoreReady",ON_DID_OPEN_ITEM:"onDidOpenItem",ON_SHOW_PANEL:"onShowPanel",IMAGE_LOADED:"imageLoaded",IMAGE_ERROR:"imageError",UPLOAD_BEGIN:"uploadBegin",UPLOAD_PROGRESS:"uploadProgress",UPLOAD_FINISH:"uploadFinish",UPLOAD_FAILED:"uploadFailed",ON_CONTEXT_MENU_OPEN:"onContextMenuOpen",ON_PLUGIN_LOADED:"onPluginLoaded",ON_PLUGIN_READY:"onPluginReady",
ALL_PLUGINS_READY:"onAllPluginsReady",REGISTER_EDITOR:"registerEditor",REGISTER_ACTION:"registerAction",SET_ITEM_ACTIONS:"onSetItemsActions",ON_RENDER_ACTIONS:"onRenderActions",ON_FILE_CONTENT_CHANGED:"onFileContentChanged",ON_PANEL_CLOSED:"onPanelClosed",ON_PANEL_CREATED:"onPanelCreated",ON_COPY_BEGIN:"onCopyBegin",ON_COPY_END:"onCopyEnd",ON_DELETE_BEGIN:"onDeleteBegin",ON_DELETE_END:"onDeleteEnd",ON_MOVE_BEGIN:"onMoveBegin",ON_MOVE_END:"onMoveEnd",ON_CHANGED_CONTENT:"onChangedContent",ON_COMPRESS_BEGIN:"onCompressBegin",
ON_COMPRESS_END:"onCompressEnd",ON_CREATE_EDITOR_BEGIN:"onCreateEditorBegin",ON_CREATE_EDITOR_END:"onCreateEditorEnd",ON_EXPRESSION_EDITOR_ADD_FUNCTIONS:"onExpressionEditorAddFunctions",ON_ACE_READY:"onACEReady",ON_SERVER_LOG_MESSAGE:"onServerLogMessage",ON_CLIENT_LOG_MESSAGE:"onClientLogMessage",ON_DID_RENDER_COLLECTION:"onDidRenderCollection",ON_COMPONENT_READY:"onComponentReady",ON_ALL_COMPONENTS_LOADED:"onAllComponentsLoaded",ON_APP_READY:"onAppReady",ON_CREATE_STORE:"onCreateStore",ON_STORE_CREATED:"onStoreCreated",
ON_STORE_CHANGED:"onStoreChanged",ON_STATUS_MESSAGE:"onStatusMessage",ON_OPEN_VIEW:"onOpenView",ON_VIEW_MAXIMIZE_START:"onViewMaximizeStart",ON_VIEW_MAXIMIZE_END:"onViewMaximizeEnd"};m.DIALOG_SIZE={SIZE_NORMAL:"size-normal",SIZE_SMALL:"size-small",SIZE_WIDE:"size-wide",SIZE_LARGE:"size-large"};m.DIALOG_TYPE={DEFAULT:"type-default",INFO:"type-info",PRIMARY:"type-primary",SUCCESS:"type-success",WARNING:"type-warning",DANGER:"type-danger"};m.SERVICE_STATUS={OFFLINE:"offline",ONLINE:"online",TIMEOUT:"timeout"};
m.MAIN_MENU_KEYS={VIEWS:"views",FILES:"files",LOG:"log"};m.WidgetGroupTitle={General:"General",Visual:"Visual",Module:"Modules",Content:"Content",Facebook:"Facebook",Twitter:"Twitter",Google:"Google",Apple:"Apple",Others:"Misc",FourSquare:"Foursquare",Bitly:"Bitly",Tablet:"Tablet",Unknown:"Unknown",System:"System"};p.mixin(m,{LAYOUT_RIGHT_CENTER_BOTTOM:"LAYOUT_RIGHT_CENTER_BOTTOM",LAYOUT_CENTER_BOTTOM:"LAYOUT_CENTER_BOTTOM",LAYOUT_CENTER_RIGHT:"LAYOUT_CENTER_RIGHT",LAYOUT_LEFT_CENTER_RIGHT:"LAYOUT_LEFT_CENTER_RIGHT",
LAYOUT_LEFT_CENTER_RIGHT_BOTTOM:"LAYOUT_LEFT_CENTER_RIGHT_BOTTOM"});k.fromJson=function(g,e){var a=null,b=!1;try{a=eval("("+g+")")}catch(f){b=!0}if(b){b=g.substring(g.indexOf("{"),g.lastIndexOf("}")+1);try{b&&(a=eval("("+b+")"))}catch(h){!1!==e&&console.error("error in json parsing! "+g);if(-1!==g.indexOf("error"))return{jsonrpc:"2.0",result:{error:{code:1,message:g,data:null}},id:0};throw Error(g);}}return a};return m})},"xide/utils/ObjectUtils":function(){define(["xide/utils","require","dojo/Deferred",
"dojo/_base/json"],function(p,m,l,k){function g(h){var c=parseInt(h);return c.toString()===h?c:h}function e(h,c,d,n){_.isNumber(c)&&(c=[c]);if(_.isEmpty(c))return h;if(_.isString(c))return e(h,c.split(".").map(g),d,n);var a=c[0];if(1===c.length)return c=h[a],void 0!==c&&n||(h[a]=d),c;void 0===h[a]&&(_.isNumber(c[1])?h[a]=[]:h[a]={});return e(h[a],c.slice(1),d,n)}function a(h,c){_.isNumber(c)&&(c=[c]);if(!_.isEmpty(h)){if(_.isEmpty(c))return h;if(_.isString(c))return a(h,c.split("."));var d=g(c[0]),
n=h[d];if(1===c.length)void 0!==n&&(_.isArray(h)?h.splice(d,1):delete h[d]);else if(void 0!==h[d])return a(h[d],c.slice(1));return h}}"use strict";p.debounce=function(h,c,d,n,a,b){var f=h[c+"_debounced"];f||(f=h[c+"_debounced"]=_.debounce(d,n,a));1!=b||h[c+"_debouncedFirst"]||(h[c+"_debouncedFirst"]=!0,d.apply(h));return f()};p.pluck=function(a,c){var d=[];if(!a)return console.warn("pluck: no items"),d;for(var n=0;n<a.length;n++)d.push(a[n][c]);return d};p.download=function(a,c){var d=document.createElement("a");
c=_.isString(c)?c:JSON.stringify(c,null,2);d.setAttribute("href","data:text/plain;charset\x3dutf-8,"+encodeURIComponent(c));d.setAttribute("download",a);d.style.display="none";document.body.appendChild(d);d.click();document.body.removeChild(d)};p.hasObject=function(a,c,d){c=null;try{c=m(a)}catch(n){console.error("error in utils.hasObject ",n)}return c};p.getObject=function(a,c){var d=null;if(p.isString(a)){try{d=m(a)}catch(n){}try{if(!d){var b=new l,d=m([a],function(d){b.resolve(d)});return b.promise}}catch(f){console.error("error in requiring "+
a,f)}return d}return p.isObject(a)?a:null!==d?d:c};p.toObject=function(a,c){if(!a)return{};if(!1!==c)return _.object(_.map(a,_.values));if(p.isObject(a)&&a[0])return a[0];for(var d={},n=0;n<a.length;++n)d[n]=a[n];return d};p.byString=function(a,c,d){c=c.replace(/\[(\w+)\]/g,".$1");c=c.replace(/^\./,"");for(c=c.split(".");c.length;)if(d=c.shift(),d in a)a=a[d];else return;return a};var b=Object.prototype.hasOwnProperty,f={has:function(a,c){if(_.isEmpty(a))return!1;_.isNumber(c)?c=[c]:_.isString(c)&&
(c=c.split("."));if(_.isEmpty(c)||0===c.length)return!1;for(var d=0;d<c.length;d++){var n=c[d];if((_.isObject(a)||_.isArray(a))&&b.call(a,n))a=a[n];else return!1}return!0},ensureExists:function(a,c,d){return e(a,c,d,!0)},set:function(a,c,d,n){return e(a,c,d,n)},insert:function(a,c,d,n){var b=f.get(a,c);n=~~n;isArray(b)||(b=[],f.set(a,c,b));b.splice(n,0,d)},empty:function(a,c){if(_.isEmpty(c))return a;if(!_.isEmpty(a)){var d,n;if(!(d=f.get(a,c)))return a;if(_.isString(d))return f.set(a,c,"");if(_.isBoolean(d))return f.set(a,
c,!1);if(_.isNumber(d))return f.set(a,c,0);if(_.isArray(d))d.length=0;else if(_.isObject(d))for(n in d)b.call(d,n)&&delete d[n];else return f.set(a,c,null)}},push:function(a,c){var d=f.get(a,c);_.isArray(d)||(d=[],f.set(a,c,d));d.push.apply(d,Array.prototype.slice.call(arguments,2))},coalesce:function(a,c,d){for(var n,b=0,e=c.length;b<e;b++)if(void 0!==(n=f.get(a,c[b])))return n;return d},get:function(a,c,d){_.isNumber(c)&&(c=[c]);if(_.isEmpty(c))return a;if(_.isEmpty(a)&&a&&null==a.innerHTML)return d;
if(_.isString(c))return f.get(a,c.split("."),d);var n=g(c[0]);if(1===c.length){if(a&&void 0===a[n])return d;if(a)return a[n]}return a?f.get(a[n],c.slice(1),d):d},del:function(b,c){return a(b,c)}};p.getAt=function(a,c,d){return f.get(a,c,d)};p.setAt=function(a,c,d){return f.set(a,c,d)};p.hasAt=function(a,c){return f.has(a,c)};p.ensureAt=function(a,c,d){return f.ensureExists(a,c,d)};p.deleteAt=function(a,c){return f.del(a,c)};p.merge=function(a,c){for(var d in c)"object"!=typeof a[d]?a[d]=c[d]:"object"==
typeof c[d]&&(a[d]=p.merge(a[d],c[d]));return a};p.clone=function(a){if(!a||"object"!=typeof a||p.isFunction(a))return a;if(a.nodeType&&"cloneNode"in a)return a.cloneNode(!0);if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp)return new RegExp(a);var c,d,n;if(p.isArray(a))for(c=[],d=0,n=a.length;d<n;++d)d in a&&c.push(p.clone(a[d]));else c=a.constructor?new a.constructor:{};return p._mixin(c,a,p.clone)};p._mixin=function(a,c,d){var n,b,f={};for(n in c)b=c[n],n in a&&(a[n]===
b||n in f&&f[n]===b)||(a[n]=d?d(b):b);return a};p.mixin=function(a,c){if(c){a||(a={});for(var d=arguments.length,n=1;n<d;n++)p._mixin(a,arguments[n])}return a};p.cloneKeys=function(a,c){var d={},n;for(n in a)if(!0!==c||n in a)d[n]=a[n];return d};p.isArray=function(a){return _.isArray(a)};p.isObject=function(a){return _.isObject(a)};p.isString=function(a){return _.isString(a)};p.isNumber=function(a){return _.isNumber(a)};p.isFunction=function(a){return _.isFunction(a)};return p})},"xide/utils":function(){define(["dcl/dcl"],
function(p){return p(null,{declaredClass:"xide.utils"})})},"xlog/Server":function(){define("dojo/_base/declare dojo/_base/lang xide/types xide/utils xide/factory dojo/node!winston".split(" "),function(p,m,l,k,g,e){return p("xlog.Server",null,{fileLogger:null,loggly:null,delegate:null,publishLog:!0,loggers:{},constructor:function(a){for(var b in arguments)arguments.hasOwnProperty(b)&&(this[b]=a[b])},createLogger:function(a){var b=new e.Logger({transports:[new e.transports.File(a)]});if(this.publishLog)b.on("logging",
function(b,h,c,d){d.logId=a.filename;b={level:h,message:c,data:d,time:(new Date).getTime()};g.publish(l.EVENTS.ON_SERVER_LOG_MESSAGE,b)});return b},start:function(a){this.loggers={};this.options=a;if(a.fileLogger&&(this.fileLogger=e.add(e.transports.File,a.fileLogger),this.publishLog))this.fileLogger.on("logging",function(a,f,h,c){a={level:f,message:h,data:c,time:(new Date).getTime()};g.publish(l.EVENTS.ON_SERVER_LOG_MESSAGE,a)});a.loggly&&(this.loggly=e.add(e.transports.Loggly,a.loggly));null===
a.console&&e.remove(e.transports.Console)}})})},"xide/factory":function(){define(["dojo/_base/declare"],function(p){return p("xide.factory",null,{})})},"nxapp/types":function(){define(["dojo/_base/declare"],function(p){return p("nxapp.types",null,{})})},"nxapp/utils/FileUtils":function(){define(["dojo/_base/json","dojo/node!path","dojo/node!fs","dojo/node!util","nxapp/utils"],function(p,m,l,k,g){g.getExtension=function(e){e=m.extname(e||"").split(".");return e[e.length-1]};g.readFile=function(e){var a=
l.statSync(e).size,b=new Buffer(a);e=l.openSync(e,"r");if(!a)return"";l.readSync(e,b,0,a,0);l.closeSync(e);return b.toString()};g.writeFile=function(e,a){l.writeFile(e,a,function(a){a&&console.log(a)})};g.writeJSONFile=function(e,a){var b=JSON.stringify(a,null,4);l.writeFile(e,b,function(a){a&&console.log(a)})};return g})},"nxapp/utils":function(){define(["dojo/_base/declare"],function(p){return p("nxapp.utils",null,{})})},"nxapp/utils/TCPUtils":function(){define(["dojo/node!net","nxapp/utils","nxapp/server/WebSocket",
"nxapp/server/DeviceServer","nxapp/server/FileServer"],function(p,m,l,k,g){m.checkPort=function(e,a,b){var f=new p.Socket,h=null;f.on("connect",function(){h="open";f.end()});f.setTimeout(1500);f.on("timeout",function(){h="closed";f.destroy()});f.on("error",function(a){h="closed"});f.on("close",function(c){b(null,h,a,e)});f.connect(e,a)};m.createSocketServer=function(e,a){var b=new l;b.init({options:{port:e.socket_server.port,context:a,host:e.socket_server.host}});b.ctx=a;console.error("create socket server "+
e.socket_server.host);b.start(null,e);console.error("started socket server");return l};m.createDeviceServer=function(e,a){var b=new k;b.init({options:{port:e.socket_server.port,context:a,host:e.socket_server.host}});b.ctx=a;console.error("create device server "+e.socket_server.host+":"+e.socket_server.port);b.start(null,e);return b};m.createFileServer=function(e,a){var b=new g;b.init({options:{port:e.socket_server.port,context:a,host:e.socket_server.host}});b.ctx=a;console.error("create file server "+
e.socket_server.host);b.start(null,e);return l};m.connect=function(e,a){};return m})},"nxapp/server/WebSocket":function(){define("dojo/_base/declare dojo/_base/lang xide/types xide/factory nxapp/server/ServerBase nxapp/utils/_LogMixin nxapp/server/_CommandsParserMixin dojo/node!http dojo/node!sockjs dojo/node!colors".split(" "),function(p,m,l,k,g,e,a,b,f,h){return p("nxapp.server.WebSocket",[g,e,a],{_io_socket:null,clients:null,broadCastMessage:function(a,d){for(var n=this.clients.length;n--;)if(void 0!==
this.clients[n]){var b={event:a,data:d};3===this.clients[n].readyState?(this.clients[n].close(),this.clients.remove(this.clients[n])):(JSON.stringify(b),this.clients[n].write(JSON.stringify(b)))}},onFileChanged:function(a){this.broadCastMessage(l.EVENTS.ON_FILE_CHANGED,{path:a.path,type:a.type})},start:function(a,d){this.profile=d;this.options=m.mixin(this.options,a);this.clients=[];var n=this;k.subscribe(l.EVENTS.ON_FILE_CHANGED,this.onFileChanged,this);var q=this.options.port,h=this.options.host;
if(q){this.initLogger(d.debug);this.log("Socket server running in "+q,"socket_server");var e={};this.showDebugMsg("socket_server")||(e.log=function(){});var e=f.createServer(e),g=b.createServer(this._handler);e.installHandlers(g);g.listen(q,h);this._handleSocketEmits(e);k.publish(l.EVENTS.ON_WEBSOCKET_START,{socket_server:{port:q,socket_handler:e}},this);e.on("connection",function(d){var a=n.clients.push(d);d.on("close",function(){delete n.clients[a]})});return!0}console.error("Port must be provided into options");
return!1},emit:function(a,d){this.showDebugMsg("socket_server")&&!_.isString(d)&&_.isObject(d)&&(d=JSON.stringify(d));this.socket&&this.socket.write(d)},_handleSocketEmits:function(a){var d=this.options.port,n=this.options.delegate,b=this;a.on("connection",function(a){b.socket=a;k.publish(l.EVENTS.ON_WEBSOCKET_CONNECTION,{connection:{port:d,socket_handler:a}},this);a.on("data",function(d){m.isString(d)&&(d=dojo.fromJson(d));d.manager_command?n.handleManagerCommand(d,a):n.handleDeviceCommand(d,a)});
a.on("close",function(){console.error("closed!")})})}})})},"nxapp/server/ServerBase":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/_base/lang"],function(p,m,l){return p("nxapp.server.ServerBase",[m],{options:null,delegate:null,ctx:null,_defaultOptions:function(){return{delegate:this}},init:function(k){this.options=l.mixin(this._defaultOptions(),k.options)}})})},"nxapp/utils/_LogMixin":function(){define(["dcl/dcl"],function(p){return p(null,{declaredClass:"nxapp.utils._LogMixin",debug_conf:null,
logger:null,initLogger:function(m){this.debug_conf=m},log:function(m,l,k,g){l||(l=this._debugContext().main);l&&!this.showDebugMsg(l)||!this.logger||(k=k||"info",g.time=(new Date).getTime(),this.logger.log(k,m,g))},logEx:function(m,l,k,g){this.logger?(l=l||"info",g=g||{},g.type=k||"Unknown",g.time=g.time||(new Date).getTime(),this.logger.log(l,m,g)):console.error("have no logger!")},showDebugMsg:function(m){if(null!=this.debug_conf)return this.debug_conf.all?!0:this.debug_conf[m]?!0:!1;console.log("No debug config, showing all.");
this.debug_conf={all:!0};return!0}})})},"nxapp/server/_CommandsParserMixin":function(){define(["dcl/dcl","dojo/_base/declare","nxapp/types/Types","nxapp/utils/_console"],function(p,m,l,k){var g=!1;return p(null,{declaredClass:"nxapp.server._CommandsParserMixin",handleManagerCommand:function(e,a){switch(e.manager_command){case l.SOCKET_SERVER_COMMANDS.MANAGER_TEST:k.dir("Test Manager command");break;case l.SOCKET_SERVER_COMMANDS.MQTT_PUBLISH:return this.sendMQTTMessage(e,a);case l.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER:return this.startDriver(e,
a);case l.SOCKET_SERVER_COMMANDS.GET_DEVICE_VARIABLES:return this.getVariables(e,a);case l.SOCKET_SERVER_COMMANDS.WRITE_LOG_MESSAGE:this.logClientMessage(e);break;case l.SOCKET_SERVER_COMMANDS.MANAGER_STOP_DRIVER:this.stopDriver(e);break;case l.SOCKET_SERVER_COMMANDS.MANAGER_STATUS:e={message:"returning status",deviceConnections:this.options.context.getConnectionManager().getNumberOfConnections()};this.emit(l.SOCKET_SERVER_COMMANDS.SIGNAL_RESPONSE,JSON.stringify(e));break;case l.SOCKET_SERVER_COMMANDS.MANAGER_CLOSE_ALL:this.options.context.getConnectionManager().closeAll()}},
handleDeviceCommand:function(e,a){var b=e.device_command,f=this.options.context,h=this,c=this;g=!1;this.showDebugMsg("socket_server")&&g&&k.log("Handle device command: "+b+" | "+l.SOCKET_SERVER_COMMANDS.CALL_METHOD);var d=f.getConnectionManager().connect(e.host,e.protocol,e.port,null,null,a);a||g&&k.error("---have no client connect");try{f.getConnectionManager().registerFeedBack(d,function(d,a){c.profile.debug.debugDevices&&g&&k.log("Data received from "+d.host);h.emit(l.SOCKET_SERVER_COMMANDS.SIGNAL_RESPONSE,
a);if(_.isString(a))e.lastResponse=""+a;else if(_.isObject(a))try{e.lastResponse=JSON.stringify(a)}catch(n){g&&k.error("error serializing data")}c.onDeviceMessage(d,a)})}catch(n){k.error("-register feed back function failed",n),k.trace()}try{switch(b){case l.SOCKET_SERVER_COMMANDS.CALL_METHOD:this.options.context.getConnectionManager().callMethod(d,e,a);break;case l.SOCKET_SERVER_COMMANDS.DEVICE_SEND:this.options.context.getConnectionManager().send(d,e.command,e.options)}}catch(q){k.error("error command parser",
q)}}})})},"nxapp/types/Types":function(){define(["dojo/_base/lang","xide/types/Types"],function(p,m){p.mixin(m.EVENTS,{ON_FILE_CHANGED:"fileChanged",ON_CONNECTION_CREATED:"connectionCreated",ON_CONNECTION_ERROR:"connectionError",ON_WEBSOCKET_START:"webSocketStart",ON_WEBSOCKET_CONNECTION:"webSocketConnection",ON_MQTT_MESSAGE:"onMQTTMessage",ON_DEVICE_MESSAGE:"onDeviceMessage",ON_COMMAND_FINISH:"onCommandFinish",ON_COMMAND_ERROR:"onCommandError",ON_DEVICE_DISCONNECTED:"onDeviceDisconnected",ON_DEVICE_CONNECTED:"onDeviceConnected",
STORE_CHANGED:"storeChange",BEFORE_STORE_CHANGE:"beforeStoreChange",STORE_REFRESHED:"storeRefreshed",ON_DID_OPEN_ITEM:"onDidOpenItem",ON_SHOW_PANEL:"onShowPanel",ITEM_SELECTED:"itemSelected",ERROR:"fileOperationError",STATUS:"fileOperationStatus",IMAGE_LOADED:"imageLoaded",IMAGE_ERROR:"imageError",RESIZE:"resize",UPLOAD_BEGIN:"uploadBegin",UPLOAD_PROGRESS:"uploadProgress",UPLOAD_FINISH:"uploadFinish",ON_CLIPBOARD_COPY:"onClipboardCopy",ON_CLIPBOARD_PASTE:"onClipboardPaste",ON_CLIPBOARD_CUT:"onClipboardCut",
ON_CONTEXT_MENU_OPEN:"onContextMenuOpen",ON_PLUGIN_LOADED:"onPluginLoaded",ON_PLUGIN_READY:"onPluginReady",ON_MAIN_VIEW_READY:"onMainViewReady2",REGISTER_EDITOR:"registerEditor",REGISTER_ACTION:"registerAction",ON_FILE_CONTENT_CHANGED:"onFileContentChanged",ON_PANEL_CLOSED:"onPanelClosed",ON_PANEL_CREATED:"onPanelCreated",SET_DEVICE_VARIABLES:"setDeviceVariables"});m.LOG_CONTEXT={DEVICE:"Device"};m.SOCKET_SERVER_COMMANDS={MQTT_PUBLISH:"MQTT_PUBLISH",MQTT_SUBSCRIBE:"MQTT_SUBSCRIBE",SIGNAL_MANAGER:"Manager_command",
SIGNAL_DEVICE:"Device_command",CALL_METHOD:"Call_Method",SIGNAL_RESPONSE:"WebSocket_response",MANAGER_TEST:"Manager_Test",MANAGER_CLOSE_ALL:"Close_All_Connections",MANAGER_STATUS:"status",MANAGER_START_DRIVER:"startDriver",GET_DEVICE_VARIABLES:"getVariables",MANAGER_STOP_DRIVER:"stopDriver",DEVICE_SEND:"Device_Send",LOG:"Log",WRITE_LOG_MESSAGE:"Write_Log_Message"};return m})},"nxapp/utils/_console":function(){define(["dojo/has!host-node?dojo/node!tracer"],function(p){var m=m;p&&(m=p.colorConsole({format:"\x3c{{title}}\x3e {{message}} (in {{file}}:{{line}})",
dateformat:"HH:MM:ss.L"}));"undefined"==typeof logError&&(global.logError=function(l,k){m.error("Error "+k,l)});return m})},"nxapp/server/DeviceServer":function(){define("dcl/dcl dojo/_base/declare dojo/_base/lang xide/types xide/factory nxapp/server/WebSocket nxapp/utils/_LogMixin nxapp/server/_CommandsParserMixin dojo/node!http dojo/node!sockjs dojo/node!colors nxapp/utils/_console xide/utils".split(" "),function(p,m,l,k,g,e,a,b,f,h,c,d,n){return m("nxapp.server.WebSocket",[e,a,b],{mqttManager:null,
sendMQTTMessage:function(d,a){var c=d.data.device;d.data.sourceHost=a.remoteAddress;d.data.sourcePort=a.remotePort;if(c&&(c=this.ctx.getConnectionManager().getConnection(c.host,c.protocol,c.port))&&c.variables){var n=d.topic.split("/");if(4==n.length&&"Variable"==n[2]){n=n[3];if(!n)return;for(var b=0;b<c.variables.length;b++){var h=c.variables[b];h.name===n&&(h.value=d.data.value)}}}this.mqttManager&&this.mqttManager.publishTopic(d.topic,d.data)},sendClientMessage:function(d,a,c,n){a={data:l.mixin({device:{host:a.host,
port:a.port,protocol:a.protocol}},n),event:c};d.write(JSON.stringify(a))},getVariables:function(a,c){var n=a.device,b=this.ctx.getConnectionManager().getConnection(n.host,n.protocol,n.port);this.ctx.getDeviceManager().toDeviceControlInfo(n);var h=[];if(b){var f=b.variables;f?(h=f,this.sendClientMessage(c,n,k.EVENTS.SET_DEVICE_VARIABLES,{variables:f})):(h=b.variables=a.variables,_.each(h,function(d){d.value=d.initial}),this.sendClientMessage(c,n,k.EVENTS.SET_DEVICE_VARIABLES,{variables:a.variables}))}else d.error(" get variables failed, have no connection");
if((b=c.mqtt)&&!b.didSubscribe)for(f=0;f<h.length;f++)b.subscribe(n.host+"/"+n.port+"/Variable/"+h[f].name)},logClientMessage:function(a){var c=a.data.device;c?this.logEx(a.message,a.level,a.type,{device:{host:c.host,port:c.port,protocol:c.protocol},deviceMessage:"",time:a.time}):d.error("wrong log parameters, host missing",a)},getLogger:function(d){var a=this.ctx.getLogManager(),c=a.options;d=n.replaceAll("/","_",d.host)+"_"+d.port+"_"+d.protocol;var b=a.loggers[d];b||(b=a.createLogger({filename:d,
dirname:c.fileLogger.dirname,json:!0,console:null}),a.loggers[d]=b);return b},logEx:function(d,a,c,n){var b=this.getLogger(n.device);a=a||"info";n=n||{};n.type=c||"Unknown";n.time=n.time||(new Date).getTime();b.log(a,d,n)},stopDriver:function(d){var a=this.ctx.getConnectionManager(),c=this.ctx.getDeviceManager();a.connectionExists(d.host,d.port,d.protocol);a.removeConnection({host:d.host,protocol:d.protocol,port:d.port});c.stopDevice(d.id)},sendClientEvent:function(d){},startDriver:function(a,c){var n=
this.ctx.getConnectionManager();this.ctx.getDriverManager();var b=this.ctx.getDeviceManager();if(-1!==n.connectionExists(a.host,a.protocol,a.port))return n.connect(a.host,a.protocol,a.port,a.mqtt);n.connect(a.host,a.protocol,a.port,a.mqtt,a,c);a.driverOptions&k.DRIVER_FLAGS.RUNS_ON_SERVER&&b&&b.startDevice&&((n=b.getItemById(a.id))?b.toDeviceControlInfo(n)&&b.startDevice(n,!0):d.error("cant find device with id "+a.id));return"xxxx"},onFileChanged:function(a){this.broadCastMessage(k.EVENTS.ON_FILE_CHANGED,
{path:a.path,event:a.event})},onDeviceMessage:function(a,c){c&&c.message&&256<c.message.length||(c?this.broadCastMessage(k.EVENTS.ON_DEVICE_MESSAGE,{device:{host:a.host,port:a.port,protocol:a.protocol},deviceMessage:c}):d.error("---onDeviceMessage:have no data"))},onLogMessage:function(a){this.broadCastMessage(k.EVENTS.ON_SERVER_LOG_MESSAGE,a)},onClientDisconnect:function(a){a.mqtt&&a.mqtt.end()},onClientConnection:function(a){if(this.mqttManager){var d=this;if(a&&!a.mqtt){var c=this.mqttManager.createMQTTClient(a.remoteAddress,
a.remotePort);c.client=a;a.mqtt=c;c.on("message",function(c,n){n.sourceHost!==a.remoteAddress&&n.sourcePort!==a.remotePort&&d.sendClientMessage(a,{},k.EVENTS.ON_MQTT_MESSAGE,{topic:c,message:n.toString(),host:a.remoteAddress,port:a.remotePort})})}}},start:function(a,c){this.profile=c;this.options=l.mixin(this.options,a);this.clients=[];var n=this,b=this.options.port,e=this.options.host;g.subscribe(k.EVENTS.ON_SERVER_LOG_MESSAGE,this.onLogMessage,this);if(b){this.initLogger(c.debug);this.log("Socket server running in "+
b,"socket_server");var m={heartbeat_delay:1E3};this.showDebugMsg("socket_server");m.log=function(){};var m=h.createServer(m),p=f.createServer(this._handler);m.installHandlers(p);p.listen(b,e);this._handleSocketEmits(m);g.publish(k.EVENTS.ON_WEBSOCKET_START,{socket_server:{port:b,socket_handler:m}},this);m.on("connection",function(a){var d=n.clients.push(a);n.onClientConnection(a);a.on("close",function(){n.onClientDisconnect(a);delete n.clients[d]})});return!0}d.error("Port must be provided into options");
return!1},_handleSocketEmits:function(a){var d=this.options.port,c=this.options.delegate,n=this;a.on("connection",function(a){n.socket=a;g.publish(k.EVENTS.ON_WEBSOCKET_CONNECTION,{connection:{port:d,socket_handler:a}},this);a.on("data",function(d){l.isString(d)&&(d=dojo.fromJson(d));d.manager_command?c.handleManagerCommand(d,a):c.handleDeviceCommand(d,a)});a.on("close",function(){})})}})})},"nxapp/server/FileServer":function(){define("dojo/_base/declare dojo/_base/lang xide/types xide/factory nxapp/server/WebSocket nxapp/utils/_LogMixin dojo/node!http dojo/node!sockjs".split(" "),
function(p,m,l,k,g,e,a,b){return p("nxapp.server.WebSocket",[g,e],{onFileChanged:function(a){console.log("file changed : "+a.modulePath);this.broadCastMessage(l.EVENTS.ON_FILE_CHANGED,{path:a.path,modulePath:a.modulePath,mask:a.mask})},start:function(f,h){this.profile=h;this.options=m.mixin(this.options,f);this.clients=[];var c=this;k.subscribe(l.EVENTS.ON_FILE_CHANGED,this.onFileChanged,this);var d=this.options.port,n=this.options.host;if(d){this.initLogger(h.debug);this.log("File Socket server running in "+
d,"socket_server");var q={};this.showDebugMsg("socket_server")||(q.log=function(){});var q=b.createServer(q),e=a.createServer(this._handler);q.installHandlers(e);e.listen(d,n);this._handleSocketEmits(q);k.publish(l.EVENTS.ON_WEBSOCKET_START,{socket_server:{port:d,socket_handler:q}},this);q.on("connection",function(a){var d=c.clients.push(a);a.on("close",function(){delete c.clients[d]})});return!0}console.error("Port must be provided into options");return!1},_handleSocketEmits:function(a){var b=this.options.port,
c=this;a.on("connection",function(a){c.socket=a;k.publish(l.EVENTS.ON_WEBSOCKET_CONNECTION,{connection:{port:b,socket_handler:a}},this);a.on("close",function(){})})}})})},"nxappmain/nxAppBase":function(){define("dcl/dcl dojo/_base/lang nxapp/utils/FileUtils dojo/Stateful dojo/node!commander dojo/node!fs dojo/node!os dojo/node!path xide/factory/Events dojo/has xide/model/Base xide/utils".split(" "),function(p,m,l,k,g,e,a,b,f,h,c,d){h.add("windows",function(){return"win32"===a.platform()});h.add("osx",
function(){return"darwin"===a.platform()});h.add("linux",function(){return"linux"===a.platform()});h.add("arm",function(){return"arm"===a.arch()});return p(c.dcl,{declaredClass:"nxappmain.nxAppBase",profile:null,commander:null,profilePath:"/nxappmain/profile_device_server.json",getDefaultProfilePath:function(){return process.cwd()+this.profilePath},getProfile:function(a){var d={};a||(a=this.commander.profile&&0<this.commander.profile.length?this.commander.profile:this.getDefaultProfilePath());e.existsSync(a)||
(a=process.cwd()+this.profilePath);var c=l.readFile(a);c?d=dojo.fromJson(c):console.error("have no profile at : "+a);return d},init:function(){this.commander||(g.version("0.0.1").option("-c, --command \x3cname\x3e","command to send").option("-i, --info","return service profile").option("-f, --file \x3cpath\x3e","run a file").option("-o, --oneshot","one shot command").option("-s, --send","Puts the shell into send mode").option("-P, --port \x3cnumber\x3e","set the device connection port").option("-H, --host \x3caddress\x3e",
"set the device host").option("-T, --protocol \x3cname\x3e","set the device connection protocol").option("-d, --data \x3cname\x3e","path to data location").option("-D, --driver \x3cname\x3e","runs a driver").option("-j, --jhelp","output options as json"),this.commander=g,this.commander.allowUnknownOption(!0),this.commander.parse(process.argv));if(g.jhelp){var a=[];g.options.map(function(d){a.push(d)});console.log(JSON.stringify(a));process.exit()}this.profile=this.getProfile(this.profilePath);d.mixin(this.profile,
this.commander);var c=b.resolve(this.profile.data);e.existsSync(c)||(c=process.cwd()+"/data/system",this.profile.data=c,g.data=c)}})})},"xide/factory/Events":function(){define(["xide/factory","dojo/_base/connect","dojo/_base/lang","dojo/on","dojo/has"],function(p,m,l,k,g){var e={click:null,dblclick:null,mousedown:null,mouseup:null,mouseover:null,mousemove:null,mouseout:null,keypress:null,keydown:null,keyup:null,focus:null,blur:null,change:null};p.publish=function(a,b,f,h){b=b?_.isString(b)?{message:b}:
b:{};f=a;var c=m.publish,d=[];_.isArray(a)||(f=[a]);a=0;for(var n=f.length;a<n;a++){var q=f[a];if(!h||h(q))d=c(q,b)}return d};p.subscribe=function(a,b,f,h){var c=a,d=m.subscribe,n=[];_.isArray(a)||(c=[a]);a=0;for(var q=c.length;a<q;a++)if(c[a]&&(!h||h(y))){var r=c[a],g=_.isString(r),y=g?r:r.key,r=g?b:r.handler,g=y in e;null!=f?(r=null!=r?r:f[y],g=g?k(f,y,l.hitch(f,r)):d(y,l.hitch(f,r)),g.handler=l.hitch(f,r)):(g=m.subscribe(y,r),g.handler=r);g.type=y;n.push(g)}return n};return p})},"xide/model/Base":function(){define(["dcl/dcl",
"xdojo/declare","xide/utils"],function(p,m,l){var k={declaredClass:"xide/model/Base",constructor:function(g){l.mixin(this,g)},getLabel:function(){return null},getID:function(){return null}};m=m("xide/model/Base",null,k);m.dcl=p(null,k);return m})},"nxapp/manager/Context":function(){define(["dcl/dcl","./ConnectionManager","xide/manager/ContextBase"],function(p,m,l){return p(l,{declaredClass:"nxapp.manager.Context",connectionManager:null,driverManager:null,fileManager:null,blockManager:null,deviceServer:null,
logManager:null,getDeviceServer:function(){return this.deviceServer},getFileManager:function(){return this.fileManager},getConnectionManager:function(){return this.connectionManager},initManagers:function(k){this.connectionManager.init(k)},constructManagers:function(){this.connectionManager=new m({ctx:this})},getLogManager:function(){return this.logManager}})})},"nxapp/manager/ConnectionManager":function(){define("dcl/dcl dojo/_base/array nxapp/manager/ManagerBase nxapp/utils/_LogMixin nxapp/protocols/Tcp nxapp/protocols/Udp nxapp/protocols/Driver nxapp/protocols/SSH nxapp/protocols/Serial nxapp/protocols/MQTT nxapp/types/Types xide/factory xide/utils nxapp/utils/_console".split(" "),
function(p,m,l,k,g,e,a,b,f,h,c,d,n,q){return p([l,k],{declaredClass:"nxapp.manager.ConnectionManager",options:null,profile:null,lastUpTime:null,mqttManager:null,onWakeup:function(){this.lastUpTime=(new Date).getTime();for(var a=0;a<this.pool.length;a++){var d=this.pool[a];d.socket&&d.socket.close&&d.socket.close();d.socket&&d.socket._socket&&d.socket._socket.close&&d.socket._socket.close()}this.pool=[]},init:function(a){this.profile=a;this.initLogger(a.debug);this.lastUpTime=(new Date).getTime();
var d=this;setInterval(function(){var a=(new Date).getTime();if(3E3<a-d.lastUpTime)d.onWakeup();d.lastUpTime=a},1E3)},connect:function(r,v,y,k,l,m){this.debug=!0;if(!v)return q.error("have no protocol, exit"),!1;v=v.toLowerCase();var p={port:y,host:r,debug:this.profile.debug,delegate:this};n.mixin(p,l);l=this.connectionExists(r,y,v);if(l!=this.poolNotFound){k=r+":"+y+":"+v+"_didOnConnect";if(m[k])return l;m[k]=!0;if(this.debug)this.onConnect(r,y,v);return l}l=m=null;switch(v){case c.PROTOCOL.TCP:m=
new g;m.init({options:p});l=m.connect();break;case c.PROTOCOL.UDP:m=new e;m.init({options:p});l=m.connect();break;case c.PROTOCOL.DRIVER:m=new a({owner:this});m.init({options:p});l=m.connect(p);break;case c.PROTOCOL.SSH:m=new b({owner:this});m.init({options:p});l=m.connect(p);break;case c.PROTOCOL.SERIAL:m=new f({owner:this});m.init({options:p});l=m.connect(p);break;case c.PROTOCOL.MQTT:m=new h({owner:this}),m.init({options:p}),l=m.connect(p)}if(l){l=this.addConnection(l,r,y,v);d.publish(c.EVENTS.ON_CONNECTION_CREATED,
{connection:this.getConnection(l)},this);if(this.mqttManager)this.mqttManager.onConnectedToDevice(p,m,k);return l}d.publish(c.EVENTS.ON_CONNECTION_ERROR,{connection:{port:y,host:r,protocol:v}},this);return!1},send:function(a,d,c){var n=this.getConnection(a);return n.socket&&n.socket._socket&&n.socket._socket.writable?n.socket.send(d,c):(q.log("client is not writable "+d,a),this.close(a,!0),!1)},callMethod:function(a,d){var c=this.getConnection(a);if(!(c.socket&&c.socket._socket&&c.socket._socket.writable))return q.log("client is not writable "+
cmd,a),this.close(a,!0),!1;d=n.getJson(d);var b=d.method,h=d.args;if(c.socket[b])return c.socket[b].apply(c.socket,[h,d]);q.error("no such method ",c)},close:function(a,d){var c=this.getConnection(a);c&&c.socket&&c.socket._socket&&c.socket._socket.close&&c.socket._socket.close();this.removeConnection(a)},closeAll:function(){var a=this;this.forEachPool(function(d,c){a.close(c)});this.clearPool()},onTimeout:function(a){q.log("Timeout!")},onClose:function(a,d){this.removeConnection(a,d)},onDrain:function(a){q.log("Drain")},
onError:function(a,d,c){a.lastError=d;this.removeConnection(a,c)},onFinish:function(a,d,c){this.showDebugMsg("protocol_messages");this.pinMode(2,0);d=this.connectionExists(a.host,a.port,a.protocol);d!=this.poolNotFound?this.callFeedBack(d,data):q.error("ConnectionManager::onData : cant find pool - reference:"+d+":"+a.host+":"+a.port+":"+a.protocol)},onData:function(a,d){this.showDebugMsg("protocol_messages");var c=this.connectionExists(a.host,a.port,a.protocol);if(c!=this.poolNotFound)try{this.callFeedBack(c,
d)}catch(n){q.error("call feedback error : "+n.message),q.log(n.stack)}else q.error("ConnectionManager::onData : cant find pool - reference:"+c+":"+a.host+":"+a.port+":"+a.protocol)},onConnect:function(a,d,n,b){var h={device:{host:a,port:d,protocol:n}};this.ctx.getDeviceServer().broadCastMessage(c.EVENTS.ON_DEVICE_CONNECTED,h);var q=this.ctx.getDeviceServer();b&&(a=this.connectionExists(a,d,n),this.registerFeedBack(a,function(a,d){q.emit(c.SOCKET_SERVER_COMMANDS.SIGNAL_RESPONSE,d);d.lastResponse=
""+d;q.onDeviceMessage(a,d)}))},onHandle:function(a,d){this.showDebugMsg("protocol_messages")},pool:[],poolNotFound:-1,getNumberOfConnections:function(){return this.pool.length},getDeviceConnection:function(){if(this.getNumberOfConnections())for(var a=0;a<this.pool.length;a++);},addConnection:function(a,d,c,n,b,h){this.pool.push({socket:a,host:d,port:c,protocol:n,user:b,customFields:h,feedbackTo:[]});return this.pool.length-1},removeConnection:function(a,d){for(var n=this,b=0;b<this.pool.length;b++){var h=
this.pool[b];if(a.host===h.host&&a.port===h.port&&a.protocol===h.protocol){h.socket&&h.socket.close();this.ctx.getDeviceServer()&&setTimeout(function(){var d={device:{host:h.host,port:h.port,protocol:h.protocol},error:a.lastError};n.ctx.getDeviceServer().broadCastMessage(c.EVENTS.ON_DEVICE_DISCONNECTED,d)},1E3);this.pool.splice(b,1);break}}},clearPool:function(){this.pool=[]},getConnection:function(a){if(3==arguments.length){for(var d=arguments[0],c=arguments[1],n=arguments[2],b=0;b<this.pool.length;b++){var h=
this.pool[b];if(h.host==d&&h.port==n&&h.protocol==c)return h}return null}return this.pool[a]},registerFeedBack:function(a,d){var c=this.getConnection(a);null==c?q.error("cant find connection for pool ref:"+a):c&&0<c.feedbackTo.length||c.feedbackTo.push(d)},callFeedBack:function(a,d){var c=this,n=this.getConnection(a);n?n.feedbackTo&&0!=n.feedbackTo.length?_.each(n.feedbackTo,function(n){n(c.getConnection(a),d)}):q.error("-- call feed back: have no feedback targets",n.feedbackTo):q.error("-- call feed back: have no connection")},
connectionExists:function(a,d,c){var n=this.poolNotFound;_.each(this.pool,function(b,h){b&&b.host===a&&b.port===d&&b.protocol===c&&(n=h)});return n},forEachPool:function(a){_.each(this.pool,function(d,c){a(d,c)})}})})},"nxapp/manager/ManagerBase":function(){define(["dcl/dcl","xide/model/Base"],function(p,m){var l=p(m.dcl,{declaredClass:"nxapp.manager.ManagerBase",ctx:null,profile:null,init:function(k){this.profile=k}});p.chainAfter(l,"init");return l})},"nxapp/protocols/Tcp":function(){define(["dojo/_base/declare",
"nxapp/utils","nxapp/protocols/ProtocolBase","dojo/node!net","dojo/node!child_process"],function(p,m,l,k,g){return p("nxapp.protocols.Tcp",[l],{_socket:null,protocolName:"tcp",connect:function(e){this.options=e=e||this.options;var a=this.options.port,b=this.options.host;this.delegate=e.delegate;this._socket=new k.Socket({allowHalfOpen:!0});this._socket.setEncoding(this.options.text_encoding);var f=this;this._socket.connect(a,b,function(){f.delegate.onConnect(b,a,f.protocolName,f)});this._socket.setNoDelay(!0);
this._socket.setKeepAlive(!0,0);this._setupEventListeners(this._socket,this.delegate);this.logConnection("New TCP connection to "+b+":"+a);return this},send:function(e){null==e?console.error("TCP : invalid command"):(e=e.toUpperCase?e.toUpperCase():e,e+=this.options.end_of_command,this._socket.write(e))},close:function(){this._socket.end()}})})},"nxapp/protocols/ProtocolBase":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/_base/lang","nxapp/utils/_LogMixin"],function(p,m,l,k){return p("nxapp.protocols.ProtocolBase",
[m,k],{options:null,protocolName:"undefined",debug_connection:"protocol_connection",debug_messages:"protocol_messages",delegate:null,_setupEventListeners:function(g,e){var a={port:this.options.port,host:this.options.host,protocol:this.protocolName};g.handle=function(b){e.onHandle(a,b)};g.on("data",function(b){e.onData(a,b)});g.on("error",function(b){e.onError(a,b)});g.on("drain",function(){e.onDrain(a)});g.on("timeout",function(){e.onTimeout(a)});g.on("close",function(b){e.onClose(a,b)})},_defaultOptions:function(){return{port:23,
text_encoding:"utf8",end_of_command:"\r"}},init:function(g){var e=this._defaultOptions();this.options=l.mixin(e,g.options);this.initLogger(g.options.debug)},logConnection:function(g){this.log(g,this.debug_connection)},logMessages:function(g){this.log(g,this.debug_messages)}})})},"nxapp/protocols/Udp":function(){define(["dojo/_base/declare","nxapp/utils","nxapp/protocols/ProtocolBase","dojo/node!dgram"],function(p,m,l,k){return p("nxapp.protocols.Udp",[l],{_socket:null,protocolName:"udp",port:null,
host:null,connect:function(g){this.options=g||this.options;this.port=this.options.port;this.host=this.options.host;this.delegate=this.options.delegate;this._socket=k.createSocket("udp4");this._setupEventListeners(this._socket,this.delegate);return this},send:function(g){try{var e=new Buffer(g),a=this;this._socket.send(e,0,e.length,this.port,this.host,function(b,h){if(b)a.delegate.onError(b);else console.log("UDP message sent to "+a.host+":"+a.port)})}catch(b){console.error("crash !")}},close:function(){this._socket.close()}})})},
"nxapp/protocols/Driver":function(){define("dojo/_base/declare nxapp/utils nxapp/protocols/ProtocolBase dojo/node!net dojo/node!path dojo/node!child_process require dojo/node!tracer".split(" "),function(p,m,l,k,g,e,a,b){var f=b.colorConsole();return p("nxapp.protocols.Driver",[l],{_socket:null,protocolName:"driver",instance:null,onError:function(a){debugger},onConnected:function(a,c,d){f.error("# driver onConnected "+this.options.host+" : "+this.options.port+" @ "+this.protocolName);this.delegate.onConnect(this.options.host,
this.options.port,this.protocolName)},_connect:function(a,c){var d=new a(c);d.owner=this;d.connect||f.error("     have     no connect");d.connect();this._socket=d;this._socket.writable=!0},connect:function(b){this.delegate=b.delegate;if(!b||!b.driver)return f.error("no driver in options",b),this;try{var c="system_drivers/"+b.driver.replace(".js","");f.log("load driver module "+c+" \x3d\x3d\x3d ");var d=this;try{a([c],function(a){f.log("got module "+c);try{d._connect?d._connect(a,b):f.error("have no _connect")}catch(n){f.error("error calling connect on "+
c+" | Error "+n.message,n)}})}catch(n){f.error("-----error loading driver module "+c+" :: "+n.message,n)}}catch(q){f.error("Error connecting driver "+q.message)}return this},send:function(a){null==a?f.error("TCP : invalid command"):(this.logMessages("TCP - Sending command: "+a),a+=this.options.end_of_command,this._socket.write(a))},close:function(){this._socket.end()}})})},"nxapp/protocols/SSH":function(){define("dojo/_base/declare xide/utils nxapp/types/Types nxapp/protocols/ProtocolBase dojo/node!net dojo/node!path dojo/node!ssh2 dojo/node!strip-ansi dojo/node!child_process dojo/node!util dojo/node!deferred dojo/node!ansi-to-html dojo/node!ansi_up nxapp/utils/_console".split(" "),
function(p,m,l,k,g,e,a,b,f,h,c,d,n,q){var r=!1;return p("nxapp.protocols.SSH",[k],{_socket:null,protocolName:"ssh",instance:null,connection:null,sshOptions:null,getOptions:function(a,d,c){return m.mixin({config:!1,host:a,username:c.username,password:c.password,agent:"",agentForward:!1,port:d,proxy:{port:d},ignoreErrors:!1,minimatch:{},debug:r,suppressRemoteErrors:!1,callback:function(){}},c)},onConnected:function(){r&&q.log("# "+this.protocolName+" - Protocol:: onConnected "+this.options.host+" : "+
this.options.port+" @ "+this.protocolName);this.delegate.onConnect(this.options.host,this.options.port,this.protocolName)},onError:function(a,d){this.delegate.onError(this,m.mixin({code:a},d),this.options)},onClose:function(){this.delegate.onClose(this,this.options)},connect:function(d){this.delegate=d.delegate;if(!d||!d.driver)return r&&q.error("no driver in options",d),this;var c=this,n=d.host,b=d.port;d=m.getJson(d.options);!0===d.debug&&(r=!0);var h=this.getOptions(n,b,d);d=function(a){var d=
{host:a.host,port:a.port,username:a.username,readyTimeout:a.readyTimeout,agentForward:a.agentForward};a.privateKey?(d.privateKey=a.privateKey.trim(),a.passphrase&&(d.passphrase=a.passphrase.trim())):a.password?(d.password=a.password,a.agent&&(d.agent=a.agent)):d.agent=a.agent;return d}(h);this.sshOptions=h;this.host=n;this.port=b;this.protocol=this.protocolName;r&&q.log("SSH-\x3econnecting SSH with",h);var f=new a;this.connection=f;f.on("keyboard-interactive",function(a,d,c,n,b){n.forEach(function(a){-1!==
a.prompt.toLowerCase().indexOf("password")&&b([h.password])})});f.on("connect",function(){r&&q.log("SSH-\x3eConnection :: connect")});f.on("ready",function(){r&&q.log("SSH-\x3eConnection :: ready");var a,d,n;f.once("session",function(c,b){c().once("pty",function(c,b,h){a=h.rows;d=h.cols;n=h.term;c&&c();r&&q.log("SSH-\x3e pty "+a+" "+d+" "+n)}).once("shell",function(a,d){r&&q.log("SSH-\x3eshell")})});c.onConnected()});f.on("error",function(a){r&&q.warn("SSH-\x3eConnection - Error :: "+a);a=a.level+
":"+a.message;c.onError(a);c.lastError=a});f.on("debug",function(a){r&&q.log("SSH-\x3eConnection :: debug :: "+a)});f.on("end",function(){r&&q.log("SSH-\x3eConnection :: end");c.onClose()});f.on("close",function(a){if(a)r&&q.log("SSH - Connection :: Close, had Error ");else c.onClose()});f.connect(d);this._socket=f;this._socket.writable=!0;return this},onData:function(a){r&&q.log("SSH-\x3eonData",a);this.delegate.onData(this,a)},onCommandError:function(a,d){r&&q.log("SSH-\x3eonCommandError "+a+" id "+
d.id+" src "+d.src);var c=this.delegate;try{c.onData(this,m.mixin({cmd:a,event:l.EVENTS.ON_COMMAND_ERROR},d))}catch(n){q.error("---",n)}},onFinish:function(a,d){r&&q.log("SSH-\x3eonFinish "+a+" id "+d.id+" src "+d.src);var c=this.delegate;try{c.onData(this,m.mixin({cmd:a,event:l.EVENTS.ON_COMMAND_FINISH},d))}catch(n){q.error("onFinish-Error:",n)}},execCommand:function(a,b){var h=this.connection,f=this,e=f.sshOptions,g=c(),k=b.id,l=new d(e.ansiOptions||{}),m=1==e.waitForEOF,p="";if(0===a.length)r&&
q.log("SSH-\x3eno more SSH commands, call Defered::resolve");else{var B=a.shift();r&&q.log("SSH-\x3eExecuting :: "+B);h.exec(B,e,function(d,c){if(d)r&&q.log("---error in SSH ",d);else{var h;c.on("data",function(a,d){h=String(a);!0!==e.ansiUp&&1==e.html?h=l.toHtml(h):1==e.ansiUp&&1==e.html&&(h=n.ansi_to_html(h));(r||e.debug)&&q.log("SSH DATA : "+h);"stderr"===d?e.suppressRemoteErrors?r&&q.warn("SSH-\x3edata - 1"+h):r&&q.warn("SSH-\x3estdErr"+h):(r&&q.log("SSH-\x3edata - 2 "+h),m?(p+=h,c.lastData=p):
(f.onData(h),c.lastData=h))});c.on("end",function(){r&&q.log(!0!=="SSH-\x3eStream :: EOF, had Error "+c.hadError);h&&"function"===typeof e.callback&&e.callback(h.trim());c.hadError?g.reject({id:k,error:c.lastData}):(m&&(r&&q.error("--------------release data on EOF"),f.onData(c.lastData)),g.resolve(k))});c.on("exit",function(){r&&q.log("SSH-\x3eStream :: exit")});c.on("close",function(d,n){r&&q.log("SSH-\x3eStream :: close :: code: "+d+", signal: "+n);127==d&&(r&&q.error("--command error!"),c.hadError=
!0);e.ignoreErrors||0===d?f.execCommand(a,b):r&&q.error("SSH-\x3eError executing task "+B)})}})}return g.promise},send:function(a,d){if(null==a)q.error("SSH: invalid command");else{d=d||{id:m.createUUID()};this.logMessages("SSH - Sending command: "+a);r&&q.log("SSH-\x3esend : "+a,d);var c=this.execCommand([a],d),n=this;c.then(function(c){n.onFinish(a,d)},function(c){d.error=c.error;n.onCommandError(a,d)});return c}},close:function(){this.connection&&(this.connection.end(),this.connection=null)}})})},
"nxapp/protocols/Serial":function(){define("dojo/_base/declare xide/utils nxapp/types/Types nxapp/protocols/ProtocolBase dojo/node!net dojo/node!path dojo/node!child_process dojo/node!util dojo/node!deferred nxapp/utils/_console xdojo/has!serialport?dojo/node!serialport".split(" "),function(p,m,l,k,g,e,a,b,f,h,c){var d=!1;return p("nxapp.protocols.Serial",[k],{_socket:null,protocolName:"serial",instance:null,connection:null,sshOptions:null,getOptions:function(a,d,b,h){a=JSON.parse('"'+(h||"\\r")+
'"');a={baudrate:9600,parity:"none",rtscts:!1,xon:!1,xoff:!1,xany:!1,hupcl:!0,rts:!0,cts:!1,dtr:!0,dts:!1,brk:!1,databits:8,stopbits:1,buffersize:256,parser:c.parsers.readline(b.lineBreak||a||"\r")};return m.mixin(a,b)},onConnected:function(){d&&h.log("# "+this.protocolName+" - Protocol:: onConnected "+this.options.host+" : "+this.options.port+" @ "+this.protocolName);this.delegate.onConnect(this.options.host,this.options.port,this.protocolName,this)},onError:function(a,d){this.delegate.onError(this,
m.mixin({code:a},d),this.options)},onClose:function(){this.delegate.onClose(this,this.options)},connect:function(a){this.delegate=a.delegate;if(!has("serialport"))return this.onError("have serial port");if(!a||!a.driver)return d&&h.error("no driver in options",a),this;var b=this,f=a.host,e=a.port,g=m.getJson(a.options||{});!0===g.debug&&(d=!0);this.serialOptions=a=this.getOptions(f,e,g,(a.responseSettings||{}).delimiter);this.host=f;this.port=e;this.protocol=this.protocolName;d&&h.log("Serial-\x3econnecting to "+
f+" with",a);var k=new c.SerialPort(f,a);this.connection=k;try{k.on("open",function(a){if(a){var c=a.level+":"+a.message;b.onError(c);b.lastError=c;d&&h.warn("Serial-\x3eConnection - Error :: "+f+":"+a)}else b.onConnected(),k.on("data",function(a){b.onData(a.toString())})})}catch(l){d&&h.error("Serial-\x3econnect error :: code: ",l)}k.on("close",function(a){d&&h.log("Serial-\x3eclose :: code: ",a);b.onClose();k.close()});this._socket={};this._socket.writable=!0;return this},onData:function(a){d&&
h.log("SERIAL -\x3e on data",a);this.delegate.onData(this,a)},onCommandError:function(a,c){d&&h.log("SERIAL-\x3eCommandError "+a+" id "+c.id+" src "+c.src);var b=this.delegate;try{b.onData(this,m.mixin({cmd:a,event:l.EVENTS.ON_COMMAND_ERROR},c))}catch(f){h.error("---",f)}},onFinish:function(a,c){d&&h.log("SERIALonFinish "+a+" id "+c.id+" src "+c.src);var b=this.delegate;try{b.onData(this,m.mixin({cmd:a,event:l.EVENTS.ON_COMMAND_FINISH},c))}catch(f){h.error("onFinish-Error:",f)}},execCommand:function(a,
c){var b=this.connection,e=this,g=e.sshOptions,k=f(),l=c.id,m=new AnsiToHtml(g.ansiOptions||{}),p=1==g.waitForEOF,C="";if(0===a.length)d&&h.log("SERIALno more SSH commands, call Defered::resolve");else{var A=a.shift();d&&h.log("SERIALExecuting :: "+A);b.exec(A,g,function(b,f){if(b)d&&h.log("---error in SSH ",b);else{var r;f.on("data",function(a,c){r=String(a);!0!==g.ansiUp&&1==g.html?r=m.toHtml(r):1==g.ansiUp&&1==g.html&&(r=ansi_up.ansi_to_html(r));(d||g.debug)&&h.log("SSH DATA : "+r);"stderr"===
c?g.suppressRemoteErrors?d&&h.warn("SERIALdata - 1"+r):d&&h.warn("SERIALstdErr"+r):(d&&h.log("SERIALdata - 2 "+r),p?(C+=r,f.lastData=C):(e.onData(r),f.lastData=r))});f.on("end",function(){d&&h.log(!0!=="SERIALStream :: EOF, had Error "+f.hadError);r&&"function"===typeof g.callback&&g.callback(r.trim());f.hadError?k.reject({id:l,error:f.lastData}):(p&&(d&&h.error("--------------release data on EOF"),e.onData(f.lastData)),k.resolve(l))});f.on("exit",function(){d&&h.log("SERIALStream :: exit")});f.on("close",
function(b,r){d&&h.log("SERIAL-\x3eclose :: code: "+b+", signal: "+r);127==b&&(d&&h.error("--command error!"),f.hadError=!0);g.ignoreErrors||0===b?e.execCommand(a,c):d&&h.error("SERIALError executing task "+A)})}})}return k.promise},send:function(a,c){null==a?h.error("SERIAL invalid command"):(c=c||{id:m.createUUID()},this.logMessages("SERIAL - Sending command: "+a),d&&h.log("SERIAL -\x3e send command: "+a,c),this.connection.write(a))},close:function(){this.connection&&(this.connection.close(),this.connection=
null)}})})},"nxapp/protocols/MQTT":function(){define("dojo/_base/declare xide/utils nxapp/types/Types nxapp/protocols/ProtocolBase dojo/node!net dojo/node!path dojo/node!child_process dojo/node!util dojo/node!deferred nxapp/utils/_console dojo/node!mqtt".split(" "),function(p,m,l,k,g,e,a,b,f,h,c){var d=!0;return p("nxapp.protocols.MQTT",[k],{_socket:null,protocolName:"mqtt",instance:null,connection:null,subscriptions:null,getOptions:function(a,d,c){return m.mixin({clean:!1,clientId:c.clientId||a+
":"+d,port:d},c)},onConnected:function(){d&&h.log("# "+this.protocolName+" - Protocol:: onConnected "+this.options.host+" : "+this.options.port+" @ "+this.protocolName);this.delegate.onConnect(this.options.host,this.options.port,this.protocolName,this)},onError:function(a,d){this.delegate.onError(this,m.mixin({code:a},d),this.options)},onClose:function(){this.delegate.onClose(this,this.options)},connect:function(a){this.delegate=a.delegate;if(!a||!a.driver)return d&&h.error("no driver in options",
a),this;var b=this,f=a.host,e=a.port;a=m.getJson(a.options||{});!0===a.debug&&(d=!0);a=this.getOptions(f,e,a);this.host=f;this.port=e;this.protocol=this.protocolName;d&&h.log("MQTT-\x3econnecting to "+f+" with",a);var g=c.connect(f,a);this.connection=g;try{g.on("connect",function(a){b.onConnected()})}catch(k){d&&h.error("MQTT-\x3econnect error :: code: ",k)}g.on("close",function(a){d&&h.log("MQTT-\x3eclose :: code: ",a);b.onClose();g.end()});this._socket={};this._socket.writable=!0;return this},onData:function(a){var c=
this.delegate;d&&h.log("---mqtt data",a.topic);c.onData(this,a)},onCommandError:function(a,c){d&&h.log("MQTT-\x3eCommandError "+a+" id "+c.id+" src "+c.src);var b=this.delegate;try{b.onData(this,m.mixin({cmd:a,event:l.EVENTS.ON_COMMAND_ERROR},c))}catch(f){h.error("---",f)}},onFinish:function(a,c){d&&h.log("SERIALonFinish "+a+" id "+c.id+" src "+c.src);var b=this.delegate;try{b.onData(this,m.mixin({cmd:a,event:l.EVENTS.ON_COMMAND_FINISH},c))}catch(f){h.error("onFinish-Error:",f)}},execCommand:function(a,
c){var b=this.connection,e=this,g=e.sshOptions,k=f(),l=c.id,m=new AnsiToHtml(g.ansiOptions||{}),p=1==g.waitForEOF,C="";if(0===a.length)d&&h.log("SERIALno more SSH commands, call Defered::resolve");else{var A=a.shift();d&&h.log("SERIALExecuting :: "+A);b.exec(A,g,function(b,f){if(b)d&&h.log("---error in SSH ",b);else{var r;f.on("data",function(a,c){r=String(a);!0!==g.ansiUp&&1==g.html?r=m.toHtml(r):1==g.ansiUp&&1==g.html&&(r=ansi_up.ansi_to_html(r));(d||g.debug)&&h.log("SSH DATA : "+r);"stderr"===
c?g.suppressRemoteErrors?d&&h.warn("SERIALdata - 1"+r):d&&h.warn("SERIALstdErr"+r):(d&&h.log("SERIALdata - 2 "+r),p?(C+=r,f.lastData=C):(e.onData(r),f.lastData=r))});f.on("end",function(){d&&h.log(!0!=="SERIALStream :: EOF, had Error "+f.hadError);r&&"function"===typeof g.callback&&g.callback(r.trim());f.hadError?k.reject({id:l,error:f.lastData}):(p&&(d&&h.error("--------------release data on EOF"),e.onData(f.lastData)),k.resolve(l))});f.on("exit",function(){d&&h.log("SERIALStream :: exit")});f.on("close",
function(b,r){d&&h.log("MQTT-\x3eclose :: code: "+b+", signal: "+r);127==b&&(d&&h.error("--command error!"),f.hadError=!0);g.ignoreErrors||0===b?e.execCommand(a,c):d&&h.error("SERIALError executing task "+A)})}})}return k.promise},addSubscription:function(a,d,c){!this.subscriptions&&(this.subscriptions={});if(a){var b=this,f=""+a;if(!this.subscriptions[f]){a={qos:parseInt(d.qos)||0};h.log("-add subscription "+_.isString(d),a);this.connection.subscribe(f,a);var e=this.subscriptions[f]={id:c.id,src:c.src,
topic:f};this.connection.on("message",function(a,d){if(a===f){var c=m.getJson(d.toString());if(_.isObject(c))b.onData(m.mixin(c,e));else if(_.isString(c)||_.isNumber(c))b.onData(m.mixin({payload:c},e))}})}}else h.error("invalid topic")},unSubscribeTopic:function(a,d,c){a=m.getJson(a);(a=""+a.topic)&&this.unsubscribe(a)},subscribeTopic:function(a,d,c){a=m.getJson(a);d=m.getJson(d);c=""+a.topic;delete a.topic;this.addSubscription(c,a,d.options)},publishTopic:function(a,c,b){try{a=m.getJson(a);m.getJson(c);
var f=""+a.topic,e=a.qos,g=a.retain;delete a.topic;delete a.qos;var k=null!==a.payload?a.payload:JSON.stringify(a);d&&h.log("publish "+f+" at "+e,k);this.connection.publish(f,k,{qos:e,retain:g})}catch(l){d&&h.log("---error ",l)}},send:function(a,d){},unsubscribe:function(a){this.connection&&this.subscriptions[a]&&(this.connection.unsubscribe(a),delete this.subscriptions[a])},close:function(){this.connection&&(_.each(this.subscriptions,this.unsubscribe,this),this.connection.end(),this.connection=null)}})})},
"xide/manager/ContextBase":function(){define(["dcl/dcl","xide/factory","xide/types","xide/utils","xide/mixins/EventedMixin"],function(p,m,l,k,g){g=p(g.dcl,{declaredClass:"xide.manager.ContextBase",language:"en",managers:[],mixins:null,createManager:function(e,a,b){try{this.managers||(this.managers=[]);var f={ctx:this,config:a||this.config};k.mixin(f,b);if(_.isString(e)&&this.namespace){var h=null,h=-1==e.indexOf(".")?this.namespace+e:""+e;e=dojo.getObject(h)&&p.getObject(h)?h:this.defaultNamespace+
e}else _.isObject(e);var c=m.createInstance(e,f);if(c)return this.managers.push(c),m.publish(l.EVENTS.ON_CREATED_MANAGER,{instance:c,className:e,ctx:this,config:a||this.config}),c}catch(d){console.error("error creating manager "+d,arguments)}},constructManagers:function(){},initManagers:function(){},doMixins:function(e){this.mixins=e||this.mixins;for(var a=0;a<e.length;a++){var b=e[a],f=dojo.getObject(b.declaredClass)||p.getObject(b.declaredClass);b.declaredClass===this.declaredClass&&(f=this);f&&
k.mixin(f.prototype,b.mixin)}}});p.chainAfter(g,"constructManagers");p.chainAfter(g,"initManagers");return g})},"xide/mixins/EventedMixin":function(){define("dojo/_base/array dcl/dcl xdojo/declare xdojo/has xide/types xide/factory".split(" "),function(p,m,l,k,g,e){k={_didRegisterSubscribers:!1,subscribers:null,subscribes:{},emits:{},__events:null,addPublishFilter:function(a,b){a&&(null!=b?this.emits[a]=b:a in this.emits&&delete this.emits[a])},filterSubscribe:function(a){return this.subscribes?!1!==
this.subscribes[a]:!0},filterPublish:function(a){return this.emits?!1!==this.emits[a]:!0},subscribe:function(a,b,f){this.__events||(this.__events={});a=e.subscribe(a,b,f||this,this.filterSubscribe.bind(this));b=this.__events;f=0;for(var h=a.length;f<h;f++){var c=a[f].type;b[c]||(b[c]=[]);b[c].push(a[f])}return a},publish:function(a,b,f,h){var c=this;0<h?setTimeout(function(){e.publish(a,b,f||c,c.filterPublish.bind(c))}.bind(c),h):e.publish(a,b,f||c,c.filterPublish.bind(c))},_destroyHandle:function(a){},
_destroyHandles:function(){if(this.__events){for(var a in this.__events)p.forEach(this.__events[a],function(a){a&&a.remove&&a.remove()});delete this.__events}},destroy:function(){this.inherited&&this.inherited(arguments);this._destroyHandles()},once:function(a,b){function f(){h.unsubscribe(a,b);return b.apply(h,arguments)}var h=this;f.listener=b;h._on(a,f);return this},_emit:function(a){if(this.__events){if(!this._didRegisterSubscribers&&this.subscribers){for(var b=0;b<this.subscribers.length;b++){var f=
this.subscribers[b];this._on(f.event,f.handler,f.owner)}this._didRegisterSubscribers=!0}if(!0===arguments[2])throw Error("Please use emit.sticky() instead of passing sticky\x3dtrue for event: "+a);b=this.__events[a];f=1<arguments.length?arguments[2]:null;if(b){var h;if("function"==typeof b)switch(arguments.length){case 1:return b.call(this);case 2:return b.call(this,arguments[1]);case 3:return b.call(this,arguments[1],arguments[2]);default:var c=Array.prototype.slice.call(arguments,1);h=b.apply(this,
c)}else if(_.isArray(b))for(var c=Array.prototype.slice.call(arguments,1),d=b.slice(),n,e=n=null,b=0,g=d.length;b<g;b++)n=d[b],e=n.owner||this,c&&c[0]&&(c[0].owner=c[0]?c[0].owner||e:null),n=n.handler.apply(e,c),void 0!==n&&(h=n);f&&!0===f["public"]&&this.publish(a,c);return h}}},unsubscribe:function(a,b){if(!this.__events||!this.__events[a])return this;if("function"!==typeof b||!b)return p.forEach(this.__events[a],dojo.unsubscribe),delete this.__events[a],this.__events[a]=[],this;var f=this.__events[a];
if(_.isArray(f)){var h=[];_.each(f,function(a,d,n){(a.handler==b?a.handler:a.handler.listener==b&&a.handler.listener)&&h.push(a)});_.each(h,function(a){a.remove()});0===f.length&&delete this.__events[a]}else(this.__events[a].listener||this.__events[a])===b&&delete this.__events[a];return this},listeners:function(a){this.__events||(this.__events={});this.__events[a]||(this.__events[a]=[]);isArray(this.__events[a])||(this.__events[a]=[this.__events[a]]);return this.__events[a]},addHandle:function(a,
b){this.__events||(this.__events={});this.__events[a]||(this.__events[a]=[]);b.type=a;this.__events[a].push(b);return b},__on:function(a,b,f,h){var c=h;"function"!=typeof f||h||(h=f,f=null);a=a.jquery?a:$(a);a.on(b,f,h);this.__events||(this.__events={});this.__events[b]||(this.__events[b]=[]);var d=this.__events[b];a={handler:c,owner:this,type:b,element:a,selector:f,remove:function(){d.remove(this);this.element.off(this.type,this.selector,this.handler)}};d.push(a);return a},_on:function(a,b,f){try{this.__events||
(this.__events={});this.__events[a]||(this.__events[a]=[]);var h=this.__events[a];if(!h)this.__events[a]=b;else if(_.isArray(h)){if(-1!=h.indexOf(b))return console.warn("adding same listener twice",a);a={handler:b,owner:f||this,type:a,remove:function(){h.remove(this);this.handler=this.owner=null;delete this.type}};h.push(a);return a}}catch(c){logError(c)}return this}};l=l(null,k);l.Impl=k;l.dcl=m(null,k);return l})},"nxapp/Commons":function(){define("dojo/_base/declare dojo/has dojo/_base/lang nxapp/types/Types xide/factory xide/factory/Events xide/factory/Objects xide/utils/StringUtils xide/utils/CIUtils xide/utils/ObjectUtils xide/utils/StoreUtils xide/utils nxapp/utils dojo/node!os".split(" "),
function(p,m,l,k,g,e,a,b,f,h,c,d,n,q){p="linux";"win32"===q.platform()?p="windows":"darwin"===q.platform()?p="osx":"linux"===q.platform()&&"arm"==q.arch()&&(p="arm");"arm"===p?m.add("serialport",function(){return!1}):m.add("serialport",function(){return!0});d.mixin(n,d);Array.prototype.remove=function(){for(var a,d=arguments,c=d.length,b;c&&this.length;)for(a=d[--c];-1!=(b=this.indexOf(a));)this.splice(b,1);return this};Array.prototype.contains=function(a){for(var d=this.length;d--;)if(this[d]==a)return!0;
return!1};Array.prototype.indexOfPropertyValue||(Array.prototype.indexOfPropertyValue=function(a,d){for(var c=0;c<this.length;c++)if(this[c][a]&&this[c][a]==d)return c;return-1});"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.substring(0,a.length)===a});"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.substring(this.length-a.length,this.length)===a})})},"xide/factory/Objects":function(){define(["dcl/dcl",
"xide/utils","xide/factory","xdojo/declare"],function(p,m,l,k){l.createInstance=function(g,e,a){var b={};m.mixin(b,e);e=g;if(_.isString(g)&&(e=dojo.getObject(e)||p.getObject(e),!e))return console.error("no such class : "+g),null;a&&(e=k(a,e.prototype));b.id||(b.id=(e.declaredClass||"no_class_").replace(/\//g,"_")+m.createUUID());(g=new e(b))&&(g.ctrArgs=b);return g};return l})},"xide/utils/StringUtils":function(){define(["dojo/_base/lang","xide/utils","xide/types","dojo/json"],function(p,m,l,k){function g(e,
a){var b=[],f=[];null==a&&(a=function(a,c){return b[0]===c?"[Circular ~]":"[Circular ~."+f.slice(0,b.indexOf(c)).join(".")+"]"});return function(h,c){if(0<b.length){var d=b.indexOf(this);~d?b.splice(d+1):b.push(this);~d?f.splice(d,Infinity,h):f.push(h);~b.indexOf(c)&&(c=a.call(this,h,c))}else b.push(c);return null==e?c:e.call(this,h,c)}}m.stringify=function(e){return JSON.stringify(e,g(),2)};m.humanFileSize=function(e,a){var b=a?1E3:1024;if(Math.abs(e)<b)return e+" B";var f=a?"kB MB GB TB PB EB ZB YB".split(" "):
"KiB MiB GiB TiB PiB EiB ZiB YiB".split(" "),h=-1;do e/=b,++h;while(Math.abs(e)>=b&&h<f.length-1);return e.toFixed(1)+" "+f[h]};"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return 0===this.indexOf(e)});m.isNativeEvent=function(e){var a={onclick:null,ondblclick:null,onmousedown:null,onmouseup:null,onmouseover:null,onmousemove:null,onmouseout:null,onkeypress:null,onkeydown:null,onkeyup:null,onfocus:null,onblur:null,onchange:null};if(e in a)return!0;a={click:null,
dblclick:null,mousedown:null,mouseup:null,mouseover:null,mousemove:null,mouseout:null,keypress:null,keydown:null,keyup:null,focus:null,blur:null,change:null};return e in a};m.isSystemEvent=function(e){for(var a in l.EVENTS)if(l.EVENTS[a]===e)return!0;return!1};m.contains=function(e,a){for(var b=0;b<e.length;b++)if(e[b]===a)return b;return-1};m.getObjectKeyByValue=function(e,a){if(e&&a)for(var b in e)if(e.hasOwnProperty(b)&&e[b]===a)return b;return null};m.removeURLParameter=function(e,a){var b=e.split("?");
if(2<=b.length){for(var f=encodeURIComponent(a)+"\x3d",h=b[1].split(/[&;]/g),c=h.length;0<c--;)-1!==h[c].lastIndexOf(f,0)&&h.splice(c,1);e=b[0]+"?"+h.join("\x26")}return e};m.replaceUrlParam=function(e,a,b){var f=e.replace(new RegExp("("+a+"\x3d).*?(\x26|$)"),"$1"+b+"$2");f==e&&(f=f+(0<f.indexOf("?")?"\x26":"?")+a+"\x3d"+b);return f};m.buildPath=function(e,a,b){var f=""+e,f=m.replaceAll("/","",e);e=(""+a).replace("./","/").replace(/^\/|\/$/g,"");f=f+"://"+e;return!0===b?encodeURIComponent(f):f};m.isImage=
function(e){return null!=e.toLowerCase().match(/\.(jpeg|jpg|gif|png)$/)};m.hasFlag3=function(e,a){return 1<<a&e?!0:!1};m.hasFlag=function(e,a){return 1<<a&e?!0:!1};m.disableFlag=function(e,a){return e&~(1<<a)};m.cleanUrl=function(e){e&&(e=e.replace("//","/"),e=e.replace("./","/"),e=e.replace("http:/","http://"),e=e.replace("./","/"),e=e.replace("XApp-portletxasweb","XApp-portlet/xasweb"),e=e.replace("XApp-portletutils","XApp-portlet/utils"),e=e.replace("/XApp-portlet/CMAC/","/CMAC/"),e=e.replace("////",
"/"),e=e.replace("///","/"));return e};m.getJson=function(e,a,b){try{return _.isString(e)?k.parse(e,!1):!0===a?null:e}catch(f){!1!==b&&console.error("error parsing json data "+e+" error \x3d "+f)}return null};m.fromJson=function(e){if(!p.isString(e))return e;var a=null,b=!1;try{a=eval("("+e+")",{})}catch(f){b=!0}if(b){e=e.substring(e.indexOf("{"),e.lastIndexOf("}")+1);try{a=eval("("+e+")",{})}catch(h){throw Error(e);}}return a};m.replaceAll=function(e,a,b){return b?b.split(e).join(a):""};m.isValidString=
function(e){return null!=e&&null!=e.length&&0<e.length&&"undefined"!=e};m.substituteString=function(e,a){return e.replace(/\$\{([^\s\:\}]+)(?:\:([^\s\:\}]+))?\}/g,function(b,f){return a[f]})};m.findOcurrences=function(e,a){var b=m.escapeRegExp(a.begin),f=m.escapeRegExp(a.end);return e.match(new RegExp(b+"("+("[^"+f+"]*")+")"+f,"g"))};m.escapeRegExp=function(e){for(var a="[ ] ( ) { } * + . | ||".split(" "),b=0;b<a.length;b++)e=e.replace(a[b],"\\"+a[b]);return e};m.findOcurrences=function(e,a){var b=
m.escapeRegExp(a.begin),f=m.escapeRegExp(a.end);return e.match(new RegExp(b+"("+("[^"+f+"]*")+")"+f,"g"))};m.multipleReplace=function(e,a){var b=[],f;for(f in a)b[b.length]=f;return e.replace(new RegExp(b.join("\\b|\\b"),"g"),function(b){return a[b]||a["\\"+b]})};m.replace=function(e,a,b,f){if(!e)return"";if(b&&p.isObject(b)||p.isArray(b)){if(f){a=m.findOcurrences(e,f);var h=m.replaceAll;if(a)for(var c=0,d=a.length;c<d;c++){var n=a[c],q=h(f.begin,"",n),q=h(f.end,"",q);e=h(n,b[q],e)}}else return m.multipleReplace(e,
b);return e}return m.replaceAll(a,b,e)};m.capitalize=function(e){return e.substring(0,1).toUpperCase()+e.substring(1)};m.vsprintf=function(e,a){return m.sprintf.apply(this,[e].concat(a))};m.sprintf=function(){var e=arguments,a=0,b=function(a,d,b,h){b||(b=" ");d=a.length>=d?"":Array(1+d-a.length>>>0).join(b);return h?a+d:d+a},f=function(a,d,n,h,f,e){var g=h-a.length;0<g&&(a=n||!f?b(a,h,e,n):a.slice(0,d.length)+b("",g,"0",!0)+a.slice(d.length));return a},h=function(a,d,n,h,e,g,k){a>>>=0;n=n&&a&&{2:"0b",
8:"0",16:"0x"}[d]||"";a=n+b(a.toString(d),g||0,"0",!1);return f(a,n,h,e,k)};return e[a++].replace(/%%|%(\d+\$)?([-+\'#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuideEfFgG])/g,function(c,d,n,q,g,k,l){var m,p;if("%%"===c)return"%";var u=!1;p="";var w=g=!1;m=" ";for(var C=n.length,A=0;n&&A<C;A++)switch(n.charAt(A)){case " ":p=" ";break;case "+":p="+";break;case "-":u=!0;break;case "'":m=n.charAt(A+1);break;case "0":g=!0;break;case "#":w=!0}q=q?"*"===q?+e[a++]:"*"==q.charAt(0)?+e[q.slice(1,-1)]:
+q:0;0>q&&(q=-q,u=!0);if(!isFinite(q))throw Error("sprintf: (minimum-)width must be finite");k=k?"*"===k?+e[a++]:"*"==k.charAt(0)?+e[k.slice(1,-1)]:+k:-1<"fFeE".indexOf(l)?6:"d"===l?0:void 0;d=d?e[d.slice(0,-1)]:e[a++];switch(l){case "s":return l=String(d),null!=k&&(l=l.slice(0,k)),f(l,"",u,q,g,m);case "c":return l=String.fromCharCode(+d),null!=k&&(l=l.slice(0,k)),f(l,"",u,q,g,void 0);case "b":return h(d,2,w,u,q,k,g);case "o":return h(d,8,w,u,q,k,g);case "x":return h(d,16,w,u,q,k,g);case "X":return h(d,
16,w,u,q,k,g).toUpperCase();case "u":return h(d,10,w,u,q,k,g);case "i":case "d":return m=+d||0,m=Math.round(m-m%1),c=0>m?"-":p,d=c+b(String(Math.abs(m)),k,"0",!1),f(d,c,u,q,g);case "e":case "E":case "f":case "F":case "g":case "G":return m=+d,c=0>m?"-":p,p=["toExponential","toFixed","toPrecision"]["efg".indexOf(l.toLowerCase())],l=["toString","toUpperCase"]["eEfFgG".indexOf(l)%2],d=c+Math.abs(m)[p](k),f(d,c,u,q,g)[l]();default:return c}})};m.cleanString=function(e){return e?e=e.replace(/[\r]/g,"").replace(/[\b]/g,
"").replace(/[\f]/g,"").replace(/[\n]/g,"").replace(/\\/g,""):null};m.normalizePath=function(e){if(!e)return null;e=m.cleanString(e);e=e.replace("./","");e=e.replace("/.","");return e=e.replace(/([^:]\/)\/+/g,"$1")};l.PATH_PARTS={DIRNAME:1,BASENAME:2,EXTENSION:4,FILENAME:8,PATHINFO_ALL:0};m.basename=function(e,a){var b=e,f=b.charAt(b.length-1);if("/"===f||"\\"===f)b=b.slice(0,-1);b=b.replace(/^.*[\/\\]/g,"");"string"===typeof a&&b.substr(b.length-a.length)==a&&(b=b.substr(0,b.length-a.length));return b};
m.pathinfo=function(e,a){var b="",f="",h="",c=0,d={},n=0,q=0,g=n=!1,k=!1;if(!e)return!1;a||(a="PATHINFO_ALL");var l={PATHINFO_DIRNAME:1,PATHINFO_BASENAME:2,PATHINFO_EXTENSION:4,PATHINFO_FILENAME:8,PATHINFO_ALL:0};for(h in l)l.hasOwnProperty(h)&&(l.PATHINFO_ALL|=l[h]);if("number"!==typeof a){a=[].concat(a);for(q=0;q<a.length;q++)l[a[q]]&&(c|=l[a[q]]);a=c}h=function(a){a+="";var d=a.lastIndexOf(".")+1;return d?d!==a.length?a.substr(d):"":!1};a&l.PATHINFO_DIRNAME&&(c=e.replace(/\\/g,"/").replace(/\/[^\/]*\/?$/,
""),d.dirname=c===e?".":c);a&l.PATHINFO_BASENAME&&(!1===n&&(n=m.basename(e)),d.basename=n);a&l.PATHINFO_EXTENSION&&(!1===n&&(n=m.basename(e)),!1===g&&(g=h(n)),!1!==g&&(d.extension=g));a&l.PATHINFO_FILENAME&&(!1===n&&(n=m.basename(e)),!1===g&&(g=h(n)),!1===k&&(k=n.slice(0,n.length-(g?g.length+1:!1===g?0:1))),d.filename=k);n=0;for(b in d)d.hasOwnProperty(b)&&(n++,f=b);return 1===n?d[f]:d};m.parse_url=function(e,a){var b;b="source scheme authority userInfo user pass host port relative path directory file query fragment".split(" ");
for(var f=this.php_js&&this.php_js.ini||{},h=f["phpjs.parse_url.mode"]&&f["phpjs.parse_url.mode"].local_value||"php",c={php:/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/\/?)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},
c=c[h].exec(e),d={},n=14;n--;)c[n]&&(d[b[n]]=c[n]);if(a)return d[a.replace("PHP_URL_","").toLowerCase()];if("php"!==h){var q=f["phpjs.parse_url.queryKey"]&&f["phpjs.parse_url.queryKey"].local_value||"queryKey",c=/(?:^|&)([^&=]*)=?([^&]*)/g;d[q]={};b=d[b[12]]||"";b.replace(c,function(a,c,b){c&&(d[q][c]=b)})}delete d.source;return d};m.getMimeTable=function(){return{mid:"midi.png",txt:"txt2.png",sql:"txt2.png",js:"javascript.png",gif:"image.png",jpg:"image.png",html:"html.png",htm:"html.png",rar:"archive.png",
gz:"zip.png",tgz:"archive.png",z:"archive.png",ra:"video.png",ram:"video.png",rm:"video.png",pl:"source_pl.png",zip:"zip.png",wav:"sound.png",php:"php.png",php3:"php.png",phtml:"php.png",exe:"exe.png",bmp:"image.png",png:"image.png",css:"css.png",mp3:"sound.png",m4a:"sound.png",aac:"sound.png",xls:"spreadsheet.png",xlsx:"spreadsheet.png",ods:"spreadsheet.png",sxc:"spreadsheet.png",csv:"spreadsheet.png",tsv:"spreadsheet.png",doc:"word.png",docx:"word.png",odt:"word.png",swx:"word.png",rtf:"word.png",
ppt:"presentation.png",pps:"presentation.png",odp:"presentation.png",sxi:"presentation.png",pdf:"pdf.png",mov:"video.png",avi:"video.png",mpg:"video.png",mpeg:"video.png",mp4:"video.png",m4v:"video.png",ogv:"video.png",webm:"video.png",wmv:"video.png",swf:"flash.png",flv:"flash.png",tiff:"image.png",tif:"image.png",svg:"image.png",psd:"image.png",ers:"horo.png"}};m.getMimeTable2=function(){return{mid:"fa-file-audio-o",txt:"fa-file-text-o",sql:"fa-cube",js:"fa-cube",gif:"fa-file-picture-o",jpg:"fa-file-picture-o",
html:"fa-cube",htm:"fa-cube",rar:"fa-file-zip-o",gz:"fa-file-zip-o",tgz:"fa-file-zip-o",z:"fa-file-zip-o",ra:"fa-file-movie-o",ram:"fa-file-movie-o",rm:"fa-file-movie-o",pl:"source_pl.png",zip:"fa-file-zip-o",wav:"fa-file-audio-o",php:"fa-cube",php3:"fa-cube",phtml:"fa-cube",exe:"fa-file-o",bmp:"fa-file-picture-o",png:"fa-file-picture-o",css:"fa-cube",mp3:"fa-file-audio-o",m4a:"fa-file-audio-o",aac:"fa-file-audio-o",xls:"fa-file-excel-o",xlsx:"fa-file-excel-o",ods:"fa-file-excel-o",sxc:"fa-file-excel-o",
csv:"fa-file-excel-o",tsv:"fa-file-excel-o",doc:"fa-file-word-o",docx:"fa-file-word-o",odt:"fa-file-word-o",swx:"fa-file-word-o",rtf:"fa-file-word-o",ppt:"fa-file-powerpoint-o",pps:"fa-file-powerpoint-o",odp:"fa-file-powerpoint-o",sxi:"fa-file-powerpoint-o",pdf:"fa-file-pdf-o",mov:"fa-file-movie-o",avi:"fa-file-movie-o",mpg:"fa-file-movie-o",mpeg:"fa-file-movie-o",mp4:"fa-file-movie-o",m4v:"fa-file-movie-o",ogv:"fa-file-movie-o",webm:"fa-file-movie-o",wmv:"fa-file-movie-o",swf:"fa-file-movie-o",flv:"fa-file-movie-o",
tiff:"fa-file-picture-o",tif:"fa-file-picture-o",svg:"fa-file-picture-o",psd:"fa-file-picture-o",ers:"horo.png"}};m.getIconTable=function(){return{mid:"midi.png",txt:"txt2.png",sql:"txt2.png",js:"javascript.png",gif:"image.png",jpg:"image.png",html:"html.png",htm:"html.png",rar:"archive.png",gz:"zip.png",tgz:"archive.png",z:"archive.png",ra:"video.png",ram:"video.png",rm:"video.png",pl:"source_pl.png",zip:"zip.png",wav:"sound.png",php:"php.png",php3:"php.png",phtml:"php.png",exe:"exe.png",bmp:"image.png",
png:"image.png",css:"css.png",mp3:"sound.png",m4a:"sound.png",aac:"sound.png",xls:"spreadsheet.png",xlsx:"spreadsheet.png",ods:"spreadsheet.png",sxc:"spreadsheet.png",csv:"spreadsheet.png",tsv:"spreadsheet.png",doc:"word.png",docx:"word.png",odt:"word.png",swx:"word.png",rtf:"word.png",ppt:"presentation.png",pps:"presentation.png",odp:"presentation.png",sxi:"presentation.png",pdf:"pdf.png",mov:"video.png",avi:"video.png",mpg:"video.png",mpeg:"video.png",mp4:"video.png",m4v:"video.png",ogv:"video.png",
webm:"video.png",wmv:"video.png",swf:"flash.png",flv:"flash.png",tiff:"image.png",tif:"image.png",svg:"image.png",psd:"image.png",ers:"horo.png"}};m.urlDecode=function(e,a){if(!e||!e.length)return{};for(var b={},f=e.split("\x26"),h,c,d=0,n=f.length;d<n;d++)h=f[d].split("\x3d"),c=decodeURIComponent(h[0]),h=decodeURIComponent(h[1]),null!=h&&"true"===h?h=!0:"false"===h&&(h=!1),!0!==a?"undefined"==typeof b[c]?b[c]=h:("string"==typeof b[c]&&(b[c]=[b[c]]),b[c].push(h)):b[c]=h;return b};m.getUrlArgs=function(e){var a=
{};if(e&&(-1!=e.indexOf("?")||-1!=e.indexOf("\x26"))){e=(e.substr(e.indexOf("?")+1)||location.search.substring(1)).split("\x26");for(var b=0;b<e.length;b++){var f=e[b].indexOf("\x3d"),h=e[b].substring(0,f),f=e[b].substring(f+1),f=decodeURIComponent(f);a[h]=f}}return a};m.urlArgs=function(e){e=m.getUrlArgs(e);var a={},b;for(b in e){var f=e[b],h=m.findOcurrences(f,{begin:"|",end:"|"}),c=null;if(h&&h.length)for(var f=f.replace(h[0],""),h=h[0].substr(1,h[0].length-2).split(","),c={},d=0;d<h.length;d++){var n=
h[d].split(":");c[n[0]]=n[1]}f&&f.length&&(a[b]={value:f,options:c})}return a};m.getIcon=function(e){if(!e)return"txt2.png";if(e=m.getFileExtension(e)){var a=m.getMimeTable();if(null!=a[e])return a[e]}return"txt2.png"};m.getIconClass=function(e){if(!e)return"fa-file-o";e=m.getFileExtension(e);if(l.customMimeIcons[e])return l.customMimeIcons[e];if(e){var a=m.getMimeTable2();if(null!=a[e])return a[e]}return"fa-file-o"};m.getFileExtension=function(e){if(!e||""==e)return"";e=m.getBaseName(e).split(".");
return 1<e.length?e[e.length-1].toLowerCase():""};m.getBaseName=function(e){if(null==e)return null;var a="/";-1!=e.indexOf("\\")&&(a="\\");return e.substr(e.lastIndexOf(a)+1,e.length)};m.createUUID=function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()};m.strip_tags=function(e,a){a=(((a||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return e.replace(/\x3c!--[\s\S]*?--\x3e|<\?(?:php)?[\s\S]*?\?>/gi,
"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(b,f){return-1<a.indexOf("\x3c"+f.toLowerCase()+"\x3e")?b:""})};return m})},"xide/utils/CIUtils":function(){define("dojo/_base/declare dojo/_base/lang xide/utils xide/types xide/factory dojo/has".split(" "),function(p,m,l,k,g,e){l.toOptions=function(a){a=l.flattenCIS(a);for(var b=[],f=0;f<a.length;f++){var h=a[f];b.push({name:l.toString(h.name),value:l.getCIValue(h),type:l.toInt(h.type),enumType:l.toString(h.enumType),visible:l.toBoolean(h.visible),
active:l.toBoolean(h.active),changed:l.toBoolean(h.changed),group:l.toString(h.group),user:l.toObject(h.user),dst:l.toString(h.dst),params:l.toString(h.params)})}return b};l.getEventsAsOptions=function(a){var b=[{label:"Select Event",value:""}],f;for(f in k.EVENTS)b.push({label:k.EVENTS[f],value:k.EVENTS[f]});b=b.concat([{label:"onclick",value:"onclick"},{label:"ondblclick",value:"dblclick"},{label:"onmousedown",value:"mousedown"},{label:"onmouseup",value:"mouseup"},{label:"onmouseover",value:"mouseover"},
{label:"onmousemove",value:"mousemove"},{label:"onmouseout",value:"mouseout"},{label:"onkeypress",value:"keypress"},{label:"onkeydown",value:"keydown"},{label:"onkeyup",value:"keyup"},{label:"onfocus",value:"focus"},{label:"onblur",value:"blur"},{label:"On Load",value:"Load"}]);for(f=0;f<b.length;f++){var h=b[f];if(h.value===a){h.selected=!0;break}}return b};l.flattenCIS=function(a){for(var b=[],f=[],h=0;h<a.length;h++){var c=a[h],d=l.toInt(c.type);d>k.ECIType.END&&(d=k.resolveType(d))&&(m.mixin(b,
d),f.push(c))}0<b.length&&(a=a.concat(b));if(f)for(h in f)a.remove(f[h]);return a};l.arrayContains=function(a,b){for(var f=0;f<a.length;f++)if(a[f]===b)return!0;return!1};l.setStoreCIValueByField=function(a,b,f){null==a[b]&&(a[b]=[]);a[b][0]=l.getStringValue(f);return a};l.createOption=function(a,b,f){a={label:a,value:null!=b?b:a};f&&m.mixin(a,f);return a};l.createCI=function(a,b,f,h,c){a={dataRef:null,dataSource:null,name:a,group:-1,id:a,title:a,type:b,uid:-1,value:null!=f?f:-1,visible:!0,enumType:-1,
"class":"cmx.types.ConfigurableInformation"};h&&m.mixin(a,h);c&&c.publish&&g.publish(c.publish,{CI:a,owner:c.owner},c.owner);return a};l.createCIAsArray=function(a,b,f,h){return{chainType:[f?f:0],dataRef:[null],dataSource:[null],params:[],name:[a],group:[-1],id:[a],title:[a],type:[b],uid:[-1],value:[h?h:-1],visible:[!0],enumType:[-1],parentId:[-1],"class":["cmx.types.ConfigurableInformation"]}};l.hasValue=function(a){return a.value&&null!=a.value[0]&&0<a.value[0].length&&"0"!=a.value[0]&&"undefined"!=
a.value[0]&&"Unset"!=a.value[0]};l.hasValueAndDataRef=function(a){return a.value&&null!=a.value[0]&&0<a.value[0].length&&"0"!=a.value[0]&&"undefined"!=a.value[0]&&"Unset"!=a.value[0]&&a.dataRef&&null!=a.dataRef[0]&&0<a.dataRef[0].length&&"0"!=a.dataRef[0]&&"undefined"!=a.dataRef[0]};l.getInputCIByName=function(a,b){if(!a)return null;var f=a.inputs;f||(f=a);if(null!=f)for(var h=0;h<f.length;h++){var c=f[h],d=l.getStringValue(c.name);if(null!=d&&d.toLowerCase()===b.toLowerCase())return c}return null};
l.getCIByChainAndName=function(a,b,f){if(!a)return null;(b=0==b?a.inputs:1==b?a.outputs:null)||(b=a);if(null!=b)for(a=0;a<b.length;a++){var h=b[a],c=l.getStringValue(h.name);if(null!=c&&c.toLowerCase()===f.toLowerCase())return h}return null};l.getCIByUid=function(a,b){if(null!=a)for(var f=0;f<a.length;f++){var h=a[f],c=l.getStringValue(h.uid);if(null!=c&&c===b)return h}return null};l.getCIById=function(a,b,f){a=0==b?a.inputs:1==b?a.outputs:null;if(null!=a)for(b=0;b<a.length;b++){var h=a[b];if(h.id[0]==
f[0])return h}return null};l.getCIInputValueByName=function(a,b){var f=l.getCIByChainAndName(a,0,b);return f?f.value:null};l.getCIValue=function(a){return l.getCIValueByField(a,"value")};l.getStringValue=function(a){return l.toString(a)};l.toString=function(a){return null!=a?_.isArray(a)?a&&1==a.length&&null==a[0]?null:""+(null!=a[0]?a[0]:a):""+a:null};l.setIntegerValue=function(a,b){null!=a&&dojo.isArray(a)&&(a[0]=b)};l.getCIValueByField=function(a,b){return null!=a[b]?m.isArray(a[b])?a[b][0]?a[b][0]:
a[b]:a[b]:null};l.setCIValueByField=function(a,b,f){if(!a)return a;null==a[b]&&(a[b]=[]);a[b]=f;return a};l.setCIValue=function(a,b,f){(a=l.getInputCIByName(a,b))&&l.setCIValueByField(a,"value",f);return a};l.getCIInputValueByNameAndField=function(a,b,f){return(a=l.getCIByChainAndName(a,0,b))?a[""+f]:null};l.getCIInputValueByNameAndFieldStr=function(a,b,f){return(a=l.getCIInputValueByNameAndField(a,b,f))?l.getStringValue(a):null};l.getCIInputValueByNameAndFieldBool=function(a,b,f){return(a=l.getCIInputValueByNameAndField(a,
b,f))?l.toBoolean(a):null};l.getCIWidgetByName=function(a,b){for(var f=0;f<a.length;f++){var h=a[f];if(h._widget&&h.name===b)return h._widget}return null};return l})},"xide/utils/StoreUtils":function(){define(["xide/utils","dojo/store/Memory"],function(p,m){p.removeFromStore=function(l,k,g,e,a){l.getSync(k[e])&&console.error("no such item !! ",l);l.removeSync(k[e]);var b={};b[a]=k[e];if((k=l.query(b))&&k.length)for(b=0;b<k.length;b++)p.removeFromStore(l,k[b],g,e,a)};p.toString=function(l){return null!=
l?dojo.isArray(l)?l&&1==l.length&&null==l[0]?null:""+(null!=l[0]?l[0]:l):""+l:null};p.toBoolean=function(l){var k=!1;null!=l&&(l=l[0]?l[0]:l,null!=l&&(k=!(!0!==l&&"true"!==l&&"1"!==l)));return k};p.toObject=function(l){return null!=l?l[0]?l[0]:l:null};p.toInt=function(l){var k=-1;if(null!=l&&(l=1<l.length?l:l[0]?l[0]:l,null!=l))try{k=parseInt(l)}catch(g){}return k};p.deleteStoreItemById=function(l,k){var g=!1;l.fetch({query:{id:k},queryOptions:{deep:!0},onComplete:function(e){for(;0<e.length;){l.deleteItem(e[0]);
l.save();g=!0;break}}});return g};p.getStoreItemByName=function(l,k){var g=null;l.fetch({query:{name:k},queryOptions:{deep:!0},onComplete:function(e){g=0<e.length?e[0]:null}});return g};p.getStoreItemById=function(l,k){return p.queryStoreEx(l,{id:k})};p.getAppDataElementByIdAndType=function(l,k,g){return p.queryStore(l,{uid:k,type:g})};p.getElementsByType=function(l,k){return p.queryStoreEx(l,{type:k})};p.queryStoreEx=function(l,k,g,e){if(!l)return console.error("utils.queryStoreEx: store \x3d null"),
console.trace(),null;if(null!=dojo.store&&l instanceof dojo.store.Memory||l instanceof xide.data.Memory)return p.queryMemoryStoreEx(l,k);var a=null;l.fetch?l.fetch({query:k,queryOptions:{deep:!0},onComplete:function(b){a=b}}):l.query&&(a=l.query(k));return null!=g&&!0===g&&a&&0==a.length?null:!0===e&&a&&1==a.length?a[0]:a};p.queryStore=function(l,k,g){return null!=dojo.store&&l instanceof dojo.store.Memory?p.queryMemoryStoreSingle(l,k):(l=p.queryStoreEx(l,k))&&1==l.length?l[0]:null!=g&&!0===g&&l&&
0==l.length?null:l};p.queryMemoryStoreEx=function(l,k){var g=[];l.query(k).forEach(function(e){g.push(e)});return g};p.queryMemoryStoreSingle=function(l,k){var g=p.queryMemoryStoreEx(l,k);return 1==g.length?g[0]:g};return p})},"nxapp/manager/FileManager":function(){define("dojo/_base/declare dcl/dcl dojo/has nxapp/manager/ManagerBase nxapp/utils/_LogMixin xide/types xide/factory dojo/node!util dojo/node!path dojo/node!fs dojo/node!child_process dojo/node!watchr".split(" "),function(p,m,l,k,g,e,a,
b,f,h,c,d){var n=l("windows"),q=l("arm");return m([k,g],{declaredClass:"nxapp.manager.FileManager",initWindows_Watchr:function(c){for(var b=0;b<c.watchr.paths.length;b++){var n=c.watchr.paths[b],q=f.resolve(dojoConfig.libRoot),g=f.resolve(dojoConfig.clientRoot);"/"==n[0]?n=f.resolve(n):f.resolve(q+"/"+n)?c.watchr.paths[b]=f.resolve(q+"/"+n):h.existsSync(f.resolve(n))?c.watchr.paths[b]=f.resolve(n):f.resolve(g+"/"+n)&&(c.watchr.paths[b]=f.resolve(g+"/"+n))}var k=this;d.watch({paths:c.watchr.paths,
interval:500,listeners:{log:function(a){},error:function(a){console.log("an error occured:",a)},watching:function(a,d,c){a?console.log("watching the path "+d.path+" failed with error",a):console.log("watching the path "+d.path+" completed")},change:function(d,c,b,n){c&&a.publish(e.EVENTS.ON_FILE_CHANGED,{path:c,modulePath:c.replace(dojoConfig.libRoot,"")},k)}},next:function(a,d){if(a)return console.log("watching everything failed with error",a);console.log("watching everything completed")}})},initWindows:function(a){for(var d=
0;d<a.watchr.paths.length;d++){var b=a.watchr.paths[d],n=f.resolve(dojoConfig.libRoot),e=f.resolve(dojoConfig.clientRoot);"/"==b[0]?b=f.resolve(b):f.resolve(n+"/"+b)?a.watchr.paths[d]=f.resolve(n+"/"+b):h.existsSync(f.resolve(b))?a.watchr.paths[d]=f.resolve(b):f.resolve(e+"/"+b)&&(a.watchr.paths[d]=f.resolve(e+"/"+b))}var q=new function(a,d,b,n){var h=c.spawn;a=h(a,d);var f=this;a.stdout.on("data",function(a){b(f,a)});a.stdout.on("end",n)}(f.resolve(global.cwd+"/inotifywait.exe"),["-r","-m","-q",
"--format\x3d%w|%e|%f",a.watchr.paths[0]],function(a,d){a.stdout="";for(var c=d.toString().split(/(\r?\n)/g),b=0;b<c.length;b++){var n=c[b];if(n&&5<n.length&&(n=n.split("|"),3==n.length)){var h=f.resolve(n[0]+"/"+n[2]);console.log("file changed : "+n[1]+" path:"+h)}}},function(){console.log("end : "+q.stdout)})},init:function(a){if(n||q)return this.initWindows_Watchr(a);var d=this,c=require;try{c(["dojo/node!gbaumgart.inotify-plusplus"],function(c){d.initLinux(a,c)})}catch(b){return this.initWindows_Watchr(a)}},
initLinux:function(d,c){for(var b=0;b<d.watchr.paths.length;b++){var n=d.watchr.paths[b],q=f.resolve(dojoConfig.libRoot),g=f.resolve(dojoConfig.clientRoot);"/"==n[0]?n=f.resolve(n):f.resolve(q+"/"+n)?d.watchr.paths[b]=f.resolve(q+"/"+n):h.existsSync(f.resolve(n))?d.watchr.paths[b]=f.resolve(n):f.resolve(g+"/"+n)&&(d.watchr.paths[b]=f.resolve(g+"/"+n))}for(var k=this,l=function(a){var d=[];h.existsSync(a)&&h.readdirSync(a).forEach(function(c){c=a+"/"+c;var b=h.statSync(c);b&&b.isDirectory()&&(d.push(c),
d=d.concat(l(c)))});return d},n=function(){return{all_events:function(d){if(d&&d.name&&d.name.indexOf&&-1==d.name.indexOf(".git")&&-1==d.name.indexOf(".tmp")&&-1==d.name.indexOf("_jb_old_")&&-1==d.name.indexOf("_jb_bak_")&&-1==d.masks.toString().indexOf("access")){d.masks.toString().indexOf("moved_to");var c=f.resolve(d.watch+"/"+d.name);d=d.masks.toString().replace("all_events,","");var b="changed";-1!==d.indexOf("delete")&&(b="deleted");c&&a.publish(e.EVENTS.ON_FILE_CHANGED,{path:c,modulePath:c.replace(dojoConfig.libRoot,
""),mask:d,type:b},k)}},close_write:function(d){-1==d.name.indexOf(".git")&&-1==d.name.indexOf(".tmp")&&-1==d.name.indexOf("_jb_old_")&&-1==d.name.indexOf("_jb_bak_")&&-1==d.masks.toString().indexOf("access")&&-1==d.masks.toString().indexOf("moved_to")&&(d=f.resolve(d.watch+"/"+d.name))&&a.publish(e.EVENTS.ON_FILE_CHANGED,{path:d,modulePath:d.replace(dojoConfig.libRoot,"")},k)},access:!0,moved_to:!0,moved_from:!0,"delete":!0}}(),q=c.create(!1),g=0;g<d.watchr.paths.length;g++)if(b=d.watchr.paths[g],
h.existsSync(b)){var m=l(b);q.watch(n,b);for(b=0;b<m.length;b++)q.watch(n,m[b])}}})})},"nxapp/client/WebSocket":function(){define(["dojo/_base/declare","dojo/_base/lang","nxapp/utils/_LogMixin","nxapp/client/ClientBase","dojo/node!sockjs-client"],function(p,m,l,k,g){return p("nxapp.client.WebSocket",[k,l],{_socket:null,debugConnect:!0,connect:function(e){this.options=m.mixin(this.options,e);e=this.options.host;var a=this.options.port;this.options.debug&&this.initLogger(this.options.debug);this.log("Sock-JS-Client Connecting to "+
e+":"+a,"socket_client");var b=g.create(e+":"+a),f=this;b.on("close",function(){console.log("on close!",f.options)});b.on("connection",function(){f.log("socket client connected","socket_client");b.on("error",function(a){console.error("Socket client error ")});b.on("end",function(){f.log("socket client connection end","socket_client")})});this._socket=b},emit:function(e,a){this.showDebugMsg("socket_client")&&(console.log("Emiting: "+e+" with: "),console.dir(a));this._socket.write(a)},onSignal:function(e,
a){this._socket.on("data",a)}})})},"nxapp/client/ClientBase":function(){define(["dojo/_base/declare","dojo/Stateful","dojo/_base/lang"],function(p,m,l){return p("nxapp.server.ClientBase",[m],{options:null,_defaultOptions:function(){return{}},init:function(k){this.options=l.mixin(this._defaultOptions(),k.options)}})})},"xcf/types/Types":function(){define(["dojo/_base/lang","xide/types"],function(p,m){p.mixin(m.ITEM_TYPE,{DEVICE:"Device",DEVICE_GROUP:"Device Group",DRIVER:"Driver",DRIVER_GROUP:"Driver Group",
PROTOCOL:"Protocol",PROTOCOL_GROUP:"Protocol Group"});p.mixin(m.EVENTS,{ON_DEBUGGER_READY:"onDebuggerReady",ON_DEVICE_SELECTED:"onDeviceSelected",ON_DEVICE_GROUP_SELECTED:"onDeviceGroupSelected",ON_PROTOCOL_SELECTED:"onProtocolSelected",ON_PROTOCOL_GROUP_SELECTED:"onProtocolGroupSelected",ON_PROTOCOL_CHANGED:"onProtocolChanged",ON_MQTT_MESSAGE:"onMQTTMessage",ON_DEVICE_MESSAGE:"onDeviceMessage",ON_COMMAND_FINISH:"onCommandFinish",ON_COMMAND_ERROR:"onCommandError",ON_DEVICE_DISCONNECTED:"onDeviceDisconnected",
ON_DEVICE_CONNECTED:"onDeviceConnected",ON_DEVICE_STATE_CHANGED:"onDeviceStateChanged",ON_DEVICE_DRIVER_INSTANCE_READY:"onDeviceDriveInstanceReady",ON_DRIVER_SELECTED:"onDriverSelected",ON_DRIVER_GROUP_SELECTED:"onDriverGroupSelected",ON_DRIVER_VARIABLE_ADDED:"onDriverVariableAdded",ON_DRIVER_VARIABLE_REMOVED:"onDriverVariableRemoved",ON_DRIVER_VARIABLE_CHANGED:"onDriverVariableChanged",ON_DRIVER_COMMAND_ADDED:"onDriverCommandAdded",ON_DRIVER_COMMAND_REMOVED:"onDriverCommandRemoved",ON_DRIVER_COMMAND_CHANGE:"onDriverVariableChanged",
ON_SCOPE_CREATED:"onScopeCreated",ON_DRIVER_MODIFIED:"onDriverModified",SET_DEVICE_VARIABLES:"setDeviceVariables"});m.MESSAGE_SOURCE={DEVICE:"DEVICE",GUI:"GUI",BLOX:"BLOX",CODE:"CODE"};m.DEVICE_STATE={CONNECTING:"DeviceIsConnecting",CONNECTED:"DeviceIsConnected",SYNCHRONIZING:"DeviceIsSynchronizing",READY:"DeviceIsReady",DISCONNECTED:"DeviceIsDisconnected",DISABLED:"DeviceIsDisabled"};m.DRIVER_PROPERTY={CF_DRIVER_NAME:"CF_DRIVER_NAME",CF_DRIVER_ICON:"CF_DRIVER_ICON",CF_DRIVER_CLASS:"CF_DRIVER_CLASS",
CF_DRIVER_ID:"CF_DRIVER_ID",CF_DRIVER_COMMANDS:"CF_DRIVER_COMMANDS",CF_DRIVER_VARIABLES:"CF_DRIVER_VARIABLES",CF_DRIVER_RESPONSES:"CF_DRIVER_RESPONSES"};m.PROTOCOL_PROPERTY={CF_PROTOCOL_TITLE:"Title",CF_PROTOCOL_ICON:"CF_PROTOCOL_ICON",CF_PROTOCOL_CLASS:"CF_PROTOCOL_CLASS",CF_PROTOCOL_ID:"CF_PROTOCOL_ID",CF_PROTOCOL_COMMANDS:"CF_PROTOCOL_COMMANDS",CF_PROTOCOL_VARIABLES:"CF_PROTOCOL_VARIABLES",CF_PROTOCOL_RESPONSES:"CF_PROTOCOL_RESPONSES"};m.DEVICE_PROPERTY={CF_DEVICE_DRIVER:"Driver",CF_DEVICE_HOST:"Host",
CF_DEVICE_PORT:"Port",CF_DEVICE_PROTOCOL:"Protocol",CF_DEVICE_TITLE:"Title",CF_DEVICE_ID:"Id",CF_DEVICE_ENABLED:"Enabled",CF_DEVICE_OPTIONS:"Options",CF_DEVICE_DRIVER_OPTIONS:"DriverOptions"};m.DRIVER_FLAGS={RUNS_ON_SERVER:2,DEBUG:4};p.mixin(m.ITEM_TYPE,{CF_DRIVER_VARIABLE:"DriverVariable",CF_DRIVER_BASIC_COMMAND:"DriverBasicCommand",CF_DRIVER_CONDITIONAL_COMMAND:"DriverConditionalCommand",CF_DRIVER_RESPONSE_VARIABLE:"DriverResponseVariable"});m.BLOCK_GROUPS={CF_DRIVER_VARIABLE:"DriverVariable",CF_DRIVER_BASIC_COMMAND:"DriverBasicCommand",
CF_DRIVER_CONDITIONAL_COMMAND:"DriverConditionalCommand",CF_DRIVER_RESPONSE_VARIABLE:"DriverResponseVariable",CF_DRIVER_RESPONSE_BLOCKS:"conditionalProcess",CF_DRIVER_RESPONSE_VARIABLES:"processVariables",CF_DRIVER_BASIC_VARIABLES:"basicVariables"};m.COMMAND_TYPES={BASIC_COMMAND:"basic",CONDITIONAL_COMMAND:"conditional",INIT_COMMAND:"init"};p.mixin(m.ECIType,{DEVICE_NETWORK_SETTINGS:m.ECIType.END+1,DRIVER_COMMAND_SETTINGS:"CommandSettings"});m.VFS_ROOTS={SYSTEM_DRIVERS:"system_drivers",USER_DRIVERS:"user_drivers",
APP_DRIVERS:"app_drivers"};m.SOCKET_SERVER_COMMANDS={SIGNAL_MANAGER:"Manager_command",SIGNAL_DEVICE:"Device_command",SIGNAL_RESPONSE:"WebSocket_response",MANAGER_TEST:"Manager_Test",MANAGER_CLOSE_ALL:"Close_All_Connections",MANAGER_STATUS:"status",MANAGER_START_DRIVER:"startDriver",MANAGER_STOP_DRIVER:"stopDriver",DEVICE_SEND:"Device_Send",CALL_METHOD:"Call_Method",MQTT_PUBLISH:"MQTT_PUBLISH",MQTT_SUBSCRIBE:"MQTT_SUBSCRIBE",GET_DEVICE_VARIABLES:"getVariables",WRITE_LOG_MESSAGE:"Write_Log_Message"};
return m})},"dcl/inherited":function(){(function(p){"undefined"!=typeof define?define(["./mini","./advise"],p):"undefined"!=typeof module?module.exports=p(require("./mini"),require("./advise")):p(dcl,advise)})(function(p,m){function l(e,a,b){var f=3>arguments.length&&e.callee,h=k.call(this,f?f.ctr:e,f?f.nom:a);if(h)return h.apply(this,f?e||a:b)}function k(e,a){var b=this.constructor._meta,f,h,c,d;if(!+b.weaver[a]){if(b){if(b.chains.hasOwnProperty(a)){if(f=b.chains[a])for(c=f.length-1;0<=c;--c)if(h=
f[c],h.ctr===e)return 0<c?f[c-1]:0;return}f=b.bases;for(c=f.length-1;0<=c&&f[c]!==e;--c);if(0<=c)for(++c,d=f.length;c<d;++c)if(b=(h=f[c])._meta){if((b=b.ownProps).hasOwnProperty(a))return b[a]}else return h.prototype[a]}return g[a]}}var g={};m.after(p,"_postprocess",function(e,a){for(var b=a._meta.bases,f=b.length-1,h,c,d;0<=f;--f)if(h=b[f],c=h._meta)c=c.ownProps,p.allKeys(c).some(function(a){d=c[a];if("function"==typeof d){if(d.nom===a)return 1;d.nom=a;d.ctr=h}});a.prototype.inherited=l;a.prototype.getInherited=
k});p.getInherited=l.get=k;return p.inherited=l})},"dcl/advise":function(){(function(p){"undefined"!=typeof define?define([],p):"undefined"!=typeof module?module.exports=p():advise=p()})(function(){function p(g,e){this.next_before=this.prev_before=this.next_after=this.prev_after=this.next_around=this.prev_around=this;this.instance=g;this.name=e}function m(g){var e=function(){var a,b,f=arguments,h;for(a=g.prev_before;a!==g;a=a.prev_before)a.before.apply(this,f);try{g.prev_around!==g&&(b=g.prev_around.around.apply(this,
f))}catch(c){b=c,h=!0}for(a=g.next_after;a!==g;a=a.next_after)a.after.call(this,f,b);if(h)throw b;return b};e.adviceNode=g;return e}function l(g,e,a){var b=g[e],f;b&&b.adviceNode&&b.adviceNode instanceof p?f=b.adviceNode:(f=new p(g,e),b&&b.advices?(b=b.advices,f.add(b.before,b.after,b.around)):f.add(0,0,b),g[e]=m(f));"function"==typeof a&&(a=a(e,g));return f.add(a.before,a.after,0,a.around)}var k=p.prototype={add:function(g,e,a,b){var f=new p(this.instance,this.name);f.parent=this;f.before=g;this._add("before",
f);f.after=e;this._add("after",f);f.around=a;this._add("around",f,b);if(f.original=b)f.around=l._instantiate(b,f.prev_around.around,this);return f},_add:function(g,e,a){if(e[g]||a)a="next_"+g,g="prev_"+g,(e[g]=this[g])[a]=(e[a]=this)[g]=e},remove:function(g){this._remove("before",g);this._remove("after",g);this._remove("around",g)},_remove:function(g,e){var a="next_"+g,b="prev_"+g;e[a][b]=e[b];e[b][a]=e[a]},destroy:function(){var g=this.prev_around.around,e=this.next_around,a=this.parent;this.remove(this);
if(e!==this)for(;e!==a;g=e.around,e=e.next_around)e.original&&(e.around=l._instantiate(e.original,g,this));this.instance=0}};k.unadvise=k.destroy;l.before=function(g,e,a){return l(g,e,{before:a})};l.after=function(g,e,a){return l(g,e,{after:a})};l.around=function(g,e,a){return l(g,e,{around:a})};l.Node=p;l._instantiate=function(g,e,a){return g(e)};return l})},"nxapp/manager/DeviceServerContext":function(){define("dcl/dcl nxapp/manager/Context xcf/types/Types dojo/node!path dojo/node!fs nxapp/utils xide/utils/StringUtils xide/types xcf/manager/DriverManager xcf/manager/DeviceManager nxapp/manager/FileManager xcf/manager/Context nxapp/manager/DeviceManager xcf/manager/BlockManager xblox/factory/Blocks dojo/node!tracer nxapp/utils/_console".split(" "),
function(p,m,l,k,g,e,a,b,f,h,c,d,n,q,r,v,y){var x=p(null,{write:function(a){},emit:function(a){}}),t=p(null,{owner:null,remoteAddress:"fake - address",remotePort:"fake - port",constructor:function(a){e.mixin(this,a)},write:function(a){var d=this.owner.getDeviceManager(),c=e.getJson(a),c=c||{};if(c.data&&c.data.device){var n=d.getDeviceStoreItem(c.data.device);if(n&&(n=d.toDeviceControlInfo(n))&&!n.serverSide)return}if(c&&c.data&&c.data.deviceMessage&&c.data.deviceMessage.event===b.EVENTS.ON_COMMAND_FINISH)d.onCommandFinish(c.data.device,
c.data.deviceMessage);else if(c.data&&c.data.deviceMessage&&c.data.deviceMessage.event===b.EVENTS.ON_COMMAND_ERROR)d.onCommandError(c.data.device,c.data.deviceMessage);else if(c.event===b.EVENTS.ON_DEVICE_DISCONNECTED)d.publish(b.EVENTS.ON_DEVICE_DISCONNECTED,c.data);else{if(c.event===b.EVENTS.SET_DEVICE_VARIABLES)return d.onSetDeviceServerVariables(c.data);if(c.event===b.EVENTS.ON_DEVICE_CONNECTED)d.publish(b.EVENTS.ON_DEVICE_CONNECTED,c.data);else if(c.event!==b.EVENTS.ON_SERVER_LOG_MESSAGE)if(c.event===
b.EVENTS.ON_MQTT_MESSAGE)d.publish(b.EVENTS.ON_MQTT_MESSAGE,c.data),d.onMQTTMessage(c.data);else d.onDeviceServerMessage({data:a})}},emit:function(){y.error("device server client emit",arguments)}});return p([m,d],{declaredClass:"nxapp.manager.DeviceServerContext",profile:null,getDevices:function(d){function c(d,h){var f=g.readdirSync(d);f.length&&_.each(f,function(c){if(-1!=c.indexOf(".meta.json")){var f=a.getJson(e.readFile(d+k.sep+c));f?(c={isDir:!1,path:h+"/"+c,parentId:h,scope:"system_devices",
user:f,id:e.getCIInputValueByName(f,b.DEVICE_PROPERTY.CF_DEVICE_ID)},n.push(c)):y.error("device has no meta "+d+k.sep+c)}})}var n=[],h=function(a){var b=[];g.existsSync(a)?g.readdirSync(a).forEach(function(f){f=a+"/"+f;var e=g.statSync(f);if(e){var q=f.replace(d+"/","");e.isDirectory()&&(n.push({isDir:!0,parent:q,name:q,path:q}),c(f,q),b.push(f.replace(d+"/","")),b=b.concat(h(f)))}else y.error("cant get stat for "+f)}):y.error("device path "+a+" doesnt exists");return b};h(d);return n},getDrivers:function(d){function c(d,
h){var f=g.readdirSync(d);f.length&&_.each(f,function(c){if(-1!=c.indexOf(".meta.json")){var f=a.getJson(e.readFile(d+k.sep+c));if(f){var q=e.getCIInputValueByName(f,b.DRIVER_PROPERTY.CF_DRIVER_ID);c={isDir:!1,path:h+"/"+c,parentId:h,scope:"system_drivers",user:f,id:q,blox:a.getJson(e.readFile(d+"/"+c.replace(".meta.json",".xblox"))),blockPath:d+k.sep+c.replace(".meta.json",".xblox")};n.push(c)}else y.error("cant get driver meta "+d+k.sep+c)}})}var n=[],h=function(a){var b=[];g.existsSync(a)?g.readdirSync(a).forEach(function(f){f=
a+"/"+f;var e=g.statSync(f);if(e){var q=f.replace(k+"/","");e.isDirectory()&&(n.push({isDir:!0,parent:q,name:q,path:q}),c(f,q),b.push(f.replace(d+"/","")),b=b.concat(h(f)))}}):y.error("driver path "+a+" doesnt exists");return b};h(d);return n},initManagers:function(a){a&&(this.profile=a);this.deviceManager.init();this.driverManager.init();this.blockManager.init();this.fileManager.init(a);this.blockManager.onReady();var d=this;this.subscribe(b.EVENTS.ON_FILE_CHANGED,function(a){d.onXIDEMessage({event:b.EVENTS.ON_FILE_CHANGED,
data:a},!1);d.deviceManager.onFileChanged(a);d.driverManager.onFileChanged(a)})},onReady:function(){this.initDevices();var a=this.getDeviceServer(),d=this.connection;a.clients.push(d);a.onClientConnection(d)},constructManagers:function(){this.driverManager=this.createManager(f,null);h=p([h,n],{});var a=new x({});this.connection=new t({owner:this});this.deviceManager=this.createManager(h,null,{deviceServerClient:a,connection:this.connection});this.blockManager=this.createManager(q,null);this.fileManager=
this.createManager(c,null)},onLoaded:function(){},initDevices:function(){var a=k.resolve(this.profile.data);require({packages:[{name:"system_drivers",location:a+"/drivers"}]});g.existsSync(a)||(a=process.cwd()+"/data/system");var d=k.resolve(a+"/devices"),c=k.resolve(a+"/drivers"),b=this.getDeviceManager(),a=this.getDriverManager();this.getDeviceServer();this.getConnectionManager();c=this.getDrivers(c);d=this.getDevices(d);a.createStore({items:c},"system_drivers",!0).getSync("SSH/Maintenance-SSH .meta.json");
b.initStore({items:d},"system_devices",!0);setTimeout(function(){b.connectToAllDevices()},3E3)}})})},"xcf/manager/DriverManager":function(){define("dcl/dcl xdojo/declare dojo/_base/lang dojo/_base/json xide/types xcf/types/Types xide/utils xcf/manager/BeanManager xcf/model/Variable xcf/manager/DriverManager_Server xide/data/TreeMemory xide/data/ObservableStore dstore/Trackable xdojo/has xcf/model/Driver xide/manager/ServerActionBase xide/data/Reference xdojo/has!xcf-ui?./DriverManager_UI".split(" "),
function(p,m,l,k,g,e,a,b,f,h,c,d,n,q,r,v,y,x){k=[v,b,h];q("xcf-ui")&&k.push(x);return p(k,{declaredClass:"xcf.manager.DriverManager",addDeviceInstance:function(a,d){d.directory=!0;var c=d._store,b=d.path,n=this.ctx.getDeviceManager(),h=c.getSync(b+"_instances"),h=h||c.putSync({path:b+"_instances",name:"Instances",isDir:!0,type:"leaf",parentId:b,virtual:!0,isCommand:!1,icon:"fa-folder",children:[]}),b=n.getMetaValue(a,g.DEVICE_PROPERTY.CF_DEVICE_TITLE),c=c.putSync(new y({name:b,isCommand:!1,path:h.path+
"_instance_"+a.path,isDir:!1,type:"driver_instance",parentId:h.path,device:a,driver:d,_mayHaveChildren:!1,icon:a.iconClass,state:a.state}));h.children.push(c);a.addReference(c,{properties:{name:!0,enabled:!0,state:!0,iconClass:!0},onDelete:!1},!0);!d.instances&&(d.instances=[]);d.instances.push(c)},beanNamespace:"driver",beanName:"Driver",beanIconClass:"fa-exchange",groupType:g.ITEM_TYPE.DRIVER_GROUP,itemType:g.ITEM_TYPE.DRIVER,itemMetaTitleField:g.DRIVER_PROPERTY.CF_DRIVER_NAME,defaultScope:"system_drivers",
serviceClass:"XCF_Driver_Service",rawData:null,store:null,treeView:null,driverScopes:null,_isLoading:!1,removeDriverInstance:function(a,d){var c=a.driver,b=c._store,n=c.path,h=n+"_instances_instance_"+d.path,f=b.getSync(h);f&&b.removeSync(h);c.instances.remove(f);d.removeReference(f);f&&(f.refresh(),b.getSync(n+"_instances").refresh())},onReloaded:function(){},_onReloaded:function(){},onDeviceMessage:function(d){if(d&&d.device&&d.driverInstance){var c=d.driverInstance,b=c.options;if(b)if(c.responseSettings){var b=
b.serverSide,n=[d.deviceMessage];l.isString(d.deviceMessage)&&(n=c.split(d.deviceMessage));if(c.hasMessages())console.error("abort incoming, have still messages to send");else if(0<n.length){d=c.blockScope;var c=d.getBlocks({group:g.BLOCK_GROUPS.CF_DRIVER_RESPONSE_BLOCKS}),h=d.getVariables({group:g.BLOCK_GROUPS.CF_DRIVER_RESPONSE_VARIABLES}),e=d.getVariable("value");e||(e=new f({id:a.createUUID(),name:"value",value:"",scope:d,type:13,group:"processVariables",gui:!1,cmd:!1}),d.blockStore.putSync(e));
for(var q=0;q<n.length;q++)if(0!=n[q].length){e.value=n[q];this.publish(g.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:e,scope:d,owner:this,save:!1,source:g.MESSAGE_SOURCE.DEVICE});for(var k=0;k<h.length;k++){var r=h[k];if("value"!=h[k].title){var v=null,v=e.value;"number"!=typeof v&&(v=""+v,v="'"+v+"'");if(r.target&&"None"!=r.target&&null!=v&&"null"!=v&&"'null'"!=v){var m=d.getVariable(r.target);m&&(m.value=v,this.publish(g.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:m,scope:d,owner:this,save:!1,source:g.MESSAGE_SOURCE.BLOX}))}}}if(b){for(k=
0;k<n.length;k++)if(v=n[k],_.isObject(v)&&v.src&&(m=d.getBlockById(v.src))&&m.onData)m.onData(v);for(k=0;k<c.length;k++)if(m=c[k],0!=m.enabled){m.override={args:r?[r.value]:null};try{d.solveBlock(c[k],{highlight:!1})}catch(y){logError(y,"----solving response block crashed ")}}}}}}else console.error("driver has no response settings!")}},getDriverById:function(d){var c=null,b;for(b in this.stores){a:{var c=this.stores[b],n=a.queryStore(c,{isDir:!1});l.isArray(n)||(n=[n]);for(var h=0;h<n.length;h++){var f=
n[h],e=a.getInputCIByName(f.user,g.DRIVER_PROPERTY.CF_DRIVER_ID);if(e&&e.value==d){c=c.getSync(f.path);break a}}c=null}if(c)return c}return null},getItemById:function(a){return _.find(this.store.data,{id:a})},onNewDriverScopeCreated:function(a){},onScopeCreated:function(a){},onDeviceDisconnected:function(a){},onDriverCreated:function(a){q("xcf-ui")&&g.registerEnumeration("Driver",this.getDriversAsEnumeration(a))},onDriverRemoved:function(a,d){q("xcf-ui")&&g.registerEnumeration("Driver",this.getDriversAsEnumeration(a))},
onStoreReady:function(a){q("xcf-ui")&&g.registerEnumeration("Driver",this.getDriversAsEnumeration(a))},onStoreCreated:function(a){var d=a.type;a=a.store;var c=a.query({isDir:!1});if(d===g.ITEM_TYPE.DRIVER)for(d=0;d<c.length;d++){var b=c[d];null==b._completed&&"Default"!==b.name&&(b._completed=!0,q("xcf-ui")&&this.completeDriver(a,b,b))}},createStore:function(a,b,h){a=new (m("driverStore",[c,n,d],{}))({data:a.items,Model:r,idProperty:"path",scope:b,observedProperties:["name","enabled"]});b&&!this.stores[b]&&
!1!==h&&(this.stores[b]=a);this.store||"system_drivers"!==b||(this.store=a);return a},initStore:function(a,d){return this.createStore(a,d)},getStore:function(a){if(!a||"system_drivers"===a)return this.store;var d=this.stores[a];if(d)return d;if(a)return this.ls(a)},ls:function(a){return this.runDeferred(null,"ls",[a]).then(function(d){try{var c=this.initStore(d,a);"system_drivers"===a&&(this.store=c);this.stores[a]=c;this.onStoreReady(c);this.publish(g.EVENTS.ON_STORE_CREATED,{data:d,owner:this,store:c,
type:this.itemType})}catch(b){logError(b,"error ls drivers")}}.bind(this))},init:function(){var a=this,d=g.EVENTS;this.stores={};this.subscribe([d.ON_SCOPE_CREATED,d.ON_STORE_CREATED]);this.subscribe(d.ON_BLOCK_EXPRESSION_FAILED,function(c){a.publish(d.ON_SERVER_LOG_MESSAGE,{data:{type:"Expression",device:c.deviceInfo},level:"error",message:"Expression Failed: "+c.item.title+" : "+c.item.value})});this.driverScopes={system_drivers:"system_drivers/"}}})})},"xcf/manager/BeanManager":function(){define("dcl/dcl xdojo/declare dojo/_base/lang xide/types xide/utils xide/manager/BeanManager xdojo/has!xcf-ui?xide/views/ActionDialog xdojo/has!xcf-ui?xide/views/CIActionDialog xdojo/has!xcf-ui?xide/views/CIGroupedSettingsView".split(" "),
function(p,m,l,k,g,e,a,b,f,h){return p(e,{declaredClass:"xcf.manager.BeanManager",toUrl:function(a,d,b,h){return l.replace((h||"")+"deviceScope\x3d{deviceScope}\x26device\x3d{deviceId}\x26driver\x3d{driverId}\x26driverScope\x3d{driverScope}\x26block\x3d{block}",{deviceId:a.id,deviceScope:a.scope,driverId:d.id,driverScope:d.scope,block:b.id})},openItemSettings:function(c,d){var b=c.user;if(!b||!b.inputs)return null;var f=this.getViewId(c),e=a.byId(f);try{if(e)return e.parentContainer&&e.parentContainer.selectChild(e),
null}catch(v){g.destroy(e)}var e=this.ctx.mainView.getDocker(),l=this.getMetaValue(c,this.itemMetaTitleField),m=d?this.ctx.getDeviceManager().toDeviceControlInfo(d):null,e=e.addTab(null,{title:(l||c.name)+""+(d?":"+d.name+":"+m.host+":":""),icon:this.beanIconClass});if(l=g.getCIByChainAndName(b,0,k.DRIVER_PROPERTY.CF_DRIVER_COMMANDS))l.device=d;c.blockScope&&!c.blockScope.serviceObject&&(c.blockScope.serviceObject=this.serviceObject);return g.addWidget(h,{cis:b.inputs,storeItem:c,iconClass:this.beanIconClass,
id:f,delegate:this,storeDelegate:this,blockManager:this.ctx.getBlockManager(),options:{groupOrder:{General:1,Settings:2,Visual:3}}},this,e,!0)},newGroup:function(){var a=this,d=this.getItem(),b=d?!0===d.isDir?d.path:"":"",d=new f({title:"New "+this.groupType,delegate:{onOk:function(d,h){var f=g.getCIInputValueByName(h,"Title"),e=g.getCIInputValueByName(h,"Scope");a.createGroup(e,b+"/"+f,function(d){d=a.createNewGroupItem(f,e,b);a.store.putSync(d);a.publish(k.EVENTS.ON_STORE_CHANGED,{owner:a,store:a.store,
action:k.NEW_DIRECTORY,item:d})})}},cis:[g.createCI("Title",13,""),g.createCI("Scope",3,this.defaultScope,{options:[{label:"System",value:this.defaultScope},{label:"User",value:this.userScope},{label:"App",value:this.appScope}]})]});d.startup();d.show()},onDeleteItem:function(a){var d=!0===g.toBoolean(a.isDir),n=d?"removeGroup":"removeItem",h=this;(new b({title:"Remove "+this.beanName+(d?" Group":"")+' "'+a.name+'"  ',style:"max-width:400px",titleBarClass:"text-danger",delegate:{isRemoving:!1,onOk:function(d){h[n](g.toString(a.scope),
g.toString(a.path),g.toString(a.name),function(){h.onItemDeleted(a);h.publish(k.EVENTS.ON_STORE_CHANGED,{owner:h,store:h.store,action:k.DELETE,item:a})})}}})).show()},hasItemActions:function(){return!0},onItemDeleted:function(a){this.store.removeSync(a.path);a==this.currentItem&&(this.currentItem=null);a&&(a=this.getView(a))&&g.destroyWidget(a)},onItemSelected:function(a){this.currentItem=a},onCIUpdate:function(a){a.owner===this&&this.updateCI(a.ci,a.newValue,a.oldValue,a.storeItem)},createNewGroupItem:function(a,
d,b){return this.createItemStruct(a,d,b,a,!0,this.groupType)},createNewItem:function(a,d,b){return this.createItemStruct(a,d,b,b+"/"+a,!1,this.itemType)},init:function(){this.subscribe(k.EVENTS.ON_CI_UPDATE)},createItem:function(a,d,b,h,f){return this.runDeferred(null,"createItem",[a,d,b,h,f])},ls:function(a){return this.runDeferred(null,"ls",[a]).then(function(a){try{this.rawData=a,this.initStore(a),this.publish(k.EVENTS.ON_STORE_CREATED,{data:a,owner:this,store:this.store,type:this.itemType})}catch(c){logError(c,
"error ls")}}.bind(this))},_getText:function(a){var d;dojo.xhrGet({url:a,sync:!0,handleAs:"text",load:function(a){d=a}});return""+d+""}})})},"xide/manager/BeanManager":function(){define("dcl/dcl dojo/_base/lang xide/utils xide/encoding/MD5 xide/registry xide/data/TreeMemory".split(" "),function(p,m,l,k,g,e){return p(null,{declaredClass:"xide.manager.BeanManager",beanNamespace:"beanNS",beanName:"beanName",createItemStruct:function(a,b,f,h,c,d){return{name:a,isDir:c,parentId:f,path:h,beanType:d,scope:b}},
getMetaValue:function(a,b){return l.getCIInputValueByName(l.getAt(a,this.itemMetaPath||"user"),b)},setCurrentItem:function(a){},getItem:function(){},onItemSelected:function(a){},onItemAdded:function(a){},onItemRemoved:function(a){},reload:function(){},getViewTarget:function(){return this.ctx.getApplication().mainView.getNewAlternateTarget()},getRightTopTarget:function(a,b,f,h){return this.ctx.getApplication().mainView.getRightTopTarget(a,b,f,h)},getLayoutRightMain:function(a,b){return this.ctx.getApplication().mainView.getLayoutRightMain(a,
b)},getRightBottomTarget:function(a,b){return this.ctx.getApplication().mainView.getRightBottomTarget(a,b)},getViewId:function(a,b){return this.beanNamespace+k(l.toString(a.scope)+l.toString(a.path),1)+(null!=b?b:"")},getView:function(a,b){var f=this.getViewId(a,b);return g.byId(f)},getStore:function(){return this.store},isValid:function(){return null!=this.store},initStore:function(a){this.store=new e({data:a.items,idProperty:"path"});this.onStoreReady(this.store);return this.store},onStoreReady:function(){},
createGroup:function(a,b,f){return this.callMethodEx(null,"createGroup",[a,b],f,!0)},removeGroup:function(a,b,f,h){return this.callMethodEx(null,"removeGroup",[a,b,f],h,!0)},removeItem:function(a,b,f,h){return this.callMethodEx(null,"removeItem",[a,b,f],h,!0)},updateCI:function(a,b,f,h){a&&h&&this.updateItemMetaData(l.toString(h.scope),l.toString(h.path),this.itemMetaStorePath||"/inputs",{id:l.toString(a.id)},{value:b})},updateItemMetaData:function(a,b,f,h,c,d,n){return this.callMethodEx(null,"updateItemMetaData",
[a,b,f,h,c],d,!1)},mergeNewModule:function(a){for(var b in a){var f=a[b];f&&_.isFunction(f)&&(this[b]=f)}},_onReloaded:function(a){this.mergeNewModule(a.prototype);a=this.declaredClass;(a=m.getObject(l.replaceAll("/",".",a))||m.getObject(a))&&a.prototype&&a.prototype.solve&&this.mergeNewModule(a.prototype)}})})},"xide/encoding/MD5":function(){define(["./_base"],function(p){function m(a,f){return a<<f|a>>>32-f}function l(a,f,h,c,d,n){return p.addWords(m(p.addWords(p.addWords(f,a),p.addWords(c,n)),
d),h)}function k(a,f,h,c,d,n,e){return l(f&h|~f&c,a,f,d,n,e)}function g(a,f,h,c,d,n,e){return l(f&c|h&~c,a,f,d,n,e)}function e(a,f,h,c,d,n,e){return l(h^(f|~c),a,f,d,n,e)}function a(a,f){a[f>>5]|=128<<f%32;a[(f+64>>>9<<4)+14]=f;for(var h=1732584193,c=-271733879,d=-1732584194,n=271733878,q=0;q<a.length;q+=16)var r=h,v=c,m=d,x=n,h=k(h,c,d,n,a[q+0],7,-680876936),n=k(n,h,c,d,a[q+1],12,-389564586),d=k(d,n,h,c,a[q+2],17,606105819),c=k(c,d,n,h,a[q+3],22,-1044525330),h=k(h,c,d,n,a[q+4],7,-176418897),n=k(n,
h,c,d,a[q+5],12,1200080426),d=k(d,n,h,c,a[q+6],17,-1473231341),c=k(c,d,n,h,a[q+7],22,-45705983),h=k(h,c,d,n,a[q+8],7,1770035416),n=k(n,h,c,d,a[q+9],12,-1958414417),d=k(d,n,h,c,a[q+10],17,-42063),c=k(c,d,n,h,a[q+11],22,-1990404162),h=k(h,c,d,n,a[q+12],7,1804603682),n=k(n,h,c,d,a[q+13],12,-40341101),d=k(d,n,h,c,a[q+14],17,-1502002290),c=k(c,d,n,h,a[q+15],22,1236535329),h=g(h,c,d,n,a[q+1],5,-165796510),n=g(n,h,c,d,a[q+6],9,-1069501632),d=g(d,n,h,c,a[q+11],14,643717713),c=g(c,d,n,h,a[q+0],20,-373897302),
h=g(h,c,d,n,a[q+5],5,-701558691),n=g(n,h,c,d,a[q+10],9,38016083),d=g(d,n,h,c,a[q+15],14,-660478335),c=g(c,d,n,h,a[q+4],20,-405537848),h=g(h,c,d,n,a[q+9],5,568446438),n=g(n,h,c,d,a[q+14],9,-1019803690),d=g(d,n,h,c,a[q+3],14,-187363961),c=g(c,d,n,h,a[q+8],20,1163531501),h=g(h,c,d,n,a[q+13],5,-1444681467),n=g(n,h,c,d,a[q+2],9,-51403784),d=g(d,n,h,c,a[q+7],14,1735328473),c=g(c,d,n,h,a[q+12],20,-1926607734),h=l(c^d^n,h,c,a[q+5],4,-378558),n=l(h^c^d,n,h,a[q+8],11,-2022574463),d=l(n^h^c,d,n,a[q+11],16,1839030562),
c=l(d^n^h,c,d,a[q+14],23,-35309556),h=l(c^d^n,h,c,a[q+1],4,-1530992060),n=l(h^c^d,n,h,a[q+4],11,1272893353),d=l(n^h^c,d,n,a[q+7],16,-155497632),c=l(d^n^h,c,d,a[q+10],23,-1094730640),h=l(c^d^n,h,c,a[q+13],4,681279174),n=l(h^c^d,n,h,a[q+0],11,-358537222),d=l(n^h^c,d,n,a[q+3],16,-722521979),c=l(d^n^h,c,d,a[q+6],23,76029189),h=l(c^d^n,h,c,a[q+9],4,-640364487),n=l(h^c^d,n,h,a[q+12],11,-421815835),d=l(n^h^c,d,n,a[q+15],16,530742520),c=l(d^n^h,c,d,a[q+2],23,-995338651),h=e(h,c,d,n,a[q+0],6,-198630844),n=
e(n,h,c,d,a[q+7],10,1126891415),d=e(d,n,h,c,a[q+14],15,-1416354905),c=e(c,d,n,h,a[q+5],21,-57434055),h=e(h,c,d,n,a[q+12],6,1700485571),n=e(n,h,c,d,a[q+3],10,-1894986606),d=e(d,n,h,c,a[q+10],15,-1051523),c=e(c,d,n,h,a[q+1],21,-2054922799),h=e(h,c,d,n,a[q+8],6,1873313359),n=e(n,h,c,d,a[q+15],10,-30611744),d=e(d,n,h,c,a[q+6],15,-1560198380),c=e(c,d,n,h,a[q+13],21,1309151649),h=e(h,c,d,n,a[q+4],6,-145523070),n=e(n,h,c,d,a[q+11],10,-1120210379),d=e(d,n,h,c,a[q+2],15,718787259),c=e(c,d,n,h,a[q+9],21,-343485551),
h=p.addWords(h,r),c=p.addWords(c,v),d=p.addWords(d,m),n=p.addWords(n,x);return[h,c,d,n]}p.MD5=function(b,f){var h=f||p.outputTypes.Base64,c=a(p.stringToWord(b),8*b.length);switch(h){case p.outputTypes.Raw:return c;case p.outputTypes.Hex:return p.wordToHex(c);case p.outputTypes.String:return p.wordToString(c);default:return p.wordToBase64(c)}};p.MD5._hmac=function(b,f,h){h=h||p.outputTypes.Base64;var c=p.stringToWord(f);16<c.length&&(c=a(c,8*f.length));var d=[];f=[];for(var n=0;16>n;n++)d[n]=c[n]^
909522486,f[n]=c[n]^1549556828;b=a(d.concat(p.stringToWord(b)),512+8*b.length);b=a(f.concat(b),640);switch(h){case p.outputTypes.Raw:return b;case p.outputTypes.Hex:return p.wordToHex(b);case p.outputTypes.String:return p.wordToString(b);default:return p.wordToBase64(b)}};return p.MD5})},"xide/encoding/_base":function(){define(["dojo/_base/lang"],function(p){return{outputTypes:{Base64:0,Hex:1,String:2,Raw:3},addWords:function(m,l){var k=(m&65535)+(l&65535);return(m>>16)+(l>>16)+(k>>16)<<16|k&65535},
stringToWord:function(m){for(var l=[],k=0,g=8*m.length;k<g;k+=8)l[k>>5]|=(m.charCodeAt(k/8)&255)<<k%32;return l},wordToString:function(m){for(var l=[],k=0,g=32*m.length;k<g;k+=8)l.push(String.fromCharCode(m[k>>5]>>>k%32&255));return l.join("")},wordToHex:function(m){for(var l=[],k=0,g=4*m.length;k<g;k++)l.push("0123456789abcdef".charAt(m[k>>2]>>k%4*8+4&15)+"0123456789abcdef".charAt(m[k>>2]>>k%4*8&15));return l.join("")},wordToBase64:function(m){for(var l=[],k=0,g=4*m.length;k<g;k+=3)for(var e=(m[k>>
2]>>k%4*8&255)<<16|(m[k+1>>2]>>(k+1)%4*8&255)<<8|m[k+2>>2]>>(k+2)%4*8&255,a=0;4>a;a++)8*k+6*a>32*m.length?l.push("\x3d"):l.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e>>6*(3-a)&63));return l.join("")},stringToUtf8:function(m){for(var l="",k=-1,g,e;++k<m.length;)g=m.charCodeAt(k),e=k+1<m.length?m.charCodeAt(k+1):0,55296<=g&&56319>=g&&56320<=e&&57343>=e&&(g=65536+((g&1023)<<10)+(e&1023),k++),127>=g?l+=String.fromCharCode(g):2047>=g?l+=String.fromCharCode(192|g>>>
6&31,128|g&63):65535>=g?l+=String.fromCharCode(224|g>>>12&15,128|g>>>6&63,128|g&63):2097151>=g&&(l+=String.fromCharCode(240|g>>>18&7,128|g>>>12&63,128|g>>>6&63,128|g&63));return l}}})},"xide/registry":function(){define(["dojo/_base/array","dojo/_base/window","xdojo/has"],function(p,m,l){var k={},g={},e={length:0,add:function(a){this._hash[a.id]&&(console.error("already registered "+a.id+" calss "+a.declaredClass),this.remove(a.id),this.add(a));g[a.id]=a;this.length++},remove:function(a){g[a]&&(delete g[a],
this.length--)},byId:function(a){return"string"==typeof a?g[a]:a},byNode:function(a){return g[a.getAttribute("widgetId")]},toArray:function(){return _.values(_.mapKeys(g,function(a,b){a.id=b;return a}))},getUniqueId:function(a){var b;do b=a+"_"+(a in k?++k[a]:k[a]=0);while(g[b]);return b},findWidgets:function(a,b){function f(a){for(a=a.firstChild;a;a=a.nextSibling)if(1==a.nodeType){var d=a.getAttribute("widgetId");d?(d=g[d])&&h.push(d):a!==b&&f(a)}}var h=[];f(a);return h},_destroyAll:function(){p(e.findWidgets(m.body()),
function(a){a._destroyed||(a.destroyRecursive?a.destroyRecursive():a.destroy&&a.destroy())})},getEnclosingWidget:function(a){for(;a;){var b=1==a.nodeType&&a.getAttribute("widgetId");if(b)return g[b];a=a.parentNode}return null},_hash:g};return e})},"xide/data/TreeMemory":function(){define(["xdojo/declare","xide/data/Memory","dstore/Tree","dojo/Deferred","dstore/QueryResults"],function(p,m,l,k,g){return p("xide.data.TreeMemory",[m,l],{_state:{filter:null},parentField:"parentId",reset:function(){this._state.filter=
null;this.resetQueryLog()},resetQueryLog:function(){this.queryLog=[]},fetchRange:function(){var e=this._fetchRange(arguments);return new g(e.then(function(a){return a}),{totalLength:e.then(function(a){return a.length})})},filter:function(e){var a=this.inherited(arguments);this._state.filter=e;return a},_fetchRange:function(e){var a=new k;e=this.fetchRangeSync(e);if(this._state.filter){if(this._state&&this._state.filter&&this._state.filter.parent){var b=this.getSync(this._state.filter.parent);b&&(this.reset(),
e={},this.getChildrenSync?e=this.getChildrenSync(b):(e[this.parentField]=b[this.idProperty],e=this.root.query(e)))}this._state&&this._state.filter&&this._state.filter.group&&(this.getSync(this._state.filter.parent),b&&(this.reset(),e=b.items))}a.resolve(e);return a},children:function(e){for(var a=this.root.data,b=[],f=0;f<a.length;f++){var h=a[f];h[this.parentField]==e[this.idProperty]&&b.push(h)}return a},mayHaveChildren:function(e){return!1===e._mayHaveChildren?!1:!0}})})},"xide/data/Memory":function(){define(["xdojo/declare",
"dstore/Memory","xide/data/_Base"],function(p,m,l){return p("xide.data.Memory",[m,l],{})})},"dstore/Memory":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array ./Store ./Promised ./SimpleQuery ./QueryResults".split(" "),function(p,m,l,k,g,e,a){return p([k,g,e],{constructor:function(){this.storage.version=0},postscript:function(){this.inherited(arguments);this.setData(this.data||[])},data:null,autoEmitEvents:!1,getSync:function(a){return this.storage.fullData[this.storage.index[a]]},
putSync:function(a,f){f=f||{};var h=this.storage,c=h.index,d=h.fullData,n=this.Model;!n||a instanceof n||(a=this._restore(a));var e=this.getIdentity(a);null==e&&(this._setIdentity(a,"id"in f?f.id:Math.random()),e=this.getIdentity(a));h.version++;var h=e in c?"update":"add",n={target:a},g;if("update"===h){if(!1===f.overwrite)throw Error("Object already exists");d.splice(g=c[e],1);e=g}else e=this.defaultNewToStart?0:d.length;var k;if("beforeId"in f){var l=f.beforeId;null===l?k=d.length:(k=c[l],g<k&&
--k);void 0!==k?n.beforeId=l:(console.error("options.beforeId was specified but no corresponding index was found"),k=e)}else k=e;d.splice(k,0,a);g=isFinite(g)?Math.min(g,k):k;for(e=d.length;g<e;++g)c[this.getIdentity(d[g])]=g;this.emit(h,n);return a},addSync:function(a,f){(f=f||{}).overwrite=!1;return this.putSync(a,f)},removeSync:function(a){var f=this.storage,h=f.index,f=f.fullData;if(a in h)return h=f.splice(h[a],1)[0],this._reindex(),this.emit("delete",{id:a,target:h}),!0},setData:function(a){this.parse&&
(a=this.parse(a));a.items&&(this.idProperty=a.identifier||this.idProperty,a=a.items);this.storage.fullData=this.data=a;this._reindex()},_reindex:function(){for(var a=this.storage,f=a.index={},h=a.fullData,c=this.Model,d=Object.prototype,n=0,e=h.length;n<e;n++){var g=h[n];if(c&&!(g instanceof c)){var k=this._restore(g,g.__proto__===d);g!==k&&(h[n]=g=k)}f[this.getIdentity(g)]=n}a.version++},fetchSync:function(){var b=this.data;if(!b||b._version!==this.storage.version){for(var b=this.storage.fullData,
f=this.queryLog,h=0,c=f.length;h<c;h++)b=f[h].querier(b);b._version=this.storage.version;this.data=b}return new a(b)},fetchRangeSync:function(b){var f=this.fetchSync();return new a(f.slice(b.start,b.end),{totalLength:f.length})},_includePropertyInSubCollection:function(a){return"data"!==a&&this.inherited(arguments)}})})},"dstore/Store":function(){define("dojo/_base/lang dojo/_base/array dojo/aspect dojo/has dojo/when dojo/Deferred dojo/_base/declare ./QueryMethod ./Filter dojo/Evented".split(" "),
function(p,m,l,k,g,e,a,b,f,h){function c(a){return function(d,c){var b=this;g(d,function(d){d={target:d};var h=c[1]||{};"beforeId"in h&&(d.beforeId=h.beforeId);b.emit(a,d)});return d}}k.add("object-proto",!!{}.__proto__&&!{}.watch);var d=k("object-proto");return a(h,{constructor:function(d){d&&a.safeMixin(this,d);this.Model&&this.Model.createSubclass&&(this.Model=this.Model.createSubclass([]).extend({_store:this}));this.storage=new h;var b=this;this.autoEmitEvents&&(l.after(this,"add",c("add")),l.after(this,
"put",c("update")),l.after(this,"remove",function(a,d){g(a,function(){b.emit("delete",{id:d[0]})});return a}))},autoEmitEvents:!0,idProperty:"id",queryAccessors:!0,getIdentity:function(a){return a.get?a.get(this.idProperty):a[this.idProperty]},_setIdentity:function(a,d){a.set?a.set(this.idProperty,d):a[this.idProperty]=d},forEach:function(a,d){var c=this;return g(this.fetch(),function(b){for(var h=0,f;void 0!==(f=b[h]);h++)a.call(d,f,h,c);return b})},on:function(a,d){return this.storage.on(a,d)},
emit:function(a,d){d=d||{};d.type=a;try{return this.storage.emit(a,d)}finally{return d.cancelable}},parse:null,stringify:null,Model:null,_restore:function(a,c){var b=this.Model;if(b&&a){var h=b.prototype,f=h._restore;f?a=f.call(a,b,c):d&&c?a.__proto__=h:a=p.delegate(h,a)}return a},create:function(a){return new this.Model(a)},_createSubCollection:function(d){var c=p.delegate(this.constructor.prototype),b;for(b in this)this._includePropertyInSubCollection(b,c)&&(c[b]=this[b]);return a.safeMixin(c,d)},
_includePropertyInSubCollection:function(a,d){return!(a in d)||d[a]!==this[a]},queryLog:[],filter:new b({type:"filter",normalizeArguments:function(a){var d=this.Filter;return a instanceof d?[a]:[new d(a)]}}),Filter:f,sort:new b({type:"sort",normalizeArguments:function(a,d){var c;"function"===typeof a?c=[a]:(c=a instanceof Array?a.slice():"object"===typeof a?[].slice.call(arguments):[{property:a,descending:d}],c=m.map(c,function(a){a=p.mixin({},a);a.descending=!!a.descending;return a}),c=[c]);return c}}),
select:new b({type:"select"}),_getQuerierFactory:function(a){return this["_create"+(a[0].toUpperCase()+a.substr(1))+"Querier"]}})})},"dstore/QueryMethod":function(){define([],function(){return function(p){var m=p.type,l=p.normalizeArguments,k=p.applyQuery,g=p.querierFactory;return function(){var e=Array.prototype.slice.call(arguments),a=l?l.apply(this,e):e,e={type:m,arguments:e,normalizedArguments:a},b=this._getQuerierFactory(m)||g;b&&(e.querier=b.apply(this,a));a=this._createSubCollection({queryLog:this.queryLog.concat(e)});
return k?k.call(this,a,e):a}}})},"dstore/Filter":function(){define(["dojo/_base/declare"],function(p){function m(l){return function(){var k=this.constructor,g=new k;g.type=l;g.args=arguments;return this.type?m("and").call(k.prototype,this,g):g}}p=p(null,{constructor:function(l){var k=typeof l;switch(k){case "object":var k=this,g;for(g in l)var e=l[g],k=e instanceof this.constructor?k[e.type](g,e.args[0]):e&&e.test?k.match(g,e):k.eq(g,e);this.type=k.type;this.args=k.args;break;case "function":case "string":this.type=
k,this.args=[l]}},and:m("and"),or:m("or"),eq:m("eq"),ne:m("ne"),lt:m("lt"),lte:m("lte"),gt:m("gt"),gte:m("gte"),contains:m("contains"),"in":m("in"),match:m("match")});p.filterCreator=m;return p})},"dstore/Promised":function(){define(["dojo/_base/declare","dojo/Deferred","./QueryResults","dojo/when"],function(p,m,l,k){function g(e,a){return function(){var b=new m;try{b.resolve(this[e].apply(this,arguments))}catch(f){b.reject(f)}return a?(b=new l(b.promise),b.totalLength=k(b.totalLength),b):b.promise}}
return p(null,{get:g("getSync"),put:g("putSync"),add:g("addSync"),remove:g("removeSync"),fetch:g("fetchSync",!0),fetchRange:g("fetchRangeSync",!0)})})},"dstore/QueryResults":function(){define(["dojo/_base/lang","dojo/when"],function(p,m){function l(k,g){return m(this,function(e){for(var a=0,b=e.length;a<b;a++)k.call(g,e[a],a,e)})}return function(k,g){var e=g&&"totalLength"in g;if(k.then){k=p.delegate(k);var a=k.then(function(a){var f=e?g.totalLength:a.totalLength||a.length;a.totalLength=f;return!e&&
f});k.totalLength=e?g.totalLength:a;k.response=g&&g.response}else k.totalLength=e?g.totalLength:k.length;k.forEach=l;return k}})},"dstore/SimpleQuery":function(){define(["dojo/_base/declare","dojo/_base/array"],function(p,m){function l(g,e){if(-1<g.indexOf(".")){var a=g.split("."),b=a.length;return function(f){for(var h=0;h<b;h++)f=f&&(e&&f.get?f.get(a[h]):f[a[h]]);return f}}return function(a){return a.get?a.get(g):a[g]}}var k={eq:function(g,e){return g===e},"in":function(g,e){return-1<m.indexOf(e.data||
e,g)},ne:function(g,e){return g!==e},lt:function(g,e){return g<e},lte:function(g,e){return g<=e},gt:function(g,e){return g>e},gte:function(g,e){return g>=e},match:function(g,e,a){return e.test(g,a)},contains:function(g,e,a,b){var f=this;return m.every(e.data||e,function(h){if("object"===typeof h&&h.type){var c=f._getFilterComparator(h.type);return m.some(g,function(d){return c.call(f,d,h.args[1],a,b)})}return-1<m.indexOf(g,h)})}};return p(null,{_createFilterQuerier:function(g){function e(h){var c=
h.type;h=h.args;var d=b._getFilterComparator(c);if(d){var n=h[0],g=l(n,a),k=h[1];k&&k.fetchSync&&(k=k.fetchSync());return function(a){return d.call(b,g(a),k,a,n)}}switch(c){case "and":case "or":for(var v=0,m=h.length;v<m;v++){var p=e(h[v]);f=f?function(a,d){return"and"===c?function(c){return a(c)&&d(c)}:function(c){return a(c)||d(c)}}(f,p):p}return f;case "function":return h[0];case "string":v=b[h[0]];if(!v)throw Error("No filter function "+h[0]+" was found in the collection");return v;case void 0:return function(){return!0};
default:throw Error('Unknown filter operation "'+c+'"');}}var a=this.queryAccessors,b=this,f=e(g);return function(a){return m.filter(a,f)}},_getFilterComparator:function(g){return k[g]||this.inherited(arguments)},_createSelectQuerier:function(g){return function(e){var a=g.length;return m.map(e,g instanceof Array?function(b){for(var f={},h=0;h<a;h++){var c=g[h];f[c]=b[c]}return f}:function(a){return a[g]})}},_createSortQuerier:function(g){var e=this.queryAccessors;return function(a){a=a.slice();a.sort("function"==
typeof g?g:function(a,f){for(var h=0;h<g.length;h++){var c,d=g[h];if("function"==typeof d)c=d(a,f);else{c=d.get||(d.get=l(d.property,e));var d=d.descending,n=c(a);c=c(f);null!=n&&(n=n.valueOf());null!=c&&(c=c.valueOf());c=n===c?0:!!d===(null===n||n>c&&null!==c)?-1:1}if(0!==c)return c}return 0});return a}}})})},"xide/data/_Base":function(){define(["xdojo/declare","dstore/Memory","dstore/Tree","dstore/QueryResults","xide/mixins/EventedMixin"],function(p,m,l,k,g){return p("xide/data/_base",g,{__all:null,
allowCache:!1,constructor:function(){var e=this;if(e._getQuerierFactory("filter")||e._getQuerierFactory("sort"))this.queryEngine=function(a,f){f=f||{};var h=e._getQuerierFactory("filter"),c=h?h(a):passthrough,h=e._getQuerierFactory("sort"),d=passthrough;h&&(d=h(arrayUtil.map(f.sort,function(a){return{property:a.attribute,descending:a.descending}})));var n=passthrough;isNaN(f.start)&&isNaN(f.count)||(n=function(a){var d=f.start||0,d=a.slice(d,d+(f.count||Infinity));d.total=a.length;return d});return function(a){return n(d(c(a)))}};
var a=this;e.on("add,update,delete",function(b){var f=b.type,h=b.target;a.notify("add"===f||"update"===f?h:void 0,"delete"===f||"update"===f?"id"in b?b.id:e.getIdentity(h):void 0)})},destroy:function(){this._emit("destroy",this)},notify:function(){},refreshItem:function(e){this.emit("update",{target:e})},query:function(e,a,b){a=a||{};e=e||{};var f=this.filter(e),h;if(e=a.sort)if("[object Array]"===Object.prototype.toString.call(e))for(;b=e.pop();)f=f.sort(b.attribute,b.descending);else f=f.sort(e);
"start"in a&&(h=a.start||0,h=f[f.fetchRangeSync?"fetchRangeSync":"fetchRange"]({start:h,end:a.count?h+a.count:Infinity}),h.total=h.totalLength);h=h||new k(f[f.fetchSync?"fetchSync":"fetch"]());h.observe=function(a,d){var b=f.on("add",function(d){a(d.target,-1,d.index)}),h=f.on("update",function(b){!d&&b.previousIndex===b.index&&isFinite(b.index)||a(b.target,b.previousIndex,b.index)}),e=f.on("delete",function(d){a(d.target,d.previousIndex,-1)}),g={remove:function(){b.remove();h.remove();e.remove()}};
g.cancel=g.remove;return g};return h}})})},"dstore/Tree":function(){define(["dojo/_base/declare"],function(p){return p(null,{constructor:function(){this.root=this},mayHaveChildren:function(m){return"hasChildren"in m?m.hasChildren:!0},getRootCollection:function(){return this.root.filter({parent:null})},getChildren:function(m){return this.root.filter({parent:this.getIdentity(m)})}})})},"xcf/model/Variable":function(){define(["dcl/dcl","xblox/model/variables/Variable"],function(p,m){return p(m,{declaredClass:"xcf.model.Variable",
hasInlineEdits:!0,gui:"off",cmd:"off",save:!1,target:"None",name:"No Title",value:-1,observed:["value","initial","name"],solve:function(){var l="";if("processVariables"==this.group){var k=this.scope.getVariable("value");k&&(k=k.value,this.isNumber(k)||(k="'"+k+"'"),l="var value \x3d "+k+";\n")}return this.scope.parseExpression(l+this.getValue(),!0)},canEdit:function(){return!0},canDisable:function(){return!1},getFields:function(){var l=this.getDefaultFields();l.push(this.utils.createCI("title",13,
this.name,{group:"General",title:"Name",dst:"name"}));var k=this;l.push(this.utils.createCI("value",this.types.ECIType.EXPRESSION,this.value,{group:"General",title:"Value",dst:"value",widget:{allowACECache:!0,showBrowser:!1,showSaveButton:!0,editorOptions:{showGutter:!1,autoFocus:!1,hasConsole:!1},aceOptions:{hasEmmet:!1,hasLinking:!1,hasMultiDocs:!1},item:this},delegate:{runExpression:function(g,e,a){if("processVariables"==k.group){var b=k.scope.getVariable("value"),f="";b&&(b=b.value,k.isNumber(b)||
(b="'"+b+"'"),f="var value \x3d "+b+";\n")}return k.scope.expressionModel.parse(k.scope,f+g,!1,e,a)}}}));return l}})})},"xblox/model/variables/Variable":function(){define(["dcl/dcl","xide/types","xblox/model/Block"],function(p,m,l){return p(l,{declaredClass:"xblox.model.variables.Variable",name:null,value:null,register:!0,readOnly:!1,initial:null,getValue:function(){return this.value},canDisable:function(){return!1},canMove:function(){return!1},getIconClass:function(){return"el-icon-quotes-alt"},
getBlockIcon:function(){return'\x3cspan class\x3d"'+this.icon+'"\x3e\x3c/span\x3e '},toText:function(){return"\x3cspan class\x3d'text-primary'\x3e"+this.getBlockIcon()+this.makeEditable("name","right","text","Enter a unique name","inline")+"\x3c/span\x3e"},solve:function(){this.scope.parseExpression(this.getValue(),!0);return[]},getFields:function(){var k=this.getDefaultFields(),g=this;k.push(this.utils.createCI("title",m.ECIType.STRING,this.name,{group:"General",title:"Name",dst:"name"}));k.push(this.utils.createCI("value",
m.ECIType.EXPRESSION,this.value,{group:"General",title:"Value",dst:"value",delegate:{runExpression:function(e,a,b){return g.scope.expressionModel.parse(g.scope,e,!1,a,b)}}}));return k}})})},"xblox/model/Block":function(){define("dcl/dcl dojo/Deferred dojo/_base/lang dojo/has ./ModelBase xide/factory xide/utils xide/types dojo/has!xblox-ui?./Block_UI".split(" "),function(p,m,l,k,g,e,a,b,f){g=[g];g.push(p(null,{getStatusIcon:function(){},getStatusClass:function(){},setStatusClass:function(){},onActivity:function(){},
onRun:function(){},onFailed:function(){},onSuccess:function(){},getIconClass:function(){}}));l.mixin(b,{BLOCK_FLAGS:{NONE:0,ACTIVE:1,SCRIPT:2,RESERVED1:4,USEFUNCTION:8,RESERVED2:16,SINGLE:32,WAITSFORMESSAGE:64,VARIABLEINPUTS:128,VARIABLEOUTPUTS:256,VARIABLEPARAMETERINPUTS:512,VARIABLEPARAMETEROUTPUTS:1024,TOPMOST:16384,BUILDINGBLOCK:32768,MESSAGESENDER:65536,MESSAGERECEIVER:131072,TARGETABLE:262144,CUSTOMEDITDIALOG:524288,RESERVED0:1048576,EXECUTEDLASTFRAME:2097152,DEACTIVATENEXTFRAME:4194304,RESETNEXTFRAME:8388608,
INTERNALLYCREATEDINPUTS:16777216,INTERNALLYCREATEDOUTPUTS:33554432,INTERNALLYCREATEDINPUTPARAMS:67108864,INTERNALLYCREATEDOUTPUTPARAMS:134217728,INTERNALLYCREATEDLOCALPARAMS:1073741824,ACTIVATENEXTFRAME:268435456,LOCKED:536870912,LAUNCHEDONCE:2147483648},BLOCK_CALLBACKMASK:{PRESAVE:1,DELETE:2,ATTACH:4,DETACH:8,PAUSE:16,RESUME:32,CREATE:64,RESET:4096,POSTSAVE:256,LOAD:512,EDITED:1024,SETTINGSEDITED:2048,READSTATE:4096,NEWSCENE:8192,ACTIVATESCRIPT:16384,DEACTIVATESCRIPT:32768,RESETINBREAKPOINT:65536,
RENAME:131072,BASE:14,SAVELOAD:769,PPR:304,EDITIONS:3072,ALL:4294967295}});g=p(g,{declaredClass:"xblox.model.Block",scopeId:null,isCommand:!1,getInstance:function(){var a=this.scope.instance;return a?a:null},stop:function(){this._loop&&(clearTimeout(this._loop),this._loop=null);this.reset&&this.reset()},mergeNewModule:function(a){for(var c in a){var d=a[c];d&&_.isFunction(d)&&(this[c]=d)}},__onReloaded:function(b){this.mergeNewModule(b.prototype);b=this.declaredClass;(b=l.getObject(a.replaceAll("/",
".",b))||l.getObject(b))&&b.prototype&&b.prototype.solve&&this.mergeNewModule(b.prototype)},reparent:function(){if(!this)return!1;if(!this.getParent()){var a=this.next(null,1)||this.next(null,-1);a&&(this.group=null,a._add(this))}},unparent:function(a,c){if(!this)return!1;var d=this.getParent();d&&d.removeBlock&&d.removeBlock(this,!1);this.group=a;this.parent=this.parentId=null;!1!==c&&(this._place(null,-1,null),this._place(null,-1,null))},move:function(a){if(!this)return!1;var c=this.getParent(),
d=null;if(c){d=c[c._getContainer(this)];if(!d||2>d.length||!this.containsItem(d,this))return!1;c=this.indexOf(d,this);if(0>c+a)return!1;var b=d[c+a];if(!b)return!1;d[c+a]=this;d[c]=b}else this._place(null,a);return!0},_place:function(a,c,d){function b(a){for(var c=0;c<d.length;c++)if(a.id===d[c].id)return c}var f=this._store,e=this;(a=a||e.next(null,c))?(a=_.isString(a)?f.getSync(a):a,e=_.isString(e)?f.getSync(e):e,d=d||f.storage.fullData,c=-1==c?0:1,d.remove(e),-1==c&&(c=0),d.splice(Math.max(b(a)+
c,0),0,e),f._reindex()):console.error("have no next",this)},index:function(){var a=this.getParent(),c=null,d=this.group,c=this._store;if(a)return c=a[a._getContainer(this)],c=c.filter(function(a){return a.group===d}),!c||2>c.length||!this.containsItem(c,this)?!1:this.indexOf(c,this);c=c.storage.fullData;c=c.filter(function(a){return a.group===d});return this.indexOf(c,this)},numberOfParents:function(){var a=0,c=this.getParent();c&&(a++,a+=c.numberOfParents());return a},next:function(a,c){function d(a,
c,h){var f=a.indexOf(c,a);if(f=c[f+h*b]){if(!f.parentId&&f.group&&f.group===a.group)return f;b++;return d(a,c,h)}return null}var b=1;a=a||this._store.storage.fullData;return d(this,a,c)},getParent:function(){return this.parentId?this.scope.getBlockById(this.parentId):null},getScope:function(){var a=this.scope;if(this.scopeId&&0<this.scopeId.length){var c=a.owner;c&&c.hasScope&&(c.hasScope(this.scopeId)?a=c.getScope(this.scopeId):console.error("have scope id but cant resolve it",this))}return a},enabled:!0,
serializeMe:!0,name:null,shareTitle:"",sharable:!1,items:null,parent:null,_return:null,_lastResult:null,_deferredObject:null,_currentIndex:0,_lastRunSettings:null,_onLoaded:!1,beanType:"BLOCK",override:{},ignoreSerialize:"_currentIndex _deferredObject _return parent ignoreSerialize _lastRunSettings _onLoaded beanType sharable override virtual _scenario _didRegisterSubscribers additionalProperties renderBlockIcon serializeMe _statusIcon _statusClass".split(" "),canAdd:function(){return null},getTarget:function(){var a=
this._targetReference;if(a)return a;var c=this.getParent();c&&c.getTarget&&(a=c.getTarget());return a},addToEnd:function(a,c){c&&null!=a.length&&null!=c.length&&a.push.apply(a,c);return a},removeBlock:function(a,c){a&&(!1!==c&&a.empty&&a.empty(),!1!==c&&delete a.items,a.parent=null,this.items&&this.items.remove(a))},_getContainer:function(a){return"items"},empty:function(a){try{this._empty(a)}catch(c){debugger}},_empty:function(a){if(a=a||this.items)for(var c=0;c<a.length;c++){var d=a[c];d&&d.empty&&
d.empty();d&&this.scope&&this.scope.blockStore&&this.scope.blockStore.remove(d.id)}},containsItem:function(a,c){for(var d=a.length;d--;)if(a[d].id===c.id)return!0;return!1},indexOf:function(a,c){for(var d=a.length;d--;)if(a[d].id===c.id)return d;return-1},_getBlock:function(a){try{if(!this||!this.parentId)return!1;var c=this.scope.getBlockById(this.parentId);if(!c)return null;var d=c[c._getContainer(this)];if(!d||2>d.length||!this.containsItem(d,this))return null;var b=this.indexOf(d,this);if(0>b+
a)return!1;var f=d[b+a];if(f)return f}catch(e){debugger}return null},getPreviousBlock:function(){return this._getBlock(-1)},getNextBlock:function(){return this._getBlock(1)},getPreviousResult:function(){var a=this.getPreviousBlock()||this.getParent();return a&&null!=a._lastResult?this.isArray(a._lastResult)?a._lastResult:[a._lastResult]:null},_getArg:function(b,c){var d=parseFloat(b);return isNaN(d)?"true"===b||"false"===b?a.toBoolean(b):b&&c&&_.isString(b)?"'"+b+"'":b:d},getArgs:function(b){var c=
[],d=this._get("args");b&&b.override&&b.override.args&&(d=b.override.args);d&&(c=a.getJson(d,null,!1),null!=c&&_.isArray(c));if(c&&0==c.length&&d&&d.length&&_.isString(d)){if(-1!==d.indexOf(",")){d=d.split(",");for(b=0;b<d.length;b++){var n=parseFloat(d[b]);isNaN(n)?"true"===d[b]||"false"===d[b]?c.push(a.toBoolean(d[b])):c.push(d[b]):c.push(n)}return c}c=[this._getArg(d)]}b=this.getPreviousResult();null!=b&&(l.isArray(b)&&1==b.length?c.push(b[0]):c.push(b));return c||[d]},remove:function(a){this._destroyed=
!0;null!=this.parentId&&null==this.parent&&(this.parent=this.scope.getBlockById(this.parentId));if(this.parent&&this.parent.removeBlock)this.parent.removeBlock(this);else if(a=a||this)a.empty&&a.empty(),delete a.items,a.parent=null,this.items&&this.items.remove(a)},prepareBlockContructorArgs:function(a){a||(a={});a.id||(a.id=this.createUUID());a.items||(a.items=[])},_add:function(a,c,d){var b=null;try{c?(this.prepareBlockContructorArgs(c),b=e.createBlock(a,c)):null==c&&(b=a);(b.scope=this.scope)&&
(b=this.scope.registerBlock(b));if(b.id===this.id){console.error("adding new block to our self");debugger}b.parent=this;b.parentId=this.id;var f=d||this._getContainer();if(f)if(this[f]||(this[f]=[]),-1!=this.indexOf(this[f],b))console.error(" have already "+b.id+" in "+f);else{if(this.id==b.id){console.error("tried to add our self to "+f);return}this[f].push(b)}return b}catch(g){logError(g,"_add")}return null},getStore:function(){return this.getScope().getStore()},add:function(a,c,d){a=this._add(a,
c,d);return a.getStore().getSync(a.id)},getContext:function(){return this.scope.instance&&this.scope.instance?this.scope.instance:null},resolved:function(){this._deferredObject&&(this._deferredObject.resolve(),delete this._deferredObject)},_solve:function(a,c){c=c||{highlight:!1};for(var d=[],b=0;b<this.items.length;b++)this.addToEnd(d,this.items[b].solve(a,c));return d},solve:function(a,c){c=c||{highlight:!1};for(var d=[],b=0;b<this.items.length;b++)this.addToEnd(d,this.items[b].solve(a,c));return d},
solveMany:function(a,c){!this._lastRunSettings&&c&&(this._lastRunSettings=c);c=this._lastRunSettings||c;this._currentIndex=0;this._return=[];var d=this[this._getContainer()];if(d.length)return d=this.runFrom(d,0,c),this.onSuccess(this,c),d;this.onSuccess(this,c);return[]},runFrom:function(a,c,d){var b=this;a=a||this.items;var f=function(c){c._deferredObject.then(function(f){c._lastResult=c._lastResult||f;b._currentIndex++;b.runFrom(a,b._currentIndex,d)})};if(a.length)for(;c<a.length;c++){var e=a[c];
if(!0===e.deferred){e._deferredObject=new m;this._currentIndex=c;f(e);this.addToEnd(this._return,e.solve(this.scope,d));break}else this.addToEnd(this._return,e.solve(this.scope,d))}else this.onSuccess(this,d);return this._return},serializeField:function(a){return-1==this.ignoreSerialize.indexOf(a)},onLoad:function(){},activate:function(){},deactivate:function(){},_get:function(a){return a in this.override?this.override[a]:this[a]},onDidRun:function(){this.override={}}});g.FLAGS=b.BLOCK_FLAGS;g.EMITS=
b.BLOCK_CALLBACKMASK;k("xblox-ui")&&l.mixin(g.prototype,f.prototype);g.prototype.onSuccess||(g.prototype.onSuccess=function(){},g.prototype.onRun=function(){});p.chainAfter(g,"stop");return g})},"xblox/model/ModelBase":function(){define(["dcl/dcl","xide/utils","xide/types"],function(p,m,l){return p(null,{declaredClass:"xblox.model.ModelBase",id:null,description:"",parent:null,parentId:null,group:null,order:0,_store:null,outputs:function(){return[]},takes:function(){return[]},needs:function(){return[]},
constructor:function(k){for(var g in k)k.hasOwnProperty(g)&&(this[g]=k[g]);this.id||(this.id=this.createUUID());this.utils=m;this.types=l},keys:function(k){var g=[],e;for(e in k)g.push(e);return g},values:function(k){var g=[],e;for(e in k)g.push(k[e]);return g},toArray:function(){return this.map()},size:function(){return this.toArray().length},createUUID:function(){var k=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return k()+k()+"-"+k()+"-"+k()+"-"+k()+"-"+k()+k()+k()},
canEdit:function(){return!0},getFields:function(){return null},isString:function(k){return"string"==typeof k},isNumber:function(k){return"number"==typeof k},isBoolean:function(k){return"boolean"==typeof k},isObject:function(k){return"object"===typeof k},isArray:function(k){return Array.isArray?Array.isArray(k):!1},getValue:function(k){var g=parseFloat(k);return isNaN(g)?"true"===k||!0===k?!0:"false"===k||!1===k?!1:k:g},isScript:function(k){return this.isString(k)&&(-1!=k.indexOf("return")||-1!=k.indexOf(";")||
-1!=k.indexOf("+")||-1!=k.indexOf("-")||-1!=k.indexOf("\x3c")||-1!=k.indexOf("*")||-1!=k.indexOf("/")||-1!=k.indexOf("%")||-1!=k.indexOf("\x3d")||-1!=k.indexOf("\x3d\x3d")||-1!=k.indexOf("\x3e")||-1!=k.indexOf("[")||-1!=k.indexOf("{")||-1!=k.indexOf("}"))},replaceAll:function(k,g,e){return this.isString(e)?e.split(k).join(g):e},isInValidState:function(){return!0}})})},"xcf/manager/DriverManager_Server":function(){define(["dcl/dcl","dojo/_base/lang","dojo/_base/declare","xide/types","xide/utils"],
function(p,m,l,k,g){return p(null,{declaredClass:"xcf.manager.DriverManager_Server",onDriverBlocksChanged:function(e,a){var b=[],f=this.getStore()||this.store;if(!f)return console.error("getDriversAsEnumeration:: have no store!"),b;b=f.query({isDir:!1});for(f=0;f<b.length;f++){var h=b[f],c=h.user;g.getInputCIByName(c,k.DRIVER_PROPERTY.CF_DRIVER_ID);g.getInputCIByName(c,k.DRIVER_PROPERTY.CF_DRIVER_NAME);c&&h.blockPath&&h.blockPath.indexOf(a)}},onFileChanged:function(e){if("changed"===e.type&&!e._didb){e._didb=
!0;var a=g.replaceAll("\\","/",e.path),a=g.replaceAll("//","/",a),a=a.replace(/\\/g,"/"),b;b=a;b=-1!=b.indexOf("system/driver")?b.substr(b.indexOf("system/driver")+14,b.length):null;b&&-1!==b.indexOf(".xblox")&&(console.log("driver blocks changed "+b+" @ "+a,e),this.onDriverBlocksChanged(a,b))}},createDriverInstance:function(e,a){var b=this,f=this.driverScopes.system_drivers+"DriverBase";console.error(f);require([f],function(h){h.prototype.declaredClass=f;var c=b.driverScopes[e.scope],d=g.getCIInputValueByName(e.user,
k.DRIVER_PROPERTY.CF_DRIVER_CLASS);if(d){var n=c+d,n=n.replace(".js",""),n=n.replace("./","");console.log("create driver instance "+n);require([n],function(d){d=new (l([h],d.prototype));d.baseClass=h.prototype.declaredClass;d.modulePath=g.replaceAll("//","/",n);d.delegate=b;e.instance=d;a&&a(d);try{d.start()}catch(c){}return d})}else console.error("cant find driver class in meta")})},onDeviceDisconnected:function(e){},onDeviceMessage:function(e){if(e&&e.device&&e.driverInstance){var a=e.device,b=
e.driverInstance,f=b.options;if(f){var h=[e.deviceMessage];m.isString(e.deviceMessage)&&-1!=e.deviceMessage.indexOf(b.lineBreak)&&(h=e.deviceMessage.split(b.lineBreak));if(0<h.length){e=this.ctx.getBlockManager().getScope(f.id);b=e.getBlocks({group:k.BLOCK_GROUPS.CF_DRIVER_RESPONSE_BLOCKS});f=e.getVariables({group:k.BLOCK_GROUPS.CF_DRIVER_RESPONSE_VARIABLES});b&&0!=b.length||console.log("have no response blocks, abort");var c=e.getVariable("value");c||(c=new Variable({id:g.createUUID(),title:"value",
value:"",scope:e,type:13,group:"processVariables",gui:!1,cmd:!1}));for(var d=0;d<h.length;d++)if(0!=h[d].length){c.value=h[d];console.log("update process value "+c.value+" for "+a.host);this.publish(k.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:c,scope:e,owner:this});for(var n=0;n<f.length;n++)"value"!=f[n].title&&e.expressionModel.parseVariable(e,f[n]);for(n=0;n<b.length;n++)e.solveBlock(b[n],{highlight:!0})}console.log("forward messages to scope")}}}},init:function(){this.subscribe(k.EVENTS.ON_DEVICE_MESSAGE,
this.onDeviceMessage);this.subscribe(k.EVENTS.ON_DEVICE_DISCONNECTED,this.onDeviceDisconnected)}})})},"xide/data/ObservableStore":function(){define(["xdojo/declare","xide/mixins/EventedMixin"],function(p,m){return p("xide/data/Observable",m,{_ignoreChangeEvents:!0,observedProperties:[],putSync:function(l){this._ignoreChangeEvents=!0;var k=this.inherited(arguments);this._ignoreChangeEvents=!1;this.emit("added",k);return k},removeSync:function(l){var k=this.getSync(l);k&&k.onRemove&&k.onRemove();return this.inherited(arguments)},
postscript:function(){var l=this;l.inherited(arguments);if(l.on)l.on("add",function(k){k=k.target;l._observe(k);k._store||(k._store=l);k._onCreated();k.onAdd&&k.onAdd(k)})},_onItemChanged:function(l,k,g,e){this._ignoreChangeEvents||(k={target:l,property:k,value:g,source:e},this.emit("update",k),l.onItemChanged&&l.onItemChanged(k))},_observe:function(l){var k=this,g=k.observedProperties;l&&l.observed&&(g=g.concat(l.observed));g&&g.forEach(function(e){l.property(e).observe(function(a){k._ignoreChangeEvents||
k._onItemChanged(l,e,a,k)})})},setData:function(l){this.inherited(arguments);this._ignoreChangeEvents=!0;l&&_.each(l,this._observe,this);this._ignoreChangeEvents=!1}})})},"dstore/Trackable":function(){define("dojo/_base/lang dojo/_base/declare dojo/aspect dojo/when dojo/promise/all dojo/_base/array dojo/on".split(" "),function(p,m,l,k,g,e,a){function b(a,d,b){for(var f=a.length-1;0<=f;--f){var e=a[f],h=e.start,e=h+e.count;if(d>e){a.splice(f+1,0,{start:d,count:b-d});return}b>=h&&(d=Math.min(d,h),b=
Math.max(b,e),a.splice(f,1))}a.unshift({start:d,count:b-d})}var f=0,h={track:function(){function c(){return function(){var a=this,d=this.inherited(arguments);k(d,function(d){d=a._results=d.slice();a._partialResults&&(a._partialResults=null);a._ranges=[];b(a._ranges,0,d.length)});return d}}function d(){return function(a){var d=this,c=a.start,f=a.end,n=this.inherited(arguments);this._results||k(n,function(a){return k(a.totalLength,function(n){var e=d._partialResults||(d._partialResults=[]);f=Math.min(f,
c+a.length);e.length=n;n=[c,f-c].concat(a);e.splice.apply(e,n);b(d._ranges,c,f);return a})});return n}}function n(a,d){f++;var c=d.target;d=p.delegate(d,u[a]);k(x._results||x._partialResults,function(b){if(b){var f,n,g,k=x._ranges,l,r="id"in d?d.id:h.getIdentity(c),v=-1,m=-1,p=-1,y=-1;if("delete"===a||"update"===a)for(f=0;-1===v&&f<k.length;++f)for(l=k[f],n=l.start,g=n+l.count;n<g;++n)if(h.getIdentity(b[n])==r){v=d.previousIndex=n;m=f;b.splice(v,1);l.count--;for(n=f+1;n<k.length;++n)k[n].start--;
break}if("add"===a||"update"===a){if(t){if(t([c]).length){var u=0;g=k.length-1;n=-1;for(var G;u<=g&&-1===p;)f=u+Math.round((g-u)/2),l=k[f],m=b.slice(l.start,l.start+l.count),"beforeId"in d&&(n=null===d.beforeId?m.length:w(m,d.beforeId)),-1===n&&(n=v>=Math.max(0,l.start-1)&&v<=l.start+l.count?v:h.defaultNewToStart?0:m.length),m.splice(n,0,c),r=e.indexOf(t(m),c),G=l.start+r,0===r&&0!==l.start?g=f-1:r>=m.length-1&&G<b.length?u=f+1:(p=G,y=f);if(-1===p&&0<u&&u<k.length)var H=!0}}else{n=-1;if("beforeId"in
d)if(null===d.beforeId)p=b.length,n=k.length-1;else for(f=0,g=k.length;-1===y&&f<g;++f)l=k[f],p=w(b,d.beforeId,l.start,l.start+l.count),-1!==p&&(y=f);else"update"===a?(p=v,y=m):h.defaultNewToStart?n=p=0:(p=b.length,n=k.length-1);-1!==n&&-1===y&&(l=k[n])&&l.start<=p&&p<=l.start+l.count&&(y=n)}if(-1<p&&-1<y)for(d.index=p,b.splice(p,0,c),k[y].count++,f=y+1;f<k.length;++f)k[f].start++;else if(H)for(d.beforeIndex=k[u].start,f=u;f<k.length;++f)k[f].start++}d.totalLength=b.length}(b=x["on_tracked"+a])&&
b.call(x,d)})}var h=this.store||this,g=[],v={add:1,update:1,"delete":1},y;for(y in v)g.push(this.on(y,function(a){return function(d){n(a,d)}}(y)));var x=m.safeMixin(p.delegate(this),{_ranges:[],fetch:c(),fetchRange:d(),releaseRange:function(a,d){if(this._partialResults){a:for(var c=this._ranges,b=0,f;f=c[b];++b){var n=f.start,e=n+f.count;if(a<=n)if(d>=e)c.splice(b,1);else{f.start=d;f.count=e-f.start;break a}else if(a<e)if(d>n){c.splice(b,1,{start:n,count:a-n},{start:d,count:e-d});break a}else f.count=
a-f.start}for(c=a;c<d;++c)delete this._partialResults[c]}},on:function(d,c){var b=this,f=this.getInherited(arguments);return a.parse(x,d,c,function(a,d){return d in v?l.after(x,"on_tracked"+d,c,!0):f.call(b,d,c)})},tracking:{remove:function(){for(;0<g.length;)g.pop().remove();this.remove=function(){}}},track:null});this.fetchSync&&(m.safeMixin(x,{fetchSync:c(),fetchRangeSync:d()}),x.fetchSync());var t;e.forEach(this.queryLog,function(a){var d=t,c=a.querier;c&&(t=d?function(a){return c(d(a))}:c)});
var u={add:{index:void 0},update:{previousIndex:void 0,index:void 0},"delete":{previousIndex:void 0}},w=function(a,d,c,b){b=void 0!==b?b:a.length;for(c=void 0!==c?c:0;c<b;++c)if(h.getIdentity(a[c])===d)return c;return-1};return x}};g=m(null,h);g.create=function(a,d){a=m.safeMixin(p.delegate(a),h);m.safeMixin(a,d);return a};return g})},"xcf/model/Driver":function(){define(["xdojo/declare","xide/data/Model","xide/utils"],function(p,m,l){return p(m,{itemMetaPath:"user.meta",getMetaValue:function(k){return l.getCIInputValueByName(this.user,
k)},setMetaValue:function(k,g,e){var a=l.getCIByChainAndName(this.user,0,k);if(!a)return null;var b=this.getMetaValue(k);l.setCIValueByField(a,"value",g);this[k]=g;if(!1!==e)return this.publish(types.EVENTS.ON_CI_UPDATE,{owner:this.owner,ci:a,newValue:g,oldValue:b})},getParent:function(){return this._store.getSync(this.parentId)}})})},"xide/data/Model":function(){define("dcl/dcl dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/aspect dojo/when".split(" "),function(p,m,l,k,g,e){function a(a,d){var c=
a.schema[d];void 0===c||c instanceof t||(c=new t(c),c._parent=a);c&&(c.name=d);return c}function b(d,c){var b,f=d.hasOwnProperty("_properties")&&d._properties[c];b=f;f||(f=a(d,c))&&f.validate&&(f=l.delegate(f,{_parent:d,key:c}));return f&&f.validate?e(f.validate(),function(a){a||b||((d.hasOwnProperty("_properties")?d._properties:d._properties=new x)[c]=f);return a}):!0}function f(a){var d,c=1;a(function(a,b,f){a&&a.then?(c++,d||(d=new k),a.then(function(a){b(a,f);c--;c||d.resolve()}).then(null,d.reject)):
b(a,f)});if(d)return c--,c||d.resolve(),d.promise}function h(){2>q&&v&&(v(),v=null);q--}function c(){return c}var d=[].slice,n=m("xide/data/Model",null,{schema:{},additionalProperties:!0,_scenario:"update",constructor:function(a){this.init(a)},refresh:function(a){var d=this._store;d&&d.refreshItem(this,a)},getStore:function(){return this._store},init:function(a){this._scenario="insert";a=this._setValues(a);for(var d in this.schema){var c=this.schema[d];c&&"object"===typeof c&&"default"in c&&!a.hasOwnProperty(d)&&
(c=c["default"],a[d]="function"===typeof c?c.call(this):c)}},_setValues:function(a){return l.mixin(this,a)},_getValues:function(){return this._values||this},save:function(a){var d=this;return e(a&&a.skipValidation?!0:this.validate(),function(a){if(!a)throw d.createValidationError(d.errors);a=d._scenario;d.prepareForSerialization();return d._store&&e(d._store["insert"===a?"add":"put"](d),function(a){d.set(a);d._scenario="update";return d})})},remove:function(){var a=this._store;return a.remove(a.getIdentity(this))},
prepareForSerialization:function(){this._scenario=void 0;this._inherited&&(this._inherited.toJSON=c)},createValidationError:function(a){return Error("Validation error")},property:function(c,b){var f=this.hasOwnProperty("_properties")?this._properties:this._properties=new x,n=f[c];n||(n=a(this,c),n=f[c]=n?l.delegate(n):new t,n.name=c,n._parent=this);return b?n.property.apply(n,d.call(arguments,1)):n},get:function(d){var c,b=this.schema[d];return(b=c||this.schema[d])&&b.valueOf&&(b.valueOf!==u||b.hasCustomGet)?
((c=c||this.hasOwnProperty("_properties")&&this._properties[d])||(c=l.delegate(a(this,d),{name:d,_parent:this})),c.valueOf()):this._getValues()[d]},set:function(a,d){if("object"===typeof a){q++;try{for(var f in a)d=a[f],!a.hasOwnProperty(f)||d&&d.toJSON===c||this.set(f,d)}finally{h()}}else{f=this.schema[a];if(!f&&!this.additionalProperties)return console.warn("Schema does not contain a definition for",a);var n=this.hasOwnProperty("_properties")&&this._properties[a];!n&&(d&&"object"===typeof d||f&&
f.put!==w)&&(n=this.property(a));n?n.put(d):(f&&f.coerce&&(d=f.coerce(d)),this._getValues()[a]=d,f&&!1!==f.validateOnSet&&b(this,a));return d}},observe:function(a,d,c){return this.property(a).observe(d,c)},validate:function(a){var d=this,c=!0,n=[],h;if(a){h={};for(var g=0;g<a.length;g++)h[g]=!0}return e(f(function(a){for(var f in d.schema)h&&!h.hasOwnProperty(f)||a(b(d,f),function(a,b){a||(c=!1,n.push.apply(n,d.property(b).errors))},f)}),function(){d.set("errors",c?void 0:n);return c})},isValid:function(){var a=
!0,d;for(d in this.schema){var c=this.hasOwnProperty("_properties")&&this._properties[d];c&&c.errors&&c.errors.length&&(a=!1)}return a}}),q=0,r,v;(n.nextTurn=function(a){v=a}).atEnd=!0;var y=m([n],{observe:function(a,d){var c;if("string"===typeof a)return this.inherited(arguments);d&&d.onlyFutureUpdates||(c=new y,this._has()&&(c.value=a(this.valueOf())));var b=this._addListener(function(d){d=a(d);c&&c.put(d)});return c?(c.remove=b.remove,c):b},validateOnSet:!1,validators:null,_addListener:function(a){return g.after(this,
"onchange",a,!0)},valueOf:function(){return this._get()},_get:function(){return this.value},_has:function(){return this.hasOwnProperty("value")},setValue:function(a){this.value=a},put:function(a){var d=this._get();a=this.coerce(a);this.errors&&this.set("errors",void 0);var c=this;q++;return e(this.setValue(a,this._parent),function(b){void 0!==b&&(a=b);c.onchange&&c._queueChange(c.onchange,d);var f,n=d&&"object"===typeof d&&!(d instanceof Array),e=a&&"object"===typeof a&&!(a instanceof Array);if(n||
e){b={};if(n)for(f in d=d._getValues?d._getValues():d,d)b[f]={old:d[f]};if(e)for(f in a=a._getValues?a._getValues():a,a)(b[f]=b[f]||{}).value=a[f];c._values=e&&a;for(f in b)n=b[f],(e=c._properties&&c._properties[f])&&e.onchange&&e._queueChange(e.onchange,n.old)}c.validateOnSet&&c.validate();h()})},coerce:function(a){var d=this.type;d&&("string"===d?a=""+a:"number"===d?a=+a:"boolean"===d?a="false"===a||"0"===a||a instanceof Array&&!a.length?!1:!!a:"function"!==typeof d||a instanceof d||(a=new d(a)));
return a},addError:function(a){this.set("errors",(this.errors||[]).concat([a]))},checkForErrors:function(a){var d=[];this.type&&!("function"===typeof this.type?a instanceof this.type:this.type===typeof a)&&d.push(a+" is not a "+this.type);!this.required||null!=a&&""!==a||d.push("required, and it was not present");return d},validate:function(){var a=this,d=this._parent,c=this.validators,b=this.valueOf(),n=[];return e(f(function(f){function e(a){a&&n.push.apply(n,a)}if(c)for(var h=0;h<c.length;h++)f(c[h].checkForErrors(b,
a,d),e);f(a.checkForErrors(b,a,d),e)}),function(){if(n.length)return a.set("errors",n),!1;void 0!==a.get("errors")&&a.set("errors",void 0);return!0})},_queueChange:function(a,d){if(!a._queued){a._queued=!0;var c=this,b=function(){a._queued=!1;a.call(c,c._get(),d)};r&&r.push(b);r||(!n.nextTurn.atEnd||0<q?(r=[b],n.nextTurn(function(){for(var a=0;a<r.length;a++)r[a]();r=null})):b())}},toJSON:function(){return this._values||this}}),x=function(){};x.prototype.toJSON=c;var t=n.Property=m(y,{init:function(a){if("string"===
typeof a||"function"===typeof a)a={type:a};a&&m.safeMixin(this,a)},_get:function(){return this._parent._getValues()[this.name]},_has:function(){return this.name in this._parent._getValues()},setValue:function(a,d){d._getValues()[this.name]=a}}),u=t.prototype.valueOf,w=t.prototype.put;return n})},"xide/manager/ServerActionBase":function(){define("dcl/dcl dojo/_base/declare xdojo/has dojo/Deferred xide/manager/RPCService xide/manager/ManagerBase xide/types xide/utils".split(" "),function(p,m,l,k,g,
e,a,b){l={declaredClass:"xide.manager.ServerActionBase",serviceObject:null,serviceUrl:null,singleton:!0,serviceClass:null,defaultOptions:{omit:!0,checkMessages:!0,checkErrors:!0},base64_encode:function(a){var b,c,d,n,e=0,g=0,k="",k=[];if(!a)return a;do b=a.charCodeAt(e++),c=a.charCodeAt(e++),d=a.charCodeAt(e++),n=b<<16|c<<8|d,b=n>>18&63,c=n>>12&63,d=n>>6&63,n&=63,k[g++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(c)+
"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(n);while(e<a.length);k=k.join("");a=a.length%3;return(a?k.slice(0,a-3):k)+"\x3d\x3d\x3d".slice(a||3)},runDeferred:function(b,e,c,d){var n=new k,g;d=d||this.defaultOptions;this.check();if(!this.checkCall(b,e,d.omit))return n.reject("method doesnt exists: "+e+" for service class:"+this.serviceClass+" in "+this.declaredClass);this.prepareCall();
var l=this.getService(),m=this.getServiceClass(b),p=this,x=function(a,c){var b=n;d.returnProm&&(b=g);b._data=a;if(c&&d.onError)return d.onError(c);b.resolve(a)};g=l[m][e](c);g.then(function(c){c=c||{};var b=c.error||{};if(d.checkMessages&&b&&3==b.code)p.onMessages(b);if(d.checkErrors){if(1==b.code){p.onError(b,m+"::"+e);n.reject(b);return}}else{if(1==b.code&&d.displayError)p.onError(b,m+"::"+e);if(b&&0!=b.code){x(c,b);return}}d.omit&&p.publish(a.EVENTS.STATUS,{message:"Ok!",what:arguments},this);
x(c)},function(a){p.onError(a)});return d.returnProm?g:n},getService:function(){return this.serviceObject},getServiceClass:function(a){return a||this.serviceClass},hasMethod:function(a,b){var c=this.getService(),d=b||this.getServiceClass();return c&&d&&null!=c[d]&&null!=c[d][a]},findServiceUrl:function(a){var b=window.xFileConfig;if(b&&b.mixins)for(var c=0;c<b.mixins.length;c++){var d=b.mixins[c];if(d.declaredClass===a&&d.mixin&&d.mixin.serviceUrl)return d.mixin.serviceUrl}return null},init:function(){this.check()},
_initService:function(){return!1},check:function(){this.serviceObject||this._initService()},onError:function(b,e){if(b)if(1===b.code){if(b.message&&_.isArray(b.message)){this.publish(a.EVENTS.ERROR,{message:b.message.join("\x3cbr/\x3e")});return}}else 0===b.code&&this.publish(a.EVENTS.STATUS,"Ok");e&&(b.message=e+" -\x3e "+b.message);this.publish(a.EVENTS.ERROR,{error:b},this)},checkCall:function(a,b,c){a=this.getServiceClass(a);return this.getService()?this.hasMethod(b,a)||!0!==c?!0:(this.onError({code:1,
message:["Sorry, server doesnt know "+b]}),!1):(console.error("have no service object"),!1)},prepareCall:function(){var a={};this.config&&this.config.RPC_PARAMS&&(a=b.mixin(a,this.config.RPC_PARAMS.rpcFixedParams),this.serviceObject.extraArgs=a,this.config.RPC_PARAMS.rpcUserField&&(a[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue,this.serviceObject.signatureField=this.config.RPC_PARAMS.rpcSignatureField,this.serviceObject.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken))},
callMethodEx:function(b,e,c,d,n){(b=b||this.serviceClass)||console.error("have no service class! "+this.declaredClass,this);this.check();if(this.checkCall(b,e,n)){this.prepareCall();var g=this;if(!this.getServiceClass(b))debugger;var k=this.serviceObject[this.getServiceClass(b)];if(!k||!k[e])debugger;this.serviceObject[this.getServiceClass(b)][e](c).then(function(c){try{d&&d(c)}catch(k){console.error("bad news : callback for method "+e+" caused a crash in service class "+b),logError(k,"server method failed "+
k)}c&&c.error&&3==c.error.code&&setTimeout(function(){g.onMessages(c.error)},50);if(c&&c.error&&c.error&&0!=c.error.code)g.onError(c.error);else 1==n&&g.publish(a.EVENTS.STATUS,{message:"Ok!"},this)},function(a){g.onError(a)})}},callMethodEx2:function(a,b,c,d,n){this.check();if(this.checkCall(a,b,n))return this.prepareCall(),this.serviceObject[this.getServiceClass(a)][b](c)},callMethod:function(f,e,c,d){e=e||[[]];var n=this.serviceClass;try{var g=this;if(null==this.serviceObject[n][f]){if(!0===d)this.onError({code:1,
message:["Sorry, server doesnt know "+f]});return null}n={};n=b.mixin(n,this.config.RPC_PARAMS.rpcFixedParams);n[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue;this.serviceObject.extraArgs=n;this.serviceObject.signatureField=this.config.RPC_PARAMS.rpcSignatureField;this.serviceObject.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken;this.serviceObject[this.serviceClass][f](e).then(function(b){try{c&&c(b)}catch(n){console.error("crashed in "+f);console.dir(n);debugger}b&&
b.error&&3==b.error.code&&setTimeout(function(){g.onMessages(b.error)},50);if(b&&b.error&&b.error&&1==b.error.code)g.onError(b.error);else!1!==d&&g.publish(a.EVENTS.STATUS,{message:"Ok!"},this)},function(a){g.onError(a)})}catch(k){console.error("crash! "+k),g.onError(k)}}};p=p(e,l);p.declare=m(null,l);return p})},"xide/manager/RPCService":function(){define("dojo/_base/declare dojo/_base/lang xide/rpc/Service xide/rpc/JsonRPC dojo/has dojo/Deferred xide/utils xide/types xide/mixins/EventedMixin xide/encoding/SHA1".split(" "),
function(p,m,l,k,g,e,a,b,f,h){return p("xide.manager.RPCService",[l,f],{extraArgs:null,signatureField:"sig",signatureToken:null,correctTarget:!0,sync:!1,defaultOptions:{omit:!0,checkMessages:!0,checkErrors:!0},onError:function(a){if(a)if(1===a.code){if(a.message&&_.isArray(a.message)){this.publish(b.EVENTS.ERROR,{message:a.message.join("\x3cbr/\x3e")});return}}else 0===a.code&&this.publish(b.EVENTS.STATUS,"Ok");this.publish(b.EVENTS.ERROR,{error:a},this)},prepareCall:function(){var c={};this.config&&
this.config.RPC_PARAMS&&(this.extraArgs=c=a.mixin(c,this.config.RPC_PARAMS.rpcFixedParams),this.config.RPC_PARAMS.rpcUserField&&(c[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue,this.signatureField=this.config.RPC_PARAMS.rpcSignatureField,this.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken))},runDeferred:function(a,d,n,f){var h=new e;f=f||this.defaultOptions;if(!this.checkCall(a,d,f.omit))return h.reject("method doesnt exists: "+d+" for service class:"+this.serviceClass+
" in "+this.declaredClass);this.prepareCall();var g=this;this[this.getServiceClass(a)][d](n).then(function(a){if(f.checkMessages&&a&&a.error&&3==a.error.code)g.onMessages(a.error);f.checkErrors&&a&&a.error&&a.error&&0!=a.error.code?(g.onError(a.error),h.reject(a.error)):(f.omit&&g.publish(b.EVENTS.STATUS,{message:"Ok!",what:arguments},this),h.resolve(a))},function(a){g.onError(a)});return h},getParameterMap:function(a,d){var b=this._smd.services[a+"."+d];return b&&b.parameters?b.parameters:[]},_getRequest:function(a,
d){var b=this._smd,f=l.envelopeRegistry.match(a.envelope||b.envelope||"NONE"),e=(a.parameters||a.params||[]).concat(b.parameters||[]);if(f.namedParams){if(1==d.length&&m.isObject(d[0]))d=d[0];else{for(var h={},g=a.parameters||a.params,k=0;k<g.length;k++)"undefined"==typeof d[k]&&g[k].optional||(h[g[k].name]=d[k]);d=h}if(a.strictParameters||b.strictParameters)for(k in d){h=!1;for(g=0;g<e.length;g++)e[k].name==k&&(h=!0);h||delete d[k]}for(k=0;k<e.length;k++)if(h=e[k],!h.optional&&h.name&&null!=d&&!d[h.name])if(h["default"])d[h.name]=
h["default"];else if(!(h.name in d))throw Error("Required parameter "+h.name+" was omitted");}else e&&e[0]&&e[0].name&&1==d.length&&dojo.isObject(d[0])&&(d=!1===f.namedParams?l.toOrdered(e,d):d[0]);m.isObject(this._options)&&(d=dojo.mixin(d,this._options));e=a._schema||a.returns;k=f.serialize.apply(this,[b,a,d]);k._envDef=f;return dojo.mixin(k,{sync:this.sync,contentType:a.contentType||b.contentType||k.contentType,headers:a.headers||b.headers||k.headers||{},target:k.target||l.getTarget(b,a),transport:a.transport||
b.transport||k.transport,envelope:a.envelope||b.envelope||k.envelope,timeout:a.timeout||b.timeout,callbackParamName:a.callbackParamName||b.callbackParamName,rpcObjectParamName:a.rpcObjectParamName||b.rpcObjectParamName,schema:e,handleAs:k.handleAs||"auto",preventCache:a.preventCache||b.preventCache,frameDoc:this._options.frameDoc||void 0})},_executeMethod:function(a){var d=[],b;if(2==arguments.length&&m.isArray(arguments[1]))d=arguments[1];else for(b=1;b<arguments.length;b++)d.push(arguments[b]);
var f=this._getRequest(a,d);this.correctTarget&&(f.target=this._smd.target);if(this.extraArgs)for(var e in this.extraArgs)f.target+=-1!=f.target.indexOf("?")?"\x26":"?",f.target+=e+"\x3d"+this.extraArgs[e];this.signatureToken&&(f.target+=-1!=f.target.indexOf("?")?"\x26":"?",d=h._hmac(f.data,this.signatureToken,1),d=h._hmac(f.data,this.signatureToken,1),f.target+=this.signatureField+"\x3d"+d);d=l.transportRegistry.match(f.transport).fire(f);d.addBoth(function(a){return f._envDef.deserialize.call(this,
a)});return d},getServiceClass:function(a){return a||this.serviceClass},hasMethod:function(a,d){var b=d||this.getServiceClass();return this&&b&&null!=this[b]&&null!=this[b][a]},checkCall:function(a,d,b){a=this.getServiceClass(a);return this.hasMethod(d,a)||!0!==b?!0:(this.onError({code:1,message:["Sorry, server doesnt know "+d]}),!1)},base64_encode:function(a){var d,b,f,e,h=0,g=0,k="",k=[];if(!a)return a;do d=a.charCodeAt(h++),b=a.charCodeAt(h++),f=a.charCodeAt(h++),e=d<<16|b<<8|f,d=e>>18&63,b=e>>
12&63,f=e>>6&63,e&=63,k[g++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(b)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\x3d".charAt(e);while(h<a.length);k=k.join("");a=a.length%3;return(a?k.slice(0,a-3):k)+"\x3d\x3d\x3d".slice(a||3)},callMethodEx:function(a,d,b,f,e,h){if(!this[a]||null==
this[a][d])return!0===h&&e&&e({code:1,message:["Sorry, server doesnt know "+d+" in class"+a]}),null;h={};this.config&&this.config.RPC_PARAMS&&(h=m.mixin(h,this.config.RPC_PARAMS.rpcFixedParams),h[this.config.RPC_PARAMS.rpcUserField]=this.config.RPC_PARAMS.rpcUserValue,this.extraArgs=h,this.signatureField=this.config.RPC_PARAMS.rpcSignatureField,this.signatureToken=this.config.RPC_PARAMS.rpcSignatureToken);this[a][d](b).then(function(b){try{f&&f(b)}catch(n){console.error("bad news : callback for method "+
d+" caused a crash in service class "+a)}b&&b.error&&b.error&&0!=b.error.code&&e&&e(b.error)},function(a){e(a)})},callMethod:function(a,d,b,f,e,h){try{var g=this;if(null==this[a][d])return!0===h&&e&&e({code:1,message:["Sorry, server doesnt know "+d]}),null;h={};h=m.mixin(h,this.config.RPC_PARAMS.rpcFixedParams);this[a][d](b).then(function(a){try{f&&f(a)}catch(c){console.error("crashed in "+d),console.dir(c)}a&&a.error&&a.error&&1==a.error.code&&e&&e(a.error)},function(a){g.onError(a)})}catch(k){console.error("crash! "+
k)}}})})},"xide/rpc/Service":function(){define(["dojo","dojo/_base/lang","dojo/_base/declare","./AdapterRegistry","dojo/_base/url"],function(p,m,l,k,g){function e(a,d){var b=a._baseUrl;a.target&&(b=new p._Url(b,a.target)+"");d.target&&(b=new p._Url(b,d.target)+"");return b}function a(a,d){if(p.isArray(d))return d;for(var b=[],f=0;f<a.length;f++)b.push(d[a[f].name]);return b}var b=new k(!0),f=new k(!0),h=1;l=l("xide.rpc.Service",null,{constructor:function(a,d){function b(a){a._baseUrl=new p._Url(p.isBrowser?
location.href:p.config.baseUrl,f||".")+"";e._smd=a;d&&"methods"===d.services&&(a.services=a.methods,delete a.methods,a.transport="POST",d.mixin&&m.mixin(a,d.mixin),d=null);for(var c in e._smd.services){a=c.split(".");for(var n=e,h=0;h<a.length-1;h++)n=n[a[h]]||(n[a[h]]={});n[a[a.length-1]]=e._generateService(c,e._smd.services[c])}}var f,e=this;if(a)if(p.isString(a)||a instanceof p._Url){f=a instanceof p._Url?a+"":a;var h=p._getText(f);if(h)b(p.fromJson(h));else throw Error("Unable to load SMD from "+
a);}else b(a);this._options=d?d:{};this._requestId=0},_generateService:function(a,d){if(this[d])throw Error("WARNING: "+a+" already exists for service. Unable to generate function");d.name=a;var f=p.hitch(this,"_executeMethod",d),e=b.match(d.transport||this._smd.transport);e.getExecutor&&(f=e.getExecutor(f,d,this));e=d.returns||(d._schema={});e._service=f;f.servicePath="/"+a+"/";f._schema=e;f.id=h++;return f},_getRequest:function(c,d){var b=this._smd,h=f.match(c.envelope||b.envelope||"NONE"),g=(c.parameters||
[]).concat(b.parameters||[]);if(h.namedParams){if(1==d.length&&p.isObject(d[0]))d=d[0];else{for(var k={},l=0;l<c.parameters.length;l++)"undefined"==typeof d[l]&&c.parameters[l].optional||(k[c.parameters[l].name]=d[l]);d=k}if(c.strictParameters||b.strictParameters)for(l in d){for(var k=!1,m=0;m<g.length;m++)g[m].name==l&&(k=!0);k||delete d[l]}for(l=0;l<g.length;l++)if(k=g[l],!k.optional&&k.name&&!d[k.name])if(k["default"])d[k.name]=k["default"];else if(!(k.name in d))throw Error("Required parameter "+
k.name+" was omitted");}else g&&g[0]&&g[0].name&&1==d.length&&p.isObject(d[0])&&(d=!1===h.namedParams?a(g,d):d[0]);p.isObject(this._options)&&(d=p.mixin(d,this._options));delete d.mixin;g=c._schema||c.returns;l=h.serialize.apply(this,[b,c,d]);l._envDef=h;return p.mixin(l,{sync:!1,contentType:c.contentType||b.contentType||l.contentType,headers:c.headers||b.headers||l.headers||{},target:l.target||e(b,c),transport:c.transport||b.transport||l.transport,envelope:c.envelope||b.envelope||l.envelope,timeout:c.timeout||
b.timeout,callbackParamName:c.callbackParamName||b.callbackParamName,rpcObjectParamName:c.rpcObjectParamName||b.rpcObjectParamName,schema:g,handleAs:l.handleAs||"auto",preventCache:c.preventCache||b.preventCache,frameDoc:this._options.frameDoc||void 0})},_executeMethod:function(a){var d=[],f;for(f=1;f<arguments.length;f++)d.push(arguments[f]);var e=this._getRequest(a,d),d=b.match(e.transport).fire(e);d.addBoth(function(a){return e._envDef.deserialize.call(this,a)});return d}});l.transportRegistry=
b;l.envelopeRegistry=f;l._nextId=h;l.getTarget=e;l.toOrdered=a;l._sync=!1;f.register("URL",function(a){return"URL"==a},{serialize:function(a,d,b){return{data:p.objectToQuery(b),transport:"POST"}},deserialize:function(a){return a},namedParams:!0});f.register("JSON",function(a){return"JSON"==a},{serialize:function(a,d,b){return{data:p.toJson(b),handleAs:"json",contentType:"application/json"}},deserialize:function(a){return a}});f.register("PATH",function(a){return"PATH"==a},{serialize:function(a,d,
b){var f;a=e(a,d);if(p.isArray(b))for(f=0;f<b.length;f++)a+="/"+b[f];else for(f in b)a+="/"+f+"/"+b[f];return{data:"",target:a}},deserialize:function(a){return a}});b.register("POST",function(a){return"POST"==a},{fire:function(a){a.url=a.target;a.postData=a.data;return p.rawXhrPost(a)}});b.register("GET",function(a){return"GET"==a},{fire:function(a){a.url=a.target+(a.data?"?"+(a.rpcObjectParamName?a.rpcObjectParamName+"\x3d":"")+a.data:"");return p.xhrGet(a)}});b.register("JSONP",function(a){return"JSONP"==
a},{fire:function(a){a.url=a.target+(-1==a.target.indexOf("?")?"?":"\x26")+(a.rpcObjectParamName?a.rpcObjectParamName+"\x3d":"")+a.data;a.callbackParamName=a.callbackParamName||"callback";return p.io.script.get(a)}});p._contentHandlers&&(p._contentHandlers.auto=function(a){var d=p._contentHandlers,b=a.getResponseHeader("Content-Type");return b?b.match(/\/.*json/)?d.json(a):b.match(/\/javascript/)?d.javascript(a):b.match(/\/xml/)?d.xml(a):d.text(a):d.text(a)});return l})},"xide/rpc/AdapterRegistry":function(){define(["dojo/_base/kernel",
"dojo/_base/lang"],function(p,m){var l=p.AdapterRegistry=function(k){this.pairs=[];this.returnWrappers=k||!1};m.extend(l,{register:function(k,g,e,a,b){this.pairs[b?"unshift":"push"]([k,g,e,a])},match:function(){for(var k=0;k<this.pairs.length;k++){var g=this.pairs[k];if(g[1].apply(this,arguments))return g[3]||this.returnWrappers?g[2]:g[2].apply(this,arguments)}throw Error("No match found");},unregister:function(k){for(var g=0;g<this.pairs.length;g++)if(this.pairs[g][0]==k)return this.pairs.splice(g,
1),!0;return!1}});return l})},"xide/rpc/JsonRPC":function(){define(["dojo/_base/lang","dojo/_base/json","./Service","dojo/errors/RequestError"],function(p,m,l,k){function g(e){return{serialize:function(a,b,f,h){a={id:this._requestId++,method:b.name,params:f};e&&(a.jsonrpc=e);return{data:m.toJson(a),handleAs:"json",contentType:"application/json",transport:"POST"}},deserialize:function(a){if("Error"==a.name||a instanceof k)a=m.fromJson(a.responseText);if(a.error){var b=Error(a.error.message||a.error);
b._rpcErrorObject=a.error;return b}return a.result}}}l.envelopeRegistry.register("JSON-RPC-1.0",function(e){return"JSON-RPC-1.0"==e},p.mixin({namedParams:!1},g()));l.envelopeRegistry.register("JSON-RPC-2.0",function(e){return"JSON-RPC-2.0"==e},p.mixin({namedParams:!0},g("2.0")))})},"xide/encoding/SHA1":function(){define(["./_base"],function(p){function m(a,b){a[b>>5]|=128<<24-b%32;a[(b+64>>9<<4)+15]=b;for(var f=Array(80),e=1732584193,c=-271733879,d=-1732584194,n=271733878,g=-1009589776,k=0;k<a.length;k+=
16){for(var l=e,m=c,x=d,t=n,u=g,w=0;80>w;w++){if(16>w)f[w]=a[k+w];else{var C=f[w-3]^f[w-8]^f[w-14]^f[w-16];f[w]=C<<1|C>>>31}C=p.addWords(p.addWords(e<<5|e>>>27,20>w?c&d|~c&n:40>w?c^d^n:60>w?c&d|c&n|d&n:c^d^n),p.addWords(p.addWords(g,f[w]),20>w?1518500249:40>w?1859775393:60>w?-1894007588:-899497514));g=n;n=d;d=c<<30|c>>>2;c=e;e=C}e=p.addWords(e,l);c=p.addWords(c,m);d=p.addWords(d,x);n=p.addWords(n,t);g=p.addWords(g,u)}return[e,c,d,n,g]}function l(a){for(var b=[],f=0,e=8*a.length;f<e;f+=8)b[f>>5]|=
(a.charCodeAt(f/8)&255)<<24-f%32;return b}function k(a){for(var b=[],f=0,e=4*a.length;f<e;f++)b.push("0123456789abcdef".charAt(a[f>>2]>>8*(3-f%4)+4&15),"0123456789abcdef".charAt(a[f>>2]>>8*(3-f%4)&15));return b.join("")}function g(a){for(var b=[],f=0,e=32*a.length;f<e;f+=8)b.push(String.fromCharCode(a[f>>5]>>>24-f%32&255));return b.join("")}function e(a){for(var b=[],f=0,e=4*a.length;f<e;f+=3)for(var c=(a[f>>2]>>8*(3-f%4)&255)<<16|(a[f+1>>2]>>8*(3-(f+1)%4)&255)<<8|a[f+2>>2]>>8*(3-(f+2)%4)&255,d=0;4>
d;d++)8*f+6*d>32*a.length?b.push("\x3d"):b.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c>>6*(3-d)&63));return b.join("")}p.SHA1=function(a,b){var f=b||p.outputTypes.Base64,h=m(l(a),8*a.length);switch(f){case p.outputTypes.Raw:return h;case p.outputTypes.Hex:return k(h);case p.outputTypes.String:return g(h);default:return e(h)}};p.SHA1._hmac=function(a,b,f){f=f||p.outputTypes.Base64;var h=l(b);16<h.length&&(h=m(h,8*b.length));var c=Array(16);b=Array(16);for(var d=
0;16>d;d++)c[d]=h[d]^909522486,b[d]=h[d]^1549556828;a=m(c.concat(l(a)),512+8*a.length);a=m(b.concat(a),672);switch(f){case p.outputTypes.Raw:return a;case p.outputTypes.Hex:return k(a);case p.outputTypes.String:return g(a);default:return e(a)}};return p.SHA1})},"xide/manager/ManagerBase":function(){define(["dcl/dcl","xide/mixins/EventedMixin","xide/model/Base"],function(p,m,l){m=p([l.dcl,m.dcl],{declaredClass:"xide.manager.ManagerBase",ctx:null,init:function(){this.initReload&&this.initReload()}});
p.chainAfter(m,"init");return m})},"xide/data/Reference":function(){define(["xdojo/declare","xide/utils"],function(p,m){var l={_sources:[],removeSource:function(g){},updateSource:function(g){},onSourceUpdate:function(g){},onSourceRemoved:function(g){},onSourceDelete:function(g){},onItemChanged:function(g){},destroy:function(){this.item.removeReference&&this.item.removeReference(this);this.inherited(arguments)},addSource:function(g,e){this._sources.push({item:g,settings:e});var a=this;if(e&&e.onDelete)g._store.on("delete",
function(b){b.target==g&&a._store.removeSync(a[a._store.idProperty])})},updateSources:function(g){for(var e=0;e<this._sources.length;e++){var a=this._sources[e],b=a.item,a=a.settings;g.property&&a.properties&&a.properties[g.property]&&(b._store._ignoreChangeEvents=!0,b.set(g.property,g.value),b._store._ignoreChangeEvents=!1,b._store.emit("update",{target:b}))}},constructor:function(g){this._sources=[];m.mixin(this,g)}},k=p("xgrid.data.Reference",null,l);k.Implementation=l;return k})},"xcf/manager/DeviceManager":function(){define("dcl/dcl xdojo/declare dojo/_base/lang xide/encoding/MD5 xide/types xide/utils xide/factory xcf/manager/BeanManager xide/mixins/ReloadMixin xide/mixins/EventedMixin ./DeviceManager_Server ./DeviceManager_DeviceServer xide/data/TreeMemory xdojo/has xide/data/ObservableStore dstore/Trackable xcf/model/Device dojo/Deferred xide/manager/ServerActionBase xide/data/Reference xide/utils/StringUtils xdojo/has!xcf-ui?./DeviceManager_UI xdojo/has!xexpression?xexpression/Expression dojo/has!host-node?nxapp/utils/_console dojo/has!host-node?nxapp/utils".split(" "),
function(p,m,l,k,g,e,a,b,f,h,c,d,n,q,r,v,y,x,t,u,w,C,A,D,E){var B="undefined"!==typeof window?window.console:B;D&&D.error&&D.warn&&(B=D);a=[t,b,c,d,f.dcl];var z=g.DEVICE_PROPERTY,F=g.EVENTS;q("xcf-ui")&&a.push(C);return p(a,{declaredClass:"xcf.manager.DeviceManager",beanNamespace:"device",beanName:"Device",beanIconClass:"fa-sliders",groupType:g.ITEM_TYPE.DEVICE_GROUP,itemType:g.ITEM_TYPE.DEVICE,itemMetaTitleField:z.CF_DEVICE_TITLE,systemScope:"system_devices",userScope:"user_devices",appScope:"app_devices",
defaultScope:"system_devices",serviceClass:"XCF_Device_Service",rawData:null,store:null,treeView:null,deviceServerClient:null,deviceInstances:null,driverScopes:null,autoConnectDevices:!0,consoles:null,lastUpTime:null,reconnectDevice:5E3,checkDeviceServerConnection:function(){if(!this.deviceServerClient){var a=this.ctx.getNodeServiceManager().getStore();if(!a)return B.error("checkDeviceServerConnection : have no service store"),!1;this.createDeviceServerClient(a)}return!0},addDriverFunctions:function(a,
d){for(var b in d)"constructor"!==b&&"inherited"!==b&&"getInherited"!=b&&"isInstanceOf"!=b&&"__inherited"!=b&&"onModuleReloaded"!=b&&"start"!=b&&"publish"!=b&&"subscribe"!=b&&"getInherited"!=b&&"getInherited"!=b&&_.isFunction(d[b])&&!a[b]&&(a[b]=d[b])},addLoggingFunctions:function(a,d){var b=this;d.log=function(a,c,f,e){e=e||{};var n=l.clone(e);e.type=e.type||c||"Driver";d.options&&(e.device=d.options);b.publish(g.EVENTS.ON_SERVER_LOG_MESSAGE,{data:e,level:a||"info",message:f,details:n})}},completeDriverInstance:function(a,
d,b){var c=this,f=d.blockScope.blockStore,e=b.path,n=e+"_commands",h=e+"_variables";f.on("delete",function(a){var d=-1!==a.target.declaredClass.indexOf("Variable")?h:n,c=b._store.getSync(d);c&&c.refresh();(a=b._store.getSync(d+"_reference_"+a.target.id))&&a.refresh()});f.on("added",function(d){var c=d.name,f=d.icon||"fa-exclamation",e=-1!==d.declaredClass.indexOf("Variable"),k=e?h:n;-1!=d.declaredClass.indexOf(e?"Variable":"Command")&&(c=new u({enabled:!0,path:k+"_reference_"+d.id,name:c,id:d.id,
parentId:k,_mayHaveChildren:!1,virtual:!0,tooltip:!0,icon:f,ref:{driver:a,item:d,device:b},type:g.ITEM_TYPE.BLOCK}),c=b._store.putSync(c),d.addReference(c,{properties:{name:!0,enabled:!0,value:!0},onDelete:!0},!0),c.refresh())});d.callCommand=function(a){(a=this.blockScope.getBlockByName(a))&&a.solve(this.blockScope)};d.setVariable=function(d,b,f){if(d=this.blockScope.getVariable(d))d.value=b,d.set("value",b),c.publish(g.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:d,scope:this.blockScope,driver:a,owner:c,
save:!0===f})};d.getVariable=function(a){return(a=this.blockScope.getVariable(a))?a.value:""};d.log=function(a,b,f,e){e=e||{};var n=l.clone(e);e.type=e.type||b||"Driver";d.options&&(e.device=d.options);c.publish(g.EVENTS.ON_SERVER_LOG_MESSAGE,{data:e,level:a||"info",message:f,details:n})};for(var k in a)"constructor"!==k&&"inherited"!==k&&"getInherited"!=k&&"isInstanceOf"!=k&&"__inherited"!=k&&"onModuleReloaded"!=k&&"start"!=k&&"publish"!=k&&"subscribe"!=k&&"getInherited"!=k&&"getInherited"!=k&&l.isFunction(a[k])&&
!d[k]&&(d[k]=a[k])},onDeviceStarted:function(a,d,b){if(a&&d&&b){var c=this.toDeviceControlInfo(d).serverSide,f=a.blockScope;if(c){var e=[],c=f.getBlocks({group:g.COMMAND_TYPES.INIT_COMMAND});_.invoke(c,"solve",f);e=e.concat(f.getBlocks({group:g.COMMAND_TYPES.BASIC_COMMAND,startup:!0}));e=e.concat(f.getBlocks({group:g.COMMAND_TYPES.CONDITIONAL_COMMAND,startup:!0}));for(c=0;c<e.length;c++)e[c].solve(f);e=e.concat(f.getBlocks({group:g.COMMAND_TYPES.BASIC_COMMAND,auto:/^[1-9][0-9]*$/}));e=e.concat(f.getBlocks({group:g.COMMAND_TYPES.CONDITIONAL_COMMAND,
auto:/^[1-9][0-9]*$/}));for(c=0;c<e.length;c++){var n=e[c];1==n.auto&&1<n.interval&&f.loopBlock(n)}this.publish(g.EVENTS.ON_DEVICE_DRIVER_INSTANCE_READY,{device:d,instance:a,driver:b,blockScope:f})}a.__didStartBlocks=!0;this.ctx.getDriverManager().addDeviceInstance(d,b)}},createDriverInstance:function(a,d,b){var c=k(JSON.stringify(a),1),n=this.driverScopes[a.scope]+a.driver,n=n.replace(".js",""),g=this,q=g.ctx,l=e.getCIInputValueByName(b.user,z.CF_DEVICE_DRIVER),r=q.getDriverManager().getItemById(l),
p=new x;b.getMetaValue(z.CF_DEVICE_ENABLED);var v=a.serverSide;if(!1===b.isEnabled())return setTimeout(function(){p.reject()}),p;try{require([n],function(k){k=new (m([d,h,f],k.prototype));k.declaredClass=n;k.options=a;k.baseClass=d.prototype.declaredClass;k.modulePath=e.replaceAll("//","/",n);k.delegate=g;k.driver=r;k.serverSide=a.serverSide;try{k.start(),k.initReload()}catch(y){B.error("crash in driver instance startup! "+b.toString())}g.deviceInstances[c]=k;var x=l+"_"+c+"_"+b.path;r.blox&&r.blox.blocks||
(r.blox={blocks:[]});r.blockPath&&(w.getJson(E.readFile(r.blockPath)),r.blox=w.getJson(E.readFile(r.blockPath)));x=q.getBlockManager().createScope({id:x,device:b,driver:r,instance:k,serviceObject:g.serviceObject,ctx:q,serverSide:v,getContext:function(){return this.instance}},dojo.clone(r.blox.blocks));k.blockScope=x;b.blockScope=x;b.driverInstance=k;g.getDriverInstance(a,!0);g.completeDriverInstance(r,k,b);p.resolve(k);return k})}catch(y){B.error("DeviceManager::createDriverInstance:: requiring base driver at "+
n+" failed",y)}return p},getDevice:function(a){var d=a;if(_.isString(a)){var b=this.getItemById(a);b?d=b:(a=this.store.getSync(a))&&(d=a)}return d},stopDevice:function(a){if(a=this.getDevice(a)||a){this.checkDeviceServerConnection();a._userStopped=!0;var d=this.toDeviceControlInfo(a);d?d.serverSide&&(d.clientSide=!0,d=k(JSON.stringify(d),1),this.deviceInstances[d]&&(this._removeInstance(this.deviceInstances[d],d,a),delete this.deviceInstances[d])):B.error("cant find device::no device info",a.toString&&
a.toString())}else B.error("cant find device")},getDevices:function(a,d){var b=this.getStore();if(!b)return[];b=e.queryStore(b,{isDir:!1});b._S&&(b=[b]);for(var c=[],f=0;f<b.length;f++){var n=b[f],h=this.getMetaValue(n,z.CF_DEVICE_ENABLED);if(!0===a&&1==h||null==h||!1===a)c.push(n),1==d&&((h=this.getMetaValue(n,z.CF_DEVICE_DRIVER))?(h=this.ctx.getDriverManager().getItemById(h))&&(n.driver=h):B.error("device has no driver id!"))}return c},connectToAllDevices:function(){var a=this.getStore();if(a){a=
e.queryStore(a,{isDir:!1});a._S&&(a=[a]);for(var d=0;d<a.length;d++){var b=a[d],c=this.getMetaValue(b,z.CF_DEVICE_ENABLED);1!=c&&null!=c||this.startDevice(b)}}else B.error("have no device store")},_getLogText:function(a){return moment().format("HH:mm:SSS")+" ::   "+a+""},_parse:function(a,d){var b=""+d;if(0<b.indexOf("{{")||0<b.indexOf("}}"))B.time("parse expression"),b=(new A).parse(g.EXPRESSION_PARSER.FILTREX,b,this,{variables:a.getVariablesAsObject(),delimiters:{begin:"{{",end:"}}"}}),B.timeEnd("parse expression");
else{var c=a.parseExpression(d);c&&(b=c)}return b},runCommand:function(a,d){},_lastActions:null,onStoreReloaded:function(a){this.completeDeviceStore()},getInstance:function(a){if(a=a?a._store?this.toDeviceControlInfo(a):a:null)return this.getDriverInstance(a,!1)},getDriverInstance:function(a,d){if(!a)return B.error("getDriverInstance::have no device info"),null;for(var b in this.deviceInstances){var c=this.deviceInstances[b],f=c.options;if(f&&f.port===a.port&&f.host===a.host&&f.protocol===a.protocol)return!1!==
d&&c&&!c.sendSettings&&(b=this.ctx.getDriverManager().getItemById(a.driverId))&&(b=b.user,(f=e.getCIByChainAndName(b,0,g.DRIVER_PROPERTY.CF_DRIVER_COMMANDS))&&f.params&&(c.sendSettings=e.getJson(f.params)),(b=e.getCIByChainAndName(b,0,g.DRIVER_PROPERTY.CF_DRIVER_RESPONSES))&&b.params&&(c.responseSettings=e.getJson(b.params))),c}return null},onDeviceServerConnectionLost:function(){this.deviceServerClient&&(this.deviceServerClient.destroy(),this.deviceServerClient=null);var a=this;a.ctx.getNotificationManager().postMessage({message:"Lost connection to device server, try reconnecting in 5 seconds",
type:"error",showCloseButton:!0,duration:3E3});setTimeout(function(){a.checkDeviceServerConnection()},5E3)},onMQTTMessage:function(a){var d=e.getJson(a.message),b=!1;if(d){var c=d.sourceHost,f=d.sourcePort,n=a.host,h=a.port;c&&f&&c===n&&f==h&&(b=!0)}if(!b&&(b=a.topic.split("/"),4==b.length&&"Variable"==b[2]))if(c=this.getDeviceByHost(b[0],b[1])){if(a=this.toDeviceControlInfo(c))if(a=this.getDriverInstance(a))if(a=a.blockScope.getVariable(b[3]))a.set("value",d.value),a.refresh()}else B.error("cant find device for : "+
a.topic)},onNodeServiceStoreReady:function(a){this.deviceServerClient&&this.deviceServerClient.destroy();var d=this;this.createDeviceServerClient(a.store);this.autoConnectDevices&&setTimeout(function(){d.connectToAllDevices()},5E3)},onDriverUpdated:function(a,d){},onModuleReloaded:function(a){if(0!=this.deviceInstances.length){var d=e.replaceAll("//","/",a.module);a=a.newModule;for(var b in this.deviceInstances){var c=this.deviceInstances[b];if(c.modulePath===d||c.baseClass===d)this.mergeFunctions(c,
a.prototype),c.blockScope&&(c.blockScope.expressionModel.expressionCache={}),this.onDriverUpdated(c,d)}}},_removeInstance:function(a,d,b){a.destroy&&a.destroy();a.blockScope&&a.blockScope._destroy();delete this.deviceInstances[d];this.ctx.getBlockManager().removeScope(a.options.id);this.ctx.getDriverManager().removeDriverInstance(a,b);b.reset()},removeDriverInstance:function(a){for(var d in this.deviceInstances){var b=this.deviceInstances[d],c=b.options;c||B.error("invalid instance!");c&&c.port===
a.port&&c.host===a.host&&c.protocol===a.protocol&&(b.destroy&&b.destroy(),delete this.deviceInstances[d],this.ctx.getBlockManager().removeScope(b.options.id))}},getMetaValue:function(a,d){var b=a.user;return b?e.getCIInputValueByName(b,d):null},getDeviceByHost:function(a,d){for(var b=e.queryStore(this.getStore(),{isDir:!1}),c=0;c<b.length;c++){var f=b[c],n=this.getMetaValue(f,z.CF_DEVICE_HOST),h=this.getMetaValue(f,z.CF_DEVICE_PORT);if(n==a&&h==d)return f}return null},getDeviceById:function(a){var d=
e.queryStore(this.getStore(),{isDir:!1});d._S&&(d=[d]);for(var b=0;b<d.length;b++){var c=d[b];if(this.getMetaValue(c,z.CF_DEVICE_ID)==a)return c}return null},getDevicesByDriverId:function(a){var d=e.queryStore(this.getStore(),{isDir:!1});d._S&&(d=[d]);for(var b=0;b<d.length;b++){var c=d[b];if(this.getMetaValue(c,z.CF_DEVICE_ID)==a)return c}return null},getDeviceStoreItem:function(a){var d=this.getStore();if(d){d=e.queryStore(d,{isDir:!1});d._S&&(d=[d]);for(var b=0;b<d.length;b++){var c=d[b],f=c.user,
n=e.getCIInputValueByName(f,z.CF_DEVICE_HOST),h=e.getCIInputValueByName(f,z.CF_DEVICE_PORT),f=e.getCIInputValueByName(f,z.CF_DEVICE_PROTOCOL);if(h===a.port&&n===a.host&&f===a.protocol)return c}}},onDriverSettingsChanged:function(a,d){for(var b in this.deviceInstances){var c=this.deviceInstances[b];if(c&&c.driver==d){b=d.user;var f=e.getCIByChainAndName(b,0,g.DRIVER_PROPERTY.CF_DRIVER_COMMANDS);f&&f.params&&f==a&&(c.sendSettings=e.getJson(f.params));(b=e.getCIByChainAndName(b,0,g.DRIVER_PROPERTY.CF_DRIVER_RESPONSES))&&
b.params&&(c.responseSettings=e.getJson(b.params));break}}},onDeviceStateChanged:function(a,d){!0!==a._userStopped&&!0!==d&&a.info&&a.state&&a.state==g.DEVICE_STATE.DISCONNECTED&&this.ctx.getNotificationManager().postMessage({message:"Lost connection to "+a.info.host+", ...reconnecting",type:"error",showCloseButton:!1,duration:1500});!0!==d&&a.info&&a.state&&a.state==g.DEVICE_STATE.CONNECTED&&this.ctx.getNotificationManager().postMessage({message:"Connected to "+a.info.host+"",type:"success",showCloseButton:!1,
duration:2E3})},connectDevice:function(a){this.checkDeviceServerConnection();var d=this.toDeviceControlInfo(a);d.clientSide=!0;if(d){var b=k(JSON.stringify(d),1);if(this.deviceInstances[b])return B.log("device already connected",d),a.setState(g.DEVICE_STATE.CONNECTED),this.deviceInstances[b];a.setState(g.DEVICE_STATE.CONNECTING);this.publish(g.EVENTS.ON_STATUS_MESSAGE,{text:"Trying to connect to "+d.toString(),type:"info"});this.sendManagerCommand(g.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER,d)}else B.error("couldnt start device, invalid control info")},
onAppReady:function(a){a=a.context;a.deviceManager=this;a.driverManager=this;if(a.blockManager){var d=this.ctx.getBlockManager();l.mixin(a.blockManager.scopes,d.scopes)}},onHaveNoDeviceServer:function(){var a=this,d=this.ctx.getNotificationManager().postMessage({message:"Have no device server connection",type:"error",showCloseButton:!0,duration:1500,actions:{reconnect:{label:"Reconnect",action:function(){a.checkDeviceServerConnection();return d.update({message:"Reconnecting...",type:"success",actions:!1,
duration:1500})}}}})},createItem:function(a,d,b){return this.callMethodEx(null,"createItem",[dojo.toJson(a)],d,!0)},setDriverScriptContent:function(a,d,b,c,f){return this.callMethodEx(null,"setDriverContent",[a,d,b],c,!0)},getDriverScriptContent:function(a,d,b,c){return this.callMethodEx(null,"getDriverContent",[a,d],b,!0)},initStore:function(a){this.store=new (m("deviceStore",[n,v,r],{}))({data:a.items,idProperty:"path",Model:y,id:e.createUUID(),observedProperties:["name","state","iconClass","enabled"]});
this.onStoreReady();return this.store},fixDeviceCI:function(a){var d=a.user,b=e.getCIByChainAndName(d,0,z.CF_DEVICE_DRIVER_OPTIONS);b?(b.data=[{value:2,label:"Runs Server Side"},{value:4,label:"Show Debug Messages"},{value:8,label:"Allow Multiple Device Connections"}],b.group="Common"):d.inputs.push({chainType:0,"class":"cmx.types.ConfigurableInformation",dataRef:"",dataSource:"",description:null,enabled:!0,enumType:"-1",flags:-1,group:"Common",id:z.CF_DEVICE_DRIVER_OPTIONS,name:z.CF_DEVICE_DRIVER_OPTIONS,
order:1,params:null,platform:null,title:"Driver Options",type:5,uid:"-1",value:0,data:[{value:2,label:"Runs Server Side"},{value:4,label:"Show Debug Messages"},{value:8,label:"Allow Multiple Device Connections"}],visible:!0,device:a});if(a=e.getCIByChainAndName(d,0,z.CF_DEVICE_PROTOCOL))a.type=3,a.options=[{label:"TCP",value:"tcp"},{label:"UDP",value:"tcp"},{label:"Driver",value:"driver"},{label:"SSH",value:"ssh"},{label:"Serial",value:"serial"},{label:"MQTT",value:"mqtt"}]},toDeviceControlInfo:function(a){if(!a._store&&
a.id){var d=this.getItemById(a.id);d&&(a=d)}if(!a.path&&(d=this.getDeviceStoreItem(a),!d))return null;var b=a.user,d=e.getCIInputValueByName(b,z.CF_DEVICE_HOST),c=e.getCIInputValueByName(b,z.CF_DEVICE_PORT),f=e.getCIInputValueByName(b,z.CF_DEVICE_TITLE),n=e.getCIInputValueByName(b,z.CF_DEVICE_PROTOCOL),h=e.getCIInputValueByName(b,z.CF_DEVICE_DRIVER),k=e.getCIInputValueByName(b,z.CF_DEVICE_OPTIONS),b=e.getCIInputValueByName(b,z.CF_DEVICE_DRIVER_OPTIONS),q=a.isServerSide(),l=null;this.fixDeviceCI(a);
var m=this.ctx.getDriverManager().getItemById(h);if(m){var r=m.user,l=e.getCIInputValueByName(r,g.DRIVER_PROPERTY.CF_DRIVER_CLASS),r=e.getCIByChainAndName(r,0,g.DRIVER_PROPERTY.CF_DRIVER_RESPONSES),p={},m=m.scope;r&&r.params&&(p=e.getJson(r.params));l={host:d,port:c,protocol:n,driver:l?l.replace("./",""):"",driverId:h,scope:m,id:a.id,title:f,options:k,driverOptions:b,serverSide:q,responseSettings:p,toString:function(){return this.host+":"+this.port+"@"+this.protocol}}}return a.info=l},getDeviceStatusIcon:function(a){switch(a.state){case g.DEVICE_STATE.READY:case g.DEVICE_STATE.CONNECTED:return"fa-link iconStatusOn";
case g.DEVICE_STATE.SYNCHRONIZING:case g.DEVICE_STATE.CONNECTING:return"fa-spinner fa-spin"}return"fa-unlink iconStatusOff"},getItemById:function(a){return this.store&&this.store.data?(a=_.find(this.store.data,{id:a}))?this.store.getSync(a.path):null:null},onStoreCreated:function(a){var d=this.ctx,b=d.mainView.getToolbar(),c=a.type,f=(a=a.store)?e.queryStore(a,{isDir:!1}):[],n=this.ctx.getDriverManager();if(c===g.ITEM_TYPE.DEVICE)for(c=0;c<f.length;c++){var h=a.getSync(f[c].path);if(null==h._completed){h._completed=
!0;var k=this.getMetaValue(h,z.CF_DEVICE_DRIVER);k?(k=n.getItemById(k),_.each(h.user.inputs,function(a){a.device=h;a.actionTarget=b;a.ctx=d}),!_.isEmpty(k)&&q("xcf-ui")&&(this.completeDevice(a,h,k),h.iconClass=h.getStateIcon())):B.error("device has no driver id!")}}},onClientMessage:function(a){this.checkDeviceServerConnection();this.deviceServerClient&&(B.log("write log message"),this.sendManagerCommand(g.SOCKET_SERVER_COMMANDS.WRITE_LOG_MESSAGE,a))},onClientLogMessage:function(a){},onVariableChanged:function(a){var d=
a.item,b=a.scope;a=d.name;"value"!==a&&(d=d.value,b=b.device,a&&null!=d||B.error("------------invalid params"),b&&(b=b.info,this.sendManagerCommand(g.SOCKET_SERVER_COMMANDS.MQTT_PUBLISH,{topic:b.host+"/"+b.port+"/Variable/"+a,data:{value:d,device:b}})))},init:function(){var a=this;this.initUI&&this.initUI();this.subscribe(g.EVENTS.ON_DRIVER_VARIABLE_CHANGED,this.onVariableChanged);this.subscribe([F.ON_NODE_SERVICE_STORE_READY,F.ON_MODULE_RELOADED,F.ON_DEVICE_DISCONNECTED,F.ON_DEVICE_CONNECTED,F.ON_CLIENT_LOG_MESSAGE,
F.ON_STORE_CREATED]);this.deviceInstances=this.consoles={};this.driverScopes={system_drivers:"system_drivers/"};this.lastUpTime=(new Date).getTime();setInterval(function(){var d=(new Date).getTime();3E4<d-a.lastUpTime&&(a.lastUpTime=(new Date).getTime());a.lastUpTime=d},1E3)},onDeviceServerConnected:function(){},addDeviceInstance:function(a,d){}})})},"xide/mixins/ReloadMixin":function(){define(["xdojo/declare","dcl/dcl","xide/types","xide/utils"],function(p,m,l,k){var g={_mergeFunctions:!0,_mergeMissingVariables:!0,
isInstanceOf_:function(e){try{if(!!this instanceof e||this.isInstanceOf&&this.isInstanceOf(e))return!0;var a=k.getAt(this,"constructor._meta.bases",[]),b=e.prototype.declaredClass;return _.findWhere(a,function(a){return a==e||k.getAt(a,"superclass.declaredClass")===b||k.getAt(a,"prototype.declaredClass")===b})}catch(f){console.log("ReloadMixin :: this.isInstanceOf_ crashed "+f)}return!1},mergeFunctions:function(e,a){for(var b in a)"constructor"!==b&&"inherited"!==b&&(_.isFunction(a[b])&&(e[b]=null,
e[b]=a[b]),_.isArray(a[b])&&null==e[b]&&(e[b]=a[b]))},onModuleReloaded:function(e){var a=e.newModule;if(a&&a.prototype&&!e._processed){var b=a.prototype,f=b.declaredClass,h=!1,c=this.declaredClass;f&&(f&&c&&(h=k.replaceAll("/",".",c)===k.replaceAll("/",".",f)),h?(this.mergeFunctions(this,b),this.onReloaded&&(e._processed=!0,this.onReloaded(a))):e.module&&k.replaceAll("//","/",e.module)===c&&this.mergeFunctions(this,b))}},initReload:function(){this.subscribe(l.EVENTS.ON_MODULE_RELOADED)}};p=p(null,
g);p.Impl=g;p.dcl=m(null,g);return p})},"xcf/manager/DeviceManager_Server":function(){define(["dcl/dcl"],function(p){return p(null,{})})},"xcf/manager/DeviceManager_DeviceServer":function(){define("dcl/dcl xdojo/declare dojo/_base/lang xide/encoding/MD5 xide/types xide/utils xide/factory xdojo/has dojo/Deferred dojo/has!host-node?nxapp/utils/_console".split(" "),function(p,m,l,k,g,e,a,b,f,h){var c="undefined"!==typeof window?window.console:c;h&&h.error&&h.warn&&(c=h);return p(null,{declaredClass:"xcf.manager.DeviceManager_Server",
onSetDeviceServerVariables:function(a){var b=this.getDriverInstance(a.device,!0),c=this.getDeviceStoreItem(a.device);if(c){if(b){var f=a.variables,e=b.blockScope;c.serverVariables=a.variables;_.each(f,function(a){var d=e.getVariable(a.name);d&&(d.value=a.value)})}this.onDeviceConnected(a);c.setState(g.DEVICE_STATE.READY);c._startDfd&&c._startDfd.resolve(c.driverInstance);delete c._startDfd;c._startDfd=null}},onDeviceDisconnected:function(a){if(a&&a.device){var b=a.error,b=b&&b.code?b.code:b||"",f=
this.getDeviceStoreItem(a.device);if(f){this.publish(g.EVENTS.ON_STATUS_MESSAGE,{text:'Device has been disconnected \x3cspan class\x3d"text-warning"\x3e'+a.device.host+":"+a.device.port+'\x3c/span\x3e :  \x3cspan class\x3d"text-danger"\x3e'+b+"\x3c/span\x3e",type:"info"});var e=this.toDeviceControlInfo(f);this.getDriverInstance(a.device,!0)&&this.removeDriverInstance(a.device);if(f.state===g.DEVICE_STATE.DISABLED)f.setState(g.DEVICE_STATE.DISCONNECTED);else if(f.setState(g.DEVICE_STATE.DISCONNECTED),
f){var h=this;setTimeout(function(){f.shouldReconnect()&&(f.setState(g.DEVICE_STATE.CONNECTING),c.info("trying to reconnect to "+e.toString()),h.connectDevice(f))},h.reconnectDevice)}}}},getDeviceServerVariables:function(a,b){var f=b.blockScope;if(f){for(var f=f.getVariables({group:g.BLOCK_GROUPS.CF_DRIVER_BASIC_VARIABLES}),e=[],h=0;h<f.length;h++)e.push({name:f[h].name,value:f[h].value,initial:f[h].value});a.setState(g.DEVICE_STATE.SYNCHRONIZING);this.sendManagerCommand(g.SOCKET_SERVER_COMMANDS.GET_DEVICE_VARIABLES,
{device:this.toDeviceControlInfo(a),variables:e})}else c.error(" have no block scope")},onDeviceConnected:function(a){var b=this.getDeviceStoreItem(a.device);a=this.getDriverInstance(a.device,!0);if(!a)b&&b.setState(g.DEVICE_STATE.DISCONNECTED);else if(b){var f=this.toDeviceControlInfo(b);if(f)if(a&&null==b.serverVariables)this.getDeviceServerVariables(b,a);else if(b.setState(g.DEVICE_STATE.CONNECTED),f.clientSide=!0,f){var e=k(JSON.stringify(f),1);if(this.deviceInstances[e]){if(a.__didStartBlocks)c.error("instance.__didStartBlocks bad "+
e,a.__didStartBlocks);else this.onDeviceStarted(a,b,a.driver);b.setState(g.DEVICE_STATE.READY);return this.deviceInstances[e]}var h=this,l=this.driverScopes.system_drivers+"DriverBase";try{require([l],function(a){a.prototype.declaredClass=l;h.createDriverInstance(f,a,b)})}catch(m){c.error("requiring base driver at "+l+" failed",m)}}else c.error("couldnt start device, invalid control info")}},startDevice:function(a,b){this.checkDeviceServerConnection();a.check();var e=new f;if(a._startDfd&&!a._startDfd.isResolved())return a._startDfd;
!a.driverInstance&&a.reset();1==b&&a.setMetaValue(g.DEVICE_PROPERTY.CF_DEVICE_ENABLED,!0,!1);if(!a.getMetaValue(g.DEVICE_PROPERTY.CF_DEVICE_ENABLED)&&!0!==b)return this.publish(g.EVENTS.ON_STATUS_MESSAGE,{text:"Can`t start device because its not enabled! "+a.toString(),type:"error"}),setTimeout(function(){e.reject()},10),e;var h=this.toDeviceControlInfo(a);h.clientSide=!0;if(!h)return c.error("couldnt start device, invalid control info "+a.toString()),e.reject(),e;var l=k(JSON.stringify(h),1);if(this.deviceInstances[l])return e.resolve(this.deviceInstances[l]),
e;a.setState(g.DEVICE_STATE.CONNECTING);a.info=h;a._userStopped=null;a._startDfd=e;var m=this,l=this.driverScopes.system_drivers,p=l+"DriverBase";try{require([p],function(b){b.prototype.declaredClass=p;m.createDriverInstance(h,b,a).then(function(b){h.mqtt={driverScopeId:b.blockScope.id,driverId:b.driver.id,deviceId:a.path};m.publish(g.EVENTS.ON_STATUS_MESSAGE,{text:"Trying to connect to "+h.toString(),type:"info"});m.sendManagerCommand(g.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER,h);delete h.mqtt})})}catch(t){logError(t,
"DeviceManager::startDevice: requiring base driver at "+p+" failed! Base Driver - Prefix : "+l)}return e},onCommandFinish:function(a,b){var c=this.getDriverInstance(a,!0);if(c&&(this.getDeviceStoreItem(a),b.src&&b.id&&(c=c.blockScope.getBlockById(b.src))&&c.onCommandFinish))c.onCommandFinish(b)},onCommandError:function(a,b){var c=this.getDriverInstance(a,!0);if(c&&(this.getDeviceStoreItem(a),b.src&&b.id&&(c=c.blockScope.getBlockById(b.src))&&c.onCommandError))c.onCommandError(b)},onDeviceServerMessage:function(a){var f=
a.data,e=null;if(l.isString(f)&&-1!=f.indexOf("{"))try{e=dojo.fromJson(f)}catch(h){c.error("error parsing device message",a);return}if(e&&e.data&&e.data.device&&(a=e.data.device)){var m=this.getDriverInstance(e.data.device,!0);if(m){a=this.getDeviceStoreItem(a);var p=a.get("state");m.onBroadcastMessage({device:e.data.device,message:e.data.deviceMessage});m.onMessage({device:e.data.device,message:e.data.deviceMessage});p!==g.DEVICE_STATE.READY&&a.set("state",g.DEVICE_STATE.READY);p=a.isDebug();e.event&&
(e.data.driverInstance=m,this.publish(e.event,e.data));if(b("xcf-ui")){var x=function(a){delete a.resposeSettings;delete a.driver;delete a.lastResponse;delete a.scope;delete a.driverId;delete a.device;delete a.src;delete a.id;delete a.sourceHost;delete a.sourcePort},f=k(JSON.stringify(m.options),1),t=[],f=this.consoles[f+"-Console"];a.setState(g.DEVICE_STATE.READY);if(p){p=e.data.deviceMessage;if(_.isObject(p)){x(p);try{p=JSON.stringify(p)}catch(u){logError(u,"error serialize message")}}this.publish(g.EVENTS.ON_STATUS_MESSAGE,
{text:"Device Message from "+m.options.host+' : \x3cspan class\x3d"text-info"\x3e'+p+"\x3c/span\x3e"})}f&&_.each(f,function(a){if(a){var d=e.data.deviceMessage;t=[];_.isString(d)?t=m.split(d):_.isObject(d)&&(x(d),t=[d]);for(d=0;d<t.length;d++){var b=t[d];_.isString(b)&&0==b.length||a.log(b)}}})}}else p&&c.error(" onDeviceMessage : failed! Have no device instance for "+e.data.device.host,e)}},sendManagerCommand:function(a,b){this.checkDeviceServerConnection();var f={manager_command:a};l.mixin(f,b);
if(this.deviceServerClient)return this.deviceServerClient.emit(null,f,a);c.error("Send Manager Command "+a+" failed, have no  device Server client");this.onHaveNoDeviceServer()},sendDeviceCommand:function(a,b,f,e){this.checkDeviceServerConnection();var h=a.options;f={command:b,device_command:"Device_Send",host:h.host,port:h.port,protocol:h.protocol,options:{id:e,src:f}};this.getDevice(h.id).isDebug()&&this.publish(g.EVENTS.ON_STATUS_MESSAGE,{text:'Did send message : \x3cspan class\x3d"text-warnin"\x3e'+
f.command.substr(0,30)+'\x3c/span\x3e to \x3cspan class\x3d"text-info"\x3e'+f.host+":"+f.port+"@"+f.protocol+"\x3c/span\x3e"});k(JSON.stringify(a.options),1);this.deviceServerClient?this.deviceServerClient.emit(null,f,"Device_Send"):(this.onHaveNoDeviceServer(),c.error("this.deviceServerClient is null"),c.error("Send Device Command "+b+"failed, have no  device Server client"))},callMethod:function(a,b,c,f,e){this.checkDeviceServerConnection();a=a.options;b={method:b,args:c,device_command:"Call_Method",
host:a.host,port:a.port,protocol:a.protocol,options:{id:e,src:f}};if(this.deviceServerClient)this.deviceServerClient.emit(null,b,"Call_Method");else this.onHaveNoDeviceServer()},createDeviceServerClient:function(d){var b=this;this.deviceServerClient=null;if(this.deviceServerClient=a.createClientWithStore(d,"Device Control Server",{delegate:{onConnected:function(){b.onDeviceServerConnected()},onLostConnection:function(){b.onDeviceServerConnectionLost()},onServerResponse:function(a){var d=a.data,c=
null;if(_.isString(d)){try{c=dojo.fromJson(d,!1)}catch(f){c=d}if((c=c||{},c.data)&&c.data.deviceMessage&&c.data.deviceMessage.event===g.EVENTS.ON_COMMAND_FINISH){b.onCommandFinish(c.data.device,c.data.deviceMessage);return}if(c.data&&c.data.deviceMessage&&c.data.deviceMessage.event===g.EVENTS.ON_COMMAND_ERROR){b.onCommandError(c.data.device,c.data.deviceMessage);return}if(c.event===g.EVENTS.ON_DEVICE_DISCONNECTED){b.publish(g.EVENTS.ON_DEVICE_DISCONNECTED,c.data);return}if(c.event===g.EVENTS.SET_DEVICE_VARIABLES)return b.onSetDeviceServerVariables(c.data);
if(c.event===g.EVENTS.ON_DEVICE_CONNECTED){b.publish(g.EVENTS.ON_DEVICE_CONNECTED,c.data);return}if(c.event===g.EVENTS.ON_SERVER_LOG_MESSAGE){b.publish(g.EVENTS.ON_SERVER_LOG_MESSAGE,c.data);return}if(c.event===g.EVENTS.ON_MQTT_MESSAGE){b.publish(g.EVENTS.ON_MQTT_MESSAGE,c.data);b.onMQTTMessage(c.data);return}}b.onDeviceServerMessage(a)}}}))return this.deviceServerClient}})})},"xcf/model/Device":function(){define("xdojo/declare xide/data/Model xide/data/Source xide/types xide/utils xide/mixins/EventedMixin".split(" "),
function(p,m,l,k,g,e){return p("xcf.model.Device",[m,l,e],{_userStopped:!1,isServerSide:function(){var a=this.getMetaValue(k.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);return 1<<k.DRIVER_FLAGS.RUNS_ON_SERVER&a},isDebug:function(){var a=this.getMetaValue(k.DEVICE_PROPERTY.CF_DEVICE_DRIVER_OPTIONS);return 1<<k.DRIVER_FLAGS.DEBUG&a},check:function(){this._startDfd&&!0===this._userStopped&&this.reset()},isEnabled:function(){return!0===this.getMetaValue(k.DEVICE_PROPERTY.CF_DEVICE_ENABLED)},shouldReconnect:function(){return this._userStopped?
!1:this.isEnabled()},reset:function(){delete this._startDfd;this._startDfd=null;delete this.blockScope;this.blockScope=null;delete this.serverVariables;this.serverVariables=null;delete this.driverInstance;this.driverInstance=null;this.setState(k.DEVICE_STATE.DISCONNECTED)},constructor:function(){},state:k.DEVICE_STATE.DISCONNECTED,driverInstance:null,blockScope:null,getBlockScope:function(){return this.blockScope},getDriverInstance:function(){return this.driverInstance},getDriver:function(){var a=
this.getBlockScope();return a?a.driver:null},getMetaValue:function(a){return g.getCIInputValueByName(this.user,a)},setMetaValue:function(a,b,f){var e=g.getCIByChainAndName(this.user,0,a);if(!e)return null;var c=this.getMetaValue(a);g.setCIValueByField(e,"value",b);this[a]=b;if(!1!==f)return this.publish(k.EVENTS.ON_CI_UPDATE,{owner:this.owner,ci:e,newValue:b,oldValue:c})},getStateIcon:function(a){a=a||this.state;switch(a){case k.DEVICE_STATE.READY:case k.DEVICE_STATE.CONNECTED:return"fa-link iconStatusOn";
case k.DEVICE_STATE.SYNCHRONIZING:case k.DEVICE_STATE.CONNECTING:return"fa-spinner fa-spin"}return"fa-unlink iconStatusOff"},setState:function(a,b){if(a!=this.state){var f=this.state,e=this.getStateIcon(a);this.state=a;this.set("iconClass",e);this.set("state",a);this._emit(k.EVENTS.ON_DEVICE_STATE_CHANGED,{old:f,state:a,icon:e,"public":!0})}}})})},"xide/data/Source":function(){define(["dcl/dcl","xdojo/declare","xide/utils"],function(p,m,l){var k={_references:null,_originReference:null,onReferenceUpdate:function(){},
onReferenceRemoved:function(){},onReferenceDelete:function(){},updateReference:function(){},getReferences:function(){return this._references?l.pluck(this._references,"item"):[]},addReference:function(g,e,a){this._references||(this._references=[]);this._references.push({item:g,settings:e});var b=this;if(e&&e.onDelete&&g._store)g._store.on("delete",function(a){a.target==g&&b._store.removeSync(b[b._store.idProperty])});a&&g.addSource&&g.addSource(this,e)},removeReference:function(g){this._references&&
_.each(this._references,function(e){e&&e.item==g&&this._references&&this._references.remove(e)},this)},updateReferences:function(g){var e=g.property,a=g.value;this._references||(this._references=[]);for(var b=0;b<this._references.length;b++){var f=this._references[b],h=f.item,f=f.settings,c=h._store;if(this._originReference!=h&&g.property&&f.properties&&f.properties[g.property]){c&&(c._ignoreChangeEvents=!0);try{if(h.onSourceChanged)h.onSourceChanged(e,a);else h.set(e,a)}catch(d){}c&&(c._ignoreChangeEvents=
!1,c.emit("update",{target:h}))}}},constructor:function(g){this._references=[];l.mixin(this,g)},onItemChanged:function(g){this.updateReferences(g)}};m=m("xgrid.data.Source",null,k);m.dcl=p(null,k);m.Implementation=k;return m})},"xcf/manager/Context":function(){define("dcl/dcl dojo/_base/declare dojo/_base/array dojo/_base/lang xide/manager/Context xide/factory xide/types xcf/manager/DriverManager xcf/manager/DeviceManager xcf/manager/ProtocolManager xcf/manager/Application xcf/manager/LogManager xide/manager/ResourceManager xide/manager/PluginManager xdojo/has xdojo/has!xideve?xcf/manager/WidgetManager".split(" "),
function(p,m,l,k,g,e,a,b,f,h,c,d,n,q,r,v){return p([g],{declaredClass:"xcf.manager.Context",namespace:"xcf.manager.",driverManager:null,deviceManager:null,protocolManager:null,debugManager:null,nodeServiceManager:null,blockManager:null,getBlockManager:function(){return this.blockManager},getProtocolManager:function(){return this.protocolManager},getDriverManager:function(){return this.driverManager},getDeviceManager:function(){return this.deviceManager},getNodeServiceManager:function(){return this.nodeServiceManager},
getDebugManager:function(){return this.debugManager},constructManagers:function(a){this.isEditor()},initManagers:function(){this.isEditor()||(this.driverManager.init(),this.deviceManager.init(),r("protocols")&&this.protocolManager.init(),r("log")&&this.logManager.init());this.resourceManager&&this.resourceManager.init()}})})},"xide/manager/Context":function(){define("dcl/dcl dojo/_base/lang dojo/_base/json dojo/Deferred dojo/has xide/manager/ContextBase xide/factory xide/types xide/utils require dojo/promise/all xdojo/has!host-browser?xide/manager/Context_UI".split(" "),
function(p,m,l,k,g,e,a,b,f,h,c,d){e=p([e],{declaredClass:"xide.manager.Context",application:null,contextManager:null,fileManager:null,resourceManager:null,notificationManager:null,serviceObject:null,pluginManager:null,windowManager:null,logManager:null,mountManager:null,config:null,managers:null,namespace:"xide.manager.",defaultNamespace:"xide.manager.",vfsMounts:null,xideServiceClient:null,fileUpdateTimes:{},onXIDEMessage:function(a,d){var c=this;!1!==d&&c.publish(a.event,a);if(a.event===b.EVENTS.ON_FILE_CHANGED)if(a.data&&
a.data.mask&&-1!==a.data.mask.indexOf("delete"))c.publish(b.EVENTS.ON_FILE_DELETED,a);else{var e=a.data.path,g=(new Date).getTime();if(c.fileUpdateTimes[e]&&30>g-c.fileUpdateTimes[e])c.fileUpdateTimes[e]=g;else if(c.fileUpdateTimes[e]=g,e=f.replaceAll("\\","/",a.data.path),e=f.replaceAll("//","/",a.data.path),e=e.replace(/\\/g,"/"),null!=e&&null!=e.indexOf){if(e.match(/\.css$/))c.onCSSChanged({path:e});if(e.match(/\.js$/)){var k=a.data.modulePath;if(k){k=k.replace(".js","");try{h(k)}catch(l){}-1!=
e.indexOf("data/system/drivers")&&(e=e.substr(e.indexOf("data/system/drivers")+20,e.length),e=e.replace(".js",""),k="system_drivers/"+e);k=f.replaceAll(".","/",k);setTimeout(function(){c._reloadModule(k,!0)},400)}}}}},onNodeServiceStoreReady:function(d){this.xideServiceClient&&this.xideServiceClient.destroy();var b=this;this.deviceServerClient=a.createClientWithStore(d.store,"XIDE Server",{delegate:{onServerResponse:function(a){b.onXIDEMessage(l.fromJson(a.data))}}})},mergeFunctions:function(a,d){for(var b in d)_.isFunction(d[b])&&
d[b]&&a&&(a[b]=d[b])},reloadModules:function(a,d){var b=new k,f=[],e=[],g=this;h({cacheBust:"time\x3d"+(new Date).getTime()});_.each(a,function(a){var b=null,c=new k;!1!==d&&(b=h(a));h.undef(a);h([a],function(a){b&&g.mergeFunctions(b.prototype,a.prototype);e.push(a);c.resolve()});f.push(c)});c(f).then(function(){b.resolve(e);h({cacheBust:null})});return b},_reloadModule:function(a,d){var c=m.getObject(f.replaceAll("/",".",a))||m.getObject(a);if(c&&c.prototype&&c.prototype.reloadModule)c.prototype.reloadModule();
else{var e=m.getObject(f.replaceAll("/",".",a))||m.getObject(a);if(!e&&(e="undefined"!==typeof a?e:null,!e&&"undefined"!==typeof window))if(e=f.getAt(window,f.replaceAll("/",".",a),null))c=e;else try{e=h(f.replaceAll(".","/",a))}catch(g){}e&&(c=e);e=document.getElementsByTagName("script");_.each(e,function(d){d&&d.src&&-1!==d.src.indexOf(a)&&d.parentElement.removeChild(d)});h.undef(a);var k=this;d&&setTimeout(function(){h({cacheBust:"time\x3d"+(new Date).getTime(),waitSeconds:5});try{h([a],function(d){h({cacheBust:null});
m.isString(d)?console.error("module reloaded failed : "+d+" for module : "+a):(d.modulePath=a,c&&(k.mergeFunctions(c.prototype,d.prototype),c.prototype&&c.prototype._onReloaded&&c.prototype._onReloaded(d)),k.publish(b.EVENTS.ON_MODULE_RELOADED,{module:a,newModule:d}),d.prototype&&d.prototype.declaredClass&&k.publish(b.EVENTS.ON_MODULE_UPDATED,{moduleClass:d.prototype.declaredClass,moduleProto:d.prototype}))})}catch(d){console.error("error reloading module",d),logError(d,"error reloading module")}},
100)}},onCSSChanged:function(a){a=a.path;a=f.replaceAll("//","/",a);a=a.replace("/PMaster/","");var d=window.xappOnStyleSheetChanged;d&&d(a)},onDidChangeFileContent:function(a){if(!a.didProcess&&(a.didProcess=!0,this.vfsMounts&&a.path)){var d=a.path;if(-1!=d.indexOf(".css"))this.onCSSChanged(a);else if(-1==d.indexOf("resources")&&-1==d.indexOf("meta")&&-1!=d.indexOf(".js")){var d=a.mount.replace("/",""),b=null;if(this.vfsMounts[d]){var b=""+a.path,b=b.replace("./",""),b=b.replace("/","."),b=b.replace(".js",
""),b=f.replaceAll(".","/",b),c=this;setTimeout(function(){c._reloadModule(b,!0)},100)}}}},getBlockManager:function(){return this.blockManager},getPluginManager:function(){return this.pluginManager},getService:function(){return this.serviceObject},getFileManager:function(){return this.fileManager},getResourceManager:function(){return this.resourceManager},getMountManager:function(){return this.mountManager},getContextManager:function(){return this.contextManager},getLogManager:function(){return this.logManager},
getApplication:function(){return this.application},constructor:function(a){this.managers=[];this.config=a;this.language="en";this.subscribe(b.EVENTS.ON_CHANGED_CONTENT,this.onDidChangeFileContent);g("xnode")&&this.subscribe(b.EVENTS.ON_NODE_SERVICE_STORE_READY,this.onNodeServiceStoreReady)},prepare:function(){this.config&&this.initWithConfig(this.config)},initWithConfig:function(a){a&&a.mixins&&this.doMixins(a.mixins)},isEditor:function(){return this.args&&this.args.file}});p.chainAfter(e,"constructManagers");
p.chainAfter(e,"initManagers");return e})},"xcf/manager/ProtocolManager":function(){define("dcl/dcl dojo/_base/declare xide/manager/ServerActionBase xide/types xide/utils xide/factory xide/action/Action ./BeanManager".split(" "),function(p,m,l,k,g,e,a,b,f,h,c,d,n,q){return p([l,b],{declaredClass:"xcf.manager.ProtocolManager",beanNamespace:"protocol",beanName:"Protocol",beanIconClass:"fa-code",groupType:k.ITEM_TYPE.PROTOCOL_GROUP,itemType:k.ITEM_TYPE.PROTOCOL,itemMetaPath:"user.meta",itemMetaStorePath:"/meta/inputs",
itemMetaTitleField:k.PROTOCOL_PROPERTY.CF_PROTOCOL_TITLE,systemScope:"system_protocols",userScope:"user_protocols",appScope:"app_protocols",defaultScope:"system_protocols",serviceClass:"XCF_Protocol_Service",rawData:null,store:null,treeView:null,protocolScopes:null,getItemActions:function(){var a=[],d=this,b=this.getItem(),c=b?!0===g.toBoolean(b.isDir):!1;a.push({title:"New Group",icon:"el-icon-folder",place:"last",emit:!1,style:"",handler:function(a,b,c){d.newGroup()}});a.push({title:"Reload",icon:"fa-refresh",
disabled:!1,command:"Reload",place:"last",emit:!1,style:"",handler:function(){d.reload()}});null!=this.getItem()&&(a.push({title:"Delete",icon:"el-icon-remove-circle",disabled:!1,command:"Delete",place:"last",emit:!1,style:"",handler:function(){d.onDeleteItem(b)}}),c?a.push({title:"New Protocol",icon:"el-icon-file-new",disabled:!1,command:"NewItem",place:"last",emit:!1,style:"",handler:function(){d.newItem(b)}}):a.push({title:"Connect",icon:"el-icon-play-circle",disabled:!1,command:"Start",place:"last",
emit:!1,style:"",handler:function(){d.startDevice(b)}}));return a},onItemRemoved:function(a){a==this.currentItem&&(this.currentItem=null);a&&(a=this.getView(a))&&g.destroyWidget(a)},_onDeleteItem:function(a){var d=!0===g.toBoolean(a.isDir),b=g.toString(a.name),c=d?"removeGroup":"removeItem",e=this;(new f({title:"Remove Protocol"+(d?" Group":"")+" '"+b+"'",style:"max-width:400px",titleBarClass:"text-danger",delegate:{isRemoving:!1,onOk:function(d){e[c](g.toString(a.scope),g.toString(a.path),function(){e.onItemRemoved(a)})}},
inserts:[{query:".dijitDialogPaneContent",insert:'\x3cdiv\x3e\x3cspan class\x3d"fileManagerDialogText"\x3eDo you really want to remove  this item?\x3c/span\x3e\x3c/div\x3e',place:"first"}]})).show()},newItem:function(){var a=this.getItem();a||(a={path:""});var d=[g.createCI("In Group",13,g.toString(a.path),{widget:{disabled:!0},group:"Common"}),g.createCI("Title",13,"",{group:"Common"})],a=new c({title:"New Device",resizable:!0,delegate:{onOk:function(a,b){var c=g.createCI("Id",13,g.createUUID(),
{visible:!1,group:"Common"});b.push(c);g.toOptions(b);g.getInputCIByName(d,"Title");g.getInputCIByName(d,"Scope");g.getInputCIByName(d,"In Group")}},cis:d});a.show();a.resize()},reload:function(){this.currentItem=null},onNodeServiceStoreReady:function(a){},onFileChanged:function(a){if(!a._pp2){a._pp2=!0;var d=a.data;this.fileUpdateTimes||(this.fileUpdateTimes={});if(d.event===k.EVENTS.ON_FILE_CHANGED){if(d.data&&d.mask&&-1!==d.mask.indexOf("delete")){console.error("deleted");return}(new Date).getTime()}var b=
g.replaceAll("\\","/",d.path),b=g.replaceAll("//","/",d.path),b=b.replace(/\\/g,"/");-1!=b.indexOf("protocols")&&(b.match(/\.json$/)&&(-1!=b.indexOf("data/system/protocols")&&console.log("protocol changed"+b),this.ls("system_protocols")),this.onFileChanged2&&this.onFileChanged2(a))}},init:function(){this.subscribe(k.EVENTS.ON_FILE_CHANGED,this.onFileChanged)},_resetItem:function(a){a.commandsItem&&g.removeFromStore(this.getStore(),a.commandsItem,!0,"path","parentId");a.variablesItem&&g.removeFromStore(this.getStore(),
a.variablesItem,!0,"path","parentId")},_completeProtocolItem:function(a){if(a&&a.user){var d=g.getInputCIByName(a.user.meta,"content"),b=this,c=this.getStore();if(!d&&(a.mount=""+a.scope,a.getPath=function(){return a.path},a.virtual=!1,a.isDir=!0,a.children=[],d=g.createCI("Content",k.ECIType.FILE_EDITOR,"no value",{group:"Content",editor:"JSON Editor",editorArgs:{subscribers:[{event:"onSave",handler:function(d){(d=g.getJson(d.value))&&d.meta&&(a.user=d,a._completed=!1,b._resetItem(a),b._completeProtocolItem(a),
b.publish(k.EVENTS.ON_PROTOCOL_CHANGED,{item:a}))},owner:b}],leftEditorArgs:{subscribers:[{event:"addAction",handler:function(a){console.log("add action",arguments)},owner:b}],hiddenFields:{},readOnlyNodes:{commands:!0,variables:!0,meta:!0},insertTemplates:[{label:"New Command",path:"commands",value:'{title:"No Title",send:""}',newNodeTemplate:"[]",collapse:!0,select:!0},{label:"New Variable",path:"variables",value:'{title:"No Title",value:""}',newNodeTemplate:"[]",collapse:!0,select:!0}],renderTemplates:[{nodeValuePath:"field.innerHTML",
match:[/^variables[\s]?\.(\d+)$/,/^commands[\s]?\.(\d+)$/],replaceWith:"{nodeValue} - {title}",variables:null,nodeValueTransform:function(a){return g.capitalize(a)},insertIfMatch:{}}]},rightEditorArgs:{subscribers:[{event:"addAction",handler:function(a){console.log("add action",arguments)},owner:b}]}},editorItem:a,editorOverrides:{},isOwnTab:!0}),a.user.meta.inputs.push(d),!a._completed)){a._completed=!0;var f={path:g.createUUID(),name:"Commands",isDir:!0,type:"leaf",parentId:a.path,virtual:!0,children:[]};
a.commandsItem=f;a.children.push(f);c.putSync(f);for(var e=a.user.commands,d=0;d<e.length;d++){var h=e[d];f.children.push(c.putSync({path:g.createUUID(),name:h.name,id:g.createUUID(),parentId:f.path,_mayHaveChildren:!1,virtual:!0,user:{},isDir:!1,value:h.value,ref:{protocol:a,item:h},type:"protocolCommand"}))}f={path:g.createUUID(),name:"Variables",isDir:!0,type:"leaf",parentId:a.path,virtual:!0,items:[],children:[]};c.putSync(f);a.children.push(f);a.variablesItem=f;e=a.user.variables;for(d=0;d<e.length;d++)h=
e[d],f.children.push(c.putSync({isDir:!1,path:g.createUUID(),name:h.name,id:g.createUUID(),parentId:f.path,_mayHaveChildren:!1,value:h.value,virtual:!0,user:{},ref:{protocol:a,item:h},type:"protocolVariable"}))}}},onStoreReady:function(a){a=a?g.queryStore(a,{isDir:!1}):[];var d=this;_.each(a,function(a,b,c){d._completeProtocolItem(a)});console.log("store ready : ",a)},onMainViewReady:function(){var d=this,b=a.createDefault("New Protocol","fa-exchange","File/New/Protocol","__anewAction",null,{permanent:!0,
handler:function(){d.newItem()}}).setVisibility(k.ACTION_VISIBILITY.ACTION_TOOLBAR,null).setVisibility(k.ACTION_VISIBILITY.MAIN_MENU,{}).setVisibility(k.ACTION_VISIBILITY.CONTEXT_MENU,null);d.publish(k.EVENTS.REGISTER_ACTION,{owner:d,action:b});h.prototype.ctx=this.ctx},openItemSettings:function(a){var b=a.user;if(!b||!b.meta)return null;var c=this.getViewId(a),f=n.byId(c);try{if(f)return f.parentContainer&&f.parentContainer.selectChild(f),null}catch(e){g.destroyWidget(f)}var f=this.getViewTarget(),
h=this.getMetaValue(a,this.itemMetaTitleField);a.beanContextName=this.ctx.mainView.beanContextName;return g.addWidget(d,{title:h||g.toString(a.name),cis:b.meta.inputs,beanContextName:this.ctx.mainView.beanContextName,storeItem:a,iconClass:this.beanIconClass,id:c,delegate:this,storeDelegate:this,closable:!0,showAllTab:!1,blockManager:this.ctx.getBlockManager()},this,f,!0)}})})},"xide/action/Action":function(){define("xdojo/declare dojo/_base/lang xide/model/Base xide/types xide/utils xide/mixins/EventedMixin".split(" "),
function(p,m,l,k,g,e){g.mixin(k,{ACTION_VISIBILITY:{MAIN_MENU:"MAIN_MENU",CONTEXT_MENU:"CONTEXT_MENU",QUICK_LAUNCH:"QUICK_LAUNCH",ACTION_TOOLBAR:"ACTION_TOOLBAR",PROPERTY_VIEW:"PROPERTY_VIEW",RIBBON:"RIBBON",widgetArgs:null,factory:function(){var a=arguments[1]||m.clone(k.ACTION_VISIBILITY),f=arguments;if(0<f[0].length&&_.isNumber(f[0][0])){var e=f[0],c=0;_.each(a,function(d,f){"function"!==typeof a[f]&&c<e.length&&(a[f+"_val"]=e[c]);c++})}if(_.isString(f[0][0])){if(!0===f[0][2])m.mixin(a[f[0][0]+
"_val"],f[0][2]);else return a[f[0][0]+"_val"]=f[0][1],a;return f[1]}return a}}});k.ACTION_VISIBILITY_ALL="ACTION_VISIBILITY_ALL";var a=p("xide/action/Action",[l,e],{disabled:!1,enabled:!0,object:null,show:!0,group:"",types:"",command:null,icon:"fa-play",event:null,handler:null,tab:null,visibility_:null,value:null,setVisibility:function(){if(2==arguments.length&&_.isString(arguments[0])&&arguments[0]==k.ACTION_VISIBILITY_ALL){var a=arguments[1],f=k.ACTION_VISIBILITY,e=this;[f.MAIN_MENU,f.ACTION_TOOLBAR,
f.CONTEXT_MENU,f.RIBBON].forEach(function(c){e.setVisibility(c,g.cloneKeys(a,!1))});return this}f=_.isArray(arguments[0])?arguments[0]:arguments;this.visibility_=k.ACTION_VISIBILITY.factory(f,this.visibility_);return this},getVisibility:function(a){this.visibility_||this.setVisibility(k.ACTION_VISIBILITY_ALL,{});return this.visibility_?(null==this.visibility_[a+"_val"]&&(this.visibility_[a+"_val"]={vis:a}),this.visibility_[a+"_val"]):{}},shouldDestroyWidget:function(a,f,e){a=null!=this.getVisibility?
this.getVisibility(a):null;var c=!0;a&&a.permanent&&(c=!(_.isFunction(a.permanent)?a.permanent(this,f,e):a.permanent));return c}});a.create=function(b,f,e,c,d,n,k,l,m,p,x){b=new a({permanent:c,command:e,icon:f,label:b,owner:this,types:n,operation:d,group:k,handler:p,title:b});g.mixin(b,x);return b};a.createDefault=function(b,f,e,c,d,g){return a.create(b,f,e,!1,null,null,c||"nogroup",null,!1,d,g)};return a})},"xcf/manager/Application":function(){define("dcl/dcl require xdojo/declare xide/manager/Application xide/utils xide/types xdojo/declare xdojo/has xdojo/has!xcf-ui?xcf/manager/Application_UI xdojo/has!xexpression?xexpression/Expression".split(" "),
function(p,m,l,k,g,e,a,b,f,h,c){return p(k,{declaredClass:"xcf.manager.Application",vfsItems:null,onReloaded:function(){},onMountDataReady:function(a){},_onXBlocksReady:function(){m("xfile/manager/BlockManager");var a=this.ctx;if(a.blockManager)a.blockManager.onReady();m(["xcf/manager/BlockManager"],function(b){a.blockManager=new b;a.blockManager.ctx=a;a.blockManager.updatePalette=!1;a.blockManager.init();a.blockManager.onReady();a.blockManager.serviceObject=a.fileManager.serviceObject});var b=m("xblox/views/BlocksFileEditor"),
a=this.ctx;a.registerEditorExtension("xBlocks","xblox","fa-play-circle-o",this,!0,null,b,{ctx:this.ctx,mainView:this.mainView,blockManagerClass:"xfile.manager.BlockManager",registerView:!0})},onComponentReady:function(a){console.log("on component ready",a)},onPluginLoaded:function(a){this.publish(e.EVENTS.ON_PLUGIN_READY,{name:a.name,mainView:this.rootView,config:this.config,ctx:this.ctx,panelManager:this,fileManager:this.ctx.getFileManager(),store:this.store,serviceObject:this.ctx.getService()},
this)}})})},"xide/manager/Application":function(){define("dcl/dcl xdojo/has xide/manager/ManagerBase xide/types xide/utils dojo/Deferred dojo/has!host-browser?xide/manager/Application_UI".split(" "),function(p,m,l,k,g,e,a){return p([l],{declaredClass:"xide.manager.Application",container:null,ctx:null,_debug:!0,_loadedComponents:{},_loadingComponents:null,getComponents:function(){return this._loadedComponents},doComponents:function(){var a=this.loadComponents(),f=require,e=this;if(!a||!a.dfd)return console.error("componentsToLoad is null or has no head dfd"),
a;m("xfile")&&a[k.COMPONENT_NAMES.XFILE].dfd&&a[k.COMPONENT_NAMES.XFILE].dfd.then(function(){e.initXFile()});m("xideve")&&a[k.COMPONENT_NAMES.XIDEVE].dfd&&a[k.COMPONENT_NAMES.XIDEVE].dfd.then(function(){e.initXIDEVE()});m("xnode")&&a[k.COMPONENT_NAMES.XNODE].dfd&&a[k.COMPONENT_NAMES.XNODE].dfd.then(function(){e.initXNODE()});a[k.COMPONENT_NAMES.XBLOX].dfd&&a[k.COMPONENT_NAMES.XBLOX].dfd.then(function(){f(["xblox/embedded_ui","xfile/manager/BlockManager","xblox/views/BlocksFileEditor"],function(){e.onXBlocksReady()})});
a.dfd.then(function(){e.registerEditorExtensions()});return a.dfd},loadComponents:function(a){if(this._loadingComponents)return this._loadingComponents;var f=this,h,c;f._loadedComponents={};a=a||g.getJson(this.ctx.getResourceManager().getVariable("COMPONENTS"));_.each(a,function(d,c){0==m(c)&&delete a[c]});if(!a)return null;h=function(){var d=_.find(a,{status:0});d?c(d.name,d):(a.dfd.resolve(a),f.publish(k.EVENTS.ON_ALL_COMPONENTS_LOADED,a),a.dfd.resolve())};c=function(a,d){var b=d.settings;0==m(a)&&
console.error("loading component "+a+"which is disabled by has!");f.ctx.getPluginManager().loadComponent(a,null,!0===b?null:b).then(function(b){f._loadedComponents[a]=b;b={component:b,name:a};d.dfd.resolve(b);f.publish(k.EVENTS.ON_COMPONENT_READY,b);d.status=1;h()})};for(var d in a){var n=""+d,l=a[n];a[n]=l?{settings:l,status:0,name:n,dfd:new e}:{status:1}}a.dfd=new e;h();return this._loadingComponents=a},hasComponent:function(a){var f=g.getJson(this.ctx.getResourceManager().getVariable("COMPONENTS"));
return!(!f||!f[a])}})})},"xcf/manager/LogManager":function(){define(["dcl/dcl","xide/utils","xlog/manager/LogManager","xdojo/has!xcf-ui?xcf/views/LogView"],function(p,m,l,k){return p(l,{declaredClass:"xcf.manager.LogManager",createLoggingView:function(g,e){var a=this.getViewTarget();try{return m.addWidget(k,{delegate:this,store:g,title:"Log",closable:!0},this,a,!0)}catch(b){console.error(b)}},ls:function(g,e){var a=this;return this.callMethodEx(null,"ls",["unset"],function(b){a.rawData=b;a.initStore(b);
g&&g(b)},!0)}})})},"xlog/manager/LogManager":function(){define("dcl/dcl xdojo/declare dojo/_base/lang xide/manager/ServerActionBase xide/manager/BeanManager xide/encoding/MD5 xide/types xide/utils dojo/cookie dojo/json dojo/Deferred xide/data/Memory dstore/Trackable xide/mixins/EventedMixin".split(" "),function(p,m,l,k,g,e,a,b,f,h,c,d,n,q){var r=m([q],{bytesLoaded:null,percentValue:null,item:null,delegate:null,_onEnd:null,_onHandle:null,serviceClass:"XIDE_Log_Service",constructor:function(a){this.item=
a;this.subscribe(a.progressMessage,this._onProgress);this.subscribe(a.progressFailedMessage,this._onProgressFailed)},_onProgressFailed:function(a){this.item.level="error";this.item.message=this.item.oriMessage+" : Failed";this.item._isTerminated=!0;a&&a.item&&a.item.error&&this.item.details&&(this.item.details.error=a.item.error)},_onFinish:function(){this._onHandle&&this._onHandle.remove()},destroy:function(){this._destroyHandles()},_onProgress:function(a){try{var d=a.progress;a=null;null==a&&(a=
Math.round(100*d.loaded/d.total),this.bytesLoaded=d.loaded);if(this.percentValue!=a){var b=""+this.item.oriMessage;this.item.message=""+(b+(" : "+a+"%"))}this.percentValue=a;this._emit("progress");100<=this.percentValue&&(this.item.message=this.item.oriMessage+" : Done",this._emit("finish"),this._onFinish(),this.destroy())}catch(c){console.error("crash in log progress "+c)}}});return p([k,g],{declaredClass:"xcf.manager.LogManager",serviceClass:"XIDE_Log_Service",cookiePrefix:"logging",singleton:!0,
serviceView:null,clients:null,beanNamespace:"logging",views:null,stores:{},removeStore:function(a){var d=this.stores[a];d&&(d.destroy&&d.destroy(),delete this.stores[a])},getViewId:function(a){return this.beanNamespace+e(JSON.stringify({info:a.info}),1)},loadPreferences:function(){var a=f(this.cookiePrefix+"_debug_settings");return a=a?h.parse(a):{}},savePreferences:function(a){f(this.cookiePrefix+"_debug_settings",h.stringify(a))},empty:function(a){this.clear(a);a=this.getStore(a);a.then&&a.then(function(a){a.setData([])})},
clear:function(a){return this.runDeferred(null,"clear",[a||""]).then(function(a){})},getViewTarget:function(){return this.ctx.getApplication().mainView.getNewAlternateTarget()},getStore:function(a){if(!a)return this.store;var d=new c;if(this.stores[a])return d.resolve(this.stores[a]),d;var f=this;this.runDeferred(null,"ls",[a||""]).then(function(c){l.isString(c)&&(c=b.getJson(c));c=f.initStore(c);f.stores[a]=c;d.resolve(c)});return d},isValid:function(){return null!=this.store},_buildLoggingMessage:function(a){var d=
{id:b.createUUID(),level:a.level,message:a.message,host:"",data:a.data||{},time:a.time||(new Date).getTime(),type:"",show:!0,showDevice:!0};a.type&&(d.type=a.type);a.device&&a.device.host&&(d.host=a.device.host+":"+a.device.port);a.deviceMessage&&(d.message=d.message+":"+a.deviceMessage);d.ori=a;return d},initStore:function(a){var b={identifier:"time",label:"level",items:[],sort:"time"},c=null;0==a.length&&(a=[]);for(var f=0;f<a.length;f++)b.items.push(this._buildLoggingMessage(a[f]));try{c=new (m("LogStore",
[d,n],{}))({idProperty:"time",data:b})}catch(e){console.error("log creation failed: ",e)}return c},createLoggingView:function(a,d,c){d=d||this.getViewTarget();try{return b.addWidget(!1,{delegate:this,store:a,title:"Log",closable:!0,style:"padding:0px",silent:c},this,d,!0)}catch(f){console.error(f)}},updateViews:function(a,d){for(var b=0;b<this.views.length;b++)this.views[b].update(a,d)},refreshViews:function(a,d){for(var b=0;b<this.views.length;b++)this.views[b].grid.refresh()},addLogView:function(a){this.views.push(a)},
openLogView:function(a,d){this.isValid()||this.initStore([]);var b=this.createLoggingView(this.store,a,d);this.views.push(b);return b},_createPendingEvent:function(a,d,b,c){function f(a){!d._isTerminated&&e&&(d.message=d.oriMessage+" : Done",a&&!0===a.failed&&(d.level="error",d.message=d.oriMessage+" : Failed"),d._isTerminated=!0,e.remove(),e=null,h.refreshViews(),d.progressHandler&&d.progressHandler.destroy())}var e=null,h=this;d._isInProgress=!0;e=h.subscribe(b,f,h)[0];d.showProgress&&d.progressMessage&&
!d.progressHandler&&(a=new r(d,this),a._onEnd=f,a._onEndHandle=e,d.progressHandler=a)},addLoggingMessage:function(a){console.log("addLoggingMessage : "+a.time);if(a&&a.data){var d=a.data.logId;!d&&a.data&&a.data.device&&(d=a.data.device,d=d.host+"_"+d.port+"_"+d.protocol)}var c={id:b.createUUID(),level:a.level,message:a.message,host:a.host||"",data:a.data||{},time:a.time||(new Date).getTime(),type:a.type||"",show:!0,showDevice:!0,terminatorItem:a.item,terminatorMessage:a.terminatorMessage,showProgress:a.showProgress,
progressMessage:a.progressMessage,progressFailedMessage:a.progressFailedMessage,details:a.details};a.data&&(a.data.type&&(c.type=a.data.type),a.data.device&&a.data.device.host&&(c.host=a.data.device.host+":"+a.data.device.port),a.data.deviceMessage&&(c.message=c.message+":"+a.data.deviceMessage));this.isValid()||this.initStore([]);try{null==c.terminatorMessage||c._isTerminated||(null==c.oriMessage&&(c.oriMessage=""+c.message),this._createPendingEvent(c.oriMessage,c,c.terminatorMessage,c.time));var f=
this.getStore(d);f&&(f.then?f.then(function(a){c=a.putSync(c)}):c=f.putSync(c))}catch(e){console.error("adding log message to store failed "+e)}},onServerLogMessage:function(d){console.log("on server log message ",d);d.data&&d.data.time&&(d.time=d.data.time);this.addLoggingMessage(d);1==d.write&&this.publish(a.EVENTS.ON_CLIENT_LOG_MESSAGE,{message:d.message,data:d.data,details:d.details,level:d.level,type:d.type,time:d.data.time||d.time})},onMainViewReady:function(){},init:function(){this.subscribe([a.EVENTS.ON_MAIN_MENU_OPEN,
a.EVENTS.ON_MAIN_VIEW_READY,a.EVENTS.ON_SERVER_LOG_MESSAGE]);this.views=[];this.stores={}},onStoreReloaded:function(a){for(a=0;a<this.views.length;a++){var d=this.views[a];d.reload(this.store);d.update()}},reload:function(){var a=this;this.currentItem=null;this.ls(function(d){a.onStoreReloaded(d)})},onMainMenuOpen:function(a){},ls:function(a,d,c){var f=this;return this.callMethodEx(null,"ls",[d||""],c||function(d){f.rawData=d;l.isString(d)&&(d=b.getJson(d));f.store=f.initStore(d);a&&a(d)},!0)}})})},
"xide/manager/ResourceManager":function(){define(["dcl/dcl","xide/manager/ServerActionBase","xide/utils","xide/mixins/VariableMixin"],function(p,m,l,k){return p([m,k.dcl],{declaredClass:"xide.manager.ResourceManager",serviceClass:"XApp_Resource_Service",resourceData:null,resourceVariables:null,getResourceVariables:function(){return this.resourceVariables},setVariable:function(g,e){return this.resourceVariables[g]=e},getVariable:function(g){return this.resourceVariables[g]},init:function(){this.resourceVariables||
(this.resourceVariables={})},replaceVariables:function(g,e){return l.multipleReplace(""+g,e||this.resourceVariables)}})})},"xide/mixins/VariableMixin":function(){define(["dcl/dcl","xdojo/declare","xide/utils"],function(p,m,l){var k={resolve:function(g,e,a){e=e||this.resourceVariables||this.ctx.getResourceManager().getResourceVariables()||null;a=a||this.variableDelimiters||null;return l.replace(g,null,e,a)}};m=m("xide/mixins/VariableMixin",null,k);m.dcl=p(null,k);return m})},"xide/manager/PluginManager":function(){define("dcl/dcl dojo/has xide/manager/ManagerBase xide/utils xide/types xide/factory dojo/Deferred dojo/promise/all".split(" "),
function(p,m,l,k,g,e,a,b){return p(l,{declaredClass:"xide.manager.PluginManager",_defaultPackageLocationPrefix:"../../",_defaultPackageLocationSuffix:"/component",_defaultComponentFlags:{LOAD:1,RUN:2},defaultComponentMixin:function(a){return{owner:this,ctx:this.ctx,flags:a}},componentBaseClasses:null,ctx:null,pluginResources:null,pluginInstances:null,_componentReady:function(a,b,c){if(b.RUN)try{a.run(this.ctx)}catch(d){}return c.resolve(a)},_componentLoaded:function(a,b,c,d){try{k.mixin(c,this.defaultComponentMixin(b));
var g=e.createInstance(a,c,this.componentBaseClasses),l=function(a,d,b){this._componentReady(a,d,b)}.bind(this);b.LOAD?g.load().then(function(){l(g,b,d)}):l(g,b,d)}catch(m){d.reject(arguments),logError(m)}},loadComponent:function(b,e,c,d,g){c="true"===c?{}:c;b=-1==b.indexOf("/")?this._defaultPackageLocationPrefix+b+this._defaultPackageLocationSuffix:b;e=null!=e?e:this._defaultComponentFlags;var l=new a,m=this;(d=k.getObject(b))?_.isFunction(d.then)?d.then(function(a){m._componentLoaded(a,e,c,l)},
function(a){console.error("error in loading component at path "+b,a)}):this._componentLoaded(d,e,c,l):console.error("cant get object at "+b);return l},loadComponentResources:function(a,b){},reloadComponent:function(a){},loadPlugins:function(f){if(m("plugins")){var e=new a,c=[],d=this;this.pluginResources=f;this.pluginInstances=[];if(this.pluginResources)for(var n=0;n<this.pluginResources.length;n++){var k=this.pluginResources[n];k.type&&"JS-PLUGIN"==k.type&&k.path&&c.push(this.loadComponent(k.path,
null,k).then(function(a){a.pluginResources=k;d.pluginInstances.push(a)}))}b(c).then(function(){e.resolve(c);d.publish(g.EVENTS.ALL_PLUGINS_READY,{instances:d.pluginInstances,resources:f})});return e}}})})},"nxapp/manager/DeviceManager":function(){define("xdojo/declare dcl/dcl nxapp/factory dojo/node!util dojo/node!fs xcf/manager/DeviceManager xide/types xide/utils nxapp/utils/_console nxapp/utils".split(" "),function(p,m,l,k,g,e,a,b,f,h){m(null,{emit:function(){f.error("device server client emit",
arguments)}});return m(e,{declaredClass:"nxapp.manager.DeviceManager",connection:null,onDeviceMetaChanged:function(a,d){_.each(this.store.data,function(f){if(-1!==f.path.indexOf(d)&&g.existsSync(a)){var e=b.getJson(h.readFile(a));e&&(f.user=e)}})},onFileChanged:function(a){if("changed"===a.type&&!a._did){a._did=!0;a=b.replaceAll("\\","/",a.path);a=b.replaceAll("//","/",a);a=a.replace(/\\/g,"/");var d;d=a;d=-1!=d.indexOf("system/devices")?d.substr(d.indexOf("system/devices")+15,d.length):null;if(d&&
-1!==d.indexOf(".meta.json"))this.onDeviceMetaChanged(a,d)}},checkDeviceServerConnection:function(){},sendManagerCommand:function(a,d){try{var e=this.ctx.getDeviceServer(),h={manager_command:a};b.mixin(h,d);e.handleManagerCommand(h,this.connection)}catch(g){f.error("error "+g.message,g.stack)}},sendDeviceCommand:function(a,d,b,f){a=a.options;d={command:d,device_command:"Device_Send",host:a.host,port:a.port,protocol:a.protocol,options:{id:f,src:b}};this.ctx.getDeviceServer().handleDeviceCommand(d,
this.connection)}})})},"nxapp/factory":function(){define(["dojo/_base/declare"],function(p){return p("nxapp.factory",null,{})})},"xcf/manager/BlockManager":function(){define("dcl/dcl xdojo/declare dojo/_base/lang xide/types xide/utils xide/factory xide/manager/ManagerBase xblox/manager/BlockManager".split(" "),function(p,m,l,k,g,e,a,b){return p([a,b],{declaredClass:"xcf.manager.BlockManager",onReady:function(){},addDriverFunctions:function(a,b){for(var c in b)"constructor"!==c&&"inherited"!==c&&l.isFunction(b[c])&&
(a[c]=b[c])},setScriptFunctions:function(a,b,c){var d=c;b.context||(b.context=a);a.blockScope||(a.blockScope=b);this.ctx.getDeviceManager();b.context?b.context.instance&&(b.device=b.context.instance):console.error("scope has no context!");a.callCommand||(a.callCommand=function(a){var d=this.blockScope.getBlockByName(a);d?d.solve(this.blockScope):console.log("no such variable : "+a)});a.setVariable||(a.setVariable=function(c,e,g,l,m){var p=this.blockScope.getVariable(c);p?(p.value=e,p.set("value",
e),console.log("setting variable "+c+" to "+e),!1!==l&&d.publish(k.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:p,scope:b,driver:a,owner:d,save:!0===g,source:m||k.MESSAGE_SOURCE.BLOX})):console.log("no such variable : "+c)});a.getVariable||(a.getVariable=function(a){return(a=this.blockScope.getVariable(a))?a.value:""});this.inherited(arguments)},onReloaded:function(){this.init()},getDeviceVariablesAsEventOptions:function(a){a=[];var b=function(a,d,b,c,f){c="";if(0<b)for(var e=0;e<b;e++)c+="\x26nbsp;",
c+="\x26nbsp;",c+="\x26nbsp;";return{label:c+("\x3cspan style\x3d''\x3e"+a+"\x3c/span\x3e"),label2:f,value:d}};this.ctx.getDriverManager();for(var c=this.ctx.getDeviceManager(),d=c.getDevices(!1,!0),e=0;e<d.length;e++){var g=d[e],l=g.driver;if(l){g=c.getMetaValue(g,k.DEVICE_PROPERTY.CF_DEVICE_TITLE);a.push(b(g,l.id+"/"+l.id,0,!1));for(var m=l.blockScope.getVariables(),p=0;p<m.length;p++){var x=m[p],t=l.id+"/"+x.id;a.push(b(x.title,t,1,ci.value===t,g+"/"+x.title))}}}},onCreateVariableCI:function(a){console.log("onCreateVariableCI12",
a);var b=a.CI,c=a.owner;a=null!=c.scope.device;console.log("ci value "+b.value);if(a){a=[];var d=function(a,d,b,c,e){c="";if(0<b)for(var f=0;f<b;f++)c+="\x26nbsp;",c+="\x26nbsp;",c+="\x26nbsp;";return{label:c+("\x3cspan style\x3d''\x3e"+a+"\x3c/span\x3e"),label2:e,value:d}};this.ctx.getDriverManager();for(var e=this.ctx.getDeviceManager(),g=e.getDevices(!1,!0),l=0;l<g.length;l++){var c=g[l],m=c.driver;if(m){var p=e.getMetaValue(c,k.DEVICE_PROPERTY.CF_DEVICE_TITLE);a.push(d(p,m.id+"/"+m.id,0,!1));
for(var x=m.blockScope.getVariables(),t=0;t<x.length;t++){var c=x[t],u=m.id+"/"+c.id;a.push(d(c.name,u,1,b.value===u,p+"/"+c.title))}}}b.options=a;b.widget={"class":"xide.form.FilterSelect"}}}})})},"xblox/manager/BlockManager":function(){define("dcl/dcl dojo/_base/declare dojo/_base/lang dojo/has dojo/Deferred dojo/promise/all xide/types xide/utils xide/factory xblox/model/ModelBase xblox/model/Scope xblox/model/BlockModel xide/mixins/ReloadMixin xide/manager/ManagerBase xblox/data/Store dojo/has!xblox-ui?xblox/manager/BlockManagerUI".split(" "),
function(p,m,l,k,g,e,a,b,f,h,c,d,n,q,r,v){return p([q,n.dcl],{declaredClass:"xblox/manager/BlockManager",serviceObject:null,loaded:{},scope:null,scopes:null,_createBlock:null,_registerActions:function(){},toScope:function(a){try{a=b.getJson(a)}catch(d){return console.error("BlockManager::toScope: failed,err\x3d"+d),null}a||(console.error("correct data"),a={blocks:[],variables:[]});var c=b.createUUID(),e=a;!l.isArray(a)&&l.isObject(a)&&(c=a.scopeId||c,e=a.blocks||[]);a=this.getScope(c,{owner:this},
!0);e=a.blocksFromJson(e);for(c=0;c<e.length;c++)e[c]._lastRunSettings={force:!1,highlight:!0};a.serviceObject=this.serviceObject;return a},loadFiles:function(a){for(var d=[],b=new g,c=0;c<a.length;c++){var f=a[c];d.push(this.load(f.mount,f.path,f.force))}e(d).then(function(a){console.log("got all block files ",a);b.resolve(a)});return b.promise},load:function(a,d,c,e){var f=new g,h=this;e=b.replaceAll("/","",a);var n=b.replaceAll("./","",d),k=e+n,k=k.trim();this.loaded[k]&&(this.removeScope(this.loaded[k].id),
this.loaded[k]=null);if(!0!==c&&this.loaded[k])return f.resolve(this.loaded[k]),f.promise;this.ctx.getFileManager().getContent(e,n,function(b){if(b=h.toScope(b))h.loaded[k]=b,b.mount=a,b.path=d;f.resolve(b)},!1);return f.promise},onBlocksReady:function(a){for(var d=a.allBlocks(),b=0;b<d.length;b++)this.setScriptFunctions(d[b],a,this);if((a=a.getBlocks({group:"On Load"}))&&0<a.length)for(b=0;b<a.length;b++)if(d=a[b],d.onLoad)d.onLoad()},setScriptFunctions:function(d,b,c){d.blockScope||(d.blockScope=
b);console.log("set script functions "+b.id,d);b.serviceObject=this.serviceObject;d.setVariable||(d.setVariable=function(e,f,g,h,n){var k=this.blockScope.getVariable(e);k?(k.value=f,!1!==h&&c.publish(a.EVENTS.ON_VARIABLE_CHANGED,{item:k,scope:b,driver:d,owner:c,save:!0===g,source:n||a.MESSAGE_SOURCE.BLOX})):console.log("no such variable : "+e)});d.getVariable||(d.getVariable=function(a){return(a=this.blockScope.getVariable(a))?a.value:""})},hasScope:function(a){this.scopes||(this.scopes={});return this.scopes[a]?
this.scopes[a]:null},getScope:function(d,b,c){this.scopes||(this.scopes={});if(!this.scopes[d]&&(this.scopes[d]=this.createScope({id:d,ctx:this.ctx}),this.scopes[d].userData=b,!1!==c))try{f.publish(a.EVENTS.ON_SCOPE_CREATED,this.scopes[d])}catch(e){console.error("bad, scope creation failed "+e,e)}return this.scopes[d]},removeScope:function(a){this.scopes||(this.scopes={});for(var d in this.loaded)this.loaded[d].id==a&&delete this.loaded[d];try{this.scopes[a]&&(this.scopes[a]._destroy(),delete this.scopes[a])}catch(b){debugger}return null},
createScope:function(a,e){e=e||[];var f=new r({data:[],Model:m("xblox.model.BlockModel",d,{}),observedProperties:["name","enabled","value"],getLabel:function(a){return a.name},labelAttr:"name"});f.reset();f.setData([]);f={owner:this,blockStore:f,serviceObject:this.serviceObject,config:this.config};b.mixin(f,a);try{var g=new c(f);e&&g.initWithData(e);g.init()}catch(h){logError(h,"error creating scope")}return g},onReloaded:function(){console.log("on reloaded")},init:function(){this.scope={variables:[],
blocks:[]};h.prototype.types=a;h.prototype.factory=f;if(this.onReady)this.onReady()}})})},"xblox/model/Scope":function(){define("dcl/dcl ./ModelBase ./Expression xide/factory xide/utils xide/types xide/mixins/EventedMixin dojo/_base/lang dojo/has!host-node?dojo/node!tracer dojo/has!host-node?nxapp/utils/_console".split(" "),function(p,m,l,k,g,e,a,b,f,h){var c="undefined"!==typeof window?window.console:c;f&&f.error&&c&&c.error&&(c=h);return p([m,a.dcl],{declaredClass:"xblox.model.Scope",variableStore:null,
serviceObject:null,context:null,blockStore:null,toFriendlyName:function(a,b){if(!b||!a)return null;var c=this,e=this.ctx,f=this.driver,f=e.getDeviceManager(),h=e.getDriverManager();if(-1==b.indexOf("://"))return b;var e=g.parse_url(b),e=g.urlArgs(e.host),k=f.getItemById(e.device.value);if(k){var l=f.toDeviceControlInfo(k),f=h.getDriverById(l.driverId);if((k=k.driverInstance)||f)if(c=f.blockScope?f.blockScope:k?k.blockScope:c,(a=c.getStore().getSync(e.block.value))||k&&k.blockScope&&(a=k.blockScope.getBlock(e.block.value)))return l.title+
"/"+a.name}return b},getContext:function(){return this.instance},toString:function(){var a={blocks:null,variables:null},b=this.blocksToJson();try{dojo.fromJson(JSON.stringify(b))}catch(c){return}a.blocks=b;return JSON.stringify(a,null,2)},initWithData:function(a){a&&this.blocksFromJson(a);this.clearCache()},getService:function(){return this.serviceObject},getStore:function(){return this.blockStore},empty:function(){this.clearCache();var a=this.blockStore,b=this.getBlocks();_.each(b,function(b){b&&
a.removeSync(b.id)});a.setData([])},fromScope:function(a){this.empty();a=a.blocksToJson();this.blocksFromJson(a)},clearCache:function(){this.expressionModel.expressionCache={};this.expressionModel.variableFuncCache={}},getVariableStore:function(){return this.blockStore},getBlockStore:function(){return this.blockStore},getVariables:function(a){if(!this.blockStore)return[];var b=this.blockStore.data,c=[];if(a&&"processVariables"===a.group){for(a=0;a<b.length;a++)"processVariables"===b[a].group&&c.push(b[a]);
return c}if(!a){for(a=0;a<b.length;a++){var e=b[a],f=e.declaredClass;"xblox.model.variables.Variable"!=f&&"xcf.model.Variable"!=f||c.push(e)}return c}return this.blockStore.query(a)},loopBlock:function(a,b){if(a&&1==a.auto&&0<a.interval&&a.enabled){var c=this;a._loop&&clearTimeout(a._loop);a._loop=setInterval(function(){a.solve(c,b||a._lastSettings);a.enabled||(clearTimeout(a._loop),a._loop=null)},a.interval)}},getEventsAsOptions:function(a){var b=[],c;for(c in e.EVENTS)b.push({label:e.EVENTS[c],
value:e.EVENTS[c]});b=b.concat([{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",
value:"onchange"}]);for(c=0;c<b.length;c++){var f=b[c];if(f.value===a){f.selected=!0;break}}return b},getVariablesAsObject:function(){for(var a=this.getVariables(),b={},c=0;c<a.length;c++)b[a[c].title]=a[c].value;return b},getVariablesAsOptions:function(){var a=this.getVariables(),b=[];if(a)for(var c=0;c<a.length;c++)b.push({label:a[c].label,value:a[c].variable});return b},getCommandsAsOptions:function(){var a=this.getBlocks({declaredClass:"xcf.model.Command"}),b=[];if(a)for(var c=0;c<a.length;c++)b.push({label:a[c].name,
value:a[c].name});return b},getBlocks:function(a){if(!this.blockStore)return[];a=a||{id:/\S+/};return this.blockStore.query(a)},expressionModel:new l,registerVariable:function(a){this.variables[a.title]=a;this.blockStore&&this.blockStore.putSync(a)},getVariable:function(a){for(var b=this.getVariables(),c=0;c<b.length;c++){var e=b[c];if(e.name===a)return e}return null},getVariableById:function(a){var b=a.split("/"),e=this;2==b.length&&((a=e.owner)&&a.hasScope&&(a.hasScope(b[0])?e=a.getScope(b[0]):
c.error("have scope id but cant resolve it",this)),a=b[1]);return(b=e.blockStore.getSync(a))?b:null},registerBlock:function(a){var b=this.blockStore;if(b){var c=b.getSync(a.id);if(c)return c;if(a.addToStore)a.addToStore(b);else return b.putSync(a)}},allBlocks:function(a){return this.getBlocks()},hasGroup:function(a){for(var b=this.allGroups(),c=0;c<b.length;c++)if(b[c]===a)return!0;return!1},allGroups:function(){for(var a=[],b=this.allBlocks(),c=function(b){for(var c=0;c<a.length;c++)if(a[c]===b)return!0;
return!1},e=0;e<b.length;e++){var f=b[e];f.parentId||(f.group?c(f.group)||a.push(f.group):c("No Group")||a.push("No Group"))}return a},variablesToJson:function(){var a=[],b=this.variableStore?this.getVariables():this.variables,c;for(c in b){var e=b[c];if(!1!==e.serializeMe&&null!=e.keys){var f={},g;for(g in e)if(this.isString(e[g])||this.isNumber(e[g])||this.isBoolean(e[g]))f[g]=e[g];a.push(f)}}return a},isScript:function(a){return this.isString(a)&&(-1!=a.indexOf("return")||-1!=a.indexOf(";")||-1!=
a.indexOf("[")||-1!=a.indexOf("{")||-1!=a.indexOf("}"))},variablesToJavascriptEx:function(a,b){for(var c=[],e=this.variableStore?this.getVariables():this.variables,f=0;f<e.length;f++){var g=e[f];if(g!=a){var h=""+g.value;a&&a.value&&-1==a.value.indexOf(g.title)||b&&-1==b.indexOf(g.title)||0==h.length||(this.isScript(h)||-1!=h.indexOf("'")?this.isScript(h)&&(h=this.expressionModel.parseVariable(this,g)):h="'"+h+"'","''"===h&&(h="'0'"),c.push(h))}}return c},variablesToJavascript:function(a,b){for(var c=
"",e=this.variableStore?this.getVariables():this.variables,f=0;f<e.length;f++){var g=e[f];if(g!=a){var h=""+g.value;a&&a.value&&-1==a.value.indexOf(g.title)||b&&-1==b.indexOf(g.title)||0==h.length||(this.isScript(h)||-1!=h.indexOf("'")?this.isScript(h)&&(h=this.expressionModel.parseVariable(this,g)):h="'"+h+"'","''"===h&&(h="'0'"),c+="var "+g.title+" \x3d "+h+";",c+="\n")}}return c},variablesFromJson:function(a){for(var b=[],e=0;e<a.length;e++){var f=a[e];f.scope=this;if(f.declaredClass){var h=g.replaceAll(".",
"/",f.declaredClass),k=require(h);k?b.push(new k(f)):c.log("couldnt resolve "+h)}else c.log("   variable has no class ")}return b},regenerateIDs:function(a){for(var b=this,c=function(a){var d=g.createUUID(),e=b.getBlocks({parentId:a.id});if(e&&0<e.length)for(var f=0;f<e.length;f++){var h=e[f];h.parentId=d;c(h)}a.id=d},e=0;e<a.length;e++)c(a[e])},cloneBlocks2:function(a,b){var c=this.blocksToJson(a),e=this.owner.getScope(g.createUUID(),null,!1),c=e.blocksFromJson(c,!1),f=this.blockStore,c=e.allBlocks();
e.regenerateIDs(c);c=e.blocksToJson(c);if(b)for(e=0;e<c.length;e++){var h=c[e];null==h.parentId&&(h.group=b)}var k=[],c=this.blocksFromJson(c);_.each(c,function(a){k.push(f.getSync(a.id))});return k},cloneBlocks:function(a){a=this.blocksToJson(a);var b=this.owner.getScope(g.createUUID(),null,!1);a=b.blocksFromJson(a,!1);a=b.allBlocks();for(b=0;b<a.length;b++){var c=a[b];c.id=g.createUUID();c.parentId=null}this.blocksToJson(a);this.blocksFromJson(a);return a},blockToJson:function(a){var b={_containsChildrenIds:[]},
c;for(c in a)if("ctrArgs"!=c&&("function"===typeof a[c]||a.serializeField(c))){if(this.isString(a[c])||this.isNumber(a[c])||this.isBoolean(a[c]))b[c]=a[c];if("parent"!=c)if(this.isBlock(a[c]))b[c]=a[c].id,b._containsChildrenIds.push(c);else if(this.areBlocks(a[c])){b[c]=[];for(var e=0;e<a[c].length;e++)b[c].push(a[c][e].id);b._containsChildrenIds.push(c)}}return b},blocksToJson:function(a){try{var b=[];a=a&&a.length?a:this.blockStore?this.getBlocks():this.blocks;for(var e in a){var f=a[e];if(null!=
f.keys&&!1!==f.serializeMe){var h={_containsChildrenIds:[]},g;for(g in f)if("ctrArgs"!=g&&("function"===typeof f[g]||f.serializeField(g))){if(this.isString(f[g])||this.isNumber(f[g])||this.isBoolean(f[g]))h[g]=f[g];if("parent"!=g)if(this.isBlock(f[g]))h[g]=f[g].id,h._containsChildrenIds.push(g);else if(this.areBlocks(f[g])){h[g]=[];for(var k=0;k<f[g].length;k++)h[g].push(f[g][k].id);h._containsChildrenIds.push(g)}}b.push(h)}}}catch(l){c.error("from json failed : "+l)}return b},_createBlockStore:function(){},
blockFromJson:function(a){a.scope=this;null==a._containsChildrenIds&&(a._containsChildrenIds=[]);for(var b={},e=0;e<a._containsChildrenIds.length;e++){var f=a._containsChildrenIds[e];b[f]=a[f];a[f]=null}delete a._containsChildrenIds;if(!a.declaredClass)return c.log("   not a class "),null;f=e=null;try{f=g.replaceAll(".","/",a.declaredClass),e=require(f)}catch(h){try{f=g.replaceAll("/",".",a.declaredClass),e=require(f)}catch(l){}}if(!e)return null;f=null;try{f=k.createBlock(e,a)}catch(m){return logError(m),
null}f._children=b;return f},blocksFromJson:function(a,b){for(var e=[],f={},h=0;h<a.length;h++){var l=a[h];l.scope=this;null==l._containsChildrenIds&&(l._containsChildrenIds=[]);for(var m={},p=0;p<l._containsChildrenIds.length;p++){var u=l._containsChildrenIds[p];m[u]=l[u];l[u]=null}delete l._containsChildrenIds;if(l.declaredClass){var w=p=null;try{w=g.replaceAll(".","/",l.declaredClass),p=require(w)}catch(C){c.error("couldnt resolve class "+w)}if(p){w=null;try{w=k.createBlock(p,l)}catch(A){c.error("error in block creation ",
A+" "+l.declaredClass);logError(A);continue}w._children=m;f[w.id]=m;e.push(w)}else c.log("couldnt resolve "+w)}else c.log("   not a class ")}m=this.allBlocks();for(h=0;h<m.length;h++){l=m[h];l._children=f[l.id];if(l._children){for(u in l._children)if("string"==typeof l._children[u])(p=this.getBlockById(l._children[u]))?(l[u]=p,p.parent=l):c.log("   couldnt resolve child: "+l._children[u],l);else if("object"==typeof l._children[u])for(l[u]=[],w=0;w<l._children[u].length;w++)(p=this.getBlockById(l._children[u][w]))?
l[u].push(p):c.log("   couldnt resolve child: "+l._children[u][w]);delete l._children}!1!==b&&null!=l.parentId&&null==this.getBlockById(l.parentId)&&(l.parentId=null)}this.allBlocks();return e},resolveBlock:function(a){var b=this,c=this.ctx,b=this.driver,b=c.getDeviceManager(),c=c.getDriverManager();if(-1==a.indexOf("://"))return a;a=g.parse_url(a);a=g.urlArgs(a.host);var e=b.getItemById(a.device.value);if(e&&(b=b.toDeviceControlInfo(e),b=c.getDriverById(b.driverId),(c=e.driverInstance)||b)&&(b=c?
c.blockScope:b.blockScope,a=b.getStore().getSync(a.block.value)))return a},getBlock:function(a){return this.getBlockById(a)},getBlockByName:function(a){if(-1!==a.indexOf("://")){var b=this.resolveBlock(a);if(b)return b}for(var c=this.getBlocks(),e=0;e<c.length;e++)if(b=c[e],b.name===a)return b;return(a=this.blockStore.query({name:a}))&&0<a.length?a[0]:null},getBlockById:function(a){return this.blockStore.getSync(a)},flatten:function(a){var b=[],c;for(c in a){var e=a[c];if(null!=e.keys){b.push(e);
for(var f in e)if("ctrArgs"!=f&&"parent"!=f)if(this.isBlock(e[f]))b.push(e[f]);else if(this.areBlocks(e[f]))for(var h=0;h<e[f].length;h++)b.push(e[f][h])}}return b},_getSolve:function(a){return a.prototype?a.prototype.solve:a.__proto__.solve},solveBlock:function(a,c,e,f){c=c||{highlight:!1};var h=null;this.isString(a)?(h=this.getBlockByName(a))||(h=this.getBlockById(a)):this.isObject(a)&&(h=a);a=null;if(h){if(!0!==c.force&&0==h.enabled)return null;!0===c.force&&(c.force=!1);var k=h.declaredClass;
(k=b.getObject(g.replaceAll("/",".",k))||b.getObject(k))?k.prototype&&k.prototype.solve&&(a=k.prototype.solve.apply(h,[this,c])):a=h.solve(this,c,e,f)}return a},solve:function(a,b){for(var c="",e=0;e<this.items.length;e++)c+=this.items[e].solve(a,b);return c},parseExpression:function(a,b,c,e,f,h){return this.expressionModel.parse(this,a,b,e,f,h,c)},isString:function(a){return"string"==typeof a},isNumber:function(a){return"number"==typeof a},isBoolean:function(a){return"boolean"==typeof a},isObject:function(a){return"object"===
typeof a},isBlock:function(a){var b=!1;"object"==typeof a&&null!=a&&void 0==a.length&&a.serializeMe&&(b=!0);return b},areBlocks:function(a){var b=!1;"object"==typeof a&&null!=a&&0<a.length&&this.isBlock(a[0])&&(b=!0);return b},_onVariableChanged:function(a){a.item&&this.expressionModel.variableFuncCache[a.item.title]&&delete this.expressionModel.variableFuncCache[a.item.title]},init:function(){this.subscribe(e.EVENTS.ON_DRIVER_VARIABLE_CHANGED,this._onVariableChanged);var a=this;this.subscribe(e.EVENTS.ON_MODULE_RELOADED,
function(b){var c=b.module,e=b.newModule;(b=a.getBlocks().filter(function(a){return a.declaredClass==c||a.declaredClass==g.replaceAll("/",".",c)?a:null}))&&_.each(b,function(a){var b=e.prototype,d;for(d in b){var c=b[d];c&&_.isFunction(c)&&(a[d]=c)}})})},_destroy:function(){for(var a=this.allBlocks(),b=0;b<a.length;b++){var c=a[b];if(c)try{c&&c.stop&&c.stop(),c&&c.reset&&c.reset(),c&&c._destroy&&c._destroy(),c&&c.destroy&&c.destroy(),c._emit&&c._emit(e.EVENTS.ON_ITEM_REMOVED,{item:c})}catch(f){}}},
moveTo:function(a,b,e,f){if(f){if(b.canAdd&&b.canAdd()){var h=this.getBlockById(a.parentId);h&&h.removeBlock(a,!1);b.add(a,null,null);return}c.error("cant reparent");return!1}if(b.parentId||0!=f)if(!a.parentId&&b.parentId&&0==f)a.group=b.group;else if(a.parentId||b.parentId||!f){if(a.parentId&&b.parentId&&0==f&&a.parentId===b.parentId){c.error("we move within the same parents");var g=this.getBlockById(a.parentId);if(!g)return c.error("     couldnt find parent "),!1;var k=g[g._getContainer(a)],h=a.indexOf(k,
a);b=a.indexOf(k,b);k=h>b?-1:1;e=Math.abs(h-(b+(1==e?-1:1)));for(b=0;b<e-1;b++)g.move(a,k);return!0}if(a.parentId&&b.parentId&&0==f&&a.parentId!==b.parentId){c.log("same parent!");c.error("we move within the different parents");h=this.getBlockById(a.parentId);if(!h)return c.error("     couldnt find source parent "),!1;g=this.getBlockById(b.parentId);if(!g)return c.error("     couldnt find target parent "),!1;if(h&&h.removeBlock&&g.canAdd&&g.canAdd())h.removeBlock(a,!1),g.add(a,null,null);else return c.error("cant reparent"),
!1;k=g[g._getContainer(a)];null==k&&c.error("weird : target parent has no item container");h=g.indexOf(k,a);b=g.indexOf(k,b);if(!h||!b){c.error(" weird : invalid drop processing state, have no valid item indicies");return}k=h>b?-1:1;e=Math.abs(h-(b+(1==e?-1:1)));for(b=0;b<e-1;b++)g.move(a,k);return!0}}else return c.error("we are adding an item into root root item"),b.canAdd&&b.canAdd()&&(a.group=null,b.add(a,null,null)),!0;else{(h=this.getBlockById(a.parentId))&&h.removeBlock&&(h.removeBlock(a,!1),
a.parentId=null,a.group=b.group);var g=[],k=this.getBlocks({group:b.group}),l=[],h=this.getBlockStore(),m=h.storage.index[b.id];for(b=0;b<k.length;b++)if(f=k[b],null==k[b].parentId&&k[b]!=a&&(f=h.storage.index[f.id],f=e?f>=m:f<=m))g.push(k[b]),l.push(h.storage.index[k[b].id]);for(b=0;b<g.length;b++)h.remove(g[b].id);this.getBlockStore().remove(a.id);e&&this.getBlockStore().putSync(a);for(b=0;b<g.length;b++)h.put(g[b]);e||this.getBlockStore().putSync(a);return!0}return!1}})})},"xblox/model/Expression":function(){define(["xdojo/declare",
"xdojo/has","xblox/model/ModelBase","dojo/has!host-node?dojo/node!tracer","dojo/has!host-node?nxapp/utils/_console"],function(p,m,l,k,g){var e="undefined"!==typeof window?window.console:global.console;return p("xblox.model.Expression",[l],{id:null,context:null,variableDelimiters:{begin:"[",end:"]"},blockCallDelimiters:{begin:"{",end:"}"},expressionCache:{},variableFuncCache:{},reset:function(){this.expressionCache={};this.variableFuncCache={}},replaceVariables:function(a,b,f,h,c,d){var g=this._findOcurrences(b,
this.variableDelimiters);if(g)for(var k=0;k<g.length;k++){var l=this._getVar(a,g[k]),m=null;if(l){if(d){b=b.replace(g[k],"this.getVariable('"+l.name+"')");continue}m=this.getValue(l.value);c&&l.name in c&&(m=c[l.name]);if(this.isScript(m)&&!1!==f)try{var p=a.variablesToJavascript(l,!0);p&&(m=p+m);var x=(new Function("{\n"+m+"\n}")).call(a.context||{});e.log(" parsed variable value to : "+x);"undefined"===x||"undefined"===typeof x?m=""+l.value:(m=x,m="'"+m+"'")}catch(t){e.log(" parsed variable expression failed \n"+
m,t)}else this.isNumber(m)||!1!==h&&(m="'"+m+"'")}else e.log("   expression failed, no such variable :"+g[k]+" ! setting to default "),m="";b=b.replace(g[k],m)}return b},parse:function(a,b,e,h,c,d,g){b=this.replaceAll("''","'",b);e=d||a.context||a.getContext()||{};b=this.replaceVariables(a,b,null,null,g,null!=e.getVariable);if(!this.isScript(b)&&(this.isString(b)||this.isNumber(b)))return h&&h("Expression "+b+" evaluates to "+b),b;-1==b.indexOf("return")&&(b="return "+b);a=this;try{b=this.replaceAll("''",
"'",b);var k=this.expressionCache[b];k||(k=new Function("{"+b+"; }"),this.expressionCache[b]=k);a=k.call(e)}catch(l){return c&&c("invalid expression : \n"+b+": "+l,l),a=""+b}h&&h("Expression "+b+" evaluates to "+a);return a},parseVariableO:function(a,b){var f=""+b.value;if("None"===b.title)return"";try{var h=a.variablesToJavascript(b,!1);h&&(f=h+f);var c=(new Function("{"+f+"}")).call(this.context||{});"undefined"===c||"undefined"===typeof c?f=""+b.value:this.isNumber(c)?f=c:(f=""+c,f="'"+f+"'")}catch(d){e.error("parse variable failed : "+
b.title+"\n"+f)}return f},parseVariable:function(a,b,e,h,c,d,g){var k=""+b.value;e=e||"";!1!==c?(c=this.variableFuncCache[a.id+"|"+b.title],c||(c=new Function("{"+e+k+"}"),this.variableFuncCache[a.id+"|"+b.title]=c)):c=new Function("{"+e+k+"}");a=c.apply(d||a.context||{},g||[]);return k="undefined"===a||"undefined"===typeof a?""+b.value:this.isNumber(a)||!1===h?a:"'"+a+"'"},replaceBlockCalls:function(a,b){var e=this._findOcurrences(b,this.blockCallDelimiters);if(e)for(var h=0;h<e.length;h++){var c=
this._removeDelimiters(e[h],this.blockCallDelimiters),c=a.solveBlock(c).join("\n");b=b.replace(e[h],c)}return b},_getVar:function(a,b){return a.getVariable(this._getVarName(b))},_getVarName:function(a){return this._removeDelimiters(a,this.variableDelimiters)},_removeDelimiters:function(a,b){return a.replace(b.begin,"").replace(b.end,"")},_escapeRegExp:function(a){for(var b="[](){}*+.".split(""),e=0;e<b.length;e++)a=a.replace(b[e],"\\"+b[e]);return a},_findOcurrences:function(a,b){var e=this._escapeRegExp(b.begin),
h=this._escapeRegExp(b.end);return a.match(new RegExp(e+"("+("[^"+h+"]*")+")"+h,"g"))}})})},"xblox/model/BlockModel":function(){define(["dcl/dcl","xdojo/declare","xide/data/Model","xide/data/Source"],function(p,m,l,k){return m("xblox.model.BlockModel",[l,k],{declaredClass:"xblox.model.BlockModel",icon:"fa-play",mayHaveChildren:function(g){return null!=this.items&&0<this.items.length},getChildren:function(g){return this.items},getBlockIcon:function(){return'\x3cspan class\x3d"'+this.icon+'"\x3e\x3c/span\x3e'}})})},
"xblox/data/Store":function(){define("dojo/_base/declare xide/data/TreeMemory xide/data/ObservableStore xide/data/Model dstore/Trackable dojo/Deferred".split(" "),function(p,m,l,k,g,e){return p("xblox.data.Store",[m,g,l],{idProperty:"id",parentField:"parentId",filter:function(a){var b=this.inherited(arguments);this._state.filter=a;return b},getChildren:function(a){return this.root.filter({parentId:this.getIdentity(a)})},__getChildren:function(a){return this.inherited(arguments)},_fetchRange:function(a){var b=
new e;a=this.fetchRangeSync(a);if(this._state.filter){if(this._state&&this._state.filter&&this._state.filter.parentId){var f=this.getSync(this._state.filter.parentId);f&&(this.reset(),a=f.items,f.getChildren&&(a=f.getChildren()),b.resolve(a))}this._state&&this._state.filter&&this._state.filter.group&&(this.getSync(this._state.filter.parent),f&&(this.reset(),a=f.items))}b.resolve(a);return b},mayHaveChildren:function(a){return a.mayHaveChildren?a.mayHaveChildren(a):null!=a.items&&0<a.items.length}})})},
"xblox/factory/Blocks":function(){define("dojo/_base/lang xide/factory xide/utils xide/types xide/mixins/ReloadMixin xide/mixins/EventedMixin xblox/model/logic/CaseBlock xblox/model/Block xblox/model/functions/CallBlock xblox/model/code/CallMethod xblox/model/code/RunScript xblox/model/loops/ForBlock xblox/model/loops/WhileBlock xblox/model/variables/VariableAssignmentBlock xblox/model/logic/IfBlock xblox/model/logic/ElseIfBlock xblox/model/logic/SwitchBlock xblox/model/variables/VariableSwitch xblox/model/logging/Log xblox/model/server/RunServerMethod xblox/model/code/RunBlock xblox/model/events/OnEvent xblox/model/events/OnKey xblox/model/html/SetStyle xblox/model/html/SetCSS xblox/model/mqtt/Subscribe xblox/model/mqtt/Publish xcf/factory/Blocks".split(" "),
function(p,m,l,k,g,e,a,b,f,h,c,d,n,q,r,v,y,x,t,u,w,C,A,D,E,B,z){var F=null;m.clearVariables=function(){};m.getAllBlocks=function(a,b,d,c,e){if(!1!==e&&null!=F){for(a=0;a<F.length;a++)if(b=F[a],"Set Variable"===b.name){F.remove(b);break}return F}0==e&&(F=null);e=m._getFlowBlocks(a,b,d,c);e=e.concat(m._getLoopBlocks(a,b,d,c));e=e.concat(m._getCommandBlocks(a,b,d,c));e=e.concat(m._getCodeBlocks(a,b,d,c));e=e.concat(m._getEventBlocks(a,b,d,c));e=e.concat(m._getLoggingBlocks(a,b,d,c));e=e.concat(m._getServerBlocks(a,
b,d,c));return F=e=e.concat(m._getMQTTBlocks(a,b,d,c))};m._getMQTTBlocks=function(a,b,d,c){var e=[];e.push({name:"MQTT",iconClass:"fa-cloud",items:[{name:"Subscribe",owner:b,iconClass:"fa-bell",proto:B,target:d,ctrArgs:{scope:a,group:c}},{name:"Publish",owner:b,iconClass:"fa-send",proto:z,target:d,ctrArgs:{scope:a,group:c}}]});m.publish(k.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"MQTT"});return e};m._getServerBlocks=function(a,b,d,c){var e=[];e.push({name:"Server",iconClass:"el-icon-repeat",
items:[{name:"Run Server Method",owner:b,iconClass:"fa-plug",proto:u,target:d,ctrArgs:{scope:a,group:c}}]});m.publish(k.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"Server"});return e};m._getHTMLBlocks=function(a,b,d,c){var e=[];e.push({name:"HTML",iconClass:"fa-paint-brush",items:[{name:"Set Style",owner:b,iconClass:"fa-paint-brush",proto:D,target:d,ctrArgs:{scope:a,group:c}},{name:"Set CSS",owner:b,iconClass:"fa-paint-brush",proto:E,target:d,ctrArgs:{scope:a,group:c}}]});return e};m._getVariableBlocks=
function(a,b,d,c){var e=[];e.push({name:"Flow",iconClass:"el-icon-random",items:[{name:"If...Else",owner:b,iconClass:"el-icon-fork",proto:r,target:d,ctrArgs:{scope:a,group:c,condition:"[value]\x3d\x3d'PW'"}}]});return e};m._getEventBlocks=function(a,b,d,c){var e=[];e.push({name:"Events",iconClass:"fa-bell",items:[{name:"On Event",owner:b,iconClass:"fa-bell",proto:C,target:d,ctrArgs:{scope:a,group:c}},{name:"On Key",owner:b,iconClass:"fa-keyboard-o",proto:A,target:d,ctrArgs:{scope:a,group:c}}]});m.publish(k.EVENTS.ON_BUILD_BLOCK_INFO_LIST,
{items:e,group:"Events"});return e};m._getLoggingBlocks=function(a,b,d,c){var e=[];e.push({name:"Logging",iconClass:"fa-bug",items:[{name:"Log",owner:b,iconClass:"fa-bug",proto:t,target:d,ctrArgs:{scope:a,group:c}}]});m.publish(k.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"Logging"});return e};m._getCodeBlocks=function(a,b,d,e){var f=[];f.push({name:"Code",iconClass:"fa-code",items:[{name:"Call Method",owner:b,iconClass:"el-icon-video",proto:h,target:d,ctrArgs:{scope:a,group:e}},{name:"Run Script",
owner:b,iconClass:"fa-code",proto:c,target:d,ctrArgs:{scope:a,group:e}},{name:"Run Block",owner:b,iconClass:"fa-code",proto:w,target:d,ctrArgs:{scope:a,group:e}}]});m.publish(k.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:f,group:"Code"});return f};m._getFlowBlocks=function(a,b,d,c){var e=[];e.push({name:"Flow",iconClass:"el-icon-random",items:[{name:"If...Else",owner:b,iconClass:"el-icon-fork",proto:r,target:d,ctrArgs:{scope:a,group:c,condition:"[value]\x3d\x3d'PW'"}},{name:"Variable Switch",owner:b,iconClass:"el-icon-fork",
proto:x,target:d,ctrArgs:{scope:a,group:c}}]});m.publish(k.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:e,group:"Flow"});return e};m._getLoopBlocks=function(a,b,c,e){var f=[];f.push({name:"Loops",iconClass:"el-icon-repeat",items:[{name:"While",owner:b,iconClass:"el-icon-repeat",proto:n,target:c,ctrArgs:{scope:a,group:e,condition:"[Volume]\x3c\x3d100"}},{name:"For",owner:b,iconClass:"el-icon-repeat",proto:d,target:c,ctrArgs:{scope:a,group:e,initial:"1",comparator:"\x3c\x3d","final":"5",modifier:"+1",counterName:"value"}}]});
m.publish(k.EVENTS.ON_BUILD_BLOCK_INFO_LIST,{items:f,group:"Loops"});return f};m._getMathBlocks=function(a,b,d,c){b=[];b.push({name:"Math",owner:this,iconClass:"el-icon-qrcode",dstItem:d,items:[{name:"If...Else",owner:d,iconClass:"el-icon-compass",proto:r,item:d,ctrArgs:{scope:a,group:c}}]});return b};m._getTimeBlocks=function(a,b,d,c){b=[];b.push({name:"Time",owner:this,iconClass:"el-icon-qrcode",dstItem:d,items:[{name:"If...Else",owner:d,iconClass:"el-icon-time",proto:r,item:d,ctrArgs:{scope:a,
group:c}}]});return b};m._getTransformBlocks=function(a,b,d,c){b=[];b.push({name:"Time",owner:this,iconClass:"el-icon-magic",dstItem:d,items:[{name:"If...Else",owner:d,iconClass:"el-icon-time",proto:r,item:d,ctrArgs:{scope:a,group:c}}]});return b};m.prepareBlockContructorArgs=function(a){a||(a={});a.id||(a.id=l.createUUID());a.items||(a.items=[])};m.createBlock=function(a,b,d){m.prepareBlockContructorArgs(b);a=m.createInstance(a,b,d);a.ctrArgs=null;var c;try{a&&a.init&&a.init();g.prototype.mergeFunctions(a,
e.prototype);a.scope&&(c=a.scope.registerBlock(a));try{a.initReload&&a.initReload()}catch(f){debugger}}catch(h){logError(h,"create block")}return c||a};return m})},"xblox/model/logic/CaseBlock":function(){define(["dcl/dcl","xide/utils","xide/types","xblox/model/Block"],function(p,m,l,k){return p(k,{declaredClass:"xblox.model.logic.CaseBlock",comparator:null,expression:null,items:null,name:"Case",icon:"",hasInlineEdits:!0,toText:function(){return'\x3cspan style\x3d"text-indent: 1em;"\x3e\x26nbsp;\x26nbsp;\x26nbsp;'+
this.getBlockIcon("I")+this.name+" "+this.makeEditable("comparator","right","text","Enter a comparison","inline")+(null!=this.expression?" "+this.makeEditable("expression","right","text","Enter a value to compare"):"")+"\x3c/span\x3e"},canAdd:function(){return[]},solve:function(g,e,a){try{var b=g.getVariableById(e.variable);e="";if(b)e=this._getArg(b.value,!0);else return this.onFailed(this,a),!1;if(!0===g.parseExpression(""+e+""+this.comparator+this._getArg(this.expression,!0)))return this.onSuccess(this,
a),this._solve(g,a);this.onFailed(this,a);return!1}catch(f){console.error("case block crashed! ",f.stack),console.trace()}},getChildren:function(g){return this.items},getFields:function(){var g=this.inherited(arguments)||this.getDefaultFields();g.push(m.createCI("Expression",13,this.expression,{group:"General",title:"Expression",dst:"expression"}));g.push(m.createCI("Comparator",13,this.comparator,{group:"General",title:"Comparator",dst:"comparator"}));console.log("fields",g);return g}})})},"xblox/model/functions/CallBlock":function(){define(["dcl/dcl",
"xide/utils","xide/types","xblox/model/Block"],function(p,m,l,k){return p([k],{declaredClass:"xblox.model.functions.CallBlock",command:"PowerStandby",icon:"",solve:function(g,e){if(this.command){var a=g.solveBlock(this.command,e);if(a)this.onSuccess(this,e);else this.onFailed(this,e);return a}},toText:function(){var g="Unknown",e=this.scope.getBlock(this.command);e&&(g=e.name);-1!==this.command.indexOf("://")&&(g='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.command)+"\x3c/span\x3e");
return this.getBlockIcon("D")+"Call Command : "+g},getFields:function(){var g=this.inherited(arguments)||this.getDefaultFields();this.command.indexOf("://")&&this.scope.toFriendlyName(this,this.command);g.push(m.createCI("value","xcf.widgets.CommandPicker",this.command,{group:"General",title:"Command",dst:"command",options:this.scope.getCommandsAsOptions(),block:this,pickerType:"command",value:this.command}));return g}})})},"xblox/model/code/CallMethod":function(){define(["dcl/dcl","xblox/model/Block",
"xide/utils"],function(p,m,l){return p(m,{declaredClass:"xblox.model.code.CallMethod",name:"Call Method",method:"",args:"",sharable:!0,solve:function(k,g){var e=this.getContext();if(e&&null!=e[this.method]){var a=[],b=e[this.method];try{var f=this.getArgs(g);console.log("args",f);a=b.apply(e,f||[]);this.onSuccess(this,g);return a}catch(h){console.error("call method "+this.method+" failed: "+h),logError(h),this.onFailed(this,g)}}else this.onFailed(this,g);return[]},toText:function(){var k=this.getBlockIcon()+
" "+this.name+" ";this.method&&(k+=this.makeEditable("method","bottom","text","Enter a driver method","inline"));return k},getFields:function(){var k=this.getDefaultFields();this.getContext();k.push(l.createCI("value",13,this.method,{group:"General",title:"Method",dst:"method"}));k.push(l.createCI("value",27,this.args,{group:"Arguments",dst:"args",widget:{title:""}}));return k},getBlockIcon:function(){return'\x3cspan class\x3d"fa-caret-square-o-right"\x3e\x3c/span\x3e'}})})},"xblox/model/code/RunScript":function(){define("dcl/dcl xdojo/has dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains dojo/promise/all xide/types dojo/has!host-node?dojo/node!tracer dojo/has!host-node?nxapp/utils/_console xdojo/has!xblox-ui?dojo/text!./RunScript.html".split(" "),
function(p,m,l,k,g,e,a,b,f,h,c){var d="undefined"!==typeof window?window.console:global.console;return p([k,e],{declaredClass:"xblox.model.code.RunScript",name:"Run Script",method:"",args:"",deferred:!1,sharable:!0,context:null,icon:"fa-code",observed:["method"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},solve2:function(a,b,c,e){this._currentIndex=0;this._return=[];var f=""+this._get("method"),h=this,g=this.getContext();if(f&&f.length){var k=function(){var a=
new Function("{"+f+"}"),d=h.getArgs()||[];try{var k=a.apply(g,d||{});h._lastResult=k;c&&c("Expression "+f+" evaluates to "+k);if("false"!==k&&!1!==k)h.onSuccess(h,b,{result:k});else return h.onFailed(h,b),[]}catch(n){return e&&e("invalid expression : \n"+f+": "+n),h.onFailed(h,b),[]}};if(a.global)(function(){window=a.global;var d=h.getArgs()||[];try{var k=null,k=g.runExpression?g.runExpression(f,null,d):(new Function("{"+f+"}")).bind(this).apply(g,d||{});h._lastResult=k;c&&c("Expression "+f+" evaluates to "+
k);if("false"!==k&&!1!==k)h.onSuccess(h,b);else return h.onFailed(h,b),[]}catch(l){return h._lastResult=null,e&&e("invalid expression : \n"+f+": "+l),h.onFailed(h,b),[]}}).call(a.global);else return k()}else d.error("have no script");k=this[this._getContainer()];if(k.length)this.runFrom(k,0,b);else this.onSuccess(this,b);this.onDidRun();return[]},solve:function(a,b,d,c,e,f){this._currentIndex=0;this._return=[];b=b||{};a=c||""+this._get("method");var h=this;d=this.getContext();var g=this[this._getContainer()],
k=new l;c=h.deferred;this.onRunThis(b);var m=new Function("{"+a+"}"),p=h.getArgs(b)||[];try{c&&(d.resolve=function(a){h._deferredObject&&h._deferredObject.resolve();h.onDidRunThis(k,a,g,b)});var D=m.apply(d,p||{});h._lastResult=D;e&&e("Expression "+a+" evaluates to "+D);if(!c)h.onDidRunThis(k,D,g,b);if("false"!==D&&!1!==D)h.onSuccess(h,b);else h.onFailed(h,b)}catch(E){E=E||{},h.onDidRunItemError(k,E,b),h.onFailed(h,b),f&&f("invalid expression : \n"+a+": "+E)}return k},toText:function(){var a='\x3cspan style\x3d""\x3e'+
this.getBlockIcon()+" "+this.name+" :: \x3c/span\x3e";this.method&&(a+=this.method.substr(0,50));return a},canAdd:function(){return[]},getFields:function(){"No Description"===this.description&&(this.description=c);var a=this.inherited(arguments)||this.getDefaultFields(),d=this;a.push(g.createCI("name",13,this.name,{group:"General",title:"Name",dst:"name"}));a.push(g.createCI("deferred",0,this.deferred,{group:"General",title:"Deferred",dst:"deferred"}));a.push(g.createCI("arguments",27,this.args,{group:"Arguments",
title:"Arguments",dst:"args"}));a.push(g.createCI("value",b.ECIType.EXPRESSION_EDITOR,this.method,{group:"Script",title:"Script",dst:"method",select:!0,widget:{allowACECache:!0,showBrowser:!1,showSaveButton:!0,editorOptions:{showGutter:!0,autoFocus:!1},item:this},delegate:{runExpression:function(a,b,c){d.method=a;d.solve(d.scope,null,b,c)}}}));return a}})})},"xblox/model/Contains":function(){define(["dcl/dcl","dojo/promise/all","xide/types"],function(p,m,l){return p(null,{declaredClass:"xblox.model.Contains",
getContainer:function(){return this[this._getContainer()]},mayHaveChildren:function(k){k=this[this._getContainer()];return null!=k&&0<k.length},getChildren:function(k){return this[this._getContainer()]},canAdd:function(){return[]},runFrom:function(k,g,e){var a=this,b=k||this.items;k=[];var f=function(c){c._deferredObject.then(function(d){console.log("----def block finish");c._lastResult=c._lastResult||d;a._currentIndex++;a.runFrom(b,a._currentIndex,e)})};if(b.length)for(;g<b.length;g++){var h=b[g];
console.log("run child \n"+h.method);if(!0===h.deferred){h._deferredObject=new Deferred;this._currentIndex=g;f(h);h=h.solve(this.scope,e);k.push(h);break}else h=h.solve(this.scope,e),k.push(h)}else this.onSuccess(this,e);return k},_solve:function(k,g,e,a){!this._lastRunSettings&&g&&(this._lastRunSettings=g);g=this._lastRunSettings||g;this._currentIndex=0;this._return=[];k=this[this._getContainer()];if(k.length)return k=this.runFrom(k,0,g),this.onSuccess(this,g),k;this.onSuccess(this,g);return[]},
onDidRunItem:function(k,g,e){this._emit(l.EVENTS.ON_RUN_BLOCK_SUCCESS,this);k.resolve(g)},onDidRunItemError:function(k,g,e){k.reject(g)},onRunThis:function(k){this._emit(l.EVENTS.ON_RUN_BLOCK,this)},onDidRunThis:function(k,g,e,a){var b=this;if(e.length)e=b.runFrom(e,0,a),m(e).then(function(e){console.log("all solved!",e);b.onDidRunItem(k,g,a)},function(e){console.error("error in chain",e);b.onDidRunItem(k,e,a)});else b.onDidRunItem(k,g,a)},___solve:function(k,g,e,a){}})})},"xblox/model/loops/ForBlock":function(){define("dcl/dcl xblox/model/Block xblox/model/variables/Variable xblox/model/Contains dojo/promise/all dojo/Deferred".split(" "),
function(p,m,l,k,g,e){return p([m,k],{declaredClass:"xblox.model.loops.ForBlock",initial:null,"final":null,comparator:null,modifier:null,items:null,counterName:null,_counter:null,name:"For",sharable:!0,icon:"",ignoreErrors:!1,runFrom:function(a,b,f){var h=this,c=a||this.items;a=[];var d=function(a){a._deferredObject.then(function(b){console.log("----def block finish");a._lastResult=a._lastResult||b;h._currentIndex++;h.runFrom(c,h._currentIndex,f)})};if(c.length)for(;b<c.length;b++){var g=c[b];if(!1!==
g.enabled)if(!0===g.deferred){g._deferredObject=new e;this._currentIndex=b;d(g);g=g.solve(this.scope,f);a.push(g);break}else g=g.solve(this.scope,f),a.push(g)}else this.onSuccess(this,f);return a},_currentForIndex:0,solveSubs:function(a,b,e,h){var c=this;h.override=h.override||{};h.override.args=[this._currentForIndex];if(e.length)return b=c.runFrom(e,0,h),g(b).then(function(a){},function(b){console.error("error in chain",b);c.onDidRunItem(a,b,h)}),b;c.onDidRunItem(a,b,h)},_solve:function(a,b){var f=
new e,h=this,c=this.solveSubs(f,null,this.items,b);g(c).then(function(a){a=a.indexOf(!1);!0!==h.ignoreErrors&&-1!==a?f.resolve(!1):f.resolve(!0)});return f},step:function(a,b){var f=this._checkCondition(a,b),h=new e;f&&this._solve(a,b).then(function(a){1==a?h.resolve(!0):h.resolve(!1)});return h},_forState:!1,loop:function(a,b){var e=this;this.step(a,b).then(function(h){e._updateCounter(a);e._currentForIndex=e._counter.value;if(1==h)e.loop(a,b);else e.onFailed(e,b)})},solve:function(a,b){this._counter=
new l({title:this.counterName,value:this.initial,scope:a,register:!1});this._forState=!0;this._currentForIndex=this.initial;this.loop(a,b);return[]},_checkCondition:function(a,b){var e=a.parseExpression(""+this._counter.value+this.comparator+this["final"]);if(0!=e)this.onSuccess(this,b);return this._forState=e},_updateCounter:function(a){var b=this._counter.value,b=a.parseExpression(""+b+this.modifier);if(b==this._counter.value)return!1;this._counter.value=b;return!0},mayHaveChildren:function(a){return null!=
this.items&&0<this.items.length},getChildren:function(a){a=[];this.items&&(a=a.concat(this.items));return a},canAdd:function(){return[]},toText:function(){return this.getBlockIcon("F")+this.name+" "+this.initial+" "+this.comparator+" "+this["final"]+" with "+this.modifier},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields();return a=a.concat([this.utils.createCI("initial",13,this.initial,{group:"General",title:"Initial",dst:"initial"}),this.utils.createCI("Final",13,this["final"],
{group:"General",title:"Final",dst:"final"}),this.utils.createCI("comparator",13,this.comparator,{group:"General",title:"Comparision",dst:"comparator"}),this.utils.createCI("modifier",13,this.modifier,{group:"General",title:"Modifier",dst:"modifier"}),this.utils.createCI("Abort on Error",0,this.ignoreErrors,{group:"General",title:"Ignore Errors",dst:"ignoreErrors"})])}})})},"xblox/model/loops/WhileBlock":function(){define(["dcl/dcl","xblox/model/Block","xblox/model/variables/Variable"],function(p,
m,l){return p(m,{declaredClass:"xblox.model.loops.WhileBlock",condition:null,items:null,loopLimit:200,name:"While",wait:0,_currentIndex:0,sharable:!0,icon:"",_timer:null,canAdd:function(){return[]},_solve:function(k,g){for(var e=0;e<this.items.length;e++)this.items[e].solve(k,g);return[]},doStep:function(k){if(this._currentIndex<this.loopLimit){var g=[];this._checkCondition(this.scope)?(this.onSuccess(this,k),this.addToEnd(g,this._solve(this.scope,k)),this._currentIndex++):(this._timer&&clearInterval(this._timer),
this.onFailed(this,k))}else console.error("--while block : reached loop limit"),this.reset()},reset:function(){this._timer&&(clearTimeout(this._timer),this._timer=null);this._currentIndex=0},solve:function(k,g){g=g||{};var e=0,a=this,b=this._getArg(this.wait);this.reset();if(0<b)return this._timer=setInterval(function(){a.doStep(g)},b),[];for(;this._checkCondition(k)&&e<this.loopLimit;)this._solve(k,g),e++;this.reset();return[]},toText:function(){return this.getBlockIcon("G")+this.name+" "+this.condition},
_checkCondition:function(k){return k.parseExpression(this.condition)},mayHaveChildren:function(k){return null!=this.items&&0<this.items.length},getChildren:function(k){k=[];this.items&&(k=k.concat(this.items));return k},getFields:function(){var k=this,g=this.inherited(arguments)||this.getDefaultFields();g.push(this.utils.createCI("condition",25,this.condition,{group:"General",title:"Expression",dst:"condition",delegate:{runExpression:function(e,a,b){return k.scope.expressionModel.parse(k.scope,e,
!1,a,b)}}}));g.push(this.utils.createCI("wait",13,this.wait,{group:"General",title:"Wait",dst:"wait"}));return g}})})},"xblox/model/variables/VariableAssignmentBlock":function(){define("dcl/dcl xblox/model/Block xide/utils xide/types dstore/legacy/DstoreAdapter xide/factory".split(" "),function(p,m,l,k,g,e){return p(m,{declaredClass:"xblox.model.variables.VariableAssignmentBlock",variable:null,value:null,name:"Set Variable",icon:"",toText:function(){var a=this.scope.getVariableById(this.variable),
a=a?a.name:"";-1!==this.variable.indexOf("://")&&(a='\x3cspan class\x3d"text-info"\x3e'+this.scope.toFriendlyName(this,this.variable)+"\x3c/span\x3e");return this.getBlockIcon("C")+this.name+" "+a+" to "+this.value},solve:function(a,b){var f=this.value;if(!f){var h=this.getArgs();0<h.length&&(f=h[0])}if(this.variable&&null!==f){this.onRun(this,b);var c=-1!==this.variable.indexOf("://")?this.scope.resolveBlock(this.variable):a.getVariableById(this.variable),h=this._getArg(f);if(!c)return console.error("     no such variable : "+
this.variable),[];this.isScript(h)?(c.value=a.parseExpression(h),c.value=this.replaceAll("'","",c.value)):c.value=h;c.set("value",h);e.publish(k.EVENTS.ON_DRIVER_VARIABLE_CHANGED,{item:c,scope:this.scope,save:!1,block:this,name:c.name,value:h});this.onSuccess(this,b);return[]}},canAdd:function(){return null},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields(!1),b=this;a.push(this.utils.createCI("value",29,this.value,{group:"General",title:"Value",dst:"value",widget:{allowACECache:!0,
showBrowser:!1,showSaveButton:!0,editorOptions:{showGutter:!1,autoSelect:!1,autoFocus:!1,hasConsole:!1,hasItemActions:function(){return!1}},item:this},delegate:{runExpression:function(a,e,c){return b.scope.expressionModel.parse(b.scope,a,!1,e,c)}}}));a.push(l.createCI("value","xcf.widgets.CommandPicker",this.variable,{group:"Variable",title:"Variable",dst:"variable",options:this.scope.getVariablesAsOptions(),block:this,pickerType:"variable",value:this.variable}));return a}})})},"dstore/legacy/DstoreAdapter":function(){define(["dojo/_base/declare",
"dojo/_base/array","dojo/store/util/QueryResults"],function(p,m,l){function k(e){return e}var g={store:null,constructor:function(e){this.store=e;if(e._getQuerierFactory("filter")||e._getQuerierFactory("sort"))this.queryEngine=function(a,f){f=f||{};var h=e._getQuerierFactory("filter"),c=h?h(a):k,h=e._getQuerierFactory("sort"),d=k;h&&(d=h(m.map(f.sort,function(a){return{property:a.attribute,descending:a.descending}})));var g=k;isNaN(f.start)&&isNaN(f.count)||(g=function(a){var b=f.start||0,b=a.slice(b,
b+(f.count||Infinity));b.total=a.length;return b});return function(a){return g(d(c(a)))}};var a=this;e.on("add,update,delete",function(b){var f=b.type,h=b.target;a.notify("add"===f||"update"===f?h:void 0,"delete"===f||"update"===f?"id"in b?b.id:e.getIdentity(h):void 0)})},labelAttr:"title",getLabel:function(e){return this.store.getLabel(e)},query:function(e,a){a=a||{};var b=this.store.filter(e),f,h,c;if(c=a.sort)if("[object Array]"===Object.prototype.toString.call(c))for(var d;d=c.pop();)b=b.sort(d.attribute,
d.descending);else b=b.sort(c);b.track&&!b.tracking&&(b=b.track(),h=!0);"start"in a&&(f=a.start||0,f=b[b.fetchRangeSync?"fetchRangeSync":"fetchRange"]({start:f,end:a.count?f+a.count:Infinity}));f=f||b[b.fetchSync?"fetchSync":"fetch"]();c=f.totalLength;f=new l(f);f.total=c;f.observe=function(a,d){function c(a){return void 0===a&&h?-1:a}var e=b.on("add",function(b){a(b.target,-1,c(b.index))}),f=b.on("update",function(b){!d&&b.previousIndex===b.index&&isFinite(b.index)||a(b.target,c(b.previousIndex),
c(b.index))}),g=b.on("delete",function(b){a(b.target,c(b.previousIndex),-1)}),k={remove:function(){e.remove();f.remove();g.remove()}};k.cancel=k.remove;return k};return f},notify:function(){}};m.forEach(["get","put","add","remove","getIdentity"],function(e){g[e]=function(){var a=this.store;return(a[e+"Sync"]||a[e]).apply(a,arguments)}});return p(null,g)})},"xblox/model/logic/IfBlock":function(){define(["dcl/dcl","xblox/model/Block","xblox/model/Statement"],function(p,m,l){return p([m],{declaredClass:"xblox.model.logic.IfBlock",
condition:"Invalid Expression",consequent:null,elseIfBlocks:null,alternate:null,canAdd:function(){return[]},autoCreateElse:!0,name:"if",icon:"",add:function(k,g,e){null==e&&(e="consequent");return this._add(k,g,e)},addToStore:function(k){k.put(this)},mayHaveChildren:function(k){return null!=this.consequent&&0<this.consequent.length},getChildren:function(k){console.log("grt children",this);k=[];this.consequent&&(k=k.concat(this.consequent));return k},toText:function(){return"\x3cspan class\x3d'text-primary'\x3e"+
this.getBlockIcon("E")+this.name+" \x3c/span\x3e\x3cspan class\x3d'text-warning small'\x3e"+this.toFriendlyName(this.condition)+"\x3cspan\x3e"},_checkCondition:function(k){return k.parseExpression(this.condition+";",null,null)},solve:function(k,g){var e=this._checkCondition(k);if(1==e||0<e){this.onSuccess(this,g);e=null;console.log("run subs");if(this.consequent&&this.consequent.length)for(var a=0;a<this.consequent.length;a++)e=this.consequent[a].solve(k,g);return e}this.onFailed(this,g);if(this.elseIfBlocks)for(e=
0;e<this.elseIfBlocks.length;e++)if("xblox.model.logic.ElseIfBlock"==this.elseIfBlocks[e].declaredClass&&this.elseIfBlocks[e]._checkCondition(k))return this.elseIfBlocks[e].consequent.solve(k,g);if(this.alternate&&0<this.alternate.length){e=null;for(a=0;a<this.alternate.length;a++)e=this.alternate[a].solve(k,g);return e}return[]},empty:function(k){this._empty(this.alternate);this._empty(this.consequent);this._empty(this.items)},removeBlock:function(k){k&&(k&&k.empty&&k.empty(),delete k.items,k.parent=
null,this.alternate.remove(k),this.consequent.remove(k))},_getContainer:function(k){return-1!=this.consequent.indexOf(k)?"consequent":-1!=this.alternate.indexOf(k)?"alternate":"_"},init:function(){this.alternate=this.alternate||[];this.consequent=this.consequent||[];for(var k=0;k<this.alternate.length;k++)this.alternate[k].parentId=this.id,this.alternate[k].parent=this;for(k=0;k<this.consequent.length;k++)this.consequent[k].parentId=this.id,this.consequent[k].parent=this},getFields:function(){var k=
this,g=this.inherited(arguments)||this.getDefaultFields();g.push(this.utils.createCI("condition",this.types.ECIType.EXPRESSION,this.condition,{group:"General",title:"Expression",dst:"condition",delegate:{runExpression:function(e,a,b){return k.scope.expressionModel.parse(k.scope,e,!1,a,b)}}}));return g},postCreate:function(){},_toPHP:function(k){},_toJavascript:function(k){},toCode:function(k,g){switch(k){case "Javascript":return this._toJavascript();case "PHP":return this._toPHP()}}})})},"xblox/model/Statement":function(){define(["dojo/_base/declare",
"./Block"],function(p,m){return p("xblox.model.Statement",[m],{toText:function(){return this.name},getChildren:function(){return this.items}})})},"xblox/model/logic/ElseIfBlock":function(){define(["dojo/_base/declare","xblox/model/Block"],function(p,m){return p("xblox.model.logic.ElseIfBlock",[m],{condition:null,consequent:null,mayHaveChildren:function(){return null!=this.consequent},getChildren:function(l){l=[];this.consequent&&l.push(this.consequent);return l},name:"else if",toText:function(){return this.name+
" "+this.condition},_checkCondition:function(l){return l.parseExpression(this.condition)}})})},"xblox/model/logic/SwitchBlock":function(){define(["dcl/dcl","xblox/model/Block","xblox/model/logic/CaseBlock"],function(p,m,l){return p(m,{declaredClass:"xblox.model.logic.SwitchBlock",variable:"PowerState",items:null,name:"Switch",toText:function(){return this.getBlockIcon("H")+this.name+" "+this.variable},canAdd:function(){return[]},solve:function(k,g){var e=!1,a=[];this.onSuccess(this,g);for(var b=0;b<
this.items.length;b++){var f=this.items[b];if("xblox.model.logic.CaseBlock"===f.declaredClass&&(f=f.solve(k,this,g),0!=f)){e=!0;this.addToEnd(a,f);break}}if(!e)for(b=0;b<this.items.length;b++)f=this.items[b],"xblox.model.logic.CaseBlock"!=f.declaredClass&&this.addToEnd(a,f.solve(k));return a},init:function(){},getChildren:function(k){return this.items},postCreate:function(){this.add(l,{comparator:"\x3d\x3d",expression:"'ON'",group:null});this.add(l,{comparator:"\x3d\x3d",expression:"'Standby'",group:null})}})})},
"xblox/model/variables/VariableSwitch":function(){define(["dcl/dcl","xblox/model/logic/SwitchBlock","xide/types","xblox/model/logic/CaseBlock","dojo/Deferred"],function(p,m,l,k,g){return p(m,{declaredClass:"xblox.model.variables.VariableSwitch",name:"Switch on Variable",icon:"",toText:function(){var e=this.scope.getVariableById(this.variable),e=e?e.name:"";return this.getBlockIcon("H")+this.name+" "+e},getFields:function(){var e=this.inherited(arguments)||this.getDefaultFields();return e=e.concat([this.utils.createCI("Variable",
3,this.variable,{group:"General",widget:{store:this.scope.blockStore,labelField:"name",valueField:"id",query:{group:"basicVariables"}},dst:"variable"})])},runAction:function(e){if("New/Case"===e.command){e=new g;var a=this.add(k,{comparator:"\x3d\x3d",expression:"'ON'",group:null});e.resolve({select:[a],focus:!0,append:!1});a.refresh();return e}},getActions:function(){return[this.createAction({label:"New Case",command:"New/Case",icon:this.getBlockIcon("I"),tab:"Home",group:"File",mixin:{addPermission:!0,
custom:!0}})]}})})},"xblox/model/logging/Log":function(){define("dcl/dcl dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin".split(" "),function(p,m,l,k,g,e){return p([l,e.dcl],{declaredClass:"xblox.model.logging.Log",name:"Log Message",level:"info",message:"",_type:"XBlox",host:"this host",sharable:!0,toText:function(){var a="text-primary";switch(this.level){case "info":a="text-info";break;case "warn":a="text-warning";break;case "error":a="text-danger"}a=this.getBlockIcon()+
" "+this.name+" : \x3cspan class\x3d'"+a+" small'\x3e  :: ";this.message&&(a+=this.message);return a+"\x3c/span\x3e"},_solveExpression:function(a,b,e,h,c){if((a=""+a)&&a.length){b=new Function("{"+a+"}");e=this.getArgs();try{var d=b.apply(this,e||{});h&&h("Expression "+a+" evaluates to "+d);return d}catch(g){c&&c("invalid expression : \n"+a+": "+g)}}else console.error("have no script");return a},solve:function(a,b,e,h){var c=new m,d=a.device;a=this._solveExpression(this.message,a,b,e,h);d={message:a,
level:this.level,type:this._type,details:this.getArgs(),time:(new Date).getTime(),data:{device:d?d.info:null},write:!0};this.onSuccess(this,b);c.resolve(a);try{this.publish(g.EVENTS.ON_SERVER_LOG_MESSAGE,d)}catch(k){this.onFailed(this,b)}return c},canAdd:function(){return null},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields(),b=this;a.push(k.createCI("Level",3,this.level,{group:"General",options:[{value:"info",label:"Info"},{value:"warn",label:"Warning"},{value:"error",
label:"Error"},{value:"debug",label:"Debug"},{value:"help",label:"Help"},{value:"verbose",label:"verbose"},{value:"silly",label:"Silly"}],dst:"level"}));a.push(k.createCI("message",25,this.message,{group:"General",title:"Message",dst:"message",delegate:{runExpression:function(a,e,c){b._solveExpression(a,b.scope,null,e,c)}}}));a.push(k.createCI("message",13,this._type,{group:"General",title:"Type",dst:"_type"}));return a},getBlockIcon:function(){return'\x3cspan class\x3d"fa-bug"\x3e\x3c/span\x3e'}})})},
"xblox/model/server/RunServerMethod":function(){define(["dojo/_base/declare","xblox/model/server/ServerBlock","xide/utils"],function(p,m,l){return p("xblox.model.server.RunServerMethod",[m],{description:"Runs a JSON-RPC-2.0 method on the server",name:"Run Server Method",method:"XShell::run",args:"",deferred:!0,defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:!0,onMethodChanged:function(k,g){this.method=k;if(!l.isValidString(this.args)){var e=this.getServerParams();e&&this._updateArgs(e,
g)}},_getArgs:function(){var k=l.getJson(this.args||"[]"),g=[];if(k){var e=!1;k&&k[0]&&null!=k[0].optional&&(e=!0);if(e)for(e=0;e<k.length;e++){var a=k[e],b=a.value;-1!=a.name.indexOf("Base64")&&(b=this.getService().base64_encode(b));"notset"!==a.value?-1!=a.value.indexOf("[")&&-1!=a.value.indexOf("]")?(b=this.scope.expressionModel.replaceVariables(this.scope,a.value,!1,!1),-1!=a.name.indexOf("Base64")&&(b=this.getService().base64_encode(b)),g.push(b)):g.push(b||a["default"]):g.push(a["default"]||
b)}}else return[this.args];return g},_updateArgs:function(k,g){var e=this.utils.getCIWidgetByName(g,"args");if(e){var a=JSON.stringify(k);e.editBox.set("value",a);this.args=a}},getServerParams:function(){var k=this.getService().getParameterMap(this.getServiceClass(),this.getServiceMethod());if(k)for(var g=0;g<k.length;g++)k[g].value="notset";return k},onReloaded:function(k){console.log("sdfsd");this._solve()},_solve:function(k,g,e,a){console.log("solve223")},solve:function(k,g,e,a){this._return=[];
this._lastResult=null;k=[];if(!this.isInValidState())return this.onFailed(this,g),k;k=this._getArgs();this.onRun(this,g);this.getService();g=this.scope.serviceObject;console.error("run deferred");(g=g.runDeferred(this.getServiceClass(),this.getServiceMethod(),k))&&g.then(function(a){console.error("returned ",a)});return g},toText:function(){var k=this.getBlockIcon()+" "+this.name+" :: ";this.method&&(k+=this.method.substr(0,50));return k},canAdd:function(){return[]},getFields:function(){var k=this.getDefaultFields(),
g=this;k.push(this.utils.createCI("value",25,this.method,{group:"General",title:"Method",dst:"method",description:"This should be in the format : MyServerClass::myMethod",delegate:{runExpression:function(e,a,b){g.method=e;g.solve(g.scope,null,a,b)}}}));return k=k.concat(this.getServerDefaultFields())},getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(k){return null!=this.items&&0<this.items.length},getChildren:function(k){return this.items},onChangeField:function(k,
g,e){if("method"===k)this.onMethodChanged(g,e)},isInValidState:function(){return null!=this.getService()},getService:function(){var k=this.scope.getService();k||console.error("have no service object");return k},getServiceClass:function(){return this.method.split("::")[0]||this.defaultServiceClass},getServiceMethod:function(){return this.method.split("::")[1]||this.defaultServiceMethod},hasMethod:function(k){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]&&null!=this.getService()[this.getServiceClass()][this.getServiceMethod()]},
hasServerClass:function(k){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]},getServerFunction:function(){return this.isInValidState()&&this.getServiceClass()&&this.getServiceMethod()?this.getService()[this.getServiceClass()][this.getServiceMethod()]:null}})})},"xblox/model/server/ServerBlock":function(){define(["dcl/dcl","xblox/model/Block"],function(p,m){return p(m,{declaredClass:"xblox.model.server.ServerBlock",name:"Run Server Block",method:"XShell::run",args:"",deferred:!0,
defaultServiceClass:"XShell",defaultServiceMethod:"run",sharable:!0,onReloaded:function(){console.log("1")},solve:function(l,k,g,e){this._currentIndex=0;this._return=[];if((l=""+this.method)&&l.length){var a=new Function("{"+l+"}"),b=this.getArgs();try{var f=a.apply(this,b||{});this._lastResult=f;g&&g("Expression "+l+" evaluates to "+f);if("false"!==f&&!1!==f)this.onSuccess(this,k);else return this.onFailed(this,k),[]}catch(h){return e&&e("invalid expression : \n"+l+": "+h),this.onFailed(this,k),
[]}}else console.error("have no script");g=this[this._getContainer()];if(g.length)this.runFrom(g,0,k);else this.onSuccess(this,k);return[]},toText:function(){var l=this.getBlockIcon()+" "+this.name+" :: ";this.method&&(l+=this.method.substr(0,50));return l},canAdd:function(){return[]},getServerDefaultFields:function(l){l=l||[];l.push(this.utils.createCI("args",27,this.args,{group:"General",title:"Arguments",dst:"args"}));return l},getFields:function(){return this.inherited(arguments)||this.getDefaultFields()},
getBlockIcon:function(){return'\x3cspan class\x3d"fa-plug"\x3e\x3c/span\x3e'},mayHaveChildren:function(l){return null!=this.items&&0<this.items.length},getChildren:function(l){return this.items},isInValidState:function(){return null!=this.getService()},getService:function(){return this.scope.getService()},getServiceClass:function(){return this.method.split("::")[0]||this.defaultServiceClass},getServiceMethod:function(){return this.method.split("::")[1]||this.defaultServiceMethod},hasMethod:function(l){return this.isInValidState()&&
null!=this.getService()[this.getServiceClass()]&&null!=this.getService()[this.getServiceClass()][this.getServiceMethod()]},hasServerClass:function(l){return this.isInValidState()&&null!=this.getService()[this.getServiceClass()]},getServerFunction:function(){return this.isInValidState()&&this.getServiceClass()&&this.getServiceMethod()?this.getService()[this.getServiceClass()][this.getServiceMethod()]:null}})})},"xblox/model/code/RunBlock":function(){define(["dcl/dcl","xblox/model/Block","xide/types",
"xide/utils"],function(p,m,l,k){return p(m,{declaredClass:"xblox.model.code.RunBlock",name:"Run Block",file:"",method:"",args:"",sharable:!0,block:"",description:"Runs another Block",solve:function(g,e){var a=this.getContext();if(a&&null!=a[this.method]){var b=[],f=a[this.method];try{var h=this._getArgs(),b=f.apply(a,h||[]);this.onSuccess(this,e);return b}catch(c){console.error("call method failed"),this.onFailed(this,e)}}else this.onFailed(this,e);return[]},toText:function(){var g=this.getBlockIcon()+
" "+this.name+" ";this.method&&(g+=this.method.substr(0,20));return g},getFields:function(){var g=this.getDefaultFields();g.push(k.createCI("Block",l.ECIType.BLOCK_REFERENCE,this.block,{toolTip:"Enter  block, you can use also the block's share title",group:"General",dst:"block",value:this.block,title:"Block",scope:this.scope}));g.push(k.createCI("File",l.ECIType.FILE,this.file,{toolTip:"Leave empty to auto-select this file",group:"General",dst:"file",value:this.file,intermediateChanges:!1,acceptFolders:!1,
acceptFiles:!0,encodeFilePath:!1,buildFullPath:!0,filePickerOptions:{dialogTitle:"Select Block File",filePickerMixin:{beanContextName:this.id,persistent:!1,globalPanelMixin:{allowLayoutCookies:!1}},configMixin:{beanContextName:this.id,LAYOUT_PRESET:l.LAYOUT_PRESET.SINGLE,PANEL_OPTIONS:{ALLOW_MAIN_MENU:!1,ALLOW_NEW_TABS:!0,ALLOW_MULTI_TAB:!1,ALLOW_INFO_VIEW:!0,ALLOW_LOG_VIEW:!1,ALLOW_CONTEXT_MENU:!0,ALLOW_LAYOUT_SELECTOR:!0,ALLOW_SOURCE_SELECTOR:!0,ALLOW_COLUMN_RESIZE:!0,ALLOW_COLUMN_REORDER:!0,ALLOW_COLUMN_HIDE:!0,
ALLOW_ACTION_TOOLBAR:!0,ALLOW_BREADCRUMBS:!1}},defaultStoreOptions:{fields:1663,includeList:"xblox",excludeList:"*"},startPath:this.file}}));return g},getBlockIcon:function(){return'\x3cspan class\x3d"el-icon-share-alt"\x3e\x3c/span\x3e'}})})},"xblox/model/events/OnEvent":function(){define("dcl/dcl dojo/_base/lang dojo/_base/array dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Referenced xide/registry dojo/on".split(" "),function(p,m,l,k,g,e,a,b,f,h,c){return p([g,
b.dcl,f.dcl],{declaredClass:"xblox.model.events.OnEvent",name:"On Event",event:"",reference:"",references:null,sharable:!0,_nativeEvents:"onclick ondblclick onmousedown onmouseup onmouseover onmousemove onmouseout onkeypress onkeydown onkeyup onfocus onblur onchange".split(" "),solve:function(a,b,c,e){!this._lastRunSettings&&b&&(this._lastRunSettings=b);b=this._lastRunSettings||b;this._currentIndex=0;this._return=[];a=this[this._getContainer()];if(a.length)return a=this.runFrom(a,0,b),this.onSuccess(this,
b),a;this.onSuccess(this,b);return[]},toText:function(){var a=this.getBlockIcon()+" "+this.name+" :: ";this.event&&(a+=this.event);return a},canAdd:function(){return[]},getFields:function(){var b=this.inherited(arguments)||this.getDefaultFields();this.deserialize(this.reference);var c=null;if(-1<e.contains(this._nativeEvents,this.event))for(var c=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},
{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],f=0;f<c.length;f++){var h=c[f];if(h.value===this.event){h.selected=!0;break}}else c=this.scope.getEventsAsOptions(this.event);b.push(e.createCI("Event",a.ECIType.ENUMERATION,
this.event,{group:"General",options:c,dst:"event",widget:{search:!0}}));b.push(e.createCI("Object/Widget",a.ECIType.WIDGET_REFERENCE,this.reference,{group:"General",dst:"reference",value:this.reference}));return b},getBlockIcon:function(){return'\x3cspan class\x3d"fa-bell"\x3e\x3c/span\x3e'},mayHaveChildren:function(a){return null!=this.items&&0<this.items.length},getChildren:function(a){return this.items},onEvent:function(a){this._lastResult=a;this.solve(this.scope,this._lastRunSettings)},_subscribe:function(a,
b,f){if(a)if(-1==e.contains(this._nativeEvents,a))this.subscribe(a,this.onEvent,f);else if(f){a=a.replace("on","");var h=this;f=c(f,a,function(a){h.onEvent(a)});console.log("wire native event : "+a);this._events.push(f)}},_registerEvent:function(a){if(a&&a.length){console.log("register event : "+a+" for "+this.reference);var b=this.resolveReference(this.deserialize(this.reference)),c=this;if(b&&b.length){for(var e=0;e<b.length;e++){var f=b[e];if(f&&f.id){var g=h.byId(f.id);if(g&&g.on){var k=this.event.replace("on",
"");console.log("found widget : "+f.id+" will register event "+k);f=g.on(k,m.hitch(this,function(a){console.log("event triggered : "+c.event);c.onEvent(a)}));this._events.push(f)}else this._subscribe(a,this.onEvent,f)}else this._subscribe(a,this.onEvent,f)}console.log("objects found : ",b)}else this._subscribe(a,this.onEvent)}},onLoad:function(){this._onLoaded=!0;this.event&&this.event.length&&this.enabled&&this._registerEvent(this.event)},destroy:function(){this.inherited(arguments)},updateEventSelector:function(b,
c){var e=[];if(b&&b.length)for(var e=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",
value:"onchange"}],f=0;f<e.length;f++){var h=e[f];if(h.value===this.event){h.selected=!0;break}}else e=this.scope.getEventsAsOptions(this.event);for(f=0;f<c.length;f++)if(h=c[f],h.widget&&"Event"===h.widget.title){f=h._widget;f.nativeWidget.set("options",e);f.nativeWidget.reset();f.nativeWidget.set("value",this.event);this.publish(a.EVENTS.RESIZE,{});break}},onReferenceChanged:function(a,b){this._destroy();this.reference=a;var c=this.resolveReference(this.deserialize(a));this.updateEventSelector(c,
b);this._registerEvent(this.event)},onChangeField:function(a,b,c){"event"==a&&(this._destroy(),this._onLoaded&&(this.event=b,this._registerEvent(b)));if("reference"==a)this.onReferenceChanged(b,c);this.inherited(arguments)},activate:function(){this._destroy();this._registerEvent(this.event)},deactivate:function(){this._destroy()},_destroy:function(){this._events||(this._events=[]);l.forEach(this._events,dojo.unsubscribe);this._lastResult=null;this._events=[]}})})},"xblox/model/Referenced":function(){define(["dcl/dcl",
"xdojo/declare","xide/mixins/ReferenceMixin"],function(p,m,l){var k={reference:null,deserialize:function(g){if(!g||0==g.length)return{};try{return dojo.fromJson(g)}catch(e){return{}}}};m=m("xblox.model.Referenced",[l],k);m.dcl=p(l.dcl,k);return m})},"xide/mixins/ReferenceMixin":function(){define(["dcl/dcl","xdojo/declare","xide/types","xide/utils","xide/registry"],function(p,m,l,k,g){var e={_targetReference:null,getTarget:function(){return this._targetReference||this.inherited(arguments)},skipWidgetCSSClasses:"dijitButtonHover dijitHover dijit dijitInline dijitReset dijitCheckBoxChecked dijitChecked dijitLeft".split(" "),
_cssClassesToQuery:function(a){var b="";if(a){a=a.split(" ");for(var e=0;e<a.length;e++)-1<k.contains(this.skipWidgetCSSClasses,a[e])||-1<a[e].toLowerCase().indexOf("hover")||(b+="."+a[e])}return b.trim()},resolveReference:function(a){var b=this.getTarget(),e=this;if(!(a&&a.reference&&a.reference.length)&&b)return[b];switch(a.mode){case l.WIDGET_REFERENCE_MODE.BY_ID:if(this.scope&&this.scope.document){var b=function(a){return(a=e.scope.document.getElementById(a))?a:null},h=[],c=a.reference;if(-1!==
c.indexOf(" "))for(c=c.split(" "),a=0;a<c.length;a++){var d=b(c[a]);d&&h.push(d)}else return[b(a.reference)];return h}return[g.byId(a.reference)];case l.WIDGET_REFERENCE_MODE.BY_CLASS:if(b=dojo.getObject(a.reference)||p.getObject(a.reference))return[b];break;case l.WIDGET_REFERENCE_MODE.BY_CSS:if(c=this._cssClassesToQuery(a.reference),this.scope&&this.scope.global&&(b=this.scope.global.$)&&(b=b(c))||(b=k.find(c,null,!1)))return b}return null}};m=m("xblox.model.ReferenceMixin",null,e);m.dcl=p(null,
e);return m})},"xblox/model/events/OnKey":function(){define("dcl/dcl dojo/_base/lang dojo/_base/array dojo/Deferred xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Referenced xblox/model/Contains xblox/model/events/OnEvent xide/registry dojo/on".split(" "),function(p,m,l,k,g,e,a,b,f,h,c,d,n){return p([g,b.dcl,f.dcl,h],{declaredClass:"xblox.model.events.OnKey",name:"On Key",event:"",reference:"",references:null,description:"Triggers when a keyboard sequence "+this.event+
" has been entered",listeners:null,sharable:!0,toText:function(){var a=this.getBlockIcon()+" "+this.name+" :: ";this.event&&(a+=this.event);return a},canAdd:function(){return[]},getFields:function(){var b=this.inherited(arguments)||this.getDefaultFields();b.push(e.createCI("Keyboard Sequence",a.ECIType.STRING,this.event,{group:"General",dst:"event",value:this.event,intermediateChanges:!1}));b.push(e.createCI("Object/Widget",a.ECIType.WIDGET_REFERENCE,this.reference,{group:"General",dst:"reference",
value:this.reference}));return b},getBlockIcon:function(){return'\x3cspan class\x3d"fa-keyboard-o"\x3e\x3c/span\x3e'},onEvent:function(a){this._lastResult=a;this.solve(this.scope,this._lastRunSettings)},_addListerner:function(a,b,c){null==this.listeners&&(this.listeners=[]);var d=null,d=new window.keypress.Listener(c,{is_unordered:!0,prevent_repeat:!1,prevent_default:!1,on_keyup:function(a){console.log("up")},on_keydown:function(a){console.log("down")},on_release:function(a){console.log("release")}});
d.simple_combo(a,function(a){b&&b(arguments)});this.listeners.push(d)},_subscribe:function(a,b,c){a&&(c&&c.domNode&&(c=c.domNode),this._addListerner(a,b,c))},_registerEvent:function(a){if(a&&a.length){var b=this.resolveReference(this.deserialize(this.reference)),c=this;if(b&&b.length)for(var e=0;e<b.length;e++){var f=b[e];if(f&&f.id){var h=d.byId(f.id);h=null,this._subscribe(a,function(){c.onEvent(arguments)},f)}else this._subscribe(a,function(){c.onEvent(arguments)},f)}else this._subscribe(a,function(){c.onEvent(arguments)})}},
onLoad:function(){this._onLoaded=!0;this.event&&this.event.length&&this.enabled&&this._registerEvent(this.event)},destroy:function(){this.inherited(arguments)},updateEventSelector:function(b,c){var d=[];if(b&&b.length)for(var d=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},
{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],e=0;e<d.length;e++){var f=d[e];if(f.value===this.event){f.selected=!0;break}}else d=this.scope.getEventsAsOptions(this.event);for(e=0;e<c.length;e++)if(f=c[e],f.widget&&"Event"===f.widget.title){e=f._widget;e.nativeWidget.set("options",d);e.nativeWidget.reset();e.nativeWidget.set("value",
this.event);this.publish(a.EVENTS.RESIZE,{});break}},onReferenceChanged:function(a,b){this._destroy();this.reference=a;this.resolveReference(this.deserialize(a));this._registerEvent(this.event)},onChangeField:function(a,b,c){"event"==a&&(this._destroy(),this._onLoaded&&(this.event=b,this._registerEvent(b)));if("reference"==a)this.onReferenceChanged(b,c);this.inherited(arguments)},activate:function(){this._destroy();this._registerEvent(this.event)},deactivate:function(){this._destroy()},_destroy:function(){if(this.listeners)for(var a=
0;a<this.listeners.length;a++){var b=this.listeners[a];b.stop_listening();var c=b.get_registered_combos();c&&b.unregister_many(c);b.reset();console.log("did destroy listener")}this.listeners=[]},onFieldsRendered:function(a,b){}})})},"xblox/model/html/SetStyle":function(){define("xdojo/declare xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Referenced dojo/dom-attr dojo/dom-style dojo/_base/Color".split(" "),function(p,m,l,k,g,e,a,b,f){var h={name:"Set Style",reference:"",
references:null,description:"Sets HTML Node Style Attribute",value:"",mode:1,sharable:!0,solve:function(a,b){var e=this.value;this.override&&this.override.variables&&(e=l.replace(e,null,this.override.variables,{begin:"{",end:"}"}));this.updateObjects(null,e,this.mode);this.onSuccess(this,b);this.onDidRun()},toText:function(){var a=this.deserialize(this.reference),a=this.getBlockIcon()+" "+this.name+" :: on "+a.reference+" to"||"  to ";this.value&&(a+=" "+this.value);return a},getFields:function(){var a=
this.inherited(arguments)||this.getDefaultFields();a.push(l.createCI("Value",k.ECIType.DOM_PROPERTIES,this.value,{group:"General",dst:"value",value:this.value,intermediateChanges:!1}));a.push(l.createCI("Mode",k.ECIType.ENUMERATION,this.mode,{group:"General",options:[l.createOption("Set",1),l.createOption("Add",2),l.createOption("Remove",3),l.createOption("Increase",4),l.createOption("Decrease",5)],dst:"mode"}));var b={group:"General",dst:"reference",value:this.reference};this.scope&&(this.scope.global&&
(b.window=this.scope.global,b.allowHTMLNodes=!0,b.allowWidgets=!1),this.scope.document&&(b.document=this.scope.document));a.push(l.createCI("Target",k.ECIType.WIDGET_REFERENCE,this.reference,b));return a},getBlockIcon:function(){return'\x3cspan class\x3d"fa-paint-brush"\x3e\x3c/span\x3e'},destroy:function(){this.inherited(arguments)},updateEventSelector:function(a,b){var e=[];if(a&&a.length)for(var e=[{label:"onclick",value:"onclick"},{label:"ondblclick",value:"ondblclick"},{label:"onmousedown",value:"onmousedown"},
{label:"onmouseup",value:"onmouseup"},{label:"onmouseover",value:"onmouseover"},{label:"onmousemove",value:"onmousemove"},{label:"onmouseout",value:"onmouseout"},{label:"onkeypress",value:"onkeypress"},{label:"onkeydown",value:"onkeydown"},{label:"onkeyup",value:"onkeyup"},{label:"onfocus",value:"onfocus"},{label:"onblur",value:"onblur"},{label:"onchange",value:"onchange"}],f=0;f<e.length;f++){var h=e[f];if(h.value===this.event){h.selected=!0;break}}else e=this.scope.getEventsAsOptions(this.event);
for(f=0;f<b.length;f++)if(h=b[f],h.widget&&"Event"===h.widget.title){f=h._widget;f.nativeWidget.set("options",e);f.nativeWidget.reset();f.nativeWidget.set("value",this.event);this.publish(k.EVENTS.RESIZE,{});break}},onReferenceChanged:function(a,b){this.reference=a;this.references=this.resolveReference(this.deserialize(a));this.updateObjects(this.references,this.value)},getPropValue:function(a,b){for(var e in a)if(e===b)return a[e];return null},_getStyle:function(a,b,e){switch(a){case "height":return e.outerHeight();
case "width":return e.outerWidth();case "color":return e.css("color");case "border-color":return e.css("border-color")||"rgba(0,0,0,0)"}return null},updateObject:function(c,d,e){if(!c)return!1;e=e||1;null!=c.domNode&&(c=c.domNode);var h=a.get(c,"style");";"===h&&(h="");""===h&&(h=null!=c.lastStyle?c.lastStyle:d);";"===h&&(h=d);switch(e){case 1:var g=this._toObject(h);d=d.split(";");for(h=0;h<d.length;h++)e=d[h].split(":"),2==e.length&&(g[e[0]]=e[1]);var h=[],k;for(k in g)h.push(k+":"+g[k]);$(c).attr("style",
h.join(";"));break;case 2:d=_.uniq((h+";"+d).split(";")).join(";");a.set(c,"style",d);break;case 3:a.set(c,"style",l.replaceAll(d,"",h));break;case 4:case 5:k=new RegExp(/(\D*)(-?)(\d+)(\D*)/);e=this._toObject(d);var m={},p=$(c);if(e)for(g in e)h=this._getStyle(g,c,p),m[g]=h;p={};for(g in e){var t=""+g.trim();if(null!=m[t]){var u=e[g],w=m[g],C=-1!=u.indexOf("#"),A=-1!=u.indexOf("rgb"),D=-1!=u.indexOf("rgba");if(C||A||D){var E=dojo.colorFromString(u),t=dojo.colorFromString(u),B=dojo.colorFromString(w),
z=new f;_.each(["r","g","b","a"],function(a){z[a]=Math.min(B[a]+E[a],"a"==a?1:255)});console.log("color computed "+B.toRgba()+" color requested: "+t.toRgba()+" | multiplicator color \x3d "+E.toRgba()+" is then \x3d "+z.toRgba());w="";C?w=z.toHex():A?w=z.toCss(!1):D&&(w=z.toCss(!0));p[g]=w;b.set(c,g,w)}else(C=k.exec(m[t]))&&3<=C.length&&parseInt(C[3])}}h=this._toObject(h);this._toObject(d);if(!h)return!1;for(g in h)t=""+g.trim();this._toStyleString(p)}},onDomStyleChanged:function(a,b,e){if(a=a||this.resolveReference(this.deserialize(this.reference))){console.log("change dom style to "+
b+" on "+a.length+" objects");for(var f=0;f<a.length;f++){var h=a[f];h&&h.id&&-1!=h.id.indexOf("davinci")||this.updateObject(h,b,e)}}else console.log("have no objects")},updateObjects:function(a,b,e){a=a||this.resolveReference(this.deserialize(this.reference));this.onDomStyleChanged(a,b,e)},onChangeField:function(a,b,e){this._destroy();"mode"==a&&b!==this.mode&&(this.mode=b);"value"==a&&b!==this.value&&(this.onDomStyleChanged(null,b,this.mode),this.value=b);if("reference"==a)this.onReferenceChanged(b,
e);this.inherited(arguments)},activate:function(){this._destroy()},deactivate:function(){this._destroy()},_destroy:function(){},_changeValue:function(a,b){if(!a)return"";for(var e=a.split(" "),f="",h=0;h<e.length;h++){0<h&&(f+=" ");var g=e[h].match(/([-\d\.]+)([a-zA-Z%]*)/);if(g)if(1==g.length)f+=g[0];else for(var k=1;k<g.length;k++)f=isNaN(g[k])||""==g[k]?f+g[k]:f+(parseFloat(g[k])+b);else f+=e[h]}return f},_toObject:function(a){if(!a)return{};var b={};a=a.split(";");for(var e=0;e<a.length;e++){var f=
a[e];f&&0!=f.length&&f.split&&(f=f.split(":"))&&f.length&&(b[f[0]]=f[1])}return b},_toStyleString:function(a){var b=[],e;for(e in a)b.push(e+":"+a[e]);return b.join(";")+";"}};p=p("xblox.model.html.SetStyle",[m,g,e],h);p.Impl=h;return p})},"xblox/model/html/SetCSS":function(){define("dojo/_base/declare dojo/_base/lang xblox/model/Block xide/utils xide/types xide/mixins/EventedMixin xblox/model/Targeted xide/registry".split(" "),function(p,m,l,k,g,e,a,b){return p("xblox.model.html.SetCSS",[l,e,a],
{name:"Set CSS",file:"",reference:"",references:null,description:"Sets HTML Node CSS",solve:function(a,b){this.onSuccess(this,b)},toText:function(){var a=this.getBlockIcon()+" "+this.name+" :: ";this.event&&(a+=this.event);return a},getFields:function(){try{var a=this.inherited(arguments)||this.getDefaultFields();a.push(k.createCI("File",g.ECIType.FILE,this.file,{group:"General",dst:"file",value:this.file,intermediateChanges:!1,acceptFolders:!1,acceptFiles:!0,encodeFilePath:!1,buildFullPath:!0,filePickerOptions:{dialogTitle:"Select CSS File",
filePickerMixin:{beanContextName:"CSSFilePicker",persistent:!1,globalPanelMixin:{allowLayoutCookies:!1}},configMixin:{beanContextName:"CSSFilePicker",LAYOUT_PRESET:g.LAYOUT_PRESET.SINGLE,PANEL_OPTIONS:{ALLOW_MAIN_MENU:!1}},defaultStoreOptions:{fields:1663,includeList:"css",excludeList:"*"},startPath:this.file}}));a.push(k.createCI("Target",g.ECIType.WIDGET_REFERENCE,this.reference,{group:"General",dst:"reference",value:this.reference}))}catch(b){}return a},getBlockIcon:function(){return'\x3cspan class\x3d"fa-paint-brush"\x3e\x3c/span\x3e'},
onReferenceChanged:function(a,b){this._destroy();this.reference=a;this.resolveReference(this.deserialize(a))},onChangeField:function(a,b,c){if("reference"==a)this.onReferenceChanged(b,c);this.inherited(arguments)},activate:function(){this._destroy()},deactivate:function(){this._destroy()},_destroy:function(){}})})},"xblox/model/Targeted":function(){define(["dojo/_base/declare","./Referenced"],function(p,m){return p("xblox.model.Targeted",[m],{})})},"xblox/model/mqtt/Subscribe":function(){define("dcl/dcl xdojo/has dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains xide/types dojo/has!host-node?dojo/node!tracer dojo/has!host-node?nxapp/utils/_console".split(" "),
function(p,m,l,k,g,e,a,b,f){return p([k,e],{declaredClass:"xblox.model.mqtt.Subscribe",name:"Subscribe",topic:"Topic",args:"",deferred:!1,sharable:!0,context:null,icon:"fa-bell",path:"",qos:0,stop:function(){var a=this.getInstance();a&&a.callMethod("unSubscribeTopic",g.mixin({topic:this.topic},g.getJson(this.args)),this.id,this.id)},onData:function(a){if(a&&a.topic&&a.topic==this.topic){this.getContext();var b=this[this._getContainer()],d=this._lastSettings,e=[];if(0<b.length){var b=a,f=this.path&&
this.path.length?this.path:null!==a.payload?"payload":null;f&&_.isObject(a)&&(b=g.getAt(a,f,a));for(a=0;a<this.items.length;a++)f=this.items[a],f.enabled&&(f.override={args:[b]},e.push(f.solve(this.scope,d)))}this.onSuccess(this,this._lastSettings);return e}},observed:["topic"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},solve:function(a,b,d,e,f,k){this._currentIndex=0;this._return=[];this._lastSettings=b;(a=this.getInstance())&&a.callMethod("subscribeTopic",
g.mixin({topic:this.topic,qos:this.qos},g.getJson(this.args||"{}")),this.id,this.id);b=b||{};this.onRunThis(b)},toText:function(){var a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+""+this.makeEditable("topic","bottom","text","Enter a topic","inline")+" :: \x3c/span\x3e";this.topic&&(a+=this.topic.substr(0,30));return a},canAdd:function(){return[]},getFields:function(){var b=this.inherited(arguments)||this.getDefaultFields();b.push(g.createCI("name",13,this.name,{group:"General",title:"Name",dst:"name"}));
b.push(g.createCI("arguments",27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));b.push(g.createCI("topic",a.ECIType.STRING,this.topic,{group:"General",title:"Topic",dst:"topic",select:!0}));b.push(g.createCI("name",a.ECIType.ENUMERATION,this.qos,{group:"General",title:"QOS",dst:"qos",widget:{options:[{label:"0 - at most once",value:0},{label:"1 - at least once",value:1},{label:"2 - exactly once",value:2}]}}));b.push(g.createCI("path",a.ECIType.STRING,this.path,{group:"General",title:"Value Path",
dst:"path"}));return b}})})},"xblox/model/mqtt/Publish":function(){define("dcl/dcl xdojo/has dojo/Deferred xblox/model/Block xide/utils xblox/model/Contains xide/types xcf/model/Command dojo/has!host-node?dojo/node!tracer dojo/has!host-node?nxapp/utils/_console".split(" "),function(p,m,l,k,g,e,a,b,f,h){return p(b,{declaredClass:"xblox.model.mqtt.Publish",name:"Publish",topic:"",args:"",deferred:!1,sharable:!0,context:null,icon:"fa-send",isCommand:!0,qos:0,retain:!1,path:null,onData:function(a){if(a&&
a.topic&&a.topic==this.topic){this.getContext();var b=this[this._getContainer()],e=this._lastSettings,f=[];if(0<b.length)for(b=a,(this.path="value",_.isObject(a))&&(b=g.getAt(a,this.path,a)),a=0;a<this.items.length;a++){var h=this.items[a];h.enabled&&(h.override={args:[b]},f.push(h.solve(this.scope,e)))}this.onSuccess(this,this._lastSettings);return f}},observed:["topic"],getContext:function(){return this.context||(this.scope.getContext?this.scope.getContext():this)},solve:function(a,b,e,f,h,k){this._currentIndex=
0;this._return=[];this._lastSettings=b;if(a=this.getInstance())e=g.getJson(this.args,!0,!1),null!==e&&0!==e&&!0!==e&&!1!==e&&_.isObject(e)||(e={payload:this.args}),a.callMethod("publishTopic",g.mixin({topic:this.topic,qos:this.qos,retain:this.retain},e),this.id,this.id);b=b||{};this.onRunThis(b)},toText:function(){var a='\x3cspan style\x3d""\x3e'+this.getBlockIcon()+" "+this.makeEditable("name","top","text","Enter a name","inline")+" :: \x3c/span\x3e";this.topic&&(a+=this.makeEditable("topic","bottom",
"text","Enter a topic","inline"));return a},canAdd:function(){return[]},getFields:function(){var b=this.inherited(arguments)||this.getDefaultFields();b.push(g.createCI("qos",a.ECIType.ENUMERATION,this.qos,{group:"General",title:"QOS",dst:"qos",widget:{options:[{label:"0 - at most once",value:0},{label:"1 - at least once",value:1},{label:"2 - exactly once",value:2}]}}));b.push(g.createCI("arguments",27,this.args,{group:"Arguments",title:"Arguments",dst:"args"}));b.push(g.createCI("topic",a.ECIType.STRING,
this.topic,{group:"General",title:"Topic",dst:"topic",select:!0}));b.push(g.createCI("retain",a.ECIType.BOOL,this.retain,{group:"General",title:"Retain",dst:"retain"}));b.remove(_.find(b,{name:"send"}));b.remove(_.find(b,{name:"waitForResponse"}));return b}})})},"xcf/model/Command":function(){define("dcl/dcl xblox/model/Block xblox/model/Contains xide/utils xide/types dojo/Deferred".split(" "),function(p,m,l,k,g,e){return p([m,l],{declaredClass:"xcf.model.Command",startup:!1,auto:null,send:"",name:"No Title",
observed:["send"],interval:0,waitForResponse:!1,_runningDfd:null,onCommandFinish:function(a){this.getScope().getContext();this.waitForResponse&&this._emit("cmd:"+a.cmd+"_"+a.id,{msg:a})},onCommandError:function(a){this.getScope().getContext();this.waitForResponse&&this._emit("cmd:"+a.cmd+"_"+a.id,a)},sendToDevice:function(a,b){a=this.replaceAll("'","",a);var e=k.createUUID(),h=this;if(this.scope.instance)this.waitForResponse&&this._on("cmd:"+a+"_"+e,function(a){if(a.error)h.onFailed(h,b);else h.onSuccess(h,
b)}),this.scope.instance.sendMessage(a,null,this.id,e);else return this.publish(g.EVENTS.ON_STATUS_MESSAGE,{text:"Command "+this.name+" : have no device",type:"error",delay:1E3}),!1;return e},reset:function(){this._lastSettings={};this._loop&&(clearTimeout(this._loop),this._loop=null)},solve:function(a,b,f,h){var c=null;a=a||this.scope;h=h||this.send;b=this._lastSettings=b||this._lastSettings;1==f&&this._loop&&this.reset();if(!0!==this.waitForResponse)this.onRun(this,b);else this.onRun(this,b,{timeout:!1}),
this._runningDfd=c=new e;if(this.items&&0<this.items.length){if(h&&0<h.length){var d=a.parseExpression(h);if(d&&0<d.length)if(this.sendToDevice(d,b))this.onSuccess(this,b);else this.onFailed(this,b)}f=[];for(d=0;d<this.items.length;d++)c=this.items[d],c.enabled&&f.push(c.solve(a,b));return f}if(0<h.length){if(c=this.override&&this.override.variables?this.override.variables:null)for(d in c)_.isNumber(c[d])&&(c[d]=Math.round(c[d]));if((d=this.isScript(h)?a.parseExpression(h,null,c):""+h)&&0<d.length&&
!this.sendToDevice(d,b))this.onFailed(this,b);if(!0!==this.waitForResponse)this.onSuccess(this,b);else this._settings=b;f&&this.scope.loopBlock(this,b);return[d]}return!1},canAdd:function(){return[]},mayHaveChildren:function(a){return null!=this.items&&0<this.items.length},getChildren:function(a){return this.items},hasInlineEdits:!0,toText:function(a,b,e,h){var c="";!1!==a&&(c+="\x3cspan class\x3d'text-primary inline-icon'\x3e"+this.getBlockIcon()+"\x3c/span\x3e");!1!==b&&(c+=""+this.makeEditable("name",
"bottom","text","Enter a unique name","inline")+"");1==h&&(c+="\x3cbr/\x3e");!1!==e&&(c+="\x3cspan class\x3d'text-muted small'\x3e Send:\x3ckbd class\x3d'text-warning'\x3e"+this.makeEditable("send","bottom","text","Enter the string to send","inline")+"\x3c/kbd\x3e\x3c/span\x3e");!1!==a&&(this.startup&&(c+=this.getIcon("fa-bell inline-icon text-warning","text-align:right;float:right;","")),this.auto&&10<this.interval&&(c+=this.getIcon("fa-clock-o inline-icon text-warning","text-align:right;float:right",
"")));return c},getFields:function(){var a=this.inherited(arguments)||this.getDefaultFields(),b=this;a.push(this.utils.createCI("name",13,this.name,{group:"General",title:"Name",dst:"name",order:200}));a.push(this.utils.createCI("startup",0,this.startup,{group:"General",title:"Send on Startup",dst:"startup",order:199}));a.push(this.utils.createCI("auto",0,this.auto,{group:"General",title:"Auto Send",dst:"auto",order:198}));a.push(this.utils.createCI("interval",13,this.interval,{group:"General",title:"Interval",
dst:"interval",order:197}));a.push(this.utils.createCI("waitForResponse",0,this.waitForResponse,{group:"General",title:"%%Has Response",dst:"waitForResponse",order:195}));a.push(this.utils.createCI("send",g.ECIType.EXPRESSION_EDITOR,this.send,{group:"Send",title:"Send",dst:"send",widget:{allowACECache:!0,showBrowser:!1,showSaveButton:!0,style:"height:inherit;",editorOptions:{showGutter:!1,autoFocus:!1},aceOptions:{hasEmmet:!1,hasLinking:!1,hasMultiDocs:!1},item:this},delegate:{runExpression:function(a,
e,c){return b.scope.expressionModel.parse(b.scope,a,!1,e,c)}}}));return a},icon:"fa-exclamation",getIconClass:function(){return"el-icon-play-circle"},getBlockIcon:function(){return'\x3cspan class\x3d"'+this.icon+'"\x3e\x3c/span\x3e '},canEdit:function(){return!0},onChangeField:function(a,b,e){"auto"==a&&(1==b?this.scope.loopBlock(this):this._loop&&this.reset());"enabled"==a&&(0==b?this.reset():this.auto&&this.scope.loopBlock(this));"interval"==a&&this.auto&&this.scope.loopBlock(this);this.inherited(arguments)}})})},
"xcf/factory/Blocks":function(){define(["dojo/_base/lang","xblox/factory/Blocks","xcf/model/Command","xblox/model/functions/CallBlock"],function(p,m,l,k){m._getCommandBlocks=function(g,e,a,b){var f=[];f.push({name:"Commands",iconClass:"el-icon-random",items:[{name:"Call Command",owner:e,iconClass:"el-icon-video",proto:k,target:a,ctrArgs:{scope:g,group:b,condition:""}},{name:"New Command",owner:e,iconClass:"el-icon-video",proto:l,target:a,ctrArgs:{scope:g,group:b,condition:"",name:"No-Title"}}]});
return f};return m})},"nxappmain/main_server":function(){require("dojo/node!readline nxapp/Commons xide/types nxapp/utils/TCPUtils nxappmain/nxAppBase nxapp/manager/DeviceServerContext nxapp/client/WebSocket xlog/Server dojo/node!winston dojo/node!path dojo/node!fs dojo/node!util dojo/node!vm nxapp/manager/MQTTManager nxapp/Commons nxapp/utils/FileUtils nxapp/utils/_console".split(" "),function(p,m,l,k,g,e,a,b,f,h,c,d,n,q,r,v,y){m={filename:"all.log",dirname:dojoConfig.logRoot,json:!0};var x=new b({});
x.start({fileLogger:m,console:null});var t=new g({commander:null}),u,w,C;t.init();var A=t.profile;g=t.commander;if(g.file){console.log("run js file : "+g.file);h=h.resolve(g.file);if(c.existsSync(h)){e=new n.createContext({require:require.nodeRequire,commander:g,console:console,process:process,setTimeout:setTimeout});v=v.readFile(h);(new n.Script(v)).runInContext(e);return}console.error("file specified but doesnt exists "+g.file)}g.port&&(A.socket_server.port=g.port);g.host&&(A.socket_server.host=
g.host);var D=new e;D.constructManagers();D.initManagers(A);D.logManager=x;var E=new q({ctx:D,profile:A});E.init(A);D.connectionManager.mqttManager=E;D.mqttManager=E;n=A.common.createSocketServer;var B=null,z=function(){var b=new a;b.init({options:{host:"http://"+t.profile.socket_server.host,port:t.profile.socket_server.port,debug:t.profile.debug}});b.connect();b.onSignal(l.SIGNAL_RESPONSE,function(a){A.common.stdout&&process.stdout.write(a+"\n");t.commander.oneshot&&t.commander.command&&process.exit()});
return b};if(t.commander.info)console.log(JSON.stringify({host:"http://"+t.profile.socket_server.host,port:t.profile.socket_server.port})),process.exit();else{var F=function(){t.commander.host&&(u=t.commander.host);t.commander.port&&(w=parseInt(t.commander.port));t.commander.protocol&&(C=t.commander.protocol);if(t.commander.driver){console.error("run in driver mode");var a=z(),b={driver:"xcf/driver/SubTest",host:"192.168.1.20",port:23,protocol:"tcp"},c=l.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER;b.manager_command=
l.SOCKET_SERVER_COMMANDS.START_DRIVER;c=l.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER;a.emit(c,b)}else if(t.commander.send){console.error("sending command");console.error("  create web socket client to control server : http://"+t.profile.socket_server.host+":"+t.profile.socket_server.port);var a=z(),d=function(b){if(null!==a&&null!=b){var c={command:b,host:u,port:w,protocol:C},d=l.SOCKET_SERVER_COMMANDS.SIGNAL_DEVICE;"startDriver"==b?(c.manager_command=l.SOCKET_SERVER_COMMANDS.MANAGER_START_DRIVER,d=l.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER):
"status"==b?(c.manager_command=l.SOCKET_SERVER_COMMANDS.MANAGER_STATUS,d=l.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER):"closeall"==b?(c.manager_command=l.SOCKET_SERVER_COMMANDS.MANAGER_CLOSE_ALL,d=l.SOCKET_SERVER_COMMANDS.SIGNAL_MANAGER):c.device_command=l.SOCKET_SERVER_COMMANDS.DEVICE_SEND;a.emit(d,c)}},b=function(b){if(null!==a&&null!=b)if(b.indexOf&&-1!=b.indexOf(";")){b=b.split(";");for(var c=0;c<b.length;c++)d(b[c])}else d(b)};p.createInterface({input:process.stdin,output:process.stdout}).on("line",
function(a){null!=a&&0<a.length&&(console.log("sending stdin : "+a),d(a))});"string"==typeof t.commander.command&&b(t.commander.command);console.error("Send command. ^C to close connection and quit")}};if(n)k.checkPort(A.socket_server.port,A.socket_server.host,function(a,b,c,d){a=!1;"closed"==b?(console.error("have no device server yet, creating a new one!"),B=k.createDeviceServer(A,D),D.deviceServer=B,D.logger=f,D.deviceServer.logger=f,D.logManager=x,B.mqttManager=E,console.log("start device server"),
D.onReady(),a=!0):"open"==b&&(a=!0);a&&F()});else try{F()}catch(I){console.error("app crash!")}}})},"nxapp/manager/MQTTManager":function(){define("dcl/dcl nxapp/manager/ManagerBase nxapp/utils/_LogMixin nxapp/types/Types dojo/node!mosca dojo/node!mqtt dojo/node!node-notifier dojo/node!colors".split(" "),function(p,m,l,k,g,e,a,b){return p([m,l],{declaredClass:"nxapp.manager.MQTTManager",options:null,profile:null,lastUpTime:null,mqttClients:null,publishTopic:function(a,b){var c={topic:a,payload:JSON.stringify(b),
qos:1};this.server.publish(c,function(){})},createMQTTClient2:function(a,b,c){var d=a+":"+b,g=e.connect("mqtt://localhost",{clean:!1,clientId:d}),l=this.ctx;console.log("create mqtt - client for "+d);g.on("connect",function(){console.log("on connected local mqtt client for "+d);g.subscribe("192.168.1.20/23/Variable/PowerState",{qos:2})});g.on("message",function(d,e){l.getDeviceServer().broadCastMessage(k.EVENTS.ON_MQTT_MESSAGE,{host:a,port:b,topic:d,message:e.toString(),mqtt:c})});return g},createMQTTClient:function(a,
b,c){a=a+":"+b;if(this.mqttClients[a])return this.mqttClients[a];if(!this.mqttClients[a])return b=e.connect("mqtt://localhost",{clean:!1,clientId:a}),b.on("connect",function(){}),this.mqttClients[a]=b},onConnectedToDevice:function(a,b,c){},onWakeup:function(){this.lastUpTime=(new Date).getTime();for(var a=0;a<this.pool.length;a++){var b=this.pool[a];b.socket&&b.socket.close&&b.socket.close();b.socket&&b.socket._socket&&b.socket._socket.close&&b.socket._socket.close()}this.pool=[]},init:function(e){this.profile=
e;this.lastUpTime=(new Date).getTime();this.mqttClients={};e=new g.Server({port:1883,backend:{type:"mongo",url:"mongodb://localhost:27017/mqtt",pubsubCollection:"xcf",mongo:{}},persistence:{factory:g.persistence.Mongo,url:"mongodb://localhost:27017/mqtt"}});e.on("ready",function(){try{a.notify({title:"Control-Freak",message:"All servers up and running, you can start now Control-Freak IDE",sound:!0,wait:!0,open:"file:///"},function(a,b){})}catch(e){}console.log(b.green("\n\r\t Mosca server up and running\n\r \t ***********   You can start Control Freak now  **************\n\r"))});
e.on("clientConnected",function(){});e.on("clientDisconnected",function(){});this.server=e},onTimeout:function(a){},onClose:function(a){this.removeConnection(a)},onDrain:function(a){},onError:function(a,b){},onData:function(a,b){this.showDebugMsg("protocol_messages");var c=this.connectionExists(a.host,a.port,a.protocol);c!=this.poolNotFound&&this.callFeedBack(c,b)},onConnect:function(a,b,c){this.log("Connected to "+a+":"+b+" via "+c,"protocol_messages");a={device:{host:a,port:b,protocol:c}};this.ctx.getDeviceServer().broadCastMessage(k.EVENTS.ON_DEVICE_CONNECTED,
a)},onHandle:function(a,b){this.showDebugMsg("protocol_messages")}})})}}});define("nxappmain/serverbuild",[],1);
//# sourceMappingURL=serverbuild.js.map